



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.2.0">
    
    
      
        <title>Kubernetes - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.750b69bd.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#quick-reference" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              Kubernetes
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../apt/" title="APT" class="md-nav__link">
      APT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../books/" title="Books" class="md-nav__link">
      Books
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../code-review/" title="Code review" class="md-nav__link">
      Code review
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases-sqlserver/" title="Databases - SqlServer" class="md-nav__link">
      Databases - SqlServer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dfir/" title="DFIR" class="md-nav__link">
      DFIR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../iam-kerberos/" title="IAM - Kerberos" class="md-nav__link">
      IAM - Kerberos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../non-security/" title="Z Non Security" class="md-nav__link">
      Z Non Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../osint/" title="OSINT" class="md-nav__link">
      OSINT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ports-and-protocols/" title="Ports and protocols" class="md-nav__link">
      Ports and protocols
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../practice/" title="Practice Environments" class="md-nav__link">
      Practice Environments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../red-blue-team/" title="Red blue team" class="md-nav__link">
      Red blue team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../rf-and-sdr/" title="RF and SDR" class="md-nav__link">
      RF and SDR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../social-engineering/" title="Social engineering" class="md-nav__link">
      Social engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../wifi/" title="WiFi & Wireless" class="md-nav__link">
      WiFi & Wireless
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36" type="checkbox" id="nav-36">
    
    <label class="md-nav__link" for="nav-36">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-36">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/cissp/" title="CISSP" class="md-nav__link">
      CISSP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/osce/" title="OSCE" class="md-nav__link">
      OSCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oswe/" title="Oswe" class="md-nav__link">
      Oswe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4" type="checkbox" id="nav-36-4">
    
    <label class="md-nav__link" for="nav-36-4">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-36-4">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4-9" type="checkbox" id="nav-36-4-9">
    
    <label class="md-nav__link" for="nav-36-4-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-36-4-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4-9-10" type="checkbox" id="nav-36-4-9-10">
    
    <label class="md-nav__link" for="nav-36-4-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-36-4-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-37" type="checkbox" id="nav-37">
    
    <label class="md-nav__link" for="nav-37">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-37">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/azuer-o360/" title="Azuer o360" class="md-nav__link">
      Azuer o360
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-38" type="checkbox" id="nav-38" checked>
    
    <label class="md-nav__link" for="nav-38">
      Devops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-38">
        Devops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CKAD/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../istio/" title="Istio" class="md-nav__link">
      Istio
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kubernetes
      </label>
    
    <a href="./" title="Kubernetes" class="md-nav__link md-nav__link--active">
      Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-reference" title="Quick Reference" class="md-nav__link">
    Quick Reference
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minikube" title="Minikube" class="md-nav__link">
    Minikube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubectl" title="Kubectl" class="md-nav__link">
    Kubectl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-management" title="Deployment Management" class="md-nav__link">
    Deployment Management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volumes" title="Volumes" class="md-nav__link">
    Volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kops" title="kops" class="md-nav__link">
    kops
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yamls" title="Yamls" class="md-nav__link">
    Yamls
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod" title="Pod" class="md-nav__link">
    Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replicaset" title="ReplicaSet" class="md-nav__link">
    ReplicaSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemonset" title="DaemonSet" class="md-nav__link">
    DaemonSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service" title="Service" class="md-nav__link">
    Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-and-volumemounts" title="Volume and VolumeMounts" class="md-nav__link">
    Volume and VolumeMounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistentvolumeclaims" title="PersistentVolumeClaims" class="md-nav__link">
    PersistentVolumeClaims
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storageclass-and-binding" title="StorageClass and Binding" class="md-nav__link">
    StorageClass and Binding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statefulset-set" title="StatefulSet Set" class="md-nav__link">
    StatefulSet Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac" title="RBAC" class="md-nav__link">
    RBAC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap" title="ConfigMap" class="md-nav__link">
    ConfigMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret" title="Secret" class="md-nav__link">
    Secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress" title="Ingress" class="md-nav__link">
    Ingress
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job" title="Job" class="md-nav__link">
    Job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjob" title="CronJob" class="md-nav__link">
    CronJob
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-deployments" title="Cloud Deployments" class="md-nav__link">
    Cloud Deployments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" title="Notes" class="md-nav__link">
    Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" title="Tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-validations" title="Security Validations" class="md-nav__link">
    Security Validations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-api" title="Cluster API" class="md-nav__link">
    Cluster API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-references" title="New References" class="md-nav__link">
    New References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teraform" title="Teraform" class="md-nav__link">
    Teraform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" title="Networking" class="md-nav__link">
    Networking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-39" type="checkbox" id="nav-39">
    
    <label class="md-nav__link" for="nav-39">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-39">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/powershell/" title="Powershell" class="md-nav__link">
      Powershell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/windows-privilege-escalation/" title="Windows Privilege Escalation" class="md-nav__link">
      Windows Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-reference" title="Quick Reference" class="md-nav__link">
    Quick Reference
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minikube" title="Minikube" class="md-nav__link">
    Minikube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubectl" title="Kubectl" class="md-nav__link">
    Kubectl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-management" title="Deployment Management" class="md-nav__link">
    Deployment Management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volumes" title="Volumes" class="md-nav__link">
    Volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kops" title="kops" class="md-nav__link">
    kops
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yamls" title="Yamls" class="md-nav__link">
    Yamls
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod" title="Pod" class="md-nav__link">
    Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replicaset" title="ReplicaSet" class="md-nav__link">
    ReplicaSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daemonset" title="DaemonSet" class="md-nav__link">
    DaemonSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service" title="Service" class="md-nav__link">
    Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-and-volumemounts" title="Volume and VolumeMounts" class="md-nav__link">
    Volume and VolumeMounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistentvolumeclaims" title="PersistentVolumeClaims" class="md-nav__link">
    PersistentVolumeClaims
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storageclass-and-binding" title="StorageClass and Binding" class="md-nav__link">
    StorageClass and Binding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statefulset-set" title="StatefulSet Set" class="md-nav__link">
    StatefulSet Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbac" title="RBAC" class="md-nav__link">
    RBAC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap" title="ConfigMap" class="md-nav__link">
    ConfigMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret" title="Secret" class="md-nav__link">
    Secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress" title="Ingress" class="md-nav__link">
    Ingress
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job" title="Job" class="md-nav__link">
    Job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjob" title="CronJob" class="md-nav__link">
    CronJob
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-deployments" title="Cloud Deployments" class="md-nav__link">
    Cloud Deployments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" title="Notes" class="md-nav__link">
    Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" title="Tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-validations" title="Security Validations" class="md-nav__link">
    Security Validations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-api" title="Cluster API" class="md-nav__link">
    Cluster API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-references" title="New References" class="md-nav__link">
    New References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teraform" title="Teraform" class="md-nav__link">
    Teraform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" title="Networking" class="md-nav__link">
    Networking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Kubernetes</h1>
                
                <h2 id="quick-reference">Quick Reference<a class="headerlink" href="#quick-reference" title="Permanent link">&para;</a></h2>
<h3 id="minikube">Minikube<a class="headerlink" href="#minikube" title="Permanent link">&para;</a></h3>
<ul>
<li>starts minikube
    <div class="highlight"><pre><span></span><code>minikube start
</code></pre></div></li>
<li>stops the minikube virtual machine
    <div class="highlight"><pre><span></span><code>minikube stop
</code></pre></div></li>
<li>completely wipe away the minikube image. Also you can delete all files in <home>/.minikube and <home>/.kube.
    <div class="highlight"><pre><span></span><code>minikube delete
</code></pre></div></li>
<li>find out the required environment variables to connect to the docker daemon running in minikube
    <div class="highlight"><pre><span></span><code>minikube env
</code></pre></div></li>
<li>find out the ip address of minikube. Needed for browser access.
    <div class="highlight"><pre><span></span><code>minikube ip
</code></pre></div></li>
</ul>
<h3 id="kubectl">Kubectl<a class="headerlink" href="#kubectl" title="Permanent link">&para;</a></h3>
<ul>
<li>get help
    <div class="highlight"><pre><span></span><code>kubectl explain pods
</code></pre></div></li>
<li>list all namespaces
    <div class="highlight"><pre><span></span><code>kubectl get ns
</code></pre></div></li>
<li>list all objects that you’ve created. Pods at first, later, ReplicaSets, Deployments and Services
    <div class="highlight"><pre><span></span><code>kubectl get all
</code></pre></div></li>
<li>either creates or updates resources depending on the contents of the yaml file
    <div class="highlight"><pre><span></span><code>- kubectl apply –f &lt;yaml file&gt;
</code></pre></div></li>
<li>apply all yaml files found in the current directory 
    <div class="highlight"><pre><span></span><code>kubectl apply –f .
</code></pre></div></li>
<li>gives full information about the specified pod
    <div class="highlight"><pre><span></span><code>kubectl describe pod &lt;name of pod&gt;
</code></pre></div></li>
<li>gives full information about the specified service
    <div class="highlight"><pre><span></span><code>kubectl describe svc &lt;name of pod&gt;
</code></pre></div></li>
<li>view pod logs
    <div class="highlight"><pre><span></span><code>kubectl logs {pod-name}
</code></pre></div></li>
<li>Events
    <div class="highlight"><pre><span></span><code>kubectl get events --sort-by=.metadata.creationTimestamp
</code></pre></div></li>
<li>execute the specified command in the pod’s container. Doesn’t work well in Cygwin.
    <div class="highlight"><pre><span></span><code>kubectl exec –it &lt;pod name&gt; &lt;command&gt;
</code></pre></div></li>
<li>get all pods or services. Later in the course, replicasets and deployments.
    <div class="highlight"><pre><span></span><code>kubectl get (pod | po | service | svc | rs | replicaset | deployment | deploy)
</code></pre></div></li>
<li>get all pods and their labels
    <div class="highlight"><pre><span></span><code>kubectl get po --show-labels
</code></pre></div></li>
<li>get all pods matching the specified name:value pair
    <div class="highlight"><pre><span></span><code>kubectl get po --show-labels -l {name}={value}
</code></pre></div></li>
<li>delete the named pod. Can also delete svc, rs, deploy
    <div class="highlight"><pre><span></span><code>kubectl delete po &lt;pod name&gt;
</code></pre></div></li>
<li>delete all pods (also svc, rs, deploy)
    <div class="highlight"><pre><span></span><code>kubectl delete po --all
</code></pre></div></li>
<li>Monitor changes: <code>--watch</code></li>
<li>Diff: <code>kubectl diff -f example.yaml</code></li>
<li>CPU/Memory usage: <code>kubectl top pods</code></li>
</ul>
<h3 id="deployment-management">Deployment Management<a class="headerlink" href="#deployment-management" title="Permanent link">&para;</a></h3>
<ul>
<li>create: <code>kubectl create deployment example --image=&lt;image-name&gt;</code></li>
<li>expose: <code>kubectl expose deployment example --type=LoadBalancer</code></li>
<li>scale: <code>kubectl scale deployment example --replicas=3</code></li>
<li>get the status of the named deployment
    <div class="highlight"><pre><span></span><code>kubectl rollout status deploy &lt;name of deployment&gt;
</code></pre></div></li>
<li>get the previous versions of the deployment
    <div class="highlight"><pre><span></span><code>kubectl rollout history deploy &lt;name of deployment&gt;
</code></pre></div></li>
<li>go back one version in the deployment. Also optionally --to-revision=\&lt;revision_number> We recommend this is used only in stressful emergency situations! Your YAML will now be out of date with the live deployment! 
    <div class="highlight"><pre><span></span><code>kubectl rollout undo deploy &lt;name of deployment&gt;
</code></pre></div></li>
<li>Manual rollouts:
    <div class="highlight"><pre><span></span><code>kubectl rollout history deployment hello-world-rest-api
kubectl set image deployment hello-world-rest-api hello-world-rest-api=in28min/hello-world-rest-api:0.0.3.RELEASE --record=true
kubectl rollout undo deployment hello-world-rest-api --to-revision=1
</code></pre></div></li>
</ul>
<h3 id="volumes">Volumes<a class="headerlink" href="#volumes" title="Permanent link">&para;</a></h3>
<ul>
<li>list PersistentVolumeClaims
    <div class="highlight"><pre><span></span><code>kubectl get pvc
</code></pre></div></li>
</ul>
<h3 id="kops">kops<a class="headerlink" href="#kops" title="Permanent link">&para;</a></h3>
<ul>
<li>Create cluster
    <div class="highlight"><pre><span></span><code>kops create cluster --zone eu-west-2a,eu-west-2b ${NAME}
</code></pre></div></li>
<li>Edit instance-group configuration
    <div class="highlight"><pre><span></span><code>kops edit ig
</code></pre></div></li>
<li>Update cluster
    <div class="highlight"><pre><span></span><code>kops update cluster ${NAME} --yes
</code></pre></div></li>
<li>Validate cluster
    <div class="highlight"><pre><span></span><code>kops validate cluster
</code></pre></div></li>
<li>Delete cluster
    <div class="highlight"><pre><span></span><code>kops delete cluster --name ${NAME} --yes
</code></pre></div></li>
</ul>
<div class="highlight"><pre><span></span><code>    kubectl create deployment hello-world-rest-api --image=in28min/hello-world-rest-api:0.0.1.RELEASE
    kubectl expose deployment hello-world-rest-api --type=LoadBalancer --port=8080
    kubectl scale deployment hello-world-rest-api --replicas=3
    kubectl delete pod hello-world-rest-api-58ff5dd898-62l9d
    kubectl autoscale deployment hello-world-rest-api --max=10 --cpu-percent=70
    kubectl edit deployment hello-world-rest-api #minReadySeconds: 15
    kubectl set image deployment hello-world-rest-api hello-world-rest-api=in28min/hello-world-rest-api:0.0.2.RELEASE

    gcloud container clusters get-credentials in28minutes-cluster --zone us-central1-a --project solid-course-258105
    kubectl create deployment hello-world-rest-api --image=in28min/hello-world-rest-api:0.0.1.RELEASE
    kubectl expose deployment hello-world-rest-api --type=LoadBalancer --port=8080
    kubectl set image deployment hello-world-rest-api hello-world-rest-api=DUMMY_IMAGE:TEST
    kubectl get events --sort-by=.metadata.creationTimestamp
    kubectl set image deployment hello-world-rest-api hello-world-rest-api=in28min/hello-world-rest-api:0.0.2.RELEASE
    kubectl get events --sort-by=.metadata.creationTimestamp
    kubectl get componentstatuses
    kubectl get pods --all-namespaces

    kubectl get events
    kubectl get pods
    kubectl get replicaset
    kubectl get deployment
    kubectl get service

    kubectl get pods -o wide

    kubectl explain pods
    kubectl get pods -o wide

    kubectl describe pod hello-world-rest-api-58ff5dd898-9trh2

    kubectl get replicasets
    kubectl get replicaset

    kubectl scale deployment hello-world-rest-api --replicas=3
    kubectl get pods
    kubectl get replicaset
    kubectl get events
    kubectl get events --sort.by=.metadata.creationTimestamp

    kubectl get rs
    kubectl get rs -o wide
    kubectl set image deployment hello-world-rest-api hello-world-rest-api=DUMMY_IMAGE:TEST
    kubectl get rs -o wide
    kubectl get pods
    kubectl describe pod hello-world-rest-api-85995ddd5c-msjsm
    kubectl get events --sort-by=.metadata.creationTimestamp

    kubectl set image deployment hello-world-rest-api hello-world-rest-api=in28min/hello-world-rest-api:0.0.2.RELEASE
    kubectl get events --sort-by=.metadata.creationTimestamp
    kubectl get pods -o wide
    kubectl delete pod hello-world-rest-api-67c79fd44f-n6c7l
    kubectl get pods -o wide
    kubectl delete pod hello-world-rest-api-67c79fd44f-8bhdt

    kubectl get componentstatuses
    kubectl get pods --all-namespaces

    gcloud auth login
    kubectl version
    gcloud container clusters get-credentials in28minutes-cluster --zone us-central1-a --project solid-course-258105

    kubectl logs hello-world-rest-api-58ff5dd898-6ctr2
    kubectl logs -f hello-world-rest-api-58ff5dd898-6ctr2

    kubectl get deployment hello-world-rest-api -o yaml
    kubectl get deployment hello-world-rest-api -o yaml &gt; deployment.yaml
    kubectl get service hello-world-rest-api -o yaml &gt; service.yaml
    kubectl apply -f deployment.yaml
    kubectl get all -o wide
    kubectl delete all -l app=hello-world-rest-api

    kubectl get svc --watch
    kubectl diff -f deployment.yaml
    kubectl delete deployment hello-world-rest-api
    kubectl get all -o wide
    kubectl delete replicaset.apps/hello-world-rest-api-797dd4b5dc

    kubectl get pods --all-namespaces
    kubectl get pods --all-namespaces -l app=hello-world-rest-api
    kubectl get services --all-namespaces
    kubectl get services --all-namespaces --sort-by=.spec.type
    kubectl get services --all-namespaces --sort-by=.metadata.name
    kubectl cluster-info
    kubectl cluster-info dump
    kubectl top node
    kubectl top pod
    kubectl get services
    kubectl get svc
    kubectl get ev
    kubectl get rs
    kubectl get ns
    kubectl get nodes
    kubectl get no
    kubectl get pods
    kubectl get po

    kubectl delete all -l app=hello-world-rest-api
    kubectl get all

    kubectl apply -f deployment.yaml 
    kubectl apply -f ../currency-conversion/deployment.yaml 
</code></pre></div>
<h2 id="yamls">Yamls<a class="headerlink" href="#yamls" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span>
<span class="nt">kind</span><span class="p">:</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">spec</span><span class="p">:</span>
</code></pre></div>
<h3 id="pod">Pod<a class="headerlink" href="#pod" title="Permanent link">&para;</a></h3>
<ul>
<li>The basic execution unit of a Kubernetes application--the smallest and simplest unit in the Kubernetes object model that you create or deploy. </li>
<li>A Pod represents processes running on your cluster.</li>
<li>Init container<ul>
<li>Run before the app containers are started.</li>
<li>Init containers always run to completion.</li>
<li>Each init container must complete successfully before the next one starts.</li>
<li>If a Pod's init container fails, Kubernetes repeatedly restarts the Pod until the init container succeeds. However, if the Pod has a restartPolicy of Never, Kubernetes does not restart the Pod.</li>
</ul>
</li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/">https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#pod-v1-core">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#pod-v1-core</a></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod-example</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu:trusty</span>
    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;echo&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;Hello</span><span class="nv"> </span><span class="s">World&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<h3 id="replicaset">ReplicaSet<a class="headerlink" href="#replicaset" title="Permanent link">&para;</a></h3>
<ul>
<li>Maintain a stable set of replica Pods running at any given time. </li>
<li>As such, it is often used to guarantee the availability of a specified number of identical Pods</li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#replicaset-v1-apps">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#replicaset-v1-apps</a></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ReplicaSet</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="c1"># Unique key of the ReplicaSet instance</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">replicaset-example</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="c1"># 3 Pods should exist at all times.</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="c1"># Run the nginx image</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.14</span>
</code></pre></div>
<h3 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>Deployment provides declarative updates for Pods and ReplicaSets.</li>
<li>You describe a desired state in a Deployment, and the Deployment Controller changes the actual state to the desired state at a controlled rate.</li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">https://kubernetes.io/docs/concepts/workloads/controllers/deployment/</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#deployment-v1-apps">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#deployment-v1-apps</a></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="c1"># Unique key of the Deployment instance</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deployment-example</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="c1"># 3 Pods should exist at all times.</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="c1"># Apply this label to pods and default</span>
        <span class="c1"># the Deployment label selector to this value</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class="c1"># Run this image</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.14</span>
</code></pre></div>
<h3 id="daemonset">DaemonSet<a class="headerlink" href="#daemonset" title="Permanent link">&para;</a></h3>
<ul>
<li>A DaemonSet ensures that all (or some) Nodes run a copy of a Pod. </li>
<li>As nodes are added to the cluster, Pods are added to them. As nodes are removed from the cluster, those Pods are garbage collected.<ul>
<li>running a cluster storage daemon on every node</li>
<li>running a logs collection daemon on every node</li>
<li>running a node monitoring daemon on every node</li>
</ul>
</li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#daemonset-v1-apps">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#daemonset-v1-apps</a></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DaemonSet</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="c1"># Unique key of the DaemonSet instance</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daemonset-example</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daemonset-example</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daemonset-example</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="c1"># This container is run once on each Node in the cluster</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">daemonset-example</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu:trusty</span>
        <span class="nt">command</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
        <span class="nt">args</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-c</span>
        <span class="c1"># This script is run through `sh -c &lt;script&gt;`</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">&gt;-</span>
          <span class="no">while [ true ]; do</span>
          <span class="no">echo &quot;DaemonSet running on $(hostname)&quot; ;</span>
          <span class="no">sleep 10 ;</span>
          <span class="no">done</span>
</code></pre></div>
<h3 id="service">Service<a class="headerlink" href="#service" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#service-v1-core">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#service-v1-core</a></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="c1"># Unique key of the Service instance</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">service-example</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">ports</span><span class="p">:</span>
    <span class="c1"># Accept traffic sent to port 80</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="nt">targetPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="c1"># Loadbalance traffic across Pods matching</span>
    <span class="c1"># this label selector</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="c1"># Create an HA proxy in the cloud provider</span>
  <span class="c1"># with an External IP address - *Only supported</span>
  <span class="c1"># by some cloud providers*</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</code></pre></div>
<h3 id="volume-and-volumemounts">Volume and VolumeMounts<a class="headerlink" href="#volume-and-volumemounts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pv-recycler</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">restartPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Never</span>
  <span class="nt">volumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vol</span>
    <span class="nt">hostPath</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/any/path/it/will/be/replaced</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pv-recycler</span>
    <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;k8s.gcr.io/busybox&quot;</span>
    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;test</span><span class="nv"> </span><span class="s">-e</span><span class="nv"> </span><span class="s">/scrub</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">rm</span><span class="nv"> </span><span class="s">-rf</span><span class="nv"> </span><span class="s">/scrub/..?*</span><span class="nv"> </span><span class="s">/scrub/.[!.]*</span><span class="nv"> </span><span class="s">/scrub/*</span><span class="nv">  </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">-z</span><span class="nv"> </span><span class="s">\&quot;$(ls</span><span class="nv"> </span><span class="s">-A</span><span class="nv"> </span><span class="s">/scrub)\&quot;</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">1&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">volumeMounts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vol</span>
      <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/scrub</span>
</code></pre></div>
<h3 id="persistentvolumeclaims">PersistentVolumeClaims<a class="headerlink" href="#persistentvolumeclaims" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ssd-local-storage</span>
  <span class="c1"># Find matching storage class</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
    <span class="c1"># Find matching access mode</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8Gi</span>
      <span class="c1"># Find 8Gi of storage </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-local-storage</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-ssd-local-storage</span>
  <span class="nt">capacity</span><span class="p">:</span>
    <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8Gi</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">hostPath</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;/mnt/somedir&quot;</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypod</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfrontend</span>
      <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
      <span class="nt">volumeMounts</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="s">&quot;/var/www/html&quot;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypd</span>
  <span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypd</span>
      <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
        <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-pvc</span>
</code></pre></div>
<h3 id="storageclass-and-binding">StorageClass and Binding<a class="headerlink" href="#storageclass-and-binding" title="Permanent link">&para;</a></h3>
<ul>
<li>Change reclaim policy as required </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># What do want?</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo-pvc</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-ssd</span>
  <span class="nt">accessModes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
  <span class="nt">resources</span><span class="p">:</span>
    <span class="nt">requests</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7Gi</span>
<span class="nn">---</span>
<span class="c1"># How do we want it implemented</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-ssd</span>
<span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/aws-ebs</span>
<span class="nt">parameters</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gp2</span>
</code></pre></div>
<h3 id="statefulset-set">StatefulSet Set<a class="headerlink" href="#statefulset-set" title="Permanent link">&para;</a></h3>
<ul>
<li>StatefulSet is the workload API object used to manage stateful applications.<ul>
<li>Stable, unique network identifiers.</li>
<li>Stable, persistent storage.</li>
<li>Ordered, graceful deployment and scaling.</li>
<li>Ordered, automated rolling updates.</li>
</ul>
</li>
<li>Like a Deployment, a StatefulSet manages Pods that are based on an identical container spec. </li>
<li>Unlike a Deployment, a StatefulSet maintains a sticky identity for each of their Pods.</li>
<li>These pods are created from the same spec, but are not interchangeable: <ul>
<li>Each has a persistent identifier that it maintains across any rescheduling.</li>
</ul>
</li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/</a></li>
</ul>
<h3 id="rbac">RBAC<a class="headerlink" href="#rbac" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">https://kubernetes.io/docs/reference/access-authn-authz/rbac/</a></li>
<li>Kind - <code>Role</code> -&gt; <code>ClusterRole</code>to grant cluster-wide permissions.
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod-reader</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span> <span class="c1"># &quot;&quot; indicates the core API group</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="c1"># This role binding allows &quot;jane&quot; to read pods in the &quot;default&quot; namespace.</span>
<span class="c1"># You need to already have a Role named &quot;pod-reader&quot; in that namespace.</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">read-pods</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="c1"># You can specify more than one &quot;subject&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jane</span> <span class="c1"># &quot;name&quot; is case sensitive</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="c1"># &quot;roleRef&quot; specifies the binding to a Role / ClusterRole</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span> <span class="c1">#this must be Role or ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pod-reader</span> <span class="c1"># this must match the name of the Role or ClusterRole you wish to bind to</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div></li>
</ul>
<h3 id="configmap">ConfigMap<a class="headerlink" href="#configmap" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">creationTimestamp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2016-02-18T18:52:05Z</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">game-config</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">resourceVersion</span><span class="p">:</span> <span class="s">&quot;516&quot;</span>
  <span class="nt">uid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">b4952dc3-d670-11e5-8cd0-68f728db1985</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">game.properties</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">enemies=aliens</span>
    <span class="no">lives=3</span>
    <span class="no">enemies.cheat=true</span>
    <span class="no">enemies.cheat.level=noGoodRotten</span>
    <span class="no">secret.code.passphrase=UUDDLRLRBABAS</span>
    <span class="no">secret.code.allowed=true</span>
    <span class="no">secret.code.lives=30</span>
  <span class="nt">ui.properties</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">color.good=purple</span>
    <span class="no">color.bad=yellow</span>
    <span class="no">allow.textmode=true</span>
    <span class="no">how.nice.to.look=fairlyNice</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>kubectl create configmap game-config-2 --from-file=configure-pod-container/configmap/game.properties
</code></pre></div></p>
<h3 id="secret">Secret<a class="headerlink" href="#secret" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysecret</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">YWRtaW4=</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MWYyZDFlMmU2N2Rm</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysecret</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class="nt">stringData</span><span class="p">:</span>
  <span class="nt">config.yaml</span><span class="p">:</span> <span class="p p-Indicator">|-</span>
    <span class="no">apiUrl: &quot;https://my.api.com/api/v1&quot;</span>
    <span class="no">username: {{username}}</span>
    <span class="no">password: {{password}}</span>
</code></pre></div>
<h3 id="ingress">Ingress<a class="headerlink" href="#ingress" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-ingress</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">nginx.ingress.kubernetes.io/rewrite-target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">rules</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">domain1.com</span>
    <span class="nt">http</span><span class="p">:</span>
      <span class="nt">paths</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/testpath</span>
        <span class="nt">pathType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Prefix</span>
        <span class="nt">backend</span><span class="p">:</span>
          <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
          <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">domain2.com</span>
</code></pre></div>
<h3 id="job">Job<a class="headerlink" href="#job" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Job</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pi</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pi</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">perl</span>
        <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;perl&quot;</span><span class="p p-Indicator">,</span>  <span class="s">&quot;-Mbignum=bpi&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;-wle&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;print</span><span class="nv"> </span><span class="s">bpi(2000)&quot;</span><span class="p p-Indicator">]</span>
      <span class="nt">restartPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Never</span>
  <span class="nt">backoffLimit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
</code></pre></div>
<h3 id="cronjob">CronJob<a class="headerlink" href="#cronjob" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">batch/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hello</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">schedule</span><span class="p">:</span> <span class="s">&quot;*/1</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span>
  <span class="nt">jobTemplate</span><span class="p">:</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">template</span><span class="p">:</span>
        <span class="nt">spec</span><span class="p">:</span>
          <span class="nt">containers</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hello</span>
            <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">busybox</span>
            <span class="nt">args</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-c</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">date; echo Hello from the Kubernetes cluster</span>
          <span class="nt">restartPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
</code></pre></div>
<h2 id="cloud-deployments">Cloud Deployments<a class="headerlink" href="#cloud-deployments" title="Permanent link">&para;</a></h2>
<p><strong>Kops</strong></p>
<ul>
<li><a href="https://kops.sigs.k8s.io/">https://kops.sigs.k8s.io/</a></li>
<li><a href="https://kops.sigs.k8s.io/getting_started/commands/">https://kops.sigs.k8s.io/getting_started/commands/</a></li>
</ul>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h2>
<ul>
<li>bretfisher Courses - Kubernetes Mastery: Hands-On Lessons From A Docker Captain: <a href="https://www.bretfisher.com/courses/">https://www.bretfisher.com/courses/</a></li>
<li>Threat matrix for Kubernetes - <a href="https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/">https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/</a></li>
<li>Pod Security Policies: <a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/">https://kubernetes.io/docs/concepts/policy/pod-security-policy/</a></li>
<li><a href="https://www.jaegertracing.io/docs/1.18/">https://www.jaegertracing.io/docs/1.18/</a></li>
</ul>
<p><img alt="" src="../_assets/2020-05-13-21-52-12.png" /></p>
<ul>
<li>Stay current in k8s</li>
<li>Harden nodes</li>
<li>Restrict network via RBAC</li>
<li>Use namespaces and network policies</li>
<li>Slim down images</li>
<li>Logs - k8s audit / k8s rbac audit logs / </li>
</ul>
<ul>
<li>Follows single responsibility concept</li>
<li>Cluster<ul>
<li>Master Node - Manage Cluster<ul>
<li>API Server (<code>kube-apiserver</code>)</li>
<li>Distributed Database (<code>etcd</code>)</li>
<li>Scheduler  (<code>kube-scheduler</code>)</li>
<li>Controller Manager (<code>kube-controller-manager</code>)</li>
</ul>
</li>
<li>Worker Nodes - Run Applications <ul>
<li>Node Agent (<code>kubelet</code>)<ul>
<li>Interacts with <code>kube-apiserver</code></li>
</ul>
</li>
<li>Networking Component (<code>kube-proxy</code>)</li>
<li>Container Runtime (CRI-OCI/docker/rkt)</li>
<li>PODS</li>
</ul>
</li>
</ul>
</li>
<li>Service<ul>
<li>Pods are not visible outside k8s cluster</li>
<li>K8s service is a long running object with IP address and stable fixed port usable to expose Pods out of k8s cluster</li>
<li>Pod can have "Label" (key value pairs)</li>
<li>Service can have "Selector" (key value pairs)</li>
<li>Service will look for any matching key-value pairs when binding a service to a pod (selector / label)</li>
<li>Service Types:<ul>
<li>NodePort <ul>
<li>Expose a port through the node </li>
<li>Port needs to be greater than 30,000</li>
<li>Configure <code>port</code> and <code>nodeport</code> </li>
</ul>
</li>
<li>ClusterIP <ul>
<li>Internal service / not exposed to external traffic but exposed to internal nodes</li>
</ul>
</li>
<li>LoadBalancer</li>
</ul>
</li>
</ul>
</li>
<li>Pod may die for many reasons:<ul>
<li>If pod take too many resources</li>
<li>If node failed (all pods in that node die)</li>
</ul>
</li>
<li>ReplicaSets <ul>
<li>Add replica count into <code>pod definition</code></li>
<li>Change kind to <code>ReplicaSet</code></li>
<li>Nest pod definition in <code>template</code>  <code>spec</code> attribute</li>
<li>Remove <code>pod names</code></li>
<li>Add <code>selector</code> block (similar to <code>services</code>)</li>
</ul>
</li>
<li>Deployment <ul>
<li>Automatic rolling update with rollbacks</li>
</ul>
</li>
<li>Networking <ul>
<li>Service Discovery<ul>
<li>Same Pod - can be accessed via <code>localhost</code></li>
<li>Kube-dns - Resolve service name to IP address</li>
</ul>
</li>
<li>Namespaces <ul>
<li>Partitioning resources into separate areas</li>
<li><code>kubectl get ns</code> get list of namespaces </li>
<li><code>kubectl get all -n kube-system</code> list resources from a namespace</li>
</ul>
</li>
<li><code>FQDN</code> -&gt; <code>database</code> -&gt; <code>database.mynamespace</code> -&gt; <code>database.mynamespace.svc.cluster.local</code> (last part is appended by DNS)<ul>
<li>Check <code>/etc/resolve.conf</code></li>
</ul>
</li>
</ul>
</li>
<li>Expand memory:<ul>
<li><code>minikube stop</code></li>
<li><code>minikube delete</code></li>
<li><code>rm -rf ~/.kube</code> and <code>rm -rf ~/.minikube</code></li>
<li><code>minikube start --memory 4096</code></li>
</ul>
</li>
<li>Microservices <ul>
<li>changing one part is hard without affecting other</li>
<li>complications of release coordination (big bang releases)</li>
<li>shared global databases (integration databases)</li>
<li>microservices as extreme form of modularity <ul>
<li>no direct communication in between</li>
<li>interfaces for communication </li>
<li>totally independent </li>
<li>limit to one specific area of business function</li>
<li>highly cohesive and loosely coupled</li>
<li>database is split </li>
<li>Domain-driven Design (Eric Evans) - Bounded Context</li>
<li><a href="https://github.com/DickChesterwood/k8s-fleetman">https://github.com/DickChesterwood/k8s-fleetman</a></li>
<li>need api gateway to expose backend functions (microservices)<ul>
<li>single point of entry to system</li>
<li><a href="https://microservices.io/patterns/apigateway.html">https://microservices.io/patterns/apigateway.html</a> </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Common Cluster Configurations: <a href="https://github.com/kubernetes/kubernetes/tree/master/cluster/addons">https://github.com/kubernetes/kubernetes/tree/master/cluster/addons</a></li>
<li>ElasticStack + (LogStash / FluentD)</li>
<li>Helm - Package management for k8s<ul>
<li><code>helm init</code></li>
<li><code>helm version</code></li>
<li><a href="https://github.com/helm/charts">https://github.com/helm/charts</a></li>
<li><code>helm repo update</code></li>
<li><code>helm install stable/mysql --set mysqlPassword=example --name my-mysql</code></li>
<li>Fix permissions:
  <div class="highlight"><pre><span></span><code>kubectl create serviceaccount --namespace kube-system tiller
kubectl create clusterrolebinding tiller-cluster-rule --clusterrole<span class="o">=</span>cluster-admin --serviceaccount<span class="o">=</span>kube-system:tiller
kubectl patch deploy --namespace kube-system tiller-deploy -p <span class="s1">&#39;{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}&#39;</span> 
</code></pre></div></li>
</ul>
</li>
<li>Prometheus / Grafana (UI)<ul>
<li><code>helm install stable/prometheus-operator --name my-monitoring --namespace monitoring</code></li>
<li>To see how this works <code>kops edit cluster --name prometheus-oper-prometheus</code> change type to <code>LoadBalancer</code> and access UI(9090/graph))</li>
<li>To get a full set of data from Prometheus:
  <div class="highlight"><pre><span></span><code>kops edit cluster --name <span class="si">${</span><span class="nv">NAME</span><span class="si">}</span>
kubelet:
  anonymousAuth: <span class="nb">false</span>    
  authenticationTokenWebhook: <span class="nb">true</span>    
  authorizationMode: Webhook
kops update cluster --yes
kops rolling-update cluster --yes 
</code></pre></div></li>
<li><code>prometheus-operator" failed: rpc error: code = Canceled</code> <a href="https://github.com/helm/helm/issues/6130">https://github.com/helm/helm/issues/6130</a><ul>
<li><code>helm del --purge monitoring</code></li>
<li><code>helm install --name monitoring --namespace monitoring stable/prometheus-operator --set prometheusOperator.createCustomResource=false</code></li>
</ul>
</li>
<li><code>AlertManager</code> over <code>/api</code><ul>
<li>Dead man's switch - Constantly alerting. Stops if an alert is fired (or Prometheus is down)</li>
</ul>
</li>
<li><code>Slack</code> integration <ul>
<li>Incoming web-hook</li>
<li>Listen for Dead man's switch</li>
<li><a href="https://prometheus.io/docs/alerting/latest/configuration/">https://prometheus.io/docs/alerting/latest/configuration/</a></li>
<li><code>alertmanager.yaml</code>
    <div class="highlight"><pre><span></span><code><span class="nt">global</span><span class="p">:</span>
<span class="nt">slack_api_url</span><span class="p">:</span> <span class="s">&#39;&lt;&lt;add</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">slack</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">here&gt;&gt;&#39;</span>
<span class="nt">route</span><span class="p">:</span>
<span class="nt">group_by</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;alertname&#39;</span><span class="p p-Indicator">]</span>
<span class="nt">group_wait</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="nt">group_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class="nt">repeat_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="nt">receiver</span><span class="p">:</span> <span class="s">&#39;slack&#39;</span>

<span class="nt">receivers</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;slack&#39;</span>
<span class="nt">slack_configs</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">channel</span><span class="p">:</span> <span class="s">&#39;#alerts&#39;</span>
    <span class="nt">icon_emoji</span><span class="p">:</span> <span class="s">&#39;:bell:&#39;</span>
    <span class="nt">send_resolved</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">text</span><span class="p">:</span> <span class="s">&quot;&lt;!channel&gt;</span><span class="nv"> </span><span class="s">\nsummary:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">.CommonAnnotations.message</span><span class="nv"> </span><span class="s">}}\n&quot;</span>
</code></pre></div></li>
<li><code>kubectl logs -n monitoring-namespace  kube-prometheus</code></li>
<li><code>kubectl logs -n monitoring-namespace  kube-prometheus -c alertmanager</code></li>
<li>remove existing secret for the config file and set a new secret (<code>alertmanager-kube-prometheus</code>)</li>
</ul>
</li>
</ul>
</li>
<li>Requests and Limits<ul>
<li>Allow cluster manager to make intelligent decisions </li>
<li>If memory limit reached -&gt; pod remain running, container restart</li>
<li>If cpu limit reached -&gt; cpu clamped/throttled (will not be allowed to go over)
  <div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="nt">containers</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
    <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
    <span class="nt">requests</span><span class="p">:</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;64Mi&quot;</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;250m&quot;</span>
    <span class="nt">limits</span><span class="p">:</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;128Mi&quot;</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;500m&quot;</span>
</code></pre></div></li>
</ul>
</li>
<li>Metrics <ul>
<li>Enable metrics server: <code>minikube addons list</code> <code>minikube addons enable metrics-server</code></li>
<li>View stats: <code>kubectl top pod</code> <code>kubectl top node</code></li>
</ul>
</li>
<li>Dashboard<ul>
<li><code>minikube dashboard</code></li>
</ul>
</li>
<li>Horizontal Pod Autoscaling (HPA)<ul>
<li><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/</a></li>
<li><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/</a></li>
<li><code>kubectl autoscale deployment example-deployment --cpu-percent 400 --min 1 --max 5</code> (relative to the request)</li>
<li><code>kubectl get hpa</code></li>
<li><code>kubectl describe hpa</code></li>
<li><code>kubectl get hpa -o yaml</code>
  <div class="highlight"><pre><span></span><code><span class="nt">behavior</span><span class="p">:</span>
<span class="nt">scaleDown</span><span class="p">:</span>
    <span class="nt">policies</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pods</span>
    <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Percent</span>
    <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
    <span class="nt">periodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
</code></pre></div></li>
</ul>
</li>
<li>Readiness Probe / Liveness Probe<ul>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/</a></li>
<li><code>readiness probes</code> - to decide when the container is available for accepting traffic</li>
<li><code>startup probe</code> - with <code>failureThreshold * periodSeconds</code> long enough to cover the worse case startup time. deal with legacy applications that might require an additional startup time on their first initialization.</li>
<li><code>liveness probes</code> - to know when to restart a container (!live = restart)</li>
</ul>
</li>
<li>QoS and Evection <ul>
<li><a href="https://kubernetes.io/docs/concepts/scheduling-eviction/kube-scheduler/">https://kubernetes.io/docs/concepts/scheduling-eviction/kube-scheduler/</a></li>
<li>A scheduler watches for newly created Pods that have no Node assigned. </li>
<li>For every Pod that the scheduler discovers, the scheduler becomes responsible for finding the best Node for that Pod to run on. </li>
<li>QoS<ul>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/">https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/</a></li>
<li>Guaranteed - Both Limit and Request defined</li>
<li>Burstable - Only Request is defined</li>
<li>BestEffort - No limit or request defined </li>
<li><code>kubectl describe pod</code> shows QoS class</li>
</ul>
</li>
<li>Evicted based on QoS</li>
</ul>
</li>
<li>Pod Priorities    <ul>
<li><a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/">https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/</a></li>
<li>Priority indicates the importance of a Pod relative to other Pods. </li>
<li>If a Pod cannot be scheduled, the scheduler tries to preempt (evict) lower priority Pods to make scheduling of the pending Pod possible.</li>
<li>Only <code>Pod-Priority</code> is used in scheduling new pods </li>
<li>During evection only <code>QoS</code> is considered first and then <code>Pod-Priority</code></li>
</ul>
</li>
<li>RBAC<ul>
<li><code>kubectl get role</code></li>
<li><code>kubectl get rolebinding</code></li>
<li>Super-user<ul>
<li>Create OS user</li>
<li>In k8s create a new namespace <code>kubectl create ns playground</code></li>
<li><code>kubectl config view</code>. Copy API LB endpoint URL. </li>
<li>X.509<ul>
<li>API only accept requests signed by <code>CA</code> within the k8s cluster</li>
<li>Create private-key: <code>openssl genrsa -out private-key-username.key 2048</code></li>
<li>CSR: <code>openssl req -new -key private-key-username.key -out req.csr --subj "/CN=username/O=groupname"</code></li>
<li><code>aws s3 cp s3://storage-name/example.local/pki/private/ca/&lt;number&gt;.key kubernetes.key</code> </li>
<li><code>aws s3 cp s3://storage-name/example.local/pki/issued/ca/&lt;number&gt;.crt kubernetes.crt</code> </li>
<li><code>openssl x509 -req -in req.csr -CA kubernetes.crt -CAkey kubernetes.key -CAcreateserial -out username.crt -days 365</code></li>
<li>Install new certificate with:<ul>
<li><code>cp username.crt /home/.certs/</code></li>
<li><code>cp private-key-username.key /home/.certs/</code></li>
<li><code>cp kubernetes.crt /home/.certs/</code></li>
<li><code>chown -R username:username /home/username/certs</code></li>
</ul>
</li>
</ul>
</li>
<li>Define <code>Role</code> and <code>RoleBinding</code> (to bind role to user).</li>
</ul>
</li>
<li>New user do:<ul>
<li><code>kubectl config set-credential username --client-certificate=username.crt --client-key=private-key-username.key</code></li>
<li><code>kubectl config set-cluster example.local --certificate-authority=kubernetes.crt</code></li>
<li><code>kubectl config set-cluster example.local --server=&lt;api-lb_url&gt;</code></li>
<li>Now new user can: <code>kubectl config set-context mycontext --user my-user-name --cluster example.local</code> <a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/</a></li>
<li>Check config with <code>kubectl config view</code></li>
<li><code>kubectl config use-context mycontext</code></li>
<li>Now new user can <code>kubectl get all</code></li>
</ul>
</li>
<li>Only allowed to access the namespace defined in <code>role</code>.</li>
<li>If all-namespaces should be visible use <code>ClusterRole</code> and <code>ClusterRoleBinding</code>.<ul>
<li>Grant limited permission across cluster. Then use <code>Role</code> section to grant wider permissions on own-cluster. </li>
</ul>
</li>
<li><code>ServiceAccount</code> in <code>RoleBinding</code> is used to grant access to one pod from another. </li>
</ul>
</li>
<li>ConfigMap <ul>
<li>Env variables are unmanageable and may get duplicated, leaving multiple places to change</li>
<li><code>kubectl get cm</code></li>
<li><code>kubectl describe cm</code> </li>
<li>Using config  map<ul>
<li><code>valueFrom</code> -&gt; <code>configMapKeyRef</code><ul>
<li>Still duplicates</li>
<li>When updating:<ul>
<li>Create a new version of the config-map</li>
<li>Change the name referenced</li>
</ul>
</li>
</ul>
</li>
<li><code>envFrom</code> -&gt; <code>configMapKeyRef</code><ul>
<li>all key value paired copied</li>
</ul>
</li>
<li><code>volumeMount</code> and <code>volume</code> -&gt; <code>configMap</code><ul>
<li>Each value of map becomes the file name</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Secrets <ul>
<li>Just prevents you from accidentals printing secret when doing <code>kubectl get secrets</code> </li>
<li>No encryption</li>
<li>RBAC can be used to deny access to <code>secrets</code> while giving access to <code>configMaps</code></li>
<li><code>kubectl get secrets</code> </li>
<li><code>kubectl get secret -n monitoring example -o yaml</code> </li>
<li><code>kubectl get secret -n monitoring example -o json</code></li>
<li><code>kubectl delete secret -n monitoring example -o json</code></li>
<li><code>kubectl create secret -n monitoring example --from-file=example.yaml</code></li>
<li>Hot Reloading of ConfigMaps Spring Cloud Kubernetes Demo: <a href="https://www.youtube.com/watch?v=DiJ0Na8rWvc&amp;t=563s">https://www.youtube.com/watch?v=DiJ0Na8rWvc&amp;t=563s</a></li>
</ul>
</li>
<li>Ingress Controllers<ul>
<li>Accessing Service <ul>
<li>NodePort - Alow defining port and exposing. Port 30,000 and above only. </li>
<li>ClusterIP - Internal access only</li>
<li>LoadBalancer - Provided by the cloud provider<ul>
<li>will require separate LB for each service</li>
</ul>
</li>
<li>LB talk to Ingress Controller (ex Nginx) and IC talk to services</li>
</ul>
</li>
<li><code>kubectl get ingress</code> <code>kubectl describe ingress</code> </li>
<li><code>minikube addons list</code> <code>minikube addons enable ingress</code></li>
<li><a href="https://kubernetes.github.io/ingress-nginx/">https://kubernetes.github.io/ingress-nginx/</a></li>
</ul>
</li>
<li>Batch Jobs <ul>
<li>Pod by default <code>always</code> restarts (restart policy)</li>
<li>Designed to run to completion</li>
</ul>
</li>
<li>DaemonSet<ul>
<li>All nodes run a copy of these pods</li>
</ul>
</li>
<li>StatefulSet <ul>
<li>Pods have predictable names</li>
<li>Startup in sequence</li>
<li>Client can address by name</li>
<li>Example: Primary secondary situation</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>- OpenFaaS Kubeless OpenWisk
- GitLab TravisCI CircleCI
- Promethius Fluentd OpenTracing Jeager 
- Istio LinkerD Consul
- Teraform Helma
</code></pre></div>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h2>
<ul>
<li>Kubernetes RBAC static Analysis &amp; visualisation tool: <a href="https://github.com/appvia/krane">https://github.com/appvia/krane</a></li>
</ul>
<h2 id="security-validations">Security Validations<a class="headerlink" href="#security-validations" title="Permanent link">&para;</a></h2>
<ul>
<li>For internal services, use <code>ClusterIP</code> service-type. (instead of <code>NodePort</code>)</li>
<li>In production all use <code>ClusterIP</code> ??</li>
<li>Are pods stateless?</li>
<li>Are resource requests and limits defined properly.<ul>
<li><code>kubectl describe node minikube</code> (cluster node). <code>Allocatable</code> and <code>Capacity</code>. </li>
</ul>
</li>
<li>If &lt; Java 10 is used &frac14; of RAM is taken for Xmx by default (<code>-Xmx50m</code>)</li>
<li>Readiness Probe / Liveness Probe defined properly</li>
<li><code>kubectl config view --minify</code> to get password of cluster admin user/password. usable to login to cluster API and all services deployed in the cluster including <code>AlertManager</code>:<ul>
<li><code>/api/v1/namespaces/</code></li>
<li><code>/api/v1/namespaces/monitoring/services</code></li>
<li><code>/api/v1/namespaces/monitoring/services/alert-manager-operated:9093/proxy</code></li>
</ul>
</li>
<li>Prometheus: <a href="https://prometheus.io/docs/operating/security/">https://prometheus.io/docs/operating/security/</a></li>
<li>Audit RBAC configuration<ul>
<li>API groups are defined properly without using <code>*</code></li>
<li>Check <code>ClusterRole</code> for cluster wide permissions </li>
</ul>
</li>
<li>K8s API only accepts requests signed by <code>CA</code> within the k8s cluster</li>
<li>Make sure cluster key is stored securely. <ul>
<li><code>kops</code>: <code>KOPS_STATE_STORE</code> (s3 bucket) contains this. <code>cluster_folder/pki/private/ca/&lt;number&gt;.key</code> and <code>pki/issued/ca/&lt;number&gt;.crt</code>.<ul>
<li><code>aws s3 ls s3://storage-name/example.local/pki/private/ca/&lt;number&gt;.key</code></li>
<li><code>aws s3 cp s3://storage-name/example.local/pki/private/ca/&lt;number&gt;.key kubernetes.key</code> </li>
<li><code>aws s3 cp s3://storage-name/example.local/pki/issued/ca/&lt;number&gt;.crt</code> </li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="cluster-api">Cluster API<a class="headerlink" href="#cluster-api" title="Permanent link">&para;</a></h2>
<ul>
<li>Bring declarative k8s style APIs to cluster creation, configuration and management.</li>
</ul>
<h2 id="new-references">New References<a class="headerlink" href="#new-references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/Salaboy/orchestrating-cloud-events">https://github.com/Salaboy/orchestrating-cloud-events</a></li>
<li>Understanding Kubernetes limits and requests by example: <a href="https://sysdig.com/blog/kubernetes-limits-requests/">https://sysdig.com/blog/kubernetes-limits-requests/</a></li>
<li>Understanding Kubernetes pod evicted and scheduling problems: <a href="https://sysdig.com/blog/kubernetes-pod-evicted/">https://sysdig.com/blog/kubernetes-pod-evicted/</a></li>
<li>How to troubleshoot Kubernetes OOM and CPU Throttle: <a href="https://sysdig.com/blog/troubleshoot-kubernetes-oom/">https://sysdig.com/blog/troubleshoot-kubernetes-oom/</a></li>
</ul>
<h2 id="teraform">Teraform<a class="headerlink" href="#teraform" title="Permanent link">&para;</a></h2>
<ul>
<li>Server provisioning </li>
<li>Two steps:<ul>
<li>Initialize: <code>terraform init</code></li>
<li>Validate: <code>terraform validate</code></li>
<li>Plan: <code>terraform plan</code></li>
<li>Execute: <code>teraform apply</code></li>
</ul>
</li>
<li><code>terraform console</code><ul>
<li>Resources are referenced as <type>.<name>: Example: <code>aws_s3_bucket.my_s3_bucket</code></li>
</ul>
</li>
<li>Types: <code>resource</code> <code>output</code> <code>variable</code> <code>lists</code> <code>maps</code> <code>provisioner</code> <code>connection</code></li>
<li><code>terfaform.tfstate</code> <code>terfaform.tfstate.backup</code> and <code>.teraform</code> must not be commited. Contains secrets in plain text. </li>
<li>When state needs to be shared, store the state inside a <code>Remote Backend</code>.</li>
<li>Create multiple resources: <code>count  = 2 \n name="my_user_${count.index}"</code></li>
<li><code>teraform show</code> <code>teraform fmt</code></li>
<li>Assign to variable from environment variables: <code>TF_VAR_&lt;variable_name&gt;="&lt;value&gt;"</code></li>
<li>Best Practice: Create separate projects for resources that might have similar lifecycle. One application would have multiple projects. </li>
<li>Best Practice: Use immutable servers - Once you provision a server and a change is required, just remove the old server and prosition a new one. Do not do tweeks.</li>
<li>Make things dynamic:<ul>
<li><code>aws_default_vpc</code> special resources that is not created / destroyed by Teraform. </li>
<li><code>data_provider</code> <code>aws_subnet_ids</code> to get list of subnets  within the VPC</li>
<li><code>aws_security_group</code></li>
<li><code>data_provider</code> <code>aws_ami</code> <code>aws_ami_ids</code> (most_recent: true)</li>
</ul>
</li>
<li><code>teraform graph</code> -&gt; Graphwiz  </li>
<li>Storing state into S3<ul>
<li>Create S3 bucket: lifecycle, versioning, server_side_encryption_configuration</li>
<li>Create aws_dynamodb_table for locks: Attribute(LockID/S)</li>
<li>terraform -&gt; backend "s3" -&gt; point to s3 and dynamodb.. name  should be unique:  application/project/type/envitronment<ul>
<li>application_name, project_name, environment can be variables</li>
</ul>
</li>
</ul>
</li>
<li>Workspaces<ul>
<li>Track multiple environments</li>
<li><code>teraform workspace show</code></li>
<li><code>teraform workspace list</code></li>
<li><code>teraform workspace new prod-env</code></li>
<li><code>teraform workspace select prod-env</code></li>
<li>Use <code>${teraform.workspace}</code> to add the workspace name to resources</li>
</ul>
</li>
<li>Modules<ul>
<li>Create <code>teraform-modules</code> dir and in it create modules for different resources</li>
<li>Create <code>dev</code>  <code>prod</code> folders. In these folders in main.tf add variable for environment. <ul>
<li><code>module "user_module" { source = "../../teraform-modules/users" environment = "dev"}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>    brew install terraform
    terraform --version
    terraform version
    terraform init
    export AWS_ACCESS_KEY_ID=*******
    export AWS_SECRET_ACCESS_KEY=*********
    terraform plan
    terraform console
    terraform apply -refresh=false
    terraform plan -out iam.tfplan
    terraform apply &quot;iam.tfplan&quot;
    terraform apply -target=aws_iam_user.my_iam_user
    terraform destroy
    terraform validate
    terraform fmt
    terraform show
    export TF_VAR_iam_user_name_prefix = FROM_ENV_VARIABLE_IAM_PREFIX
    export TF_VAR_iam_user_name_prefix=FROM_ENV_VARIABLE_IAM_PREFIX
    terraform plan -refresh=false -var=&quot;iam_user_name_prefix=VALUE_FROM_COMMAND_LINE&quot;
    terraform apply -target=aws_default_vpc.default
    terraform apply -target=data.aws_subnet_ids.default_subnets
    terraform apply -target=data.aws_ami_ids.aws_linux_2_latest_ids
    terraform apply -target=data.aws_ami.aws_linux_2_latest
    terraform workspace show
    terraform workspace new prod-env
    terraform workspace select default
    terraform workspace list
    terraform workspace select prod-env
</code></pre></div>
<h2 id="networking">Networking<a class="headerlink" href="#networking" title="Permanent link">&para;</a></h2>
<ul>
<li>Flannel </li>
<li>Calico</li>
<li>Canel = Flannel + Network Policy (Calico)</li>
<li>Weave </li>
<li>CNI has less performance than VXLAN</li>
<li>Azure Network CNI plugin </li>
<li>IPSec </li>
</ul>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<ul>
<li>Layer 0 - Kernel<ul>
<li>Check allowed syscalls and restrict</li>
<li>Improve sandbox with<ul>
<li>gViser </li>
<li>Kata container</li>
<li>AWS Firecracker </li>
</ul>
</li>
<li>Keep kernel updated</li>
</ul>
</li>
<li>Layer 1 - The container <ul>
<li>Build<ul>
<li>Remove unnecessary tools </li>
<li>Lightweight image </li>
<li>Scan images </li>
<li>Known sources </li>
<li>Check integrity </li>
</ul>
</li>
<li>Run<ul>
<li>Epherminal containers for live debugging (never exec into running container)</li>
<li>Hook into running container and watch for anomalies <ul>
<li>EBPF</li>
<li>sysdig</li>
<li>falko</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
</li>
<li>Layer 2 - The workloads <ul>
<li>Pod security context <ul>
<li></li>
</ul>
</li>
</ul>
</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../istio/" title="Istio" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Istio
              </span>
            </div>
          </a>
        
        
          <a href="../../windows/active-directory/" title="Active Directory" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Active Directory
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
    
  </body>
</html>